# ç®¡ç†å‘˜å‘å¸ƒå¤šäººä»»åŠ¡åŠŸèƒ½å¼€å‘æ—¥å¿—

> **ç‰ˆæœ¬**: v1.5  
> **åˆ›å»ºæ—¥æœŸ**: 2025-01-20  
> **æœ€åŽæ›´æ–°**: 2025-01-20  
> **è®¾è®¡åŽŸåˆ™**: å‘åŽå…¼å®¹ã€å¯æ‰©å±•ã€å®‰å…¨ä¼˜å…ˆ  
> **é‡è¦è¯´æ˜Ž**: æœ¬æ–‡æ¡£æè¿°ç®¡ç†å‘˜å‘å¸ƒå¤šäººä»»åŠ¡åŠŸèƒ½çš„å®Œæ•´å¼€å‘æ–¹æ¡ˆ

---

## ðŸ“‹ éœ€æ±‚æ¦‚è¿°

å¼€å‘ç®¡ç†å‘˜å¯ä»¥å‘å¸ƒå¤šäººä»»åŠ¡çš„åŠŸèƒ½ï¼Œå…è®¸ä¸€ä¸ªä»»åŠ¡ç”±å¤šä¸ªç”¨æˆ·åä½œå®Œæˆã€‚ä¸ŽçŽ°æœ‰çš„å•äººä»»åŠ¡ç³»ç»Ÿï¼ˆä¸€ä¸ªä»»åŠ¡åªèƒ½è¢«ä¸€ä¸ªç”¨æˆ·æŽ¥å—ï¼‰ä¸åŒï¼Œå¤šäººä»»åŠ¡å¯ä»¥è®¾ç½®æœ€å¤§å‚ä¸Žäººæ•°ï¼Œå…è®¸å¤šä¸ªç”¨æˆ·åŒæ—¶å‚ä¸Žå®Œæˆã€‚

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- **ç®¡ç†å‘˜å‘å¸ƒå®˜æ–¹å¤šäººä»»åŠ¡**ï¼šç®¡ç†å‘˜å¯ä»¥åˆ›å»ºéœ€è¦å¤šäººåä½œå®Œæˆçš„ä»»åŠ¡ï¼Œæ ‡è®°ä¸º"å®˜æ–¹ä»»åŠ¡"ï¼Œæ‰€æœ‰äººéƒ½å¯ä»¥çœ‹åˆ°å’Œç”³è¯·
- **ä»»åŠ¡è¾¾äººå‘å¸ƒå¤šäººä»»åŠ¡**ï¼šä»»åŠ¡è¾¾äººï¼ˆå…·æœ‰ç‰¹å®šæœåŠ¡æŠ€èƒ½çš„ç”¨æˆ·ï¼‰ä¹Ÿå¯ä»¥åˆ›å»ºå¤šäººä»»åŠ¡ï¼Œæä¾›å›ºå®šæ—¶é—´æ®µå›ºå®šäººæ•°çš„æœåŠ¡
- **å›ºå®šæ—¶é—´æ®µå›ºå®šäººæ•°æœåŠ¡**ï¼šä»»åŠ¡è¾¾äººå¯ä»¥ä¸ºç‰¹å®šæœåŠ¡è®¾ç½®å›ºå®šæ—¶é—´æ®µå’Œæ¯ä¸ªæ—¶é—´æ®µçš„äººæ•°é™åˆ¶ï¼ˆå¦‚ï¼šéº»å°†æœåŠ¡ï¼Œæ¯å°æ—¶ä¸€ä¸ªæ—¶é—´æ®µï¼Œæ¯ä¸ªæ—¶é—´æ®µ4äººï¼Œä»Žä¸­åˆåˆ°æ™šä¸Šï¼‰
- **éžå›ºå®šæ—¶é—´æ®µæœåŠ¡**ï¼šä»»åŠ¡è¾¾äººä¹Ÿå¯ä»¥ä¸è®¾ç½®å›ºå®šæ—¶é—´æ®µï¼Œç”³è¯·äººéœ€è¦é€‰æ‹©æˆªæ­¢æ—¥æœŸæˆ–çµæ´»æ—¶é—´ï¼ˆå¦‚ï¼šæ‘„å½±æœåŠ¡ï¼Œç”³è¯·äººå¯é€‰æ‹©æœŸæœ›å®Œæˆæ—¥æœŸæˆ–é€‰æ‹©æ—¶é—´çµæ´»ï¼‰
- **è‡ªåŠ¨æŽ¥å—æœºåˆ¶**ï¼šå®˜æ–¹å¤šäººä»»åŠ¡ä¸éœ€è¦ç®¡ç†å‘˜åŒæ„ï¼Œç”¨æˆ·ç”³è¯·åŽè‡ªåŠ¨æŽ¥å—å¹¶ç«‹å³è¿›å…¥ä»»åŠ¡èŠå¤©å®¤
- **å¤šäººç”³è¯·æœºåˆ¶**ï¼šå¤šä¸ªç”¨æˆ·å¯ä»¥å¯¹åŒä¸€ä»»åŠ¡è¿›è¡Œç”³è¯·ï¼Œè¾¾åˆ°æœ€å¤§å‚ä¸Žäººæ•°åŽåœæ­¢æŽ¥å—ç”³è¯·
- **å‚ä¸Žäººæ•°é™åˆ¶**ï¼šä»»åŠ¡å¯ä»¥è®¾ç½®æœ€å¤§å‚ä¸Žäººæ•°ï¼ˆå¦‚ï¼šéœ€è¦7äººå®Œæˆï¼‰
- **å‚ä¸ŽçŠ¶æ€ç®¡ç†**ï¼šè·Ÿè¸ªæ¯ä¸ªå‚ä¸Žè€…çš„çŠ¶æ€ï¼ˆå·²æŽ¥å—ã€è¿›è¡Œä¸­ã€å·²å®Œæˆã€é€€å‡ºç”³è¯·ä¸­ï¼‰
- **ä»»åŠ¡å®Œæˆåˆ¤å®š**ï¼šå¯ä»¥è®¾ç½®å®Œæˆæ¡ä»¶ï¼ˆå¦‚ï¼šæ‰€æœ‰å‚ä¸Žè€…å®Œæˆã€æˆ–è¾¾åˆ°æœ€å°å®Œæˆäººæ•°ï¼‰
- **ç§¯åˆ†å¥–åŠ±æœºåˆ¶**ï¼šå¤šäººä»»åŠ¡å¯ä»¥åªä½¿ç”¨ç§¯åˆ†å¥–åŠ±ï¼Œä¸éœ€è¦çŽ°é‡‘å¥–åŠ±
- **é€€å‡ºç”³è¯·æœºåˆ¶**ï¼šå‚ä¸Žè€…é€€å‡ºä»»åŠ¡éœ€è¦ç”³è¯·ï¼Œç­‰å¾…ç®¡ç†å‘˜å®¡æ ¸
- **ç¦æ­¢è®®ä»·**ï¼šå¤šäººä»»åŠ¡ä¸æ”¯æŒè®®ä»·åŠŸèƒ½ï¼ˆ`allow_negotiation=false`ï¼‰ï¼Œç”¨æˆ·ä¸èƒ½å¯¹ä»»åŠ¡ä»·æ ¼è¿›è¡Œè®®ä»·
- **ä»»åŠ¡è¾¾äººæŠ˜æ‰£åŠŸèƒ½**ï¼šè™½ç„¶å¤šäººä»»åŠ¡ä¸æ”¯æŒè®®ä»·ï¼Œä½†ä»»åŠ¡è¾¾äººå¯ä»¥åœ¨å‘å¸ƒä»»åŠ¡æ—¶è®¾ç½®æŠ˜æ‰£ï¼Œç”¨äºŽæŽ¨å¹¿æœåŠ¡æˆ–å¡«è¡¥ç‰¹å®šæ—¶é—´æ®µç©ºç¼ºï¼ˆå¦‚ï¼šåŽŸä»·10é•‘ï¼ŒçŽ°ä»·8é•‘ï¼Œæ‰“8æŠ˜ï¼‰
- **å³æ—¶èŠå¤©**ï¼šç”¨æˆ·ç”³è¯·åŽç«‹å³è¿›å…¥ä»»åŠ¡èŠå¤©å®¤ï¼Œå¯ä»¥ä¸Žå…¶ä»–å‚ä¸Žè€…èŠå¤©
- **å‘åŽå…¼å®¹**ï¼šä¸å½±å“çŽ°æœ‰çš„å•äººä»»åŠ¡ç³»ç»Ÿ

**ä¸šåŠ¡ä»·å€¼ï¼š**
- æ”¯æŒéœ€è¦å¤šäººåä½œçš„å¤§åž‹ä»»åŠ¡
- æé«˜ä»»åŠ¡å®Œæˆæ•ˆçŽ‡
- å¢žåŠ å¹³å°ä»»åŠ¡ç±»åž‹å¤šæ ·æ€§
- æå‡ç”¨æˆ·å‚ä¸Žåº¦å’Œæ´»è·ƒåº¦
- é€šè¿‡å®˜æ–¹ä»»åŠ¡æå‡å¹³å°æƒå¨æ€§å’Œç”¨æˆ·ä¿¡ä»»åº¦
- ä»»åŠ¡è¾¾äººæŠ˜æ‰£åŠŸèƒ½å¸®åŠ©æŽ¨å¹¿æœåŠ¡ã€å¡«è¡¥ç‰¹å®šæ—¶é—´æ®µç©ºç¼ºã€æé«˜ä¸Šåº§çŽ‡

---

## ðŸŽ¯ MVP èŒƒå›´è¯´æ˜Žï¼ˆv1.0 å¿…é¡»å®žçŽ°ï¼‰

### æœ¬æ¬¡è¿­ä»£å¿…é¡»å®žçŽ°çš„åŠŸèƒ½

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- âœ… ç®¡ç†å‘˜åˆ›å»ºå®˜æ–¹å¤šäººä»»åŠ¡ï¼ˆä»…æ”¯æŒç§¯åˆ†å¥–åŠ±ï¼‰
- âœ… ç”¨æˆ·ç”³è¯·å‚ä¸Žï¼ˆå®˜æ–¹ä»»åŠ¡è‡ªåŠ¨æŽ¥å—ï¼‰
- âœ… ä»»åŠ¡èŠå¤©å®¤ï¼ˆç”³è¯·åŽè‡ªåŠ¨åŠ å…¥ï¼‰
- âœ… å‚ä¸Žè€…é€€å‡ºç”³è¯·
- âœ… ç®¡ç†å‘˜æ‰¹å‡†/æ‹’ç»é€€å‡ºç”³è¯·
- âœ… ç®¡ç†å‘˜æ‰‹åŠ¨å¼€å§‹ä»»åŠ¡ï¼ˆä¸æ”¯æŒè‡ªåŠ¨å¼€å§‹ï¼‰
- âœ… å‚ä¸Žè€…æäº¤å®Œæˆ
- âœ… ç®¡ç†å‘˜ç¡®è®¤å®Œæˆå¹¶åˆ†é…å¥–åŠ±ï¼ˆä»…æ”¯æŒå¹³å‡åˆ†é…ç§¯åˆ†ï¼‰

**æ•°æ®åº“å­—æ®µ**ï¼š
- âœ… æ‰€æœ‰å¿…è¦å­—æ®µï¼ˆä¸ºæœªæ¥æ‰©å±•é¢„ç•™å­—æ®µï¼Œä½†ä¸šåŠ¡é€»è¾‘æš‚ä¸ä½¿ç”¨ï¼‰
- âš ï¸ `current_participants`ï¼šMVPé˜¶æ®µå¯ä»¥ä¸å­˜ï¼Œå®žæ—¶ `COUNT(*)`
- âš ï¸ `planned_reward_amount` / `planned_points_reward`ï¼šMVPé˜¶æ®µå¯ä»¥ä¸å­˜ï¼Œä»…åœ¨å¥–åŠ±åˆ†é…æ—¶è®¡ç®—

**é™åˆ¶æ¡ä»¶**ï¼š
- âŒ ä¸æ”¯æŒçŽ°é‡‘å¥–åŠ±ï¼ˆä»…æ”¯æŒç§¯åˆ†å¥–åŠ±ï¼‰
- âŒ ä¸æ”¯æŒè‡ªå®šä¹‰å¥–åŠ±åˆ†é…ï¼ˆä»…æ”¯æŒå¹³å‡åˆ†é…ï¼‰
- âŒ ä¸æ”¯æŒè¿Ÿåˆ°åŠ å…¥ï¼ˆä»»åŠ¡å¼€å§‹åŽç¦æ­¢æ–°æˆå‘˜ç”³è¯·ï¼‰
- âŒ ä¸æ”¯æŒè‡ªåŠ¨å¼€å§‹ï¼ˆä»…ç®¡ç†å‘˜æ‰‹åŠ¨å¼€å§‹ï¼‰
- âŒ ä¸æ”¯æŒæ™®é€šç”¨æˆ·å‘å¸ƒå¤šäººä»»åŠ¡ï¼ˆä»…ç®¡ç†å‘˜ï¼‰

### æœªæ¥æ‰©å±•ï¼ˆä¸åœ¨æœ¬æ¬¡è¿­ä»£å†…ï¼‰

ä»¥ä¸‹åŠŸèƒ½åœ¨æ–‡æ¡£ä¸­å·²è®¾è®¡ï¼Œä½†**ä¸åœ¨ v1.0 å®žçŽ°èŒƒå›´**ï¼š
- ä»»åŠ¡è¾¾äººå‘å¸ƒå¤šäººä»»åŠ¡ï¼ˆv1.0 ä»…æ”¯æŒç®¡ç†å‘˜å‘å¸ƒï¼‰
- ä»»åŠ¡è¾¾äººè®¾ç½®å›ºå®šæ—¶é—´æ®µå›ºå®šäººæ•°æœåŠ¡ï¼ˆv1.0 æš‚ä¸æ”¯æŒï¼‰
- è‡ªåŠ¨å¼€å§‹åŠŸèƒ½ï¼ˆè¾¾åˆ° min_participants è‡ªåŠ¨å¼€å§‹ï¼‰
- è¿Ÿåˆ°åŠ å…¥åŠŸèƒ½ï¼ˆä»»åŠ¡è¿›è¡Œä¸­è¡¥æ‹›ï¼‰
- çŽ°é‡‘å¥–åŠ±æˆ–çŽ°é‡‘+ç§¯åˆ†å¥–åŠ±
- è‡ªå®šä¹‰å¥–åŠ±åˆ†é…
- å¤æ‚å–æ¶ˆå’Œé€€æ¬¾æµç¨‹ï¼ˆv1.0 ä»…æ”¯æŒåŸºç¡€å–æ¶ˆï¼‰

**å®žçŽ°å»ºè®®**ï¼š
- æ•°æ®åº“å­—æ®µå¯ä»¥æå‰é¢„ç•™ï¼Œä½†ä¸šåŠ¡é€»è¾‘å’Œæµ‹è¯•ä¼˜å…ˆåªå®žçŽ° MVP åŠŸèƒ½
- è¿™æ ·å¯ä»¥å¤§å¤§å‡å°‘ç¬¬ä¸€æ¬¡ä¸Šçº¿çš„çŠ¶æ€ç»„åˆï¼Œæµ‹è¯•å·¥ä½œé‡ä¹Ÿä¼šå°å¾ˆå¤š
- åŽç»­ç‰ˆæœ¬å†é€æ­¥æ‰“å¼€æ‰©å±•åŠŸèƒ½

---

## ðŸ—„ï¸ æ•°æ®åº“æ¨¡åž‹è®¾è®¡

### 1. ä¿®æ”¹ Task è¡¨

**é‡è¦è¯´æ˜Ž**ï¼šå¤šäººä»»åŠ¡ä»ç„¶åˆ›å»ºåœ¨ `tasks` è¡¨ä¸­ï¼Œä¸Žå•äººä»»åŠ¡å…±äº«åŒä¸€å¼ è¡¨ã€‚é€šè¿‡ `is_multi_participant` å­—æ®µåŒºåˆ†ä»»åŠ¡ç±»åž‹ã€‚

**å‘å¸ƒè€…å’ŒæŽ¥æ”¶è€…å¤„ç†**ï¼ˆé‡è¦ä¸šåŠ¡é€»è¾‘ï¼‰ï¼š
- **ä»»åŠ¡è¾¾äººå‘å¸ƒçš„å¤šäººä»»åŠ¡**ï¼ˆ`created_by_expert=true`ï¼‰ï¼š
  - **ä»»åŠ¡è¾¾äººæ˜¯æŽ¥æ”¶è€…ï¼ˆtaker_idï¼‰**ï¼šä»»åŠ¡è¾¾äººæä¾›æœåŠ¡ï¼Œç”¨æˆ·ä»˜è´¹ï¼Œæ‰€ä»¥ä»»åŠ¡è¾¾äººæ˜¯æ”¶é’±çš„ä¸€æ–¹
  - **ç”¨æˆ·æ˜¯å‚ä¸Žè€…ï¼ˆtask_participantsï¼‰**ï¼šç”³è¯·å‚ä¸Žçš„ç”¨æˆ·æ˜¯ä»˜è´¹æ–¹ï¼Œå­˜å‚¨åœ¨ `task_participants` è¡¨ä¸­
  - **poster_id**ï¼šå¯ä»¥è®¾ç½®ä¸ºç³»ç»Ÿç”¨æˆ·IDæˆ–NULLï¼ˆæ ¹æ®ä¸šåŠ¡éœ€æ±‚ï¼Œä»»åŠ¡è¾¾äººä½œä¸ºæœåŠ¡æä¾›è€…ï¼Œä¸æ˜¯ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„"å‘å¸ƒè€…"ï¼‰
  - **ç¤ºä¾‹**ï¼šéº»å°†æœåŠ¡ï¼Œä»»åŠ¡è¾¾äººæä¾›éº»å°†æ¡Œå’ŒæœåŠ¡ï¼Œç”¨æˆ·ä»˜è´¹å‚ä¸Žï¼Œä»»åŠ¡è¾¾äººæ”¶é’±
  
- **ç®¡ç†å‘˜å‘å¸ƒçš„å¤šäººä»»åŠ¡**ï¼ˆ`created_by_admin=true`ï¼‰ï¼š
  - **æ ¹æ®ä»»åŠ¡ç±»åž‹å†³å®šè§’è‰²**ï¼š
    - **æ”¶é’±ä»»åŠ¡**ï¼ˆç”¨æˆ·ä»˜è´¹ç»™å¹³å°/ç®¡ç†å‘˜ï¼‰ï¼šç®¡ç†å‘˜æ˜¯æŽ¥æ”¶è€…ï¼ˆ`taker_id`ï¼‰ï¼Œç”¨æˆ·æ˜¯å‚ä¸Žè€…ï¼ˆ`task_participants`ï¼‰
    - **å‘é’±ä»»åŠ¡**ï¼ˆå¹³å°/ç®¡ç†å‘˜ä»˜è´¹ç»™ç”¨æˆ·ï¼‰ï¼šç®¡ç†å‘˜æ˜¯å‘å¸ƒè€…ï¼ˆ`poster_id`ï¼‰ï¼Œç”¨æˆ·æ˜¯å‚ä¸Žè€…ï¼ˆ`task_participants`ï¼‰ï¼Œ`taker_id` ä¸º NULL
  - **åˆ¤æ–­ä¾æ®**ï¼šæ ¹æ®ä»»åŠ¡çš„ `reward_type` å’Œä¸šåŠ¡é€»è¾‘åˆ¤æ–­æ˜¯æ”¶é’±è¿˜æ˜¯å‘é’±
  - **ç¤ºä¾‹**ï¼š
    - æ”¶é’±ä»»åŠ¡ï¼šå¹³å°ç»„ç»‡çš„ä»˜è´¹æ´»åŠ¨ï¼Œç”¨æˆ·ä»˜è´¹å‚ä¸Žï¼Œå¹³å°æ”¶é’±
    - å‘é’±ä»»åŠ¡ï¼šå¹³å°å‘å¸ƒçš„å¥–åŠ±ä»»åŠ¡ï¼Œç”¨æˆ·å®Œæˆä»»åŠ¡åŽèŽ·å¾—å¥–åŠ±ï¼Œå¹³å°å‘é’±

- **å‚ä¸Žè€…ï¼ˆtask_participantsï¼‰**ï¼š
  - æ‰€æœ‰å‚ä¸Žè€…ä¿¡æ¯å­˜å‚¨åœ¨ `task_participants` è¡¨ä¸­
  - é€šè¿‡ `task_participants` è¡¨å…³è”æŸ¥è¯¢æ‰€æœ‰å‚ä¸Žè€…
  - å‚ä¸Žè€…å¯èƒ½æ˜¯ä»˜è´¹æ–¹ï¼ˆä»»åŠ¡è¾¾äºº/ç®¡ç†å‘˜æ”¶é’±ï¼‰æˆ–å¥–åŠ±æŽ¥æ”¶æ–¹ï¼ˆå¹³å°å‘é’±ï¼‰

æ·»åŠ å¤šäººä»»åŠ¡ç›¸å…³å­—æ®µï¼š

```sql
ALTER TABLE tasks ADD COLUMN is_multi_participant BOOLEAN DEFAULT false;  -- æ˜¯å¦ä¸ºå¤šäººä»»åŠ¡
ALTER TABLE tasks ADD COLUMN is_official_task BOOLEAN DEFAULT false;  -- æ˜¯å¦ä¸ºå®˜æ–¹ä»»åŠ¡ï¼ˆç®¡ç†å‘˜å‘å¸ƒï¼‰
ALTER TABLE tasks ADD COLUMN max_participants INTEGER DEFAULT 1;  -- æœ€å¤§å‚ä¸Žäººæ•°ï¼ˆé»˜è®¤1ï¼Œä¿æŒå‘åŽå…¼å®¹ï¼‰
ALTER TABLE tasks ADD COLUMN min_participants INTEGER DEFAULT 1;  -- æœ€å°å‚ä¸Žäººæ•°ï¼ˆç”¨äºŽåˆ¤å®šä»»åŠ¡æ˜¯å¦å¯å¼€å§‹ï¼‰
ALTER TABLE tasks ADD COLUMN current_participants INTEGER DEFAULT 0;  -- å½“å‰å‚ä¸Žäººæ•°
ALTER TABLE tasks ADD COLUMN completion_rule VARCHAR(20) DEFAULT 'all';  -- å®Œæˆè§„åˆ™ï¼šallï¼ˆæ‰€æœ‰äººå®Œæˆï¼‰ã€minï¼ˆè¾¾åˆ°æœ€å°äººæ•°å³å¯ï¼‰
ALTER TABLE tasks ADD COLUMN reward_distribution VARCHAR(20) DEFAULT 'equal';  -- å¥–åŠ±åˆ†é…æ–¹å¼ï¼šequalï¼ˆå¹³å‡åˆ†é…ï¼‰ã€customï¼ˆè‡ªå®šä¹‰ï¼‰
ALTER TABLE tasks ADD COLUMN reward_type VARCHAR(20) DEFAULT 'cash';  -- å¥–åŠ±ç±»åž‹ï¼šcashï¼ˆçŽ°é‡‘ï¼‰ã€pointsï¼ˆç§¯åˆ†ï¼‰ã€bothï¼ˆçŽ°é‡‘+ç§¯åˆ†ï¼‰
ALTER TABLE tasks ADD COLUMN points_reward BIGINT DEFAULT 0;  -- ç§¯åˆ†å¥–åŠ±ï¼ˆå¦‚æžœreward_typeåŒ…å«pointsï¼‰
ALTER TABLE tasks ADD COLUMN auto_accept BOOLEAN DEFAULT false;  -- æ˜¯å¦è‡ªåŠ¨æŽ¥å—ç”³è¯·ï¼ˆå®˜æ–¹ä»»åŠ¡é»˜è®¤trueï¼‰
ALTER TABLE tasks ADD COLUMN allow_negotiation BOOLEAN DEFAULT true;  -- æ˜¯å¦å…è®¸è®®ä»·ï¼ˆå¤šäººä»»åŠ¡é»˜è®¤falseï¼‰
ALTER TABLE tasks ADD COLUMN created_by_admin BOOLEAN DEFAULT false;  -- æ˜¯å¦ç”±ç®¡ç†å‘˜åˆ›å»º
ALTER TABLE tasks ADD COLUMN admin_creator_id VARCHAR(36) REFERENCES admin_users(id);  -- åˆ›å»ºä»»åŠ¡çš„ç®¡ç†å‘˜IDï¼ˆä½¿ç”¨UUIDæ ¼å¼ï¼Œä¸Žadmin_usersè¡¨ä¸€è‡´ï¼‰
ALTER TABLE tasks ADD COLUMN created_by_expert BOOLEAN DEFAULT false;  -- æ˜¯å¦ç”±ä»»åŠ¡è¾¾äººåˆ›å»º
ALTER TABLE tasks ADD COLUMN expert_creator_id VARCHAR(8) REFERENCES users(id);  -- åˆ›å»ºä»»åŠ¡çš„ä»»åŠ¡è¾¾äººIDï¼ˆä½¿ç”¨VARCHAR(8)æ ¼å¼ï¼Œä¸Žusersè¡¨ä¸€è‡´ï¼‰
ALTER TABLE tasks ADD COLUMN expert_service_id INTEGER REFERENCES task_expert_services(id) ON DELETE RESTRICT;  -- å…³è”çš„è¾¾äººæœåŠ¡IDï¼ˆä»»åŠ¡è¾¾äººå‘å¸ƒçš„å¤šäººä»»åŠ¡å¿…é¡»å…³è”ä¸€ä¸ªè¾¾äººæœåŠ¡ï¼‰
ALTER TABLE tasks ADD COLUMN is_fixed_time_slot BOOLEAN DEFAULT false;  -- æ˜¯å¦ä¸ºå›ºå®šæ—¶é—´æ®µæœåŠ¡ï¼ˆä»»åŠ¡è¾¾äººå¯è®¾ç½®ï¼Œå¯é€‰ï¼‰
ALTER TABLE tasks ADD COLUMN time_slot_duration_minutes INTEGER;  -- æ—¶é—´æ®µæ—¶é•¿ï¼ˆåˆ†é’Ÿï¼Œå¦‚60è¡¨ç¤º1å°æ—¶ï¼Œ120è¡¨ç¤º2å°æ—¶ç­‰ï¼Œä»…å½“is_fixed_time_slot=trueæ—¶ä½¿ç”¨ï¼‰
ALTER TABLE tasks ADD COLUMN time_slot_start_time TIME;  -- æ—¶é—´æ®µå¼€å§‹æ—¶é—´ï¼ˆå¦‚12:00è¡¨ç¤ºä¸­åˆ12ç‚¹å¼€å§‹ï¼Œä»…å½“is_fixed_time_slot=trueæ—¶ä½¿ç”¨ï¼‰
ALTER TABLE tasks ADD COLUMN time_slot_end_time TIME;  -- æ—¶é—´æ®µç»“æŸæ—¶é—´ï¼ˆå¦‚22:00è¡¨ç¤ºæ™šä¸Š10ç‚¹ç»“æŸï¼Œä»…å½“is_fixed_time_slot=trueæ—¶ä½¿ç”¨ï¼‰
ALTER TABLE tasks ADD COLUMN participants_per_slot INTEGER;  -- æ¯ä¸ªæ—¶é—´æ®µçš„äººæ•°é™åˆ¶ï¼ˆå¦‚4äººï¼Œä»…å½“is_fixed_time_slot=trueæ—¶ä½¿ç”¨ï¼‰
ALTER TABLE tasks ADD COLUMN original_price_per_participant DECIMAL(12, 2);  -- åŽŸä»·ï¼ˆæ¯äººï¼Œä»…ç”¨äºŽä»»åŠ¡è¾¾äººå‘å¸ƒçš„å¤šäººä»»åŠ¡æ˜¾ç¤ºæŠ˜æ‰£ï¼‰
ALTER TABLE tasks ADD COLUMN discount_percentage DECIMAL(5, 2);  -- æŠ˜æ‰£ç™¾åˆ†æ¯”ï¼ˆ0-100ï¼Œå¦‚20è¡¨ç¤ºæ‰“8æŠ˜ï¼Œä»…ç”¨äºŽä»»åŠ¡è¾¾äººå‘å¸ƒçš„å¤šäººä»»åŠ¡ï¼‰
ALTER TABLE tasks ADD COLUMN discounted_price_per_participant DECIMAL(12, 2);  -- æŠ˜æ‰£åŽä»·æ ¼ï¼ˆæ¯äººï¼Œä»…ç”¨äºŽä»»åŠ¡è¾¾äººå‘å¸ƒçš„å¤šäººä»»åŠ¡ï¼‰

-- æ·»åŠ æ•°æ®åº“çº§CHECKçº¦æŸï¼ˆè·¨å­—æ®µéªŒè¯ï¼‰
ALTER TABLE tasks ADD CONSTRAINT chk_tasks_participants_range CHECK (
    max_participants >= min_participants AND min_participants >= 1
);
ALTER TABLE tasks ADD CONSTRAINT chk_tasks_reward_non_negative CHECK (
    (reward IS NULL OR reward >= 0) AND (points_reward IS NULL OR points_reward >= 0)
);
ALTER TABLE tasks ADD CONSTRAINT chk_tasks_reward_type_consistency CHECK (
    (reward_type = 'cash' AND reward > 0 AND (points_reward IS NULL OR points_reward = 0)) OR
    (reward_type = 'points' AND points_reward > 0 AND (reward IS NULL OR reward = 0)) OR
    (reward_type = 'both' AND reward > 0 AND points_reward > 0)
);
-- MVP é™åˆ¶çº¦æŸï¼ˆv1.0 ä»…æ”¯æŒå®˜æ–¹å¤šäººç§¯åˆ†ä»»åŠ¡ + å¹³å‡åˆ†é…ï¼Œæœªæ¥å¯èƒ½ç§»é™¤ï¼‰
ALTER TABLE tasks ADD CONSTRAINT chk_mvp_official_multi_points_equal CHECK (
    NOT is_multi_participant
    OR NOT is_official_task
    OR (reward_type = 'points' AND reward_distribution = 'equal')
);
-- ä»»åŠ¡è¾¾äººå‘å¸ƒçš„å¤šäººä»»åŠ¡å¿…é¡»å…³è”è¾¾äººæœåŠ¡
ALTER TABLE tasks ADD CONSTRAINT chk_expert_task_service CHECK (
    NOT created_by_expert OR expert_service_id IS NOT NULL
);
-- å›ºå®šæ—¶é—´æ®µæœåŠ¡çº¦æŸï¼ˆå¦‚æžœis_fixed_time_slot=trueï¼Œå¿…é¡»æä¾›æ‰€æœ‰æ—¶é—´æ®µç›¸å…³å­—æ®µï¼›å¦‚æžœis_fixed_time_slot=falseï¼Œæ—¶é—´æ®µç›¸å…³å­—æ®µåº”ä¸ºNULLï¼‰
ALTER TABLE tasks ADD CONSTRAINT chk_fixed_time_slot_fields CHECK (
    (NOT is_fixed_time_slot AND time_slot_duration_minutes IS NULL AND time_slot_start_time IS NULL AND time_slot_end_time IS NULL AND participants_per_slot IS NULL)
    OR (is_fixed_time_slot 
        AND time_slot_duration_minutes IS NOT NULL 
        AND time_slot_duration_minutes > 0
        AND time_slot_start_time IS NOT NULL
        AND time_slot_end_time IS NOT NULL
        AND time_slot_end_time > time_slot_start_time
        AND participants_per_slot IS NOT NULL
        AND participants_per_slot >= 1
        AND participants_per_slot <= max_participants)
);
-- æŠ˜æ‰£ç›¸å…³çº¦æŸï¼ˆå¦‚æžœè®¾ç½®äº†æŠ˜æ‰£ï¼Œå¿…é¡»æä¾›åŽŸä»·å’ŒæŠ˜æ‰£åŽä»·æ ¼ï¼‰
ALTER TABLE tasks ADD CONSTRAINT chk_discount_fields CHECK (
    (discount_percentage IS NULL AND original_price_per_participant IS NULL AND discounted_price_per_participant IS NULL)
    OR (discount_percentage IS NOT NULL 
        AND discount_percentage >= 0 
        AND discount_percentage <= 100
        AND original_price_per_participant IS NOT NULL
        AND original_price_per_participant > 0
        AND discounted_price_per_participant IS NOT NULL
        AND discounted_price_per_participant > 0
        AND discounted_price_per_participant <= original_price_per_participant
        AND ABS(discounted_price_per_participant - original_price_per_participant * (1 - discount_percentage / 100)) < 0.01)  -- å…è®¸æµ®ç‚¹æ•°ç²¾åº¦è¯¯å·®
);
```

**å­—æ®µè¯´æ˜Žï¼š**
- `is_multi_participant`: æ ‡è¯†æ˜¯å¦ä¸ºå¤šäººä»»åŠ¡ï¼ˆfalseè¡¨ç¤ºå•äººä»»åŠ¡ï¼Œä¿æŒå‘åŽå…¼å®¹ï¼‰
- `is_official_task`: æ ‡è¯†æ˜¯å¦ä¸ºå®˜æ–¹ä»»åŠ¡ï¼ˆç®¡ç†å‘˜å‘å¸ƒçš„ä»»åŠ¡ï¼Œæ‰€æœ‰äººéƒ½å¯ä»¥çœ‹åˆ°å’Œç”³è¯·ï¼‰
- `max_participants`: æœ€å¤§å‚ä¸Žäººæ•°ï¼Œé»˜è®¤1ï¼ˆå•äººä»»åŠ¡ï¼‰
- `min_participants`: æœ€å°å‚ä¸Žäººæ•°ï¼Œä»…ç”¨äºŽåˆ¤å®šä»»åŠ¡æ˜¯å¦å¯ä»¥å¼€å§‹ã€‚ä¸€æ—¦ä»»åŠ¡å¼€å§‹ï¼Œå³ä½¿åŽç»­æœ‰äººé€€å‡ºå¯¼è‡´äººæ•° < `min_participants`ï¼Œä»»åŠ¡ä»å¯ç»§ç»­è¿›è¡Œ
- `current_participants`: å½“å‰å·²æŽ¥å—çš„å‚ä¸Žäººæ•°ï¼ˆä»…ä½œä¸ºå±•ç¤ºç”¨ç¼“å­˜ï¼Œä¸šåŠ¡å†³ç­–ä½¿ç”¨å®žæ—¶COUNT(*)æŸ¥è¯¢ï¼‰
- `completion_rule`: 
  - `all`: éœ€è¦æ‰€æœ‰å‚ä¸Žè€…éƒ½å®Œæˆæ‰èƒ½åˆ¤å®šä»»åŠ¡å®Œæˆ
  - `min`: è¾¾åˆ°æœ€å°å®Œæˆäººæ•°å³å¯åˆ¤å®šä»»åŠ¡å®Œæˆ
- `reward_distribution`: 
  - `equal`: æ€»å¥–åŠ±å¹³å‡åˆ†é…ç»™æ‰€æœ‰å‚ä¸Žè€…
  - `custom`: ç®¡ç†å‘˜å¯ä»¥è‡ªå®šä¹‰æ¯ä¸ªå‚ä¸Žè€…çš„å¥–åŠ±
- `reward_type`: 
  - `cash`: ä»…çŽ°é‡‘å¥–åŠ±ï¼ˆ`reward > 0`ï¼Œ`points_reward = 0` æˆ– NULLï¼‰
  - `points`: ä»…ç§¯åˆ†å¥–åŠ±ï¼ˆ`points_reward > 0`ï¼Œ`reward = 0` æˆ– NULLï¼‰
  - `both`: çŽ°é‡‘+ç§¯åˆ†å¥–åŠ±ï¼ˆ`reward > 0` ä¸” `points_reward > 0`ï¼‰
  - **é‡è¦è¯´æ˜Ž**ï¼šå½“ `reward_type='both'` æ—¶ï¼Œä»»åŠ¡çº§åˆ«åŒæ—¶æœ‰çŽ°é‡‘å’Œç§¯åˆ†å¥–åŠ±ï¼Œä½†å…·ä½“åˆ°æŸä¸ªå‚ä¸Žè€…ï¼Œå¯ä»¥åªæ‹¿çŽ°é‡‘ã€åªæ‹¿ç§¯åˆ†æˆ–ä¸¤è€…éƒ½æ‹¿ï¼ŒæŒ‰ `task_participant_rewards.reward_type` ä¸ºå‡†
- `points_reward`: ç§¯åˆ†å¥–åŠ±æ•°é‡ï¼ˆå¦‚æžœreward_typeåŒ…å«pointsï¼‰
- `auto_accept`: æ˜¯å¦è‡ªåŠ¨æŽ¥å—ç”³è¯·ï¼ˆå®˜æ–¹å¤šäººä»»åŠ¡é»˜è®¤trueï¼Œç”¨æˆ·ç”³è¯·åŽç«‹å³æŽ¥å—ï¼‰
- `allow_negotiation`: æ˜¯å¦å…è®¸è®®ä»·ï¼ˆå¤šäººä»»åŠ¡é»˜è®¤falseï¼Œä¸æ”¯æŒè®®ä»·ï¼‰
- `created_by_admin`: æ ‡è¯†ä»»åŠ¡æ˜¯å¦ç”±ç®¡ç†å‘˜åˆ›å»º
- `admin_creator_id`: åˆ›å»ºä»»åŠ¡çš„ç®¡ç†å‘˜IDï¼ˆå¯ä¸ºç©ºï¼Œç”¨äºŽæ™®é€šç”¨æˆ·åˆ›å»ºçš„å•äººä»»åŠ¡ï¼Œä½¿ç”¨VARCHAR(36)ä»¥æ”¯æŒUUIDæ ¼å¼ï¼‰
- `created_by_expert`: æ ‡è¯†ä»»åŠ¡æ˜¯å¦ç”±ä»»åŠ¡è¾¾äººåˆ›å»º
- `expert_creator_id`: åˆ›å»ºä»»åŠ¡çš„ä»»åŠ¡è¾¾äººIDï¼ˆå¯ä¸ºç©ºï¼Œç”¨äºŽç®¡ç†å‘˜åˆ›å»ºçš„ä»»åŠ¡ï¼Œä½¿ç”¨VARCHAR(8)æ ¼å¼ï¼Œä¸Žusersè¡¨ä¸€è‡´ï¼‰
- `expert_service_id`: å…³è”çš„è¾¾äººæœåŠ¡IDï¼ˆ**ä»»åŠ¡è¾¾äººå‘å¸ƒçš„å¤šäººä»»åŠ¡å¿…é¡»å…³è”ä¸€ä¸ªè¾¾äººæœåŠ¡**ï¼‰
  - å¤–é”®å…³è” `task_expert_services` è¡¨
  - å½“ `created_by_expert=true` æ—¶ï¼Œæ­¤å­—æ®µå¿…é¡»è®¾ç½®
  - ç”¨äºŽæ ‡è¯†æ­¤å¤šäººä»»åŠ¡å¯¹åº”çš„è¾¾äººæœåŠ¡
  - ç”³è¯·äººç”³è¯·å‚ä¸Žæ­¤ä»»åŠ¡æ—¶ï¼Œå®žé™…ä¸Šæ˜¯åœ¨ç”³è¯·æ­¤è¾¾äººæœåŠ¡
  - ä»·æ ¼åŸºç¡€ï¼šä»»åŠ¡çš„ `reward` å­—æ®µåº”åŸºäºŽè¾¾äººæœåŠ¡çš„ `base_price`ï¼Œä½†ä»»åŠ¡è¾¾äººå¯ä»¥è®¾ç½®æŠ˜æ‰£
- `is_fixed_time_slot`: æ ‡è¯†æ˜¯å¦ä¸ºå›ºå®šæ—¶é—´æ®µæœåŠ¡ï¼ˆä»»åŠ¡è¾¾äººå¯è®¾ç½®ï¼Œå¯é€‰ï¼Œé»˜è®¤falseï¼‰
  - `true`ï¼šå›ºå®šæ—¶é—´æ®µæœåŠ¡ï¼ˆå¦‚éº»å°†æœåŠ¡ï¼Œæ¯å°æ—¶ä¸€ä¸ªæ—¶é—´æ®µï¼‰
  - `false`ï¼šéžå›ºå®šæ—¶é—´æ®µæœåŠ¡ï¼ˆç”³è¯·äººéœ€è¦é€‰æ‹©æˆªæ­¢æ—¥æœŸæˆ–çµæ´»æ—¶é—´ï¼‰
- `time_slot_duration_minutes`: æ—¶é—´æ®µæ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰ï¼Œå¦‚60è¡¨ç¤º1å°æ—¶ï¼Œ120è¡¨ç¤º2å°æ—¶ç­‰ï¼ˆä»…å½“is_fixed_time_slot=trueæ—¶ä½¿ç”¨ï¼‰
- `time_slot_start_time`: æ—¶é—´æ®µå¼€å§‹æ—¶é—´ï¼ˆTIMEç±»åž‹ï¼‰ï¼Œå¦‚12:00è¡¨ç¤ºä»Žä¸­åˆ12ç‚¹å¼€å§‹ï¼ˆä»…å½“is_fixed_time_slot=trueæ—¶ä½¿ç”¨ï¼‰
- `time_slot_end_time`: æ—¶é—´æ®µç»“æŸæ—¶é—´ï¼ˆTIMEç±»åž‹ï¼‰ï¼Œå¦‚22:00è¡¨ç¤ºåˆ°æ™šä¸Š10ç‚¹ç»“æŸï¼ˆä»…å½“is_fixed_time_slot=trueæ—¶ä½¿ç”¨ï¼‰
- `participants_per_slot`: æ¯ä¸ªæ—¶é—´æ®µçš„äººæ•°é™åˆ¶ï¼Œå¦‚4äººï¼ˆéº»å°†éœ€è¦4äººï¼Œä»…å½“is_fixed_time_slot=trueæ—¶ä½¿ç”¨ï¼‰
- `original_price_per_participant`: åŽŸä»·ï¼ˆæ¯äººï¼‰ï¼Œä»…ç”¨äºŽä»»åŠ¡è¾¾äººå‘å¸ƒçš„å¤šäººä»»åŠ¡æ˜¾ç¤ºæŠ˜æ‰£ä¿¡æ¯ï¼ˆå¦‚ï¼šåŽŸä»·10é•‘ï¼‰
- `discount_percentage`: æŠ˜æ‰£ç™¾åˆ†æ¯”ï¼ˆ0-100ï¼‰ï¼Œå¦‚20è¡¨ç¤ºæ‰“8æŠ˜ï¼ˆåŽŸä»·10é•‘ï¼ŒçŽ°ä»·8é•‘ï¼‰ï¼Œä»…ç”¨äºŽä»»åŠ¡è¾¾äººå‘å¸ƒçš„å¤šäººä»»åŠ¡
- `discounted_price_per_participant`: æŠ˜æ‰£åŽä»·æ ¼ï¼ˆæ¯äººï¼‰ï¼Œä»…ç”¨äºŽä»»åŠ¡è¾¾äººå‘å¸ƒçš„å¤šäººä»»åŠ¡ï¼ˆå¦‚ï¼šçŽ°ä»·8é•‘ï¼‰

### 2. åˆ›å»º TaskParticipant è¡¨

å­˜å‚¨ä»»åŠ¡å‚ä¸Žè€…ä¿¡æ¯ï¼š

```sql
CREATE TABLE task_participants (
    id BIGSERIAL PRIMARY KEY,
    task_id INTEGER NOT NULL REFERENCES tasks(id) ON DELETE CASCADE,
    user_id VARCHAR(8) NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    status VARCHAR(20) DEFAULT 'pending',  -- pending, accepted, in_progress, completed, exit_requested, exited, cancelled
    previous_status VARCHAR(20),  -- å‰ä¸€ä¸ªçŠ¶æ€ï¼ˆç”¨äºŽé€€å‡ºç”³è¯·è¢«æ‹’ç»æ—¶æ¢å¤ï¼‰
    time_slot_id INTEGER,  -- æ—¶é—´æ®µIDï¼ˆä»…ç”¨äºŽå›ºå®šæ—¶é—´æ®µæœåŠ¡ï¼Œæ ‡è¯†å‚ä¸Žè€…ç”³è¯·çš„æ—¶é—´æ®µï¼‰
    preferred_deadline TIMESTAMPTZ,  -- ç”³è¯·äººæœŸæœ›çš„æˆªæ­¢æ—¥æœŸï¼ˆä»…ç”¨äºŽéžå›ºå®šæ—¶é—´æ®µæœåŠ¡ï¼Œç”³è¯·äººé€‰æ‹©ï¼‰
    is_flexible_time BOOLEAN DEFAULT false,  -- æ˜¯å¦ä¸ºçµæ´»æ—¶é—´ï¼ˆä»…ç”¨äºŽéžå›ºå®šæ—¶é—´æ®µæœåŠ¡ï¼Œç”³è¯·äººé€‰æ‹©ï¼Œtrueè¡¨ç¤ºæ—¶é—´çµæ´»ï¼Œfalseè¡¨ç¤ºæœ‰å…·ä½“æˆªæ­¢æ—¥æœŸï¼‰
    planned_reward_amount DECIMAL(12, 2),  -- è¯¥å‚ä¸Žè€…è®¡åˆ’åº”å¾—çš„çŽ°é‡‘å¥–åŠ±ï¼ˆå¦‚æžœreward_distribution=customï¼Œä»…ç”¨äºŽå±•ç¤ºï¼Œå®žé™…å€¼ä»¥task_participant_rewardsè¡¨ä¸ºå‡†ï¼‰
    planned_points_reward BIGINT DEFAULT 0,  -- è¯¥å‚ä¸Žè€…è®¡åˆ’åº”å¾—çš„ç§¯åˆ†å¥–åŠ±ï¼ˆä»…ç”¨äºŽå±•ç¤ºï¼Œå®žé™…å€¼ä»¥task_participant_rewardsè¡¨ä¸ºå‡†ï¼‰
    applied_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,  -- ç”³è¯·æ—¶é—´
    accepted_at TIMESTAMPTZ,  -- æŽ¥å—æ—¶é—´ï¼ˆè‡ªåŠ¨æŽ¥å—æ—¶ç­‰äºŽapplied_atï¼Œå¾…å®¡æ ¸æ—¶ä¸ºNULLï¼‰
    started_at TIMESTAMPTZ,  -- å¼€å§‹æ—¶é—´ï¼ˆä»»åŠ¡å¼€å§‹ï¼‰
    completed_at TIMESTAMPTZ,  -- å®Œæˆæ—¶é—´
    exit_requested_at TIMESTAMPTZ,  -- é€€å‡ºç”³è¯·æ—¶é—´
    exit_reason TEXT,  -- é€€å‡ºåŽŸå› 
    exited_at TIMESTAMPTZ,  -- é€€å‡ºæ—¶é—´ï¼ˆç®¡ç†å‘˜æ‰¹å‡†é€€å‡ºï¼‰
    cancelled_at TIMESTAMPTZ,  -- å–æ¶ˆæ—¶é—´ï¼ˆç®¡ç†å‘˜å–æ¶ˆï¼‰
    completion_notes TEXT,  -- å®Œæˆå¤‡æ³¨
    admin_notes TEXT,  -- ç®¡ç†å‘˜å¤‡æ³¨
    idempotency_key VARCHAR(64),  -- å¹‚ç­‰é”®ï¼ˆç”¨äºŽé˜²æ­¢é‡å¤æ“ä½œï¼‰
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT uq_task_participant UNIQUE(task_id, user_id),  -- ç¡®ä¿åŒä¸€ç”¨æˆ·ä¸èƒ½é‡å¤ç”³è¯·åŒä¸€ä»»åŠ¡ï¼ˆæ™®é€šå¤šäººä»»åŠ¡ï¼Œtime_slot_idä¸ºNULLæ—¶ä½¿ç”¨æ­¤çº¦æŸï¼‰
    -- æ³¨æ„ï¼šå¯¹äºŽå›ºå®šæ—¶é—´æ®µæœåŠ¡ï¼Œéœ€è¦åœ¨åº”ç”¨å±‚éªŒè¯åŒä¸€ç”¨æˆ·ä¸èƒ½é‡å¤ç”³è¯·åŒä¸€æ—¶é—´æ®µ
    -- å¯ä»¥ä½¿ç”¨éƒ¨åˆ†å”¯ä¸€ç´¢å¼•ï¼šCREATE UNIQUE INDEX idx_task_participant_time_slot ON task_participants(task_id, user_id, time_slot_id) WHERE time_slot_id IS NOT NULL;
    CONSTRAINT chk_participant_time_info CHECK (
        -- å¦‚æžœä»»åŠ¡æœ‰å›ºå®šæ—¶é—´æ®µï¼Œå¿…é¡»æä¾›time_slot_id
        -- å¦‚æžœä»»åŠ¡æ²¡æœ‰å›ºå®šæ—¶é—´æ®µï¼Œå¿…é¡»æä¾›preferred_deadlineæˆ–is_flexible_time=true
        -- æ­¤çº¦æŸåœ¨åº”ç”¨å±‚éªŒè¯ï¼Œæ•°æ®åº“å±‚ä¸å¼ºåˆ¶ï¼ˆå› ä¸ºéœ€è¦å…³è”tasksè¡¨ï¼‰
    )
    CONSTRAINT uq_participant_idempotency UNIQUE(idempotency_key),  -- å¹‚ç­‰é”®å”¯ä¸€çº¦æŸ
    CONSTRAINT chk_participant_status CHECK (
        status IN ('pending', 'accepted', 'in_progress', 'completed', 'exit_requested', 'exited', 'cancelled')
    )
);

-- ç´¢å¼•ä¼˜åŒ–è¯´æ˜Žï¼š
-- 1. å”¯ä¸€çº¦æŸ uq_task_participant UNIQUE(task_id, user_id) ä¼šè‡ªåŠ¨åˆ›å»ºç´¢å¼•ï¼Œæ— éœ€æ‰‹åŠ¨åˆ›å»º idx_task_participants_task_user
-- 2. å¤åˆç´¢å¼• (task_id, status, updated_at) å¯ä»¥è¦†ç›–å•åˆ—æŸ¥è¯¢ï¼ˆleft prefixï¼‰ï¼Œå› æ­¤å•åˆ—çš„ task_id ç´¢å¼•å¯é€‰
-- 3. æ ¹æ®å®žé™…æŸ¥è¯¢æ¨¡å¼ï¼Œä¿ç•™ä»¥ä¸‹ç´¢å¼•ï¼š
CREATE INDEX idx_task_participants_user ON task_participants(user_id);  -- ç”¨æˆ·æŸ¥è¯¢è‡ªå·±çš„ä»»åŠ¡
CREATE INDEX idx_task_participants_status ON task_participants(status);  -- çŠ¶æ€è¿‡æ»¤
CREATE INDEX idx_task_participants_task_status_updated ON task_participants(task_id, status, updated_at);  -- ç®¡ç†é¡µæŽ’åºæŸ¥è¯¢ï¼ˆè¦†ç›– task_id å’Œ task_id+status æŸ¥è¯¢ï¼‰
CREATE UNIQUE INDEX idx_task_participant_time_slot ON task_participants(task_id, user_id, time_slot_id) WHERE time_slot_id IS NOT NULL;  -- å›ºå®šæ—¶é—´æ®µæœåŠ¡ï¼šç¡®ä¿åŒä¸€ç”¨æˆ·ä¸èƒ½é‡å¤ç”³è¯·åŒä¸€æ—¶é—´æ®µ
CREATE INDEX idx_task_participants_time_slot ON task_participants(task_id, time_slot_id, status) WHERE time_slot_id IS NOT NULL;  -- å›ºå®šæ—¶é—´æ®µæœåŠ¡ï¼šæŸ¥è¯¢æŸä¸ªæ—¶é—´æ®µçš„å‚ä¸Žè€…æ•°é‡
```

**å­—æ®µè¯´æ˜Žï¼š**
- `task_id`: å…³è”çš„ä»»åŠ¡ID
- `user_id`: å‚ä¸Žè€…ç”¨æˆ·ID
- `status`: å‚ä¸Žè€…çŠ¶æ€
  - `pending`: å¾…å®¡æ ¸ï¼ˆéžå®˜æ–¹ä»»åŠ¡éœ€è¦ç­‰å¾…ç®¡ç†å‘˜å®¡æ ¸ï¼Œå®˜æ–¹ä»»åŠ¡ä¸ä¼šè¿›å…¥æ­¤çŠ¶æ€ï¼‰
  - `accepted`: å·²æŽ¥å—ï¼ˆå®˜æ–¹ä»»åŠ¡è‡ªåŠ¨æŽ¥å—ï¼Œç”¨æˆ·ç”³è¯·åŽç«‹å³è¿›å…¥æ­¤çŠ¶æ€ï¼Œå¯ä»¥è¿›å…¥èŠå¤©å®¤ï¼‰
  - `in_progress`: è¿›è¡Œä¸­ï¼ˆä»»åŠ¡å·²å¼€å§‹ï¼Œå‚ä¸Žè€…æ­£åœ¨å·¥ä½œï¼‰
  - `completed`: å·²å®Œæˆï¼ˆå‚ä¸Žè€…å·²å®Œæˆè‡ªå·±çš„éƒ¨åˆ†ï¼‰
  - `exit_requested`: é€€å‡ºç”³è¯·ä¸­ï¼ˆå‚ä¸Žè€…ç”³è¯·é€€å‡ºï¼Œç­‰å¾…ç®¡ç†å‘˜å®¡æ ¸ï¼‰
  - `exited`: å·²é€€å‡ºï¼ˆç®¡ç†å‘˜æ‰¹å‡†é€€å‡ºï¼‰
  - `cancelled`: å·²å–æ¶ˆï¼ˆç®¡ç†å‘˜å–æ¶ˆå‚ä¸Žè€…èµ„æ ¼ï¼‰
- `previous_status`: å‰ä¸€ä¸ªçŠ¶æ€ï¼ˆå½“è¿›å…¥ `exit_requested` æ—¶ä¿å­˜ï¼Œç”¨äºŽæ‹’ç»é€€å‡ºç”³è¯·æ—¶æ¢å¤ï¼‰
- `time_slot_id`: æ—¶é—´æ®µIDï¼ˆä»…ç”¨äºŽå›ºå®šæ—¶é—´æ®µæœåŠ¡ï¼Œæ ‡è¯†å‚ä¸Žè€…ç”³è¯·çš„æ—¶é—´æ®µï¼Œæ™®é€šå¤šäººä»»åŠ¡ä¸ºNULLï¼‰
- `preferred_deadline`: ç”³è¯·äººæœŸæœ›çš„æˆªæ­¢æ—¥æœŸï¼ˆä»…ç”¨äºŽéžå›ºå®šæ—¶é—´æ®µæœåŠ¡ï¼Œç”³è¯·äººé€‰æ‹©ï¼Œå¦‚æžœis_flexible_time=trueåˆ™ä¸ºNULLï¼‰
- `is_flexible_time`: æ˜¯å¦ä¸ºçµæ´»æ—¶é—´ï¼ˆä»…ç”¨äºŽéžå›ºå®šæ—¶é—´æ®µæœåŠ¡ï¼Œç”³è¯·äººé€‰æ‹©ï¼Œtrueè¡¨ç¤ºæ—¶é—´çµæ´»ï¼Œfalseè¡¨ç¤ºæœ‰å…·ä½“æˆªæ­¢æ—¥æœŸï¼‰
- `planned_reward_amount`: è¯¥å‚ä¸Žè€…**è®¡åˆ’**åº”å¾—çš„çŽ°é‡‘å¥–åŠ±é‡‘é¢ï¼ˆä»…åœ¨reward_distribution=customæ—¶ä½¿ç”¨ï¼Œä»…ç”¨äºŽå±•ç¤ºï¼‰
- `planned_points_reward`: è¯¥å‚ä¸Žè€…**è®¡åˆ’**åº”å¾—çš„ç§¯åˆ†å¥–åŠ±ï¼ˆä»…ç”¨äºŽå±•ç¤ºï¼‰

**é‡è¦è¯´æ˜Ž**ï¼š
- å‚ä¸Žè€…è¡¨ä¸­çš„ `planned_reward_amount` å’Œ `planned_points_reward` å­—æ®µä¸º**è®¡åˆ’å€¼**ï¼Œä»…ç”¨äºŽå±•ç¤ºå’Œåˆæ­¥è®¡ç®—
- **å®žé™…å‘æ”¾å€¼**ä»¥ `task_participant_rewards` è¡¨ä¸ºå‡†ï¼ˆ`reward_amount` å’Œ `points_amount`ï¼‰
- è¯»æŽ¥å£åº”æ ¹æ® `task_participant_rewards` è¡¨åšèšåˆï¼Œè¿”å›žå®žé™…å‘æ”¾å€¼
- å¦‚æžœè®¡åˆ’å€¼ä¸Žå®žé™…å€¼ä¸ä¸€è‡´ï¼Œä»¥å®žé™…å€¼ä¸ºå‡†
- **MVPé˜¶æ®µå»ºè®®**ï¼šå¦‚æžœçŸ­æœŸå†…åªéœ€è¦"å¹³å‡åˆ†é…ç§¯åˆ†"ï¼Œå¯ä»¥ä¸åœ¨å‚ä¸Žè€…è¡¨å­˜å‚¨è®¡åˆ’å€¼ï¼Œä»…åœ¨å¥–åŠ±åˆ†é…æ—¶è®¡ç®—å¹¶å†™å…¥ `task_participant_rewards` è¡¨
- `applied_at`: ç”³è¯·æ—¶é—´
- `accepted_at`: æŽ¥å—æ—¶é—´ï¼ˆè‡ªåŠ¨æŽ¥å—æ—¶ç­‰äºŽapplied_atï¼Œå¾…å®¡æ ¸æ—¶ä¸ºNULLï¼‰
- `started_at`: å¼€å§‹æ—¶é—´ï¼ˆä»»åŠ¡å¼€å§‹ï¼Œå‚ä¸Žè€…å¯ä»¥å¼€å§‹å·¥ä½œï¼Œåˆå§‹ä¸ºNULLï¼‰
- `completed_at`: å®Œæˆæ—¶é—´ï¼ˆå‚ä¸Žè€…å®Œæˆè‡ªå·±çš„éƒ¨åˆ†ï¼Œåˆå§‹ä¸ºNULLï¼‰
- `exit_requested_at`: é€€å‡ºç”³è¯·æ—¶é—´ï¼ˆåˆå§‹ä¸ºNULLï¼‰
- `exit_reason`: é€€å‡ºåŽŸå› ï¼ˆå‚ä¸Žè€…ç”³è¯·é€€å‡ºæ—¶å¡«å†™ï¼‰
- `exited_at`: é€€å‡ºæ—¶é—´ï¼ˆç®¡ç†å‘˜æ‰¹å‡†é€€å‡ºï¼Œåˆå§‹ä¸ºNULLï¼‰
- `cancelled_at`: å–æ¶ˆæ—¶é—´ï¼ˆåˆå§‹ä¸ºNULLï¼‰
- `completion_notes`: å®Œæˆå¤‡æ³¨ï¼ˆå‚ä¸Žè€…æäº¤å®Œæˆæ—¶å¡«å†™ï¼‰
- `admin_notes`: ç®¡ç†å‘˜å¤‡æ³¨ï¼ˆç®¡ç†å‘˜å¯ä»¥æ·»åŠ å¤‡æ³¨ï¼‰
- `idempotency_key`: å¹‚ç­‰é”®ï¼ˆç”¨äºŽé˜²æ­¢é‡å¤æ“ä½œï¼Œå¦‚é‡å¤ç”³è¯·ã€é‡å¤å®Œæˆç­‰ï¼‰

### 3. åˆ›å»º TaskParticipantReward è¡¨

å­˜å‚¨å‚ä¸Žè€…å¥–åŠ±åˆ†é…è®°å½•ï¼ˆç”¨äºŽå®¡è®¡å’Œæ”¯ä»˜ï¼‰ï¼š

```sql
CREATE TABLE task_participant_rewards (
    id BIGSERIAL PRIMARY KEY,
    task_id INTEGER NOT NULL REFERENCES tasks(id) ON DELETE CASCADE,
    participant_id BIGINT NOT NULL REFERENCES task_participants(id) ON DELETE CASCADE,
    user_id VARCHAR(8) NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    reward_type VARCHAR(20) DEFAULT 'cash',  -- cash, points, both
    reward_amount DECIMAL(12, 2),  -- å®žé™…å‘æ”¾çš„çŽ°é‡‘å¥–åŠ±é‡‘é¢ï¼ˆå¦‚æžœreward_typeåŒ…å«cashï¼‰
    points_amount BIGINT,  -- å®žé™…å‘æ”¾çš„ç§¯åˆ†å¥–åŠ±ï¼ˆå¦‚æžœreward_typeåŒ…å«pointsï¼‰
    currency CHAR(3) DEFAULT 'GBP',
    payment_status VARCHAR(20) DEFAULT 'pending',  -- pending, paid, failed, refunded
    points_status VARCHAR(20) DEFAULT 'pending',  -- pending, credited, failed, refunded
    paid_at TIMESTAMPTZ,  -- æ”¯ä»˜æ—¶é—´ï¼ˆåˆå§‹ä¸ºNULLï¼‰
    points_credited_at TIMESTAMPTZ,  -- ç§¯åˆ†å‘æ”¾æ—¶é—´ï¼ˆåˆå§‹ä¸ºNULLï¼‰
    payment_method VARCHAR(50),  -- æ”¯ä»˜æ–¹å¼
    payment_reference VARCHAR(100),  -- æ”¯ä»˜å‚è€ƒå·
    idempotency_key VARCHAR(64),  -- å¹‚ç­‰é”®ï¼ˆç”¨äºŽé˜²æ­¢é‡å¤æ”¯ä»˜/å‘æ”¾ï¼‰
    external_txn_id VARCHAR(100),  -- å¤–éƒ¨äº¤æ˜“IDï¼ˆæ”¯ä»˜ç½‘å…³è¿”å›žçš„äº¤æ˜“IDï¼‰
    reversal_reference VARCHAR(100),  -- å›žé€€å…³è”IDï¼ˆç”¨äºŽå…³è”åŽŸäº¤æ˜“ï¼Œç”¨äºŽç§¯åˆ†/çŽ°é‡‘è¿½å›žæ—¶çš„å¯¹è´¦ï¼‰
    admin_operator_id VARCHAR(36) REFERENCES admin_users(id) ON DELETE SET NULL,  -- æ“ä½œçš„ç®¡ç†å‘˜IDï¼ˆç”¨äºŽå®¡è®¡ï¼‰
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT uq_reward_idempotency UNIQUE(idempotency_key),  -- å¹‚ç­‰é”®å”¯ä¸€çº¦æŸ
    CONSTRAINT uq_reward_external_txn UNIQUE(external_txn_id),  -- å¤–éƒ¨äº¤æ˜“IDå”¯ä¸€çº¦æŸï¼ˆé˜²æ­¢é‡å¤å¤„ç†ï¼‰
    CONSTRAINT chk_reward_payment_status CHECK (
        payment_status IN ('pending', 'paid', 'failed', 'refunded')
    ),
    CONSTRAINT chk_reward_points_status CHECK (
        points_status IN ('pending', 'credited', 'failed', 'refunded')
    ),
    CONSTRAINT chk_reward_type_values CHECK (
        reward_type IN ('cash', 'points', 'both')
    ),
    CONSTRAINT chk_reward_type_amount CHECK (
        (reward_type = 'cash' AND reward_amount IS NOT NULL AND points_amount IS NULL) OR
        (reward_type = 'points' AND reward_amount IS NULL AND points_amount IS NOT NULL) OR
        (reward_type = 'both' AND reward_amount IS NOT NULL AND points_amount IS NOT NULL)
    ),
    CONSTRAINT chk_reward_positive_amount CHECK (
        (reward_amount IS NULL OR reward_amount > 0) AND
        (points_amount IS NULL OR points_amount > 0)
    )
);

-- æ·»åŠ è§¦å‘å™¨ï¼Œç¡®ä¿å¥–åŠ±è¡¨çš„reward_typeä¸Žä»»åŠ¡è¡¨çš„reward_typeä¸€è‡´ï¼ˆåº”ç”¨å±‚ä¹Ÿåº”åšæ­¤éªŒè¯ï¼‰
CREATE OR REPLACE FUNCTION validate_reward_type_consistency() RETURNS trigger AS $$
DECLARE
    task_reward_type VARCHAR(20);
BEGIN
    SELECT reward_type INTO task_reward_type FROM tasks WHERE id = NEW.task_id;
    IF task_reward_type IS NULL THEN
        RAISE EXCEPTION 'Task not found: %', NEW.task_id;
    END IF;
    -- éªŒè¯å¥–åŠ±ç±»åž‹ä¸€è‡´æ€§
    IF task_reward_type = 'points' AND NEW.reward_type != 'points' THEN
        RAISE EXCEPTION 'Reward type mismatch: task is points-only but reward type is %', NEW.reward_type;
    END IF;
    IF task_reward_type = 'cash' AND NEW.reward_type != 'cash' THEN
        RAISE EXCEPTION 'Reward type mismatch: task is cash-only but reward type is %', NEW.reward_type;
    END IF;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_validate_reward_type_consistency
BEFORE INSERT OR UPDATE ON task_participant_rewards
FOR EACH ROW EXECUTE FUNCTION validate_reward_type_consistency();

CREATE INDEX idx_participant_rewards_task ON task_participant_rewards(task_id);
CREATE INDEX idx_participant_rewards_participant ON task_participant_rewards(participant_id);
CREATE INDEX idx_participant_rewards_user ON task_participant_rewards(user_id);
CREATE INDEX idx_participant_rewards_payment_status ON task_participant_rewards(payment_status);
CREATE INDEX idx_participant_rewards_points_status ON task_participant_rewards(points_status);
CREATE INDEX idx_participant_rewards_task_status ON task_participant_rewards(task_id, payment_status, points_status);  -- ç”¨äºŽæŸ¥è¯¢ä»»åŠ¡å¥–åŠ±å‘æ”¾çŠ¶æ€
```

**å­—æ®µè¯´æ˜Žï¼š**
- `task_id`: å…³è”çš„ä»»åŠ¡ID
- `participant_id`: å…³è”çš„å‚ä¸Žè€…è®°å½•ID
- `user_id`: å‚ä¸Žè€…ç”¨æˆ·ID
- `reward_type`: å¥–åŠ±ç±»åž‹ï¼ˆcash, points, bothï¼‰
- `reward_amount`: å®žé™…å‘æ”¾çš„çŽ°é‡‘å¥–åŠ±é‡‘é¢ï¼ˆå¦‚æžœreward_typeåŒ…å«cashï¼Œåˆå§‹ä¸ºNULLï¼Œä¸å…è®¸ä¸º0ï¼‰
- `points_amount`: å®žé™…å‘æ”¾çš„ç§¯åˆ†å¥–åŠ±ï¼ˆå¦‚æžœreward_typeåŒ…å«pointsï¼Œåˆå§‹ä¸ºNULLï¼Œä¸å…è®¸ä¸º0ï¼‰
- **é‡è¦è¯´æ˜Ž**ï¼šä¸å…è®¸ 0 é‡‘é¢è®°å½•ï¼ˆ`reward_amount` å’Œ `points_amount` å¿…é¡»ä¸º NULL æˆ– > 0ï¼‰ï¼Œç”¨äºŽé¿å…"çœ‹èµ·æ¥åƒå‘äº†å¥–åŠ±ï¼Œå®žé™…ç»™äº† 0"çš„æ­§ä¹‰
- `currency`: è´§å¸ç±»åž‹
- `payment_status`: çŽ°é‡‘æ”¯ä»˜çŠ¶æ€
- `points_status`: ç§¯åˆ†å‘æ”¾çŠ¶æ€
- `paid_at`: çŽ°é‡‘æ”¯ä»˜æ—¶é—´ï¼ˆåˆå§‹ä¸ºNULLï¼‰
- `points_credited_at`: ç§¯åˆ†å‘æ”¾æ—¶é—´ï¼ˆåˆå§‹ä¸ºNULLï¼‰
- `payment_method`: æ”¯ä»˜æ–¹å¼
- `payment_reference`: æ”¯ä»˜å‚è€ƒå·ï¼ˆç”¨äºŽå¯¹è´¦ï¼‰
- `idempotency_key`: å¹‚ç­‰é”®ï¼ˆç”¨äºŽé˜²æ­¢é‡å¤æ”¯ä»˜/å‘æ”¾ï¼Œå®¢æˆ·ç«¯ç”Ÿæˆï¼‰
- `external_txn_id`: å¤–éƒ¨äº¤æ˜“IDï¼ˆæ”¯ä»˜ç½‘å…³è¿”å›žçš„äº¤æ˜“IDï¼Œç”¨äºŽå¯¹è´¦å’Œé‡è¯•ï¼‰
- `reversal_reference`: å›žé€€å…³è”IDï¼ˆç”¨äºŽå…³è”åŽŸäº¤æ˜“ï¼Œç”¨äºŽç§¯åˆ†/çŽ°é‡‘è¿½å›žæ—¶çš„å¯¹è´¦ï¼‰
- `admin_operator_id`: æ“ä½œçš„ç®¡ç†å‘˜IDï¼ˆç”¨äºŽå®¡è®¡ï¼Œè®°å½•æ˜¯è°å‘èµ·çš„å¥–åŠ±åˆ†é…ï¼‰

### 4. åˆ›å»º TaskAuditLog è¡¨

å­˜å‚¨ä»»åŠ¡å’Œå‚ä¸Žè€…çš„å®¡è®¡æ—¥å¿—ï¼ˆç”¨äºŽè¿½è¸ªæ‰€æœ‰çŠ¶æ€å˜æ›´å’Œæ“ä½œï¼‰ï¼š

```sql
CREATE TABLE task_audit_logs (
    id BIGSERIAL PRIMARY KEY,
    task_id INTEGER REFERENCES tasks(id) ON DELETE CASCADE,
    participant_id BIGINT REFERENCES task_participants(id) ON DELETE CASCADE,
    user_id VARCHAR(8) REFERENCES users(id) ON DELETE SET NULL,
    admin_id VARCHAR(36) REFERENCES admin_users(id) ON DELETE SET NULL,
    action_type VARCHAR(50) NOT NULL,  -- æ“ä½œç±»åž‹ï¼štask_created, participant_applied, status_changed, reward_distributedç­‰
    entity_type VARCHAR(20) NOT NULL,  -- å®žä½“ç±»åž‹ï¼štask, participant, reward
    old_value JSONB,  -- å˜æ›´å‰çš„å€¼ï¼ˆJSONæ ¼å¼ï¼‰
    new_value JSONB,  -- å˜æ›´åŽçš„å€¼ï¼ˆJSONæ ¼å¼ï¼‰
    description TEXT,  -- æ“ä½œæè¿°
    ip_address INET,  -- æ“ä½œè€…IPåœ°å€
    user_agent TEXT,  -- ç”¨æˆ·ä»£ç†
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_audit_logs_task ON task_audit_logs(task_id);
CREATE INDEX idx_audit_logs_participant ON task_audit_logs(participant_id);
CREATE INDEX idx_audit_logs_user ON task_audit_logs(user_id);
CREATE INDEX idx_audit_logs_admin ON task_audit_logs(admin_id);
CREATE INDEX idx_audit_logs_action ON task_audit_logs(action_type);
CREATE INDEX idx_audit_logs_created ON task_audit_logs(created_at);
CREATE INDEX idx_audit_logs_task_created ON task_audit_logs(task_id, created_at);  -- ç”¨äºŽæŸ¥è¯¢ä»»åŠ¡æ“ä½œåŽ†å²
```

**å­—æ®µè¯´æ˜Žï¼š**
- `task_id`: å…³è”çš„ä»»åŠ¡IDï¼ˆå¯ä¸ºç©ºï¼Œç”¨äºŽç³»ç»Ÿçº§æ“ä½œï¼‰
- `participant_id`: å…³è”çš„å‚ä¸Žè€…è®°å½•IDï¼ˆå¯ä¸ºç©ºï¼‰
- `user_id`: è¢«å½±å“çš„ä¸šåŠ¡ç”¨æˆ·IDï¼ˆå¯ä¸ºç©ºï¼Œç”¨äºŽç®¡ç†å‘˜ç›´æŽ¥æ“ä½œä»»åŠ¡ï¼‰
  - **è¯­ä¹‰**ï¼šè®°å½•æ“ä½œä¸»è¦æ¶‰åŠåˆ°çš„ä¸šåŠ¡ç”¨æˆ·ï¼ˆå¦‚ï¼šç”¨æˆ·ç”³è¯·å‚ä¸Žã€ç”¨æˆ·æäº¤å®Œæˆï¼‰
  - **ä»£ç†åœºæ™¯**ï¼šç®¡ç†å‘˜ä»£è¡¨ç”¨æˆ·æ“ä½œæ—¶ï¼Œåº”åŒæ—¶è®°å½• `user_id`ï¼ˆè¢«ä»£ç†ç”¨æˆ·ï¼‰å’Œ `admin_id`ï¼ˆä»£ç†ç®¡ç†å‘˜ï¼‰
- `admin_id`: æ“ä½œæ‰§è¡Œè€…IDï¼ˆç®¡ç†å‘˜ï¼Œå¯ä¸ºç©ºï¼Œç”¨äºŽç”¨æˆ·æ“ä½œï¼‰
  - **è¯­ä¹‰**ï¼šè®°å½•è°æ‰§è¡Œäº†è¿™ä¸ªæ“ä½œï¼ˆç®¡ç†å‘˜ï¼‰
  - **ä»£ç†åœºæ™¯**ï¼šç®¡ç†å‘˜ä»£è¡¨ç”¨æˆ·æ“ä½œæ—¶ï¼Œåº”åŒæ—¶è®°å½• `user_id`ï¼ˆè¢«ä»£ç†ç”¨æˆ·ï¼‰å’Œ `admin_id`ï¼ˆä»£ç†ç®¡ç†å‘˜ï¼‰
- **æ“ä½œè€…è§„åˆ™**ï¼š
  - **è‡³å°‘æœ‰ä¸€ä¸ªä¸ä¸º NULL**ï¼š`user_id` å’Œ `admin_id` å¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ªä¸ä¸º NULL
  - **å…è®¸ä¸¤ä¸ªéƒ½ä¸ä¸ºç©º**ï¼šä»£ç†æ“ä½œåœºæ™¯ä¸‹ï¼Œ`user_id` å’Œ `admin_id` å¯ä»¥åŒæ—¶ä¸ä¸º NULL
  - **åº”ç”¨å±‚æ ¡éªŒ**ï¼š`(user_id IS NOT NULL) OR (admin_id IS NOT NULL)`
- **å®žä½“å…³ç³»è¯´æ˜Ž**ï¼š
  - `entity_type` + `task_id`/`participant_id` å§‹ç»ˆæŒ‡ï¼šè¢«ä¿®æ”¹çš„é‚£æ¡ä¸šåŠ¡å®žä½“
  - `admin_id` = æ“ä½œæ‰§è¡Œè€…ï¼ˆè°æ‰§è¡Œäº†è¿™ä¸ªæ“ä½œï¼‰
  - `user_id` = è¢«å½±å“çš„ä¸šåŠ¡ç”¨æˆ·ï¼ˆå¦‚æžœæœ‰ï¼Œå¦‚å‚ä¸Žè€…ã€ä»»åŠ¡å‘å¸ƒè€…ç­‰ï¼‰
  - **ç¤ºä¾‹**ï¼šç®¡ç†å‘˜Aå¸®ç”¨æˆ·Uæ‰¹å‡†é€€å‡ºå‚ä¸Žè€…P
    - `admin_id` = Aï¼ˆæ“ä½œæ‰§è¡Œè€…ï¼‰
    - `user_id` = Uï¼ˆè¢«å½±å“çš„ä¸šåŠ¡ç”¨æˆ·ï¼‰
    - `participant_id` = Pï¼ˆè¢«ä¿®æ”¹çš„å®žä½“ï¼‰
    - `entity_type` = 'participant'
- `action_type`: æ“ä½œç±»åž‹ï¼ˆå¦‚ï¼štask_created, participant_applied, status_changed, reward_distributed, exit_approvedç­‰ï¼‰
- `entity_type`: å®žä½“ç±»åž‹ï¼ˆtask, participant, rewardï¼‰
- `old_value`: å˜æ›´å‰çš„å€¼ï¼ˆJSONæ ¼å¼ï¼Œä¾¿äºŽæŸ¥è¯¢å’Œå›žæ»šï¼‰
- `new_value`: å˜æ›´åŽçš„å€¼ï¼ˆJSONæ ¼å¼ï¼‰
- `description`: æ“ä½œæè¿°ï¼ˆäººç±»å¯è¯»çš„æè¿°ï¼Œä»£ç†æ“ä½œéœ€æ ‡æ³¨ä»£ç†æ¥æºï¼‰
- `ip_address`: æ“ä½œè€…IPåœ°å€ï¼ˆç”¨äºŽå®‰å…¨å®¡è®¡ï¼‰
- `user_agent`: ç”¨æˆ·ä»£ç†ï¼ˆç”¨äºŽå®‰å…¨å®¡è®¡ï¼‰

### 5. åˆ›å»º ChatRoom è¡¨ï¼ˆç”¨äºŽä¸å¯é¢„æµ‹çš„èŠå¤©å®¤IDï¼‰

å­˜å‚¨ä»»åŠ¡èŠå¤©å®¤ä¿¡æ¯ï¼š

```sql
CREATE TABLE chat_rooms (
    id BIGSERIAL PRIMARY KEY,
    room_code VARCHAR(32) UNIQUE NOT NULL,  -- ä¸å¯é¢„æµ‹çš„æˆ¿é—´ä»£ç ï¼ˆUUIDæˆ–éšæœºå­—ç¬¦ä¸²ï¼‰
    task_id INTEGER UNIQUE REFERENCES tasks(id) ON DELETE CASCADE,
    room_type VARCHAR(20) DEFAULT 'task',  -- task, direct, group
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_chat_rooms_task ON chat_rooms(task_id);
CREATE INDEX idx_chat_rooms_code ON chat_rooms(room_code);
```

**å­—æ®µè¯´æ˜Žï¼š**
- `room_code`: ä¸å¯é¢„æµ‹çš„æˆ¿é—´ä»£ç ï¼ˆä½¿ç”¨UUIDæˆ–éšæœºå­—ç¬¦ä¸²ï¼Œä¸æš´éœ²ä»»åŠ¡IDï¼‰
- `task_id`: å…³è”çš„ä»»åŠ¡IDï¼ˆå”¯ä¸€çº¦æŸï¼Œä¸€ä¸ªä»»åŠ¡å¯¹åº”ä¸€ä¸ªèŠå¤©å®¤ï¼‰
- `room_type`: æˆ¿é—´ç±»åž‹ï¼ˆtaskè¡¨ç¤ºä»»åŠ¡èŠå¤©å®¤ï¼‰

### 6. ä¸º Task è¡¨æ·»åŠ ç´¢å¼•

```sql
-- ä¸ºå¸¸ç”¨æŸ¥è¯¢æ·»åŠ è”åˆç´¢å¼•
CREATE INDEX idx_tasks_multi_official ON tasks(is_multi_participant, is_official_task, status);
CREATE INDEX idx_tasks_status_deadline ON tasks(status, deadline);
CREATE INDEX idx_tasks_admin_creator ON tasks(created_by_admin, admin_creator_id);
CREATE INDEX idx_tasks_reward_type ON tasks(reward_type, status);
-- è¦†ç›–ç´¢å¼•ï¼šç”¨äºŽåˆ—è¡¨é¡µå¸¸ç”¨è¿‡æ»¤å’ŒæŽ’åº
CREATE INDEX idx_tasks_official_status_deadline ON tasks(is_official_task, status, deadline DESC) 
  WHERE is_official_task = true;  -- éƒ¨åˆ†ç´¢å¼•ï¼Œä»…é’ˆå¯¹å®˜æ–¹ä»»åŠ¡
-- å‚ä¸Žè€…åˆ—è¡¨å¸¸ç”¨æŽ’åºç´¢å¼•
CREATE INDEX idx_task_participants_task_status_completed ON task_participants(task_id, status, completed_at DESC NULLS LAST);
```

### 7. åˆ›å»º updated_at è‡ªåŠ¨æ›´æ–°è§¦å‘å™¨

ä¸ºæ‰€æœ‰éœ€è¦ä¹è§‚é”çš„è¡¨æ·»åŠ  `updated_at` è‡ªåŠ¨æ›´æ–°è§¦å‘å™¨ï¼š

```sql
-- åˆ›å»ºè§¦å‘å™¨å‡½æ•°
CREATE OR REPLACE FUNCTION set_updated_at() RETURNS trigger AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- ä¸º tasks è¡¨æ·»åŠ è§¦å‘å™¨
CREATE TRIGGER trg_tasks_updated_at
BEFORE UPDATE ON tasks
FOR EACH ROW EXECUTE FUNCTION set_updated_at();

-- ä¸º task_participants è¡¨æ·»åŠ è§¦å‘å™¨
CREATE TRIGGER trg_task_participants_updated_at
BEFORE UPDATE ON task_participants
FOR EACH ROW EXECUTE FUNCTION set_updated_at();

-- ä¸º task_participant_rewards è¡¨æ·»åŠ è§¦å‘å™¨
CREATE TRIGGER trg_task_participant_rewards_updated_at
BEFORE UPDATE ON task_participant_rewards
FOR EACH ROW EXECUTE FUNCTION set_updated_at();

-- ä¸º chat_rooms è¡¨æ·»åŠ è§¦å‘å™¨
CREATE TRIGGER trg_chat_rooms_updated_at
BEFORE UPDATE ON chat_rooms
FOR EACH ROW EXECUTE FUNCTION set_updated_at();

-- æ³¨æ„ï¼štask_audit_logs è¡¨é€šå¸¸ä¸éœ€è¦ updated_at è‡ªåŠ¨æ›´æ–°ï¼ˆå®¡è®¡æ—¥å¿—åªæ’å…¥ä¸æ›´æ–°ï¼‰
```

**è¯´æ˜Ž**ï¼šè¿™äº›è§¦å‘å™¨ç¡®ä¿æ¯æ¬¡ UPDATE æ“ä½œæ—¶ï¼Œ`updated_at` å­—æ®µè‡ªåŠ¨æ›´æ–°ä¸ºå½“å‰æ—¶é—´ï¼Œç”¨äºŽä¹è§‚é”æœºåˆ¶ã€‚

---

## ðŸ”Œ API æŽ¥å£è®¾è®¡

### 1. ç®¡ç†å‘˜åˆ›å»ºå®˜æ–¹å¤šäººä»»åŠ¡

**æŽ¥å£**: `POST /api/admin/tasks/multi-participant`

**æƒé™**: éœ€è¦ç®¡ç†å‘˜è®¤è¯

**è¯·æ±‚ä½“**:
```json
{
  "title": "å¤§åž‹æ´»åŠ¨ç»„ç»‡ä»»åŠ¡",
  "description": "éœ€è¦å¤šäººåä½œå®Œæˆçš„æ´»åŠ¨ç»„ç»‡ä»»åŠ¡",
  "deadline": "2025-02-01T00:00:00Z",
  "reward_type": "points",
  "points_reward": 5000,
  "currency": "GBP",
  "location": "London",
  "task_type": "Social Help",
  "max_participants": 7,
  "min_participants": 5,
  "completion_rule": "min",
  "reward_distribution": "equal",
  "images": ["url1", "url2"],
  "is_public": true
}
```

**æ³¨æ„**ï¼šå½“ `reward_type="points"` æ—¶ï¼Œ`reward` å­—æ®µåº”çœç•¥æˆ–ä¸º 0ï¼Œä¸”æ•°æ®åº“ä¸­çš„ `reward` å­—æ®µåº”ä¸º 0 æˆ– NULLã€‚

**å“åº”**:
```json
{
  "id": 123,
  "title": "å¤§åž‹æ´»åŠ¨ç»„ç»‡ä»»åŠ¡",
  "description": "éœ€è¦å¤šäººåä½œå®Œæˆçš„æ´»åŠ¨ç»„ç»‡ä»»åŠ¡",
  "deadline": "2025-02-01T00:00:00Z",
  "reward": 0,
  "reward_type": "points",
  "points_reward": 5000,
  "currency": "GBP",
  "location": "London",
  "task_type": "Social Help",
  "status": "open",
  "is_multi_participant": true,
  "is_official_task": true,
  "max_participants": 7,
  "min_participants": 5,
  "current_participants": 0,
  "completion_rule": "min",
  "reward_distribution": "equal",
  "auto_accept": true,
  "allow_negotiation": false,
  "created_by_admin": true,
  "admin_creator_id": "A0001",
  "created_at": "2025-01-20T10:00:00Z"
}
```

**æ³¨æ„**ï¼šå½“ `reward_type="points"` æ—¶ï¼Œå“åº”ä¸­çš„ `reward` å­—æ®µä¸º 0ï¼Œæ•°æ®åº“ä¸­çš„ `reward` å­—æ®µåº”ä¸º 0 æˆ– NULLã€‚

**ä¸šåŠ¡é€»è¾‘**:
1. éªŒè¯ç®¡ç†å‘˜æƒé™
2. éªŒè¯ä»»åŠ¡æ•°æ®ï¼ˆmax_participants >= min_participants >= 1ï¼‰
3. éªŒè¯å¥–åŠ±ç±»åž‹å’Œé‡‘é¢ï¼ˆå¦‚æžœreward_typeåŒ…å«pointsï¼Œpoints_rewardå¿…é¡»>0ï¼‰
4. åˆ›å»ºä»»åŠ¡è®°å½•ï¼Œè®¾ç½®ï¼š
   - `is_multi_participant=true`
   - `is_official_task=true`ï¼ˆç®¡ç†å‘˜å‘å¸ƒçš„ä»»åŠ¡éƒ½æ˜¯å®˜æ–¹ä»»åŠ¡ï¼‰
   - `created_by_admin=true`
   - `auto_accept=true`ï¼ˆå®˜æ–¹ä»»åŠ¡è‡ªåŠ¨æŽ¥å—ç”³è¯·ï¼‰
   - `allow_negotiation=false`ï¼ˆå¤šäººä»»åŠ¡ä¸æ”¯æŒè®®ä»·ï¼‰
5. è®¾ç½® `poster_id` ä¸ºç³»ç»Ÿç”¨æˆ·IDæˆ–ç®¡ç†å‘˜å…³è”çš„ç”¨æˆ·IDï¼ˆå¦‚æžœéœ€è¦ï¼‰
6. è¿”å›žåˆ›å»ºçš„ä»»åŠ¡ä¿¡æ¯

### 2. ä»»åŠ¡è¾¾äººåˆ›å»ºå¤šäººä»»åŠ¡ï¼ˆå›ºå®šæ—¶é—´æ®µæœåŠ¡ï¼‰

**æŽ¥å£**: `POST /api/expert/tasks/multi-participant`

**æƒé™**: éœ€è¦ç”¨æˆ·è®¤è¯ï¼Œä¸”ç”¨æˆ·å¿…é¡»æ˜¯ä»»åŠ¡è¾¾äººï¼ˆexpertï¼‰

**è¯·æ±‚ä½“ï¼ˆå›ºå®šæ—¶é—´æ®µæœåŠ¡ï¼Œå¸¦æŠ˜æ‰£ï¼‰**:
```json
{
  "title": "éº»å°†æœåŠ¡",
  "description": "æä¾›éº»å°†å¨±ä¹æœåŠ¡ï¼Œæ¯å°æ—¶ä¸€ä¸ªæ—¶é—´æ®µï¼Œæ¯ä¸ªæ—¶é—´æ®µ4äººã€‚1ç‚¹åˆ°2ç‚¹æ—¶é—´æ®µç¼ºäººï¼Œç‰¹ä»·ä¼˜æƒ ï¼",
  "deadline": "2025-02-01T00:00:00Z",
  "reward_type": "cash",
  "reward": 8.00,
  "currency": "GBP",
  "location": "London",
  "task_type": "Entertainment",
  "max_participants": 4,
  "min_participants": 4,
  "completion_rule": "all",
  "reward_distribution": "equal",
  "expert_service_id": 123,  // å¿…é¡»ï¼šå…³è”çš„è¾¾äººæœåŠ¡ID
  "is_fixed_time_slot": true,
  "time_slot_duration_minutes": 60,
  "time_slot_start_time": "12:00",
  "time_slot_end_time": "22:00",
  "participants_per_slot": 4,
  "original_price_per_participant": 10.00,  // åŸºäºŽè¾¾äººæœåŠ¡çš„base_price
  "discount_percentage": 20.00,
  "discounted_price_per_participant": 8.00,
  "images": ["url1", "url2"],  // å¯é€‰ï¼Œå¦‚æžœä¸æä¾›åˆ™ä½¿ç”¨è¾¾äººæœåŠ¡çš„images
  "is_public": true
}
```

**è¯·æ±‚ä½“ï¼ˆå›ºå®šæ—¶é—´æ®µæœåŠ¡ï¼Œæ— æŠ˜æ‰£ï¼‰**:
```json
{
  "title": "éº»å°†æœåŠ¡",
  "description": "æä¾›éº»å°†å¨±ä¹æœåŠ¡ï¼Œæ¯å°æ—¶ä¸€ä¸ªæ—¶é—´æ®µï¼Œæ¯ä¸ªæ—¶é—´æ®µ4äºº",
  "deadline": "2025-02-01T00:00:00Z",
  "reward_type": "cash",
  "reward": 10.00,
  "currency": "GBP",
  "location": "London",
  "task_type": "Entertainment",
  "max_participants": 4,
  "min_participants": 4,
  "completion_rule": "all",
  "reward_distribution": "equal",
  "expert_service_id": 123,  // å¿…é¡»ï¼šå…³è”çš„è¾¾äººæœåŠ¡ID
  "is_fixed_time_slot": true,
  "time_slot_duration_minutes": 60,
  "time_slot_start_time": "12:00",
  "time_slot_end_time": "22:00",
  "participants_per_slot": 4,
  "images": ["url1", "url2"],  // å¯é€‰ï¼Œå¦‚æžœä¸æä¾›åˆ™ä½¿ç”¨è¾¾äººæœåŠ¡çš„images
  "is_public": true
}
```

**è¯·æ±‚ä½“ï¼ˆéžå›ºå®šæ—¶é—´æ®µæœåŠ¡ï¼Œä»»åŠ¡è¾¾äººå‘å¸ƒï¼‰**:
```json
{
  "title": "æ‘„å½±æœåŠ¡",
  "description": "æä¾›ä¸“ä¸šæ‘„å½±æœåŠ¡ï¼Œç”³è¯·äººå¯é€‰æ‹©æˆªæ­¢æ—¥æœŸæˆ–çµæ´»æ—¶é—´",
  "deadline": "2025-02-28T00:00:00Z",
  "reward_type": "cash",
  "reward": 150.00,
  "currency": "GBP",
  "location": "London",
  "task_type": "Photography",
  "max_participants": 1,
  "min_participants": 1,
  "completion_rule": "all",
  "reward_distribution": "equal",
  "expert_service_id": 124,  // å¿…é¡»ï¼šå…³è”çš„è¾¾äººæœåŠ¡ID
  "is_fixed_time_slot": false,
  "images": ["url1", "url2"],  // å¯é€‰ï¼Œå¦‚æžœä¸æä¾›åˆ™ä½¿ç”¨è¾¾äººæœåŠ¡çš„images
  "is_public": true
}
```

**è¯·æ±‚ä½“ï¼ˆæ™®é€šå¤šäººä»»åŠ¡ï¼Œéžå›ºå®šæ—¶é—´æ®µï¼‰**:
```json
{
  "title": "å›¢é˜Ÿåä½œä»»åŠ¡",
  "description": "éœ€è¦å¤šäººåä½œå®Œæˆçš„ä»»åŠ¡",
  "deadline": "2025-02-01T00:00:00Z",
  "reward_type": "points",
  "points_reward": 3000,
  "currency": "GBP",
  "location": "London",
  "task_type": "Social Help",
  "max_participants": 5,
  "min_participants": 3,
  "completion_rule": "min",
  "reward_distribution": "equal",
  "is_fixed_time_slot": false,
  "images": ["url1", "url2"],
  "is_public": true
}
```

**å“åº”ï¼ˆå¸¦æŠ˜æ‰£ï¼‰**:
```json
{
  "id": 124,
  "title": "éº»å°†æœåŠ¡",
  "description": "æä¾›éº»å°†å¨±ä¹æœåŠ¡ï¼Œæ¯å°æ—¶ä¸€ä¸ªæ—¶é—´æ®µï¼Œæ¯ä¸ªæ—¶é—´æ®µ4äººã€‚1ç‚¹åˆ°2ç‚¹æ—¶é—´æ®µç¼ºäººï¼Œç‰¹ä»·ä¼˜æƒ ï¼",
  "deadline": "2025-02-01T00:00:00Z",
  "reward": 8.00,
  "reward_type": "cash",
  "currency": "GBP",
  "location": "London",
  "task_type": "Entertainment",
  "status": "open",
  "is_multi_participant": true,
  "is_official_task": false,
  "created_by_expert": true,
  "expert_creator_id": "12345678",
  "max_participants": 4,
  "min_participants": 4,
  "current_participants": 0,
  "completion_rule": "all",
  "reward_distribution": "equal",
  "auto_accept": false,
  "allow_negotiation": false,
  "is_fixed_time_slot": true,
  "time_slot_duration_minutes": 60,
  "time_slot_start_time": "12:00",
  "time_slot_end_time": "22:00",
  "participants_per_slot": 4,
  "original_price_per_participant": 10.00,
  "discount_percentage": 20.00,
  "discounted_price_per_participant": 8.00,
  "has_discount": true,
  "time_slots": [
    {
      "slot_id": 1,
      "start_time": "12:00",
      "end_time": "13:00",
      "current_participants": 0,
      "max_participants": 4,
      "is_full": false
    },
    {
      "slot_id": 2,
      "start_time": "13:00",
      "end_time": "14:00",
      "current_participants": 0,
      "max_participants": 4,
      "is_full": false
    }
    // ... æ›´å¤šæ—¶é—´æ®µ
  ],
  "created_at": "2025-01-20T10:00:00Z"
}
```

**ä¸šåŠ¡é€»è¾‘**:
1. éªŒè¯ç”¨æˆ·æ˜¯å¦ä¸ºä»»åŠ¡è¾¾äººï¼ˆexpertï¼‰
2. **éªŒè¯è¾¾äººæœåŠ¡å…³è”**ï¼ˆå¿…éœ€ï¼‰ï¼š
   - éªŒè¯è¯·æ±‚ä¸­åŒ…å« `expert_service_id`
   - éªŒè¯è¾¾äººæœåŠ¡å­˜åœ¨ä¸”å±žäºŽå½“å‰ä»»åŠ¡è¾¾äººï¼ˆ`task_expert_services.expert_id = å½“å‰ç”¨æˆ·ID`ï¼‰
   - éªŒè¯è¾¾äººæœåŠ¡çŠ¶æ€ä¸º `active`
   - èŽ·å–è¾¾äººæœåŠ¡çš„åŸºç¡€ä»·æ ¼ï¼ˆ`base_price`ï¼‰ä½œä¸ºåŽŸä»·åŸºç¡€
3. éªŒè¯ä»»åŠ¡æ•°æ®ï¼ˆmax_participants >= min_participants >= 1ï¼‰
4. **å›ºå®šæ—¶é—´æ®µéªŒè¯**ï¼ˆå¯é€‰ï¼‰ï¼šå¦‚æžœ `is_fixed_time_slot=true`ï¼ŒéªŒè¯æ—¶é—´æ®µç›¸å…³å­—æ®µï¼š
   - `time_slot_duration_minutes` å¿…é¡» > 0ï¼ˆå¯ä»¥æ˜¯60åˆ†é’Ÿã€120åˆ†é’Ÿç­‰ï¼Œè¡¨ç¤º1å°æ—¶ã€2å°æ—¶ç­‰ï¼‰
   - `time_slot_end_time` å¿…é¡» > `time_slot_start_time`
   - `participants_per_slot` å¿…é¡» >= 1 ä¸” <= `max_participants`
   - è®¡ç®—æ—¶é—´æ®µæ€»æ•°ï¼Œç¡®ä¿ä¸ºæ•´æ•°
5. **éžå›ºå®šæ—¶é—´æ®µ**ï¼šå¦‚æžœ `is_fixed_time_slot=false`ï¼Œæ—¶é—´æ®µç›¸å…³å­—æ®µåº”ä¸º NULL æˆ–çœç•¥
6. éªŒè¯å¥–åŠ±ç±»åž‹å’Œé‡‘é¢
7. **ä»·æ ¼è®¾ç½®**ï¼š
   - å¦‚æžœæœªè®¾ç½®æŠ˜æ‰£ï¼š`original_price_per_participant` å’Œ `reward` åº”ç­‰äºŽè¾¾äººæœåŠ¡çš„ `base_price`
   - å¦‚æžœè®¾ç½®äº†æŠ˜æ‰£ï¼š
     - `original_price_per_participant` åº”ç­‰äºŽè¾¾äººæœåŠ¡çš„ `base_price`
     - `discount_percentage` å¿…é¡»åœ¨ 0-100 ä¹‹é—´
     - `discounted_price_per_participant` å¿…é¡» > 0 ä¸” <= `original_price_per_participant`
     - éªŒè¯ `discounted_price_per_participant` æ˜¯å¦ç­‰äºŽ `original_price_per_participant * (1 - discount_percentage / 100)`ï¼ˆå…è®¸æµ®ç‚¹æ•°ç²¾åº¦è¯¯å·®ï¼‰
     - ä»»åŠ¡çš„ `reward` å­—æ®µåº”ç­‰äºŽ `discounted_price_per_participant`ï¼ˆæˆ–æ ¹æ®å¥–åŠ±åˆ†é…æ–¹å¼è®¡ç®—æ€»å¥–åŠ±ï¼‰
8. **å›¾ç‰‡å¤„ç†**ï¼šå¦‚æžœè¯·æ±‚ä¸­æœªæä¾› `images`ï¼Œä½¿ç”¨è¾¾äººæœåŠ¡çš„ `images`
9. åˆ›å»ºä»»åŠ¡è®°å½•ï¼Œè®¾ç½®ï¼š
   - `is_multi_participant=true`
   - `is_official_task=false`ï¼ˆä»»åŠ¡è¾¾äººå‘å¸ƒçš„ä»»åŠ¡ä¸æ˜¯å®˜æ–¹ä»»åŠ¡ï¼‰
   - `created_by_expert=true`
   - `expert_creator_id` ä¸ºå½“å‰ç”¨æˆ·IDï¼ˆä»»åŠ¡è¾¾äººIDï¼‰
   - `expert_service_id` ä¸ºè¯·æ±‚ä¸­çš„è¾¾äººæœåŠ¡IDï¼ˆå…³è”è¾¾äººæœåŠ¡ï¼‰
   - **é‡è¦**ï¼š`poster_id` å¯ä»¥è®¾ç½®ä¸ºç³»ç»Ÿç”¨æˆ·IDæˆ–NULLï¼ˆä»»åŠ¡è¾¾äººä¸æ˜¯ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„å‘å¸ƒè€…ï¼Œè€Œæ˜¯æœåŠ¡æä¾›è€…ï¼‰
   - **é‡è¦**ï¼š`taker_id` å¿…é¡»è®¾ç½®ä¸ºå½“å‰ç”¨æˆ·IDï¼ˆä»»åŠ¡è¾¾äººæä¾›æœåŠ¡ï¼Œæ”¶é’±ï¼Œæ˜¯æŽ¥æ”¶è€…ï¼‰
   - `auto_accept=false`ï¼ˆé»˜è®¤éœ€è¦å®¡æ ¸ï¼Œå¯æ ¹æ®å¹³å°ç­–ç•¥è°ƒæ•´ï¼‰
   - `allow_negotiation=false`ï¼ˆå¤šäººä»»åŠ¡ä¸æ”¯æŒè®®ä»·ï¼Œä½†ä»»åŠ¡è¾¾äººå¯ä»¥è‡ªå·±è®¾ç½®æŠ˜æ‰£ï¼‰
   - å¦‚æžœæœªæä¾› `images`ï¼Œä»Žè¾¾äººæœåŠ¡å¤åˆ¶ `images`
10. å¦‚æžœ `is_fixed_time_slot=true`ï¼Œè‡ªåŠ¨ç”Ÿæˆæ‰€æœ‰æ—¶é—´æ®µåˆ—è¡¨
11. è¿”å›žåˆ›å»ºçš„ä»»åŠ¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ—¶é—´æ®µåˆ—è¡¨ï¼ˆå¦‚æžœæœ‰ï¼‰å’ŒæŠ˜æ‰£ä¿¡æ¯ï¼ˆå¦‚æžœæœ‰ï¼‰ï¼Œä»¥åŠå…³è”çš„è¾¾äººæœåŠ¡ä¿¡æ¯

**æ—¶é—´æ®µç”Ÿæˆé€»è¾‘**:
- æ ¹æ® `time_slot_start_time`ã€`time_slot_end_time` å’Œ `time_slot_duration_minutes` è®¡ç®—æ—¶é—´æ®µæ•°é‡
- ä¾‹å¦‚ï¼š12:00-22:00ï¼Œæ¯60åˆ†é’Ÿä¸€ä¸ªæ—¶é—´æ®µï¼Œå…±10ä¸ªæ—¶é—´æ®µ
- æ¯ä¸ªæ—¶é—´æ®µç‹¬ç«‹ï¼Œæœ‰è‡ªå·±çš„å‚ä¸Žäººæ•°é™åˆ¶

### 3. ç”¨æˆ·ç”³è¯·å‚ä¸Žå¤šäººä»»åŠ¡ï¼ˆå®˜æ–¹ä»»åŠ¡è‡ªåŠ¨æŽ¥å—ï¼‰

**æŽ¥å£**: `POST /api/tasks/{task_id}/apply`

**æƒé™**: éœ€è¦ç”¨æˆ·è®¤è¯

**è¯·æ±‚ä½“ï¼ˆæ™®é€šå¤šäººä»»åŠ¡ï¼‰**:
```json
{
  "message": "æˆ‘æœ‰ç›¸å…³ç»éªŒï¼Œå¸Œæœ›å‚ä¸Žæ­¤ä»»åŠ¡",
  "idempotency_key": "unique-request-id-12345"  // å»ºè®®æºå¸¦ï¼Œç”¨äºŽé˜²æ­¢é‡å¤ç”³è¯·
}
```

**è¯·æ±‚ä½“ï¼ˆå›ºå®šæ—¶é—´æ®µæœåŠ¡ï¼‰**:
```json
{
  "message": "æˆ‘æƒ³å‚ä¸Žè¿™ä¸ªæ—¶é—´æ®µ",
  "time_slot_id": 1,  // æ—¶é—´æ®µIDï¼ˆä»Žä»»åŠ¡è¯¦æƒ…çš„æ—¶é—´æ®µåˆ—è¡¨ä¸­èŽ·å–ï¼‰
  "idempotency_key": "unique-request-id-12345"  // å»ºè®®æºå¸¦ï¼Œç”¨äºŽé˜²æ­¢é‡å¤ç”³è¯·
}
```

**è¯·æ±‚ä½“ï¼ˆéžå›ºå®šæ—¶é—´æ®µæœåŠ¡ï¼Œä»»åŠ¡è¾¾äººå‘å¸ƒï¼‰**:
```json
{
  "message": "æˆ‘å¸Œæœ›å‚ä¸Žæ­¤æœåŠ¡",
  "is_flexible_time": false,  // æ˜¯å¦ä¸ºçµæ´»æ—¶é—´ï¼Œfalseè¡¨ç¤ºæœ‰å…·ä½“æˆªæ­¢æ—¥æœŸï¼Œtrueè¡¨ç¤ºæ—¶é—´çµæ´»
  "preferred_deadline": "2025-02-15T18:00:00Z",  // æœŸæœ›çš„æˆªæ­¢æ—¥æœŸï¼ˆä»…å½“is_flexible_time=falseæ—¶æä¾›ï¼‰
  "idempotency_key": "unique-request-id-12345"  // å»ºè®®æºå¸¦ï¼Œç”¨äºŽé˜²æ­¢é‡å¤ç”³è¯·
}
```

**è¯·æ±‚ä½“ï¼ˆéžå›ºå®šæ—¶é—´æ®µæœåŠ¡ï¼Œçµæ´»æ—¶é—´ï¼‰**:
```json
{
  "message": "æˆ‘å¸Œæœ›å‚ä¸Žæ­¤æœåŠ¡ï¼Œæ—¶é—´çµæ´»",
  "is_flexible_time": true,  // æ—¶é—´çµæ´»ï¼Œä¸éœ€è¦å…·ä½“æˆªæ­¢æ—¥æœŸ
  "idempotency_key": "unique-request-id-12345"  // å»ºè®®æºå¸¦ï¼Œç”¨äºŽé˜²æ­¢é‡å¤ç”³è¯·
}
```

**å“åº”ï¼ˆå®˜æ–¹ä»»åŠ¡ï¼Œè‡ªåŠ¨æŽ¥å—ï¼‰**:
```json
{
  "id": 456,
  "task_id": 123,
  "user_id": "12345678",
  "status": "accepted",
  "applied_at": "2025-01-20T10:30:00Z",
  "accepted_at": "2025-01-20T10:30:00Z",
  "can_chat": true,
  "can_auto_accept": true,
  "room_code": "8b9f4e40-9a2c-4c7a-9f2a-7e2ce6a6b9a1"
}
```

**å­—æ®µè¯´æ˜Ž**ï¼š
- `can_auto_accept`: æ ‡è¯†ä»»åŠ¡æ˜¯å¦æ”¯æŒè‡ªåŠ¨æŽ¥å—ï¼ˆ`true` è¡¨ç¤ºå®˜æ–¹ä»»åŠ¡è‡ªåŠ¨æŽ¥å—ï¼Œ`false` è¡¨ç¤ºéœ€è¦ç­‰å¾…ç®¡ç†å‘˜å®¡æ ¸ï¼‰
- `room_code`: ä¸å¯é¢„æµ‹çš„èŠå¤©å®¤ä»£ç ï¼ˆUUIDæ ¼å¼ï¼‰ï¼Œä¸æš´éœ²ä»»åŠ¡ID

**ä¸šåŠ¡é€»è¾‘**:
1. éªŒè¯ä»»åŠ¡æ˜¯å¦å­˜åœ¨ä¸”ä¸ºå¤šäººä»»åŠ¡
2. **ä»»åŠ¡è¾¾äººæœåŠ¡éªŒè¯**ï¼ˆå¦‚æžœ `created_by_expert=true`ï¼‰ï¼š
   - éªŒè¯ä»»åŠ¡å…³è”çš„è¾¾äººæœåŠ¡å­˜åœ¨ä¸”çŠ¶æ€ä¸º `active`
   - éªŒè¯ç”¨æˆ·æœªé‡å¤ç”³è¯·æ­¤è¾¾äººæœåŠ¡ï¼ˆé€šè¿‡ `task_participants` è¡¨æ£€æŸ¥ï¼ŒåŒä¸€ç”¨æˆ·ä¸èƒ½é‡å¤ç”³è¯·åŒä¸€ä»»åŠ¡çš„åŒä¸€æ—¶é—´æ®µï¼‰
   - **é‡è¦**ï¼šç”³è¯·äººç”³è¯·å‚ä¸Žæ­¤ä»»åŠ¡æ—¶ï¼Œå®žé™…ä¸Šæ˜¯åœ¨ç”³è¯·æ­¤è¾¾äººæœåŠ¡
   - **ä»·æ ¼è¯´æ˜Ž**ï¼šä»·æ ¼ä»¥ä»»åŠ¡è¾¾äººå‘å¸ƒä»»åŠ¡æ—¶è®¾ç½®çš„ä»·æ ¼ä¸ºå‡†ï¼ˆåŸºäºŽè¾¾äººæœåŠ¡çš„ `base_price`ï¼Œå¯èƒ½åŒ…å«æŠ˜æ‰£ï¼‰
   - **ä¸šåŠ¡å«ä¹‰**ï¼šç”³è¯·äººä»¥ä»»åŠ¡è¾¾äººå‘å¸ƒä»»åŠ¡çš„ä»·æ ¼ç”³è¯·åˆ°æ­¤è¾¾äººæœåŠ¡
3. éªŒè¯ä»»åŠ¡çŠ¶æ€ä¸º `open`ï¼ˆ**é‡è¦**ï¼šä»»åŠ¡å¼€å§‹åŽï¼ˆ`in_progress` çŠ¶æ€ï¼‰ä¸å…è®¸æ–°æˆå‘˜ç”³è¯·åŠ å…¥ï¼Œå¦‚éœ€æ”¯æŒ"è¿Ÿåˆ°åŠ å…¥"ï¼Œéœ€è¦æ˜Žç¡®ç­–ç•¥ï¼Œè§"è¿Ÿåˆ°åŠ å…¥è§„åˆ™"ç« èŠ‚ï¼‰
4. **å›ºå®šæ—¶é—´æ®µéªŒè¯**ï¼šå¦‚æžœä»»åŠ¡ `is_fixed_time_slot=true`ï¼š
   - éªŒè¯è¯·æ±‚ä¸­åŒ…å« `time_slot_id`
   - éªŒè¯æ—¶é—´æ®µæ˜¯å¦å­˜åœ¨ä¸”æœ‰æ•ˆ
   - éªŒè¯æ—¶é—´æ®µæ˜¯å¦å·²æ»¡ï¼ˆè¯¥æ—¶é—´æ®µçš„å‚ä¸Žè€…æ•°é‡æ˜¯å¦å·²è¾¾åˆ° `participants_per_slot`ï¼‰
   - éªŒè¯ç”¨æˆ·æ˜¯å¦å·²ç”³è¯·è¯¥æ—¶é—´æ®µï¼ˆåŒä¸€ç”¨æˆ·ä¸èƒ½é‡å¤ç”³è¯·åŒä¸€æ—¶é—´æ®µï¼‰
5. **éžå›ºå®šæ—¶é—´æ®µéªŒè¯**ï¼šå¦‚æžœä»»åŠ¡ `is_fixed_time_slot=false` ä¸” `created_by_expert=true`ï¼ˆä»»åŠ¡è¾¾äººå‘å¸ƒçš„æœåŠ¡ï¼‰ï¼š
   - éªŒè¯è¯·æ±‚ä¸­åŒ…å« `is_flexible_time` å­—æ®µ
   - å¦‚æžœ `is_flexible_time=false`ï¼ŒéªŒè¯è¯·æ±‚ä¸­åŒ…å« `preferred_deadline` ä¸”ä¸ºæœ‰æ•ˆçš„æœªæ¥æ—¶é—´
   - å¦‚æžœ `is_flexible_time=true`ï¼Œ`preferred_deadline` åº”ä¸º NULL
   - éªŒè¯ `preferred_deadline` ä¸æ—©äºŽå½“å‰æ—¶é—´ï¼ˆå¦‚æžœæä¾›äº†ï¼‰
6. **å¹¶å‘æŽ§åˆ¶**ï¼šå¼€å¯æ•°æ®åº“äº‹åŠ¡ï¼Œå¯¹ `tasks` è®°å½•ä½¿ç”¨ `SELECT ... FOR UPDATE` é”å®š
7. **å®žæ—¶è®¡æ•°éªŒè¯**ï¼š
   - å¦‚æžœ `is_fixed_time_slot=true`ï¼šä½¿ç”¨ `COUNT(*)` æŸ¥è¯¢æŒ‡å®šæ—¶é—´æ®µçš„å‚ä¸Žè€…æ•°é‡ï¼Œç¡®è®¤æœªè¾¾åˆ° `participants_per_slot`
   - å¦‚æžœ `is_fixed_time_slot=false`ï¼šä½¿ç”¨ `COUNT(*)` æŸ¥è¯¢ `task_participants` è¡¨ä¸­çŠ¶æ€ä¸º `pending`ã€`accepted`ã€`in_progress` çš„å‚ä¸Žè€…æ•°é‡ï¼Œç¡®è®¤æœªè¾¾åˆ° `max_participants`
8. éªŒè¯ç”¨æˆ·æœªé‡å¤ç”³è¯·ï¼ˆæ£€æŸ¥ `task_participants` è¡¨ï¼Œåˆ©ç”¨å”¯ä¸€çº¦æŸï¼›å›ºå®šæ—¶é—´æ®µæœåŠ¡éœ€è¦é¢å¤–éªŒè¯åŒä¸€æ—¶é—´æ®µï¼‰
9. **å¹‚ç­‰æ€§éªŒè¯**ï¼šå¦‚æžœè¯·æ±‚åŒ…å« `idempotency_key`ï¼Œæ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒé”®çš„è®°å½•ï¼Œå¦‚æžœå­˜åœ¨åˆ™è¿”å›žå·²æœ‰è®°å½•
10. éªŒè¯ä»»åŠ¡æ˜¯å¦å…è®¸è®®ä»·ï¼ˆå¤šäººä»»åŠ¡ä¸å…è®¸è®®ä»·ï¼Œå¦‚æžœç”¨æˆ·å°è¯•è®®ä»·åˆ™æ‹’ç»ï¼‰
11. åˆ›å»º `task_participants` è®°å½•ï¼š
    - å¦‚æžœä»»åŠ¡ `auto_accept=true`ï¼ˆå®˜æ–¹ä»»åŠ¡ï¼‰ï¼ŒçŠ¶æ€ç›´æŽ¥è®¾ä¸º `accepted`ï¼Œ`accepted_at` ç­‰äºŽ `applied_at`
    - å¦‚æžœä»»åŠ¡ `auto_accept=false`ï¼ŒçŠ¶æ€è®¾ä¸º `pending`ï¼Œ`accepted_at` ä¸º NULLï¼ˆç­‰å¾…ç®¡ç†å‘˜å®¡æ ¸ï¼‰
    - å¦‚æžœ `is_fixed_time_slot=true`ï¼Œè®°å½• `time_slot_id`
    - å¦‚æžœ `is_fixed_time_slot=false` ä¸” `created_by_expert=true`ï¼Œè®°å½• `is_flexible_time` å’Œ `preferred_deadline`
12. å¦‚æžœè‡ªåŠ¨æŽ¥å—ï¼š
    - æ›´æ–°ä»»åŠ¡çš„ `current_participants` è®¡æ•°ï¼ˆä»…ä½œä¸ºå±•ç¤ºç”¨ç¼“å­˜ï¼Œå†³ç­–ä»ä»¥å®žæ—¶è®¡æ•°ä¸ºå‡†ï¼‰
    - è‡ªåŠ¨åˆ›å»ºæˆ–åŠ å…¥ä»»åŠ¡èŠå¤©å®¤ï¼ˆä½¿ç”¨ä¸å¯é¢„æµ‹çš„ `room_code`ï¼‰
    - å‘é€æ¬¢è¿Žæ¶ˆæ¯åˆ°èŠå¤©å®¤
    - å‘é€é€šçŸ¥ç»™ç”¨æˆ·ï¼ˆå·²æˆåŠŸåŠ å…¥ä»»åŠ¡ï¼‰
    - **ä»»åŠ¡è¾¾äººæœåŠ¡**ï¼šå¦‚æžœ `created_by_expert=true`ï¼Œè®°å½•ç”³è¯·äººå·²ç”³è¯·æ­¤è¾¾äººæœåŠ¡
13. å¦‚æžœæœªè‡ªåŠ¨æŽ¥å—ï¼š
    - å‘é€é€šçŸ¥ç»™ç®¡ç†å‘˜/å‘å¸ƒè€…ï¼ˆä»»åŠ¡è¾¾äººï¼‰ï¼Œé€šçŸ¥ä¸­åŒ…å«ç”³è¯·äººçš„æ—¶é—´åå¥½ä¿¡æ¯
    - **ä»»åŠ¡è¾¾äººæœåŠ¡**ï¼šå¦‚æžœ `created_by_expert=true`ï¼Œé€šçŸ¥ä»»åŠ¡è¾¾äººæœ‰æ–°çš„æœåŠ¡ç”³è¯·
14. **å®¡è®¡æ—¥å¿—**ï¼šè®°å½•æ“ä½œåˆ° `task_audit_logs` è¡¨ï¼ŒåŒ…å«æ—¶é—´åå¥½ä¿¡æ¯ï¼ˆå¦‚æžœæœ‰ï¼‰å’Œå…³è”çš„è¾¾äººæœåŠ¡ä¿¡æ¯ï¼ˆå¦‚æžœæœ‰ï¼‰
15. æäº¤äº‹åŠ¡
16. è¿”å›žå‚ä¸Žè€…ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ˜¯å¦å¯ä»¥èŠå¤©å’ŒèŠå¤©å®¤IDï¼ˆä½¿ç”¨ä¸å¯é¢„æµ‹çš„ `room_code`ï¼Œæ ¼å¼ä¸º UUIDï¼Œä¸æš´éœ² `task_id`ï¼‰ï¼Œä»¥åŠå…³è”çš„è¾¾äººæœåŠ¡ä¿¡æ¯ï¼ˆå¦‚æžœæœ‰ï¼‰

### 3. å‚ä¸Žè€…ç”³è¯·é€€å‡ºä»»åŠ¡

**æŽ¥å£**: `POST /api/tasks/{task_id}/participants/me/exit-request`

**æƒé™**: éœ€è¦ç”¨æˆ·è®¤è¯ï¼Œä¸”ç”¨æˆ·å¿…é¡»æ˜¯è¯¥ä»»åŠ¡çš„å‚ä¸Žè€…

**è¯·æ±‚ä½“**:
```json
{
  "exit_reason": "å› ä¸ªäººåŽŸå› æ— æ³•ç»§ç»­å‚ä¸Ž",
  "idempotency_key": "unique-request-id-12345"  // å»ºè®®æºå¸¦ï¼Œç”¨äºŽé˜²æ­¢é‡å¤ç”³è¯·é€€å‡º
}
```

**å“åº”**:
```json
{
  "id": 456,
  "task_id": 123,
  "user_id": "12345678",
  "status": "exit_requested",
  "exit_requested_at": "2025-01-20T11:00:00Z",
  "exit_reason": "å› ä¸ªäººåŽŸå› æ— æ³•ç»§ç»­å‚ä¸Ž"
}
```

**ä¸šåŠ¡é€»è¾‘**:
1. éªŒè¯ç”¨æˆ·æ˜¯è¯¥ä»»åŠ¡çš„å‚ä¸Žè€…
2. éªŒè¯å‚ä¸Žè€…çŠ¶æ€ä¸º `accepted` æˆ– `in_progress`ï¼ˆå·²å®Œæˆæˆ–å·²é€€å‡ºçš„ä¸èƒ½å†æ¬¡ç”³è¯·é€€å‡ºï¼‰
3. **å¹‚ç­‰æ€§éªŒè¯**ï¼šå¦‚æžœè¯·æ±‚åŒ…å« `idempotency_key`ï¼Œæ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒé”®çš„é€€å‡ºç”³è¯·
4. å¼€å¯æ•°æ®åº“äº‹åŠ¡
5. ä¿å­˜å½“å‰çŠ¶æ€åˆ° `previous_status` å­—æ®µ
6. æ›´æ–°å‚ä¸Žè€…çŠ¶æ€ä¸º `exit_requested`
7. è®¾ç½® `exit_requested_at` å’Œ `exit_reason`
8. **å®¡è®¡æ—¥å¿—**ï¼šè®°å½•æ“ä½œåˆ° `task_audit_logs` è¡¨
9. æäº¤äº‹åŠ¡
10. å‘é€é€šçŸ¥ç»™ç®¡ç†å‘˜
11. åœ¨èŠå¤©å®¤å‘é€ç³»ç»Ÿæ¶ˆæ¯ï¼ˆå¯é€‰ï¼‰

### 4. ç®¡ç†å‘˜/ä»»åŠ¡è¾¾äººæ‰¹å‡†/æ‹’ç»é€€å‡ºç”³è¯·

**æŽ¥å£**: `POST /api/admin/tasks/{task_id}/participants/{participant_id}/approve-exit`
**æŽ¥å£**: `POST /api/admin/tasks/{task_id}/participants/{participant_id}/reject-exit`
**æŽ¥å£**: `POST /api/expert/tasks/{task_id}/participants/{participant_id}/approve-exit`
**æŽ¥å£**: `POST /api/expert/tasks/{task_id}/participants/{participant_id}/reject-exit`

**æƒé™**: 
- ç®¡ç†å‘˜æŽ¥å£ï¼šéœ€è¦ç®¡ç†å‘˜è®¤è¯
- ä»»åŠ¡è¾¾äººæŽ¥å£ï¼šéœ€è¦ç”¨æˆ·è®¤è¯ï¼Œä¸”ç”¨æˆ·å¿…é¡»æ˜¯è¯¥ä»»åŠ¡çš„åˆ›å»ºè€…ï¼ˆ`expert_creator_id` æˆ– `taker_id`ï¼‰

**è¯·æ±‚ä½“ï¼ˆæ‰¹å‡†ï¼‰**:
```json
{
  "admin_notes": "æ‰¹å‡†é€€å‡ºç”³è¯·"
}
```

**è¯·æ±‚ä½“ï¼ˆæ‹’ç»ï¼‰**:
```json
{
  "admin_notes": "ä»»åŠ¡è¿›è¡Œä¸­ï¼Œæš‚ä¸æ‰¹å‡†é€€å‡º"
}
```

**å“åº”ï¼ˆæ‰¹å‡†ï¼‰**:
```json
{
  "id": 456,
  "task_id": 123,
  "user_id": "12345678",
  "status": "exited",
  "exited_at": "2025-01-20T12:00:00Z",
  "admin_notes": "æ‰¹å‡†é€€å‡ºç”³è¯·"
}
```

**ä¸šåŠ¡é€»è¾‘ï¼ˆæ‰¹å‡†ï¼‰**:
1. éªŒè¯æƒé™ï¼š
   - ç®¡ç†å‘˜æŽ¥å£ï¼šéªŒè¯ç®¡ç†å‘˜æƒé™
   - ä»»åŠ¡è¾¾äººæŽ¥å£ï¼šéªŒè¯ç”¨æˆ·æ˜¯ä»»åŠ¡åˆ›å»ºè€…ï¼ˆ`expert_creator_id` æˆ– `taker_id`ï¼‰
2. éªŒè¯å‚ä¸Žè€…çŠ¶æ€ä¸º `exit_requested`
3. å¼€å¯æ•°æ®åº“äº‹åŠ¡
4. æ›´æ–°å‚ä¸Žè€…çŠ¶æ€ä¸º `exited`
5. è®¾ç½® `exited_at` æ—¶é—´
6. **äººæ•°ç»Ÿè®¡**ï¼šå¦‚å¯ç”¨ `current_participants` ç¼“å­˜å­—æ®µï¼Œåˆ™åœ¨æ­¤å¤„ç”±è§¦å‘å™¨è‡ªåŠ¨ç»´æŠ¤ï¼Œæ— éœ€åº”ç”¨å±‚æ›´æ–°ï¼ˆè¯¦è§"current_participants å­—æ®µè¯´æ˜Ž"ç« èŠ‚ï¼‰
7. **ä»Žä»»åŠ¡èŠå¤©å®¤ç§»é™¤è¯¥ç”¨æˆ·**ï¼ˆå¿…éœ€ï¼‰ï¼š
   - ä»ŽèŠå¤©å®¤æˆå‘˜åˆ—è¡¨ä¸­ç§»é™¤
   - ç¦æ­¢è¯¥ç”¨æˆ·ç»§ç»­å‘é€æ¶ˆæ¯
   - è¯¥ç”¨æˆ·ä»å¯æŸ¥çœ‹åŽ†å²æ¶ˆæ¯ï¼ˆå¯é€‰ï¼Œæ ¹æ®ä¸šåŠ¡éœ€æ±‚ï¼‰
8. **å®¡è®¡æ—¥å¿—**ï¼šè®°å½•æ“ä½œåˆ° `task_audit_logs` è¡¨ï¼ŒåŒ…å«æ“ä½œè€…IDï¼ˆç®¡ç†å‘˜IDæˆ–ä»»åŠ¡è¾¾äººIDï¼‰
9. æäº¤äº‹åŠ¡
10. å‘é€é€šçŸ¥ç»™å‚ä¸Žè€…
11. åœ¨èŠå¤©å®¤å‘é€ç³»ç»Ÿæ¶ˆæ¯ï¼ˆå¿…éœ€ï¼‰ï¼šé€šçŸ¥å…¶ä»–å‚ä¸Žè€…è¯¥ç”¨æˆ·å·²é€€å‡º

**ä¸šåŠ¡é€»è¾‘ï¼ˆæ‹’ç»ï¼‰**:
1. éªŒè¯æƒé™ï¼š
   - ç®¡ç†å‘˜æŽ¥å£ï¼šéªŒè¯ç®¡ç†å‘˜æƒé™
   - ä»»åŠ¡è¾¾äººæŽ¥å£ï¼šéªŒè¯ç”¨æˆ·æ˜¯ä»»åŠ¡åˆ›å»ºè€…ï¼ˆ`expert_creator_id` æˆ– `taker_id`ï¼‰
2. éªŒè¯å‚ä¸Žè€…çŠ¶æ€ä¸º `exit_requested`
3. å¼€å¯æ•°æ®åº“äº‹åŠ¡
4. ä»Ž `previous_status` å­—æ®µæ¢å¤ä¹‹å‰çš„çŠ¶æ€ï¼ˆ`accepted` æˆ– `in_progress`ï¼‰
5. æ¸…ç©º `exit_requested_at`ã€`exit_reason` å’Œ `previous_status`
6. **å®¡è®¡æ—¥å¿—**ï¼šè®°å½•æ“ä½œåˆ° `task_audit_logs` è¡¨ï¼ŒåŒ…å«æ“ä½œè€…IDï¼ˆç®¡ç†å‘˜IDæˆ–ä»»åŠ¡è¾¾äººIDï¼‰
7. æäº¤äº‹åŠ¡
8. å‘é€é€šçŸ¥ç»™å‚ä¸Žè€…
9. åœ¨èŠå¤©å®¤å‘é€ç³»ç»Ÿæ¶ˆæ¯ï¼ˆå¯é€‰ï¼‰ï¼šé€šçŸ¥å…¶ä»–å‚ä¸Žè€…é€€å‡ºç”³è¯·è¢«æ‹’ç»

### 4.1. ç®¡ç†å‘˜/ä»»åŠ¡è¾¾äººè¸¢å‡ºå‚ä¸Žè€…

**æŽ¥å£**: `POST /api/admin/tasks/{task_id}/participants/{participant_id}/kick`
**æŽ¥å£**: `POST /api/expert/tasks/{task_id}/participants/{participant_id}/kick`

**æƒé™**: 
- ç®¡ç†å‘˜æŽ¥å£ï¼šéœ€è¦ç®¡ç†å‘˜è®¤è¯
- ä»»åŠ¡è¾¾äººæŽ¥å£ï¼šéœ€è¦ç”¨æˆ·è®¤è¯ï¼Œä¸”ç”¨æˆ·å¿…é¡»æ˜¯è¯¥ä»»åŠ¡çš„åˆ›å»ºè€…ï¼ˆ`expert_creator_id` æˆ– `taker_id`ï¼‰

**è¯·æ±‚ä½“**:
```json
{
  "reason": "è¿åèŠå¤©å®¤è§„åˆ™",
  "admin_notes": "è¸¢å‡ºåŽŸå› è¯´æ˜Ž"  // å¯é€‰ï¼Œä»…ç®¡ç†å‘˜æŽ¥å£
}
```

**å“åº”**:
```json
{
  "id": 456,
  "task_id": 123,
  "user_id": "12345678",
  "status": "cancelled",
  "cancelled_at": "2025-01-20T12:30:00Z",
  "admin_notes": "è¿åèŠå¤©å®¤è§„åˆ™"
}
```

**ä¸šåŠ¡é€»è¾‘**:
1. éªŒè¯æƒé™ï¼š
   - ç®¡ç†å‘˜æŽ¥å£ï¼šéªŒè¯ç®¡ç†å‘˜æƒé™
   - ä»»åŠ¡è¾¾äººæŽ¥å£ï¼šéªŒè¯ç”¨æˆ·æ˜¯ä»»åŠ¡åˆ›å»ºè€…ï¼ˆ`expert_creator_id` æˆ– `taker_id`ï¼‰
2. éªŒè¯å‚ä¸Žè€…çŠ¶æ€ä¸º `accepted`ã€`in_progress` æˆ– `exit_requested`ï¼ˆä¸èƒ½è¸¢å‡ºå·²å®Œæˆæˆ–å·²é€€å‡ºçš„å‚ä¸Žè€…ï¼‰
3. å¼€å¯æ•°æ®åº“äº‹åŠ¡
4. æ›´æ–°å‚ä¸Žè€…çŠ¶æ€ä¸º `cancelled`
5. è®¾ç½® `cancelled_at` æ—¶é—´
6. è®°å½•è¸¢å‡ºåŽŸå› åˆ° `admin_notes` å­—æ®µ
7. **äººæ•°ç»Ÿè®¡**ï¼šå¦‚å¯ç”¨ `current_participants` ç¼“å­˜å­—æ®µï¼Œåˆ™åœ¨æ­¤å¤„ç”±è§¦å‘å™¨è‡ªåŠ¨ç»´æŠ¤ï¼Œæ— éœ€åº”ç”¨å±‚æ›´æ–°
8. **ä»Žä»»åŠ¡èŠå¤©å®¤ç§»é™¤è¯¥ç”¨æˆ·**ï¼ˆå¿…éœ€ï¼‰ï¼š
   - ä»ŽèŠå¤©å®¤æˆå‘˜åˆ—è¡¨ä¸­ç§»é™¤
   - ç¦æ­¢è¯¥ç”¨æˆ·ç»§ç»­å‘é€æ¶ˆæ¯
   - ç¦æ­¢è¯¥ç”¨æˆ·æŸ¥çœ‹èŠå¤©å®¤ï¼ˆå¯é€‰ï¼Œæ ¹æ®ä¸šåŠ¡éœ€æ±‚ï¼‰
9. **å®¡è®¡æ—¥å¿—**ï¼šè®°å½•æ“ä½œåˆ° `task_audit_logs` è¡¨ï¼ŒåŒ…å«æ“ä½œè€…IDï¼ˆç®¡ç†å‘˜IDæˆ–ä»»åŠ¡è¾¾äººIDï¼‰å’Œè¸¢å‡ºåŽŸå› 
10. æäº¤äº‹åŠ¡
11. å‘é€é€šçŸ¥ç»™è¢«è¸¢å‡ºçš„å‚ä¸Žè€…
12. åœ¨èŠå¤©å®¤å‘é€ç³»ç»Ÿæ¶ˆæ¯ï¼ˆå¿…éœ€ï¼‰ï¼šé€šçŸ¥å…¶ä»–å‚ä¸Žè€…è¯¥ç”¨æˆ·å·²è¢«è¸¢å‡º

**é‡è¦è¯´æ˜Ž**ï¼š
- è¸¢å‡ºæ“ä½œä¸å¯é€†ï¼ˆä¸Žé€€å‡ºç”³è¯·ä¸åŒï¼Œé€€å‡ºç”³è¯·éœ€è¦æ‰¹å‡†ï¼‰
- è¢«è¸¢å‡ºçš„å‚ä¸Žè€…çŠ¶æ€å˜ä¸º `cancelled`ï¼Œä¸èƒ½å†ç”³è¯·å‚ä¸Žæ­¤ä»»åŠ¡
- å¦‚æžœä»»åŠ¡å·²å¼€å§‹ï¼ˆ`in_progress`ï¼‰ï¼Œè¸¢å‡ºå‚ä¸Žè€…ä¸ä¼šå½±å“ä»»åŠ¡ç»§ç»­è¿›è¡Œ
- å¦‚æžœä»»åŠ¡å·²å®Œæˆï¼ˆ`completed`ï¼‰ï¼Œä¸èƒ½è¸¢å‡ºå·²å®ŒæˆçŠ¶æ€çš„å‚ä¸Žè€…

### 5. ç®¡ç†å‘˜å¼€å§‹å¤šäººä»»åŠ¡

**æŽ¥å£**: `POST /api/admin/tasks/{task_id}/start`

**æƒé™**: éœ€è¦ç®¡ç†å‘˜è®¤è¯

**è¯·æ±‚ä½“**:
```json
{}
```

**å“åº”**:
```json
{
  "id": 123,
  "status": "in_progress",
  "started_at": "2025-01-20T12:00:00Z",
  "current_participants": 4
}
```

**ä¸šåŠ¡é€»è¾‘**:
1. éªŒè¯ç®¡ç†å‘˜æƒé™
2. éªŒè¯ä»»åŠ¡çŠ¶æ€ä¸º `open`
3. **å®žæ—¶è®¡æ•°éªŒè¯**ï¼šä½¿ç”¨ `COUNT(*)` æŸ¥è¯¢çŠ¶æ€ä¸º `accepted` çš„å‚ä¸Žè€…æ•°é‡ï¼Œç¡®è®¤ >= `min_participants`
   - **é‡è¦è¯´æ˜Ž**ï¼š`min_participants` ä»…ç”¨äºŽ"å¯å¼€å§‹"åˆ¤å®šï¼Œä¸€æ—¦ä»»åŠ¡å¼€å§‹ï¼Œå³ä½¿åŽç»­æœ‰äººé€€å‡ºå¯¼è‡´äººæ•° < `min_participants`ï¼Œä»»åŠ¡ä»å¯ç»§ç»­è¿›è¡Œ
4. å¼€å¯æ•°æ®åº“äº‹åŠ¡
5. æ›´æ–°ä»»åŠ¡çŠ¶æ€ä¸º `in_progress`
6. æ›´æ–°æ‰€æœ‰ `accepted` çŠ¶æ€çš„å‚ä¸Žè€…ä¸º `in_progress`
7. è®¾ç½®æ‰€æœ‰å‚ä¸Žè€…çš„ `started_at` æ—¶é—´
8. **å®¡è®¡æ—¥å¿—**ï¼šè®°å½•æ“ä½œåˆ° `task_audit_logs` è¡¨ï¼ŒåŒ…å« `admin_operator_id`
9. æäº¤äº‹åŠ¡
10. å‘é€é€šçŸ¥ç»™æ‰€æœ‰å‚ä¸Žè€…

**é‡è¦è¯´æ˜Ž**ï¼šå½“å‰ç‰ˆæœ¬ä»…æ”¯æŒç®¡ç†å‘˜æ‰‹åŠ¨å¼€å§‹ä»»åŠ¡ã€‚è™½ç„¶çŠ¶æ€æµè½¬å›¾ä¸­æåˆ°"è¾¾åˆ° min_participants è‡ªåŠ¨å¼€å§‹"ï¼Œä½†æ­¤åŠŸèƒ½æš‚æœªå®žçŽ°ã€‚å¦‚éœ€å®žçŽ°è‡ªåŠ¨å¼€å§‹åŠŸèƒ½ï¼Œéœ€è¦ï¼š
- åˆ›å»ºå¼‚æ­¥å®ˆæŠ¤ä»»åŠ¡ï¼ˆJobï¼‰ï¼Œç›‘å¬ `task_participants` è¡¨çš„ `accepted` çŠ¶æ€è®¡æ•°å˜åŒ–
- å½“è®¡æ•°è¾¾åˆ° `min_participants` æ—¶ï¼Œè‡ªåŠ¨è§¦å‘å¼€å§‹æµç¨‹
- è®°å½•å®¡è®¡æ—¥å¿—ï¼Œæ ‡æ³¨ä¸º"è‡ªåŠ¨å¼€å§‹"è€Œéžç®¡ç†å‘˜æ“ä½œ
- è€ƒè™‘å¹¶å‘åœºæ™¯ä¸‹çš„å¹‚ç­‰æ€§ï¼ˆé˜²æ­¢é‡å¤è§¦å‘ï¼‰

### 6. å‚ä¸Žè€…æäº¤å®Œæˆ

**æŽ¥å£**: `POST /api/tasks/{task_id}/participants/me/complete`

**æƒé™**: éœ€è¦ç”¨æˆ·è®¤è¯ï¼Œä¸”ç”¨æˆ·å¿…é¡»æ˜¯è¯¥ä»»åŠ¡çš„å‚ä¸Žè€…

**è¯·æ±‚ä½“**:
```json
{
  "completion_notes": "å·²å®Œæˆæˆ‘çš„éƒ¨åˆ†å·¥ä½œ",
  "idempotency_key": "unique-request-id-12345"  // å»ºè®®æºå¸¦ï¼Œç”¨äºŽé˜²æ­¢é‡å¤æäº¤å®Œæˆ
}
```

**å“åº”**:
```json
{
  "id": 456,
  "status": "completed",
  "completed_at": "2025-01-20T15:00:00Z",
  "completion_notes": "å·²å®Œæˆæˆ‘çš„éƒ¨åˆ†å·¥ä½œ"
}
```

**ä¸šåŠ¡é€»è¾‘**:
1. éªŒè¯ç”¨æˆ·æ˜¯è¯¥ä»»åŠ¡çš„å‚ä¸Žè€…
2. éªŒè¯å‚ä¸Žè€…çŠ¶æ€ä¸º `in_progress`
3. **å¹‚ç­‰æ€§éªŒè¯**ï¼šå¦‚æžœè¯·æ±‚åŒ…å« `idempotency_key`ï¼Œæ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒé”®çš„å®Œæˆè®°å½•
4. å¼€å¯æ•°æ®åº“äº‹åŠ¡
5. æ›´æ–°å‚ä¸Žè€…çŠ¶æ€ä¸º `completed`
6. è®¾ç½® `completed_at` æ—¶é—´
7. æ£€æŸ¥ä»»åŠ¡å®Œæˆæ¡ä»¶ï¼š
   - å¦‚æžœ `completion_rule=all`ï¼Œæ£€æŸ¥æ˜¯å¦æ‰€æœ‰çŠ¶æ€ä¸º `in_progress` çš„å‚ä¸Žè€…éƒ½å®Œæˆ
   - å¦‚æžœ `completion_rule=min`ï¼Œæ£€æŸ¥å·²å®Œæˆå‚ä¸Žè€…æ•°é‡æ˜¯å¦ >= `min_participants`
8. å¦‚æžœæ»¡è¶³å®Œæˆæ¡ä»¶ï¼š
   - æ›´æ–°ä»»åŠ¡çŠ¶æ€ä¸º `completed`
   - **é‡è¦è¯´æ˜Ž**ï¼šå¦‚æžœ `completion_rule=min`ï¼Œæœªå®Œæˆçš„å‚ä¸Žè€…çŠ¶æ€ä¿æŒä¸º `in_progress`ï¼Œä½†ä»»åŠ¡å·²æ ‡è®°ä¸ºå®Œæˆã€‚è¿™äº›å‚ä¸Žè€…ä»å¯æäº¤å®Œæˆï¼Œä½†ä¸ä¼šå½±å“ä»»åŠ¡å®ŒæˆçŠ¶æ€ã€‚å¥–åŠ±åˆ†é…æ—¶ï¼Œä»…å·²å®Œæˆå‚ä¸Žè€…å‚ä¸Žåˆ†é…ï¼ˆé™¤éžç®¡ç†å‘˜æ‰‹åŠ¨è°ƒæ•´ï¼‰
9. **å®¡è®¡æ—¥å¿—**ï¼šè®°å½•æ“ä½œåˆ° `task_audit_logs` è¡¨
10. æäº¤äº‹åŠ¡
11. å‘é€é€šçŸ¥ç»™ç®¡ç†å‘˜/å‘å¸ƒè€…

### 7. ç®¡ç†å‘˜ç¡®è®¤ä»»åŠ¡å®Œæˆå¹¶åˆ†é…å¥–åŠ±

**æŽ¥å£**: `POST /api/admin/tasks/{task_id}/complete`

**æƒé™**: éœ€è¦ç®¡ç†å‘˜è®¤è¯

**è¯·æ±‚ä½“ï¼ˆMVPç‰ˆæœ¬ï¼Œä»…æ”¯æŒå¹³å‡åˆ†é…ç§¯åˆ†ï¼‰**:
```json
{
  "idempotency_key": "unique-request-id-12345"  // å¿…éœ€ï¼Œç”¨äºŽé˜²æ­¢é‡å¤åˆ†é…å¥–åŠ±
}
```

**è¯·æ±‚ä½“ï¼ˆæœªæ¥æ‰©å±•ç‰ˆæœ¬ï¼Œæ”¯æŒè‡ªå®šä¹‰åˆ†é…ï¼‰**:
```json
{
  "participant_rewards": [
    {
      "participant_id": 456,
      "reward_amount": 100.00,
      "points_amount": 1000
    },
    {
      "participant_id": 457,
      "reward_amount": 100.00,
      "points_amount": 1000
    }
  ],
  "idempotency_key": "unique-request-id-12345"  // å¿…éœ€ï¼Œç”¨äºŽé˜²æ­¢é‡å¤åˆ†é…å¥–åŠ±
}
```

**å“åº”**:
```json
{
  "id": 123,
  "status": "completed",
  "completed_at": "2025-01-20T16:00:00Z",
  "total_points_distributed": 5000,
  "participant_rewards": [
    {
      "participant_id": 456,
      "user_id": "12345678",
      "points_amount": 2500
    },
    {
      "participant_id": 457,
      "user_id": "87654321",
      "points_amount": 2500
    }
  ]
}
```

**ä¸šåŠ¡é€»è¾‘ï¼ˆMVPç‰ˆæœ¬ï¼‰**:
1. éªŒè¯ç®¡ç†å‘˜æƒé™
2. éªŒè¯ä»»åŠ¡çŠ¶æ€ä¸º `in_progress` æˆ–å·²å®Œæˆ
3. éªŒè¯ä»»åŠ¡ `reward_type='points'` ä¸” `reward_distribution='equal'`ï¼ˆMVPé™åˆ¶ï¼‰
4. **å¹‚ç­‰æ€§éªŒè¯**ï¼šæ£€æŸ¥ `idempotency_key` æ˜¯å¦å·²å­˜åœ¨ï¼Œå¦‚æžœå­˜åœ¨åˆ™è¿”å›žå·²æœ‰è®°å½•ï¼ˆå¹‚ç­‰è¿”å›žï¼‰
5. å¼€å¯æ•°æ®åº“äº‹åŠ¡
6. **å¹¶å‘æŽ§åˆ¶**ï¼šå¯¹ `tasks` è®°å½•ä½¿ç”¨ `SELECT ... FOR UPDATE` é”å®šï¼Œå¯¹ç›¸å…³ `task_participants` è®°å½•ä½¿ç”¨ `SELECT ... FOR UPDATE` é”å®šï¼Œç¡®ä¿"åˆ¤å®šä»»åŠ¡çŠ¶æ€ + è®¡ç®—å®Œæˆäººæ•° + åˆ›å»ºå¥–åŠ±è®°å½• + æ›´æ–°ä»»åŠ¡çŠ¶æ€"åœ¨åŒä¸€äº‹åŠ¡å†…åŽŸå­æ‰§è¡Œ
7. **è‡ªåŠ¨è®¡ç®—å¹³å‡åˆ†é…**ï¼ˆä»…é’ˆå¯¹çŠ¶æ€ä¸º `completed` çš„å‚ä¸Žè€…ï¼‰ï¼š
   - æŸ¥è¯¢æ‰€æœ‰çŠ¶æ€ä¸º `completed` çš„å‚ä¸Žè€…
   - ç§¯åˆ†å¥–åŠ±ï¼š`æ€»ç§¯åˆ†å¥–åŠ± / å·²å®Œæˆå‚ä¸Žè€…æ•°é‡`ï¼ˆå‘ä¸‹å–æ•´ï¼Œä½™æ•°åˆ†é…ç»™å®Œæˆæ—¶é—´æœ€æ—©çš„å‚ä¸Žè€…ï¼‰
8. **å®Œæ•´æ€§çº¦æŸéªŒè¯**ï¼š
   - éªŒè¯æ‰€æœ‰å‚ä¸Žè€…çš„ `points_amount` æ€»å’Œ <= ä»»åŠ¡ `points_reward`
   - éªŒè¯æ‰€æœ‰ `reward_amount` å¿…é¡»ä¸º NULLï¼ˆä¸æŽ¥å— 0ï¼‰
9. åˆ›å»º `task_participant_rewards` è®°å½•ï¼ŒåŒ…å«ï¼š
   - `reward_type='points'`
   - `points_amount`ï¼ˆè®¡ç®—å‡ºçš„å¹³å‡åˆ†é…å€¼ï¼‰
   - `idempotency_key`ï¼ˆå®¢æˆ·ç«¯ç”Ÿæˆï¼‰
   - `admin_operator_id`ï¼ˆå½“å‰ç®¡ç†å‘˜IDï¼‰
10. æ›´æ–°ä»»åŠ¡çŠ¶æ€ä¸º `completed`ï¼ˆå¦‚æžœå°šæœªå®Œæˆï¼‰
11. **å®¡è®¡æ—¥å¿—**ï¼šè®°å½•æ“ä½œåˆ° `task_audit_logs` è¡¨ï¼ŒåŒ…å«å®Œæ•´çš„åˆ†é…æ–¹æ¡ˆ
12. æäº¤äº‹åŠ¡
13. å‘é€é€šçŸ¥ç»™æ‰€æœ‰å‚ä¸Žè€…
14. è§¦å‘ç§¯åˆ†å‘æ”¾æµç¨‹ï¼ˆä½¿ç”¨ `idempotency_key` ç¡®ä¿å¹‚ç­‰æ€§ï¼‰

**ä¸šåŠ¡é€»è¾‘ï¼ˆæœªæ¥æ‰©å±•ç‰ˆæœ¬ï¼Œæ”¯æŒè‡ªå®šä¹‰åˆ†é…ï¼‰**:
1-4. åŒ MVP ç‰ˆæœ¬
5. å¼€å¯æ•°æ®åº“äº‹åŠ¡
6. å¦‚æžœ `reward_distribution=equal`ï¼š
   - è‡ªåŠ¨è®¡ç®—å¹³å‡åˆ†é…ï¼ˆåŒ MVP ç‰ˆæœ¬ï¼‰
7. å¦‚æžœ `reward_distribution=custom`ï¼Œä½¿ç”¨è¯·æ±‚ä¸­çš„åˆ†é…æ–¹æ¡ˆ
8. **å®Œæ•´æ€§çº¦æŸéªŒè¯**ï¼š
   - çŽ°é‡‘å¥–åŠ±ï¼šéªŒè¯æ‰€æœ‰å‚ä¸Žè€…çš„ `reward_amount` æ€»å’Œ <= ä»»åŠ¡ `reward`ï¼ˆå¦‚æžœ `reward_type` åŒ…å« `cash`ï¼‰
   - ç§¯åˆ†å¥–åŠ±ï¼šéªŒè¯æ‰€æœ‰å‚ä¸Žè€…çš„ `points_amount` æ€»å’Œ <= ä»»åŠ¡ `points_reward`ï¼ˆå¦‚æžœ `reward_type` åŒ…å« `points`ï¼‰
   - å¦‚æžœ `reward_type='points'`ï¼ŒéªŒè¯æ‰€æœ‰ `reward_amount` å¿…é¡»ä¸º NULLï¼ˆä¸æŽ¥å— 0ï¼‰
   - å¦‚æžœ `reward_type='cash'`ï¼ŒéªŒè¯æ‰€æœ‰ `points_amount` å¿…é¡»ä¸º NULLï¼ˆä¸æŽ¥å— 0ï¼‰
   - å¦‚æžœ `reward_type='both'`ï¼ŒéªŒè¯æ‰€æœ‰ `reward_amount` å’Œ `points_amount` éƒ½ä¸ä¸º NULL
9-13. åŒ MVP ç‰ˆæœ¬

### 8. èŽ·å–ä»»åŠ¡å‚ä¸Žè€…åˆ—è¡¨

**æŽ¥å£**: `GET /api/tasks/{task_id}/participants`

**æƒé™**: éœ€è¦ç”¨æˆ·è®¤è¯

**æŸ¥è¯¢å‚æ•°**:
- `status`: è¿‡æ»¤å‚ä¸Žè€…çŠ¶æ€ï¼ˆå¯é€‰ï¼‰

**å“åº”**:
```json
{
  "task_id": 123,
  "max_participants": 5,
  "min_participants": 3,
  "current_participants": 4,
  "participants": [
    {
      "id": 456,
      "user_id": "12345678",
      "user_name": "å¼ ä¸‰",
      "user_avatar": "avatar_url",
      "status": "in_progress",
      "reward_amount": 100.00,
      "applied_at": "2025-01-20T10:30:00Z",
      "accepted_at": "2025-01-20T11:00:00Z",
      "started_at": "2025-01-20T12:00:00Z",
      "completed_at": null
    }
  ]
}
```

### 9. èŽ·å–ç”¨æˆ·å‚ä¸Žçš„å¤šäººä»»åŠ¡åˆ—è¡¨

**æŽ¥å£**: `GET /api/users/me/multi-participant-tasks`

**æƒé™**: éœ€è¦ç”¨æˆ·è®¤è¯

**æŸ¥è¯¢å‚æ•°**:
- `status`: è¿‡æ»¤ä»»åŠ¡çŠ¶æ€ï¼ˆå¯é€‰ï¼‰
- `participant_status`: è¿‡æ»¤å‚ä¸Žè€…çŠ¶æ€ï¼ˆå¯é€‰ï¼‰

**å“åº”**:
```json
{
  "tasks": [
    {
      "id": 123,
      "title": "å¤§åž‹æ´»åŠ¨ç»„ç»‡ä»»åŠ¡",
      "status": "in_progress",
      "my_participant_status": "in_progress",
      "max_participants": 5,
      "current_participants": 4,
      "reward": 500.00,
      "my_reward": 100.00
    }
  ]
}
```

---

## ðŸŽ¨ å‰ç«¯å®žçŽ°

### 1. ç®¡ç†å‘˜å‘å¸ƒå¤šäººä»»åŠ¡é¡µé¢

**è·¯å¾„**: `/admin/publish-multi-task`

**åŠŸèƒ½**:
- ä»»åŠ¡åŸºæœ¬ä¿¡æ¯è¡¨å•ï¼ˆæ ‡é¢˜ã€æè¿°ã€æˆªæ­¢æ—¶é—´ç­‰ï¼‰
- å¤šäººä»»åŠ¡ç‰¹å®šå­—æ®µï¼š
  - æœ€å¤§å‚ä¸Žäººæ•°é€‰æ‹©å™¨ï¼ˆå¦‚ï¼š7äººï¼‰
  - æœ€å°å‚ä¸Žäººæ•°é€‰æ‹©å™¨ï¼ˆå¦‚ï¼š5äººï¼‰
  - å®Œæˆè§„åˆ™é€‰æ‹©ï¼ˆå…¨éƒ¨å®Œæˆ/æœ€å°äººæ•°å®Œæˆï¼‰
  - å¥–åŠ±åˆ†é…æ–¹å¼é€‰æ‹©ï¼ˆå¹³å‡åˆ†é…/è‡ªå®šä¹‰ï¼‰
- å¥–åŠ±è®¾ç½®ï¼š
  - å¥–åŠ±ç±»åž‹é€‰æ‹©ï¼ˆçŽ°é‡‘/ç§¯åˆ†/çŽ°é‡‘+ç§¯åˆ†ï¼‰
  - å¦‚æžœé€‰æ‹©ç§¯åˆ†ï¼Œæ˜¾ç¤ºç§¯åˆ†è¾“å…¥æ¡†
  - å¦‚æžœé€‰æ‹©çŽ°é‡‘ï¼Œæ˜¾ç¤ºé‡‘é¢è¾“å…¥æ¡†
- è‡ªåŠ¨è®¾ç½®ï¼š
  - `is_official_task=true`ï¼ˆç®¡ç†å‘˜å‘å¸ƒçš„ä»»åŠ¡è‡ªåŠ¨æ ‡è®°ä¸ºå®˜æ–¹ä»»åŠ¡ï¼‰
  - `auto_accept=true`ï¼ˆå®˜æ–¹ä»»åŠ¡è‡ªåŠ¨æŽ¥å—ç”³è¯·ï¼‰
  - `allow_negotiation=false`ï¼ˆå¤šäººä»»åŠ¡ä¸æ”¯æŒè®®ä»·ï¼‰
- å›¾ç‰‡ä¸Šä¼ 
- è¡¨å•éªŒè¯

### 1.1. ä»»åŠ¡è¾¾äººå‘å¸ƒå¤šäººä»»åŠ¡é¡µé¢

**è·¯å¾„**: `/expert/publish-multi-task`

**åŠŸèƒ½**:
- ä»»åŠ¡åŸºæœ¬ä¿¡æ¯è¡¨å•ï¼ˆæ ‡é¢˜ã€æè¿°ã€æˆªæ­¢æ—¶é—´ç­‰ï¼‰
- å¤šäººä»»åŠ¡ç‰¹å®šå­—æ®µï¼š
  - æœ€å¤§å‚ä¸Žäººæ•°é€‰æ‹©å™¨ï¼ˆå¦‚ï¼š4äººï¼‰
  - æœ€å°å‚ä¸Žäººæ•°é€‰æ‹©å™¨ï¼ˆå¦‚ï¼š4äººï¼‰
  - å®Œæˆè§„åˆ™é€‰æ‹©ï¼ˆå…¨éƒ¨å®Œæˆ/æœ€å°äººæ•°å®Œæˆï¼‰
  - å¥–åŠ±åˆ†é…æ–¹å¼é€‰æ‹©ï¼ˆå¹³å‡åˆ†é…/è‡ªå®šä¹‰ï¼‰
- å›ºå®šæ—¶é—´æ®µè®¾ç½®ï¼ˆå¯é€‰ï¼‰ï¼š
  - æ˜¯å¦å¯ç”¨å›ºå®šæ—¶é—´æ®µæœåŠ¡ï¼ˆå¼€å…³ï¼Œé»˜è®¤å…³é—­ï¼‰
  - å¦‚æžœå¯ç”¨ï¼š
    - æ—¶é—´æ®µæ—¶é•¿é€‰æ‹©å™¨ï¼ˆåˆ†é’Ÿï¼Œå¦‚60åˆ†é’Ÿè¡¨ç¤º1å°æ—¶ï¼Œ120åˆ†é’Ÿè¡¨ç¤º2å°æ—¶ç­‰ï¼‰
    - æ—¶é—´æ®µå¼€å§‹æ—¶é—´é€‰æ‹©å™¨ï¼ˆå¦‚12:00ï¼‰
    - æ—¶é—´æ®µç»“æŸæ—¶é—´é€‰æ‹©å™¨ï¼ˆå¦‚22:00ï¼‰
    - æ¯ä¸ªæ—¶é—´æ®µäººæ•°é™åˆ¶ï¼ˆå¦‚4äººï¼‰
  - å¦‚æžœä¸å¯ç”¨ï¼ˆéžå›ºå®šæ—¶é—´æ®µæœåŠ¡ï¼‰ï¼š
    - æç¤ºä¿¡æ¯ï¼š"ç”³è¯·äººå°†éœ€è¦é€‰æ‹©æˆªæ­¢æ—¥æœŸæˆ–çµæ´»æ—¶é—´"
    - æ—¶é—´æ®µç›¸å…³å­—æ®µä¸æ˜¾ç¤ºæˆ–ç¦ç”¨
- å¥–åŠ±è®¾ç½®ï¼š
  - å¥–åŠ±ç±»åž‹é€‰æ‹©ï¼ˆçŽ°é‡‘/ç§¯åˆ†/çŽ°é‡‘+ç§¯åˆ†ï¼‰
  - å¦‚æžœé€‰æ‹©ç§¯åˆ†ï¼Œæ˜¾ç¤ºç§¯åˆ†è¾“å…¥æ¡†
  - å¦‚æžœé€‰æ‹©çŽ°é‡‘ï¼Œæ˜¾ç¤ºé‡‘é¢è¾“å…¥æ¡†
- **æŠ˜æ‰£è®¾ç½®**ï¼ˆä»…ä»»åŠ¡è¾¾äººï¼Œå¯é€‰ï¼‰ï¼š
  - æ˜¯å¦è®¾ç½®æŠ˜æ‰£ï¼ˆå¼€å…³ï¼‰
  - å¦‚æžœå¯ç”¨æŠ˜æ‰£ï¼š
    - åŽŸä»·è¾“å…¥æ¡†ï¼ˆæ¯äººï¼Œå¦‚10.00é•‘ï¼‰
    - æŠ˜æ‰£ç™¾åˆ†æ¯”è¾“å…¥æ¡†ï¼ˆ0-100ï¼Œå¦‚20è¡¨ç¤ºæ‰“8æŠ˜ï¼‰
    - æŠ˜æ‰£åŽä»·æ ¼è‡ªåŠ¨è®¡ç®—å¹¶æ˜¾ç¤ºï¼ˆåŽŸä»· Ã— (1 - æŠ˜æ‰£ç™¾åˆ†æ¯”/100)ï¼‰
    - æ˜¾ç¤ºèŠ‚çœé‡‘é¢ï¼ˆåŽŸä»· - æŠ˜æ‰£åŽä»·æ ¼ï¼‰
    - æç¤ºä¿¡æ¯ï¼š"å¤šäººä»»åŠ¡ä¸æ”¯æŒè®®ä»·ï¼Œä½†æ‚¨å¯ä»¥è®¾ç½®æŠ˜æ‰£æ¥æŽ¨å¹¿æœåŠ¡æˆ–å¡«è¡¥ç‰¹å®šæ—¶é—´æ®µç©ºç¼º"
- è‡ªåŠ¨è®¾ç½®ï¼š
  - `is_official_task=false`ï¼ˆä»»åŠ¡è¾¾äººå‘å¸ƒçš„ä»»åŠ¡ä¸æ˜¯å®˜æ–¹ä»»åŠ¡ï¼‰
  - `auto_accept=false`ï¼ˆé»˜è®¤éœ€è¦å®¡æ ¸ï¼Œå¯æ ¹æ®å¹³å°ç­–ç•¥è°ƒæ•´ï¼‰
  - `allow_negotiation=false`ï¼ˆå¤šäººä»»åŠ¡ä¸æ”¯æŒè®®ä»·ï¼Œä½†å¯ä»¥è®¾ç½®æŠ˜æ‰£ï¼‰
  - `created_by_expert=true`
  - `expert_creator_id` ä¸ºå½“å‰ç”¨æˆ·ID
- å›¾ç‰‡ä¸Šä¼ 
- è¡¨å•éªŒè¯ï¼š
  - éªŒè¯æŠ˜æ‰£ç›¸å…³å­—æ®µçš„ä¸€è‡´æ€§
  - éªŒè¯æŠ˜æ‰£åŽä»·æ ¼ = åŽŸä»· Ã— (1 - æŠ˜æ‰£ç™¾åˆ†æ¯”/100)
  - éªŒè¯ä»»åŠ¡çš„ `reward` å­—æ®µä¸ŽæŠ˜æ‰£åŽä»·æ ¼ä¸€è‡´ï¼ˆæˆ–æ ¹æ®å¥–åŠ±åˆ†é…æ–¹å¼è®¡ç®—ï¼‰

### 2. å¤šäººä»»åŠ¡è¯¦æƒ…é¡µé¢

**è·¯å¾„**: `/tasks/{task_id}`

**åŠŸèƒ½**:
- æ˜¾ç¤ºä»»åŠ¡åŸºæœ¬ä¿¡æ¯
- æ˜¾ç¤ºå®˜æ–¹ä»»åŠ¡æ ‡è¯†ï¼ˆå¦‚æžœæ˜¯å®˜æ–¹ä»»åŠ¡ï¼‰
- æ˜¾ç¤ºä»»åŠ¡è¾¾äººæ ‡è¯†ï¼ˆå¦‚æžœæ˜¯ä»»åŠ¡è¾¾äººå‘å¸ƒï¼‰
- æ˜¾ç¤ºå¤šäººä»»åŠ¡æ ‡è¯†å’Œå‚ä¸Žäººæ•°ä¿¡æ¯ï¼ˆå½“å‰äººæ•°/æœ€å¤§äººæ•°ï¼‰
- æ˜¾ç¤ºå¥–åŠ±ä¿¡æ¯ï¼ˆçŽ°é‡‘/ç§¯åˆ†/çŽ°é‡‘+ç§¯åˆ†ï¼‰
- **æŠ˜æ‰£ä¿¡æ¯æ˜¾ç¤º**ï¼ˆä»…ä»»åŠ¡è¾¾äººå‘å¸ƒçš„å¤šäººä»»åŠ¡ï¼‰ï¼š
  - å¦‚æžœ `has_discount=true` æˆ– `discount_percentage IS NOT NULL`ï¼Œæ˜¾ç¤ºæŠ˜æ‰£ä¿¡æ¯
  - æ˜¾ç¤ºåŽŸä»·ï¼š`åŽŸä»·ï¼šÂ£{original_price_per_participant}/äºº`ï¼ˆå¸¦åˆ é™¤çº¿æ ·å¼ï¼‰
  - æ˜¾ç¤ºçŽ°ä»·ï¼š`çŽ°ä»·ï¼šÂ£{discounted_price_per_participant}/äºº`ï¼ˆçªå‡ºæ˜¾ç¤ºï¼Œå¯ç”¨çº¢è‰²æˆ–åŠ ç²—ï¼‰
  - æ˜¾ç¤ºæŠ˜æ‰£æ ‡ç­¾ï¼š`æ‰“{discount_percentage}æŠ˜` æˆ– `èŠ‚çœ{original_price_per_participant - discounted_price_per_participant}é•‘`
  - æŠ˜æ‰£æ ‡ç­¾æ ·å¼ï¼šå¯ä½¿ç”¨é†’ç›®çš„é¢œè‰²ï¼ˆå¦‚çº¢è‰²ã€æ©™è‰²ï¼‰å’Œå›¾æ ‡ï¼ˆå¦‚"æŠ˜æ‰£"ã€"ç‰¹ä»·"å›¾æ ‡ï¼‰
  - **ç¤ºä¾‹æ˜¾ç¤º**ï¼š
    ```
    åŽŸä»·ï¼šÂ£10.00/äºº  [åˆ é™¤çº¿]
    çŽ°ä»·ï¼šÂ£8.00/äºº  [çº¢è‰²åŠ ç²—]
    [æŠ˜æ‰£æ ‡ç­¾] æ‰“8æŠ˜ / èŠ‚çœÂ£2.00
    ```
- **ä»»åŠ¡çŠ¶æ€æ˜¾ç¤º**ï¼š
  - **ä»»åŠ¡çŠ¶æ€**ï¼š`open` / `in_progress` / `completed` / `cancelled`
  - **å¥–åŠ±çŠ¶æ€**ï¼ˆéœ€æŸ¥è¯¢ `task_participant_rewards` è¡¨ï¼‰ï¼š
    - æœªç»“ç®—ï¼šæ‰€æœ‰å¥–åŠ±è®°å½•çš„ `payment_status` å’Œ `points_status` å‡ä¸º `pending`
    - ç»“ç®—ä¸­ï¼šéƒ¨åˆ†å¥–åŠ±è®°å½•çš„ `payment_status` æˆ– `points_status` ä¸º `pending`
    - å·²ç»“ç®—ï¼šæ‰€æœ‰å¥–åŠ±è®°å½•çš„ `payment_status` å’Œ `points_status` å‡ä¸º `paid`/`credited`
    - éƒ¨åˆ†å¤±è´¥ï¼šå­˜åœ¨ `failed` çŠ¶æ€çš„å¥–åŠ±è®°å½•
  - **é‡è¦è¯´æ˜Ž**ï¼š`status='completed'` ä»…è¡¨ç¤ºä»»åŠ¡å·¥ä½œæµç¨‹å®Œæˆï¼Œä¸ä»£è¡¨å¥–åŠ±å·²å‘æ”¾ï¼Œéœ€æŸ¥çœ‹å¥–åŠ±çŠ¶æ€
- æ˜¾ç¤ºå‚ä¸Žè€…åˆ—è¡¨ï¼ˆå¦‚æžœç”¨æˆ·æ˜¯å‚ä¸Žè€…æˆ–ç®¡ç†å‘˜ï¼‰
- **ç”³è¯·å‚ä¸Žç•Œé¢**ï¼ˆå¦‚æžœç”¨æˆ·æœªç”³è¯·ä¸”æœªè¾¾åˆ°æœ€å¤§äººæ•°ï¼‰ï¼š
  - **å›ºå®šæ—¶é—´æ®µæœåŠ¡**ï¼šæ˜¾ç¤ºæ‰€æœ‰å¯ç”¨æ—¶é—´æ®µåˆ—è¡¨ï¼Œç”¨æˆ·é€‰æ‹©æ—¶é—´æ®µåŽç”³è¯·
  - **éžå›ºå®šæ—¶é—´æ®µæœåŠ¡ï¼ˆä»»åŠ¡è¾¾äººå‘å¸ƒï¼‰**ï¼šæ˜¾ç¤ºæ—¶é—´é€‰æ‹©è¡¨å•
    - å•é€‰æŒ‰é’®æˆ–å¼€å…³ï¼šé€‰æ‹©"çµæ´»æ—¶é—´"æˆ–"æŒ‡å®šæˆªæ­¢æ—¥æœŸ"
    - å¦‚æžœé€‰æ‹©"æŒ‡å®šæˆªæ­¢æ—¥æœŸ"ï¼šæ˜¾ç¤ºæ—¥æœŸæ—¶é—´é€‰æ‹©å™¨ï¼Œç”¨æˆ·é€‰æ‹©æœŸæœ›çš„æˆªæ­¢æ—¥æœŸ
    - å¦‚æžœé€‰æ‹©"çµæ´»æ—¶é—´"ï¼šæ˜¾ç¤ºæç¤ºä¿¡æ¯"æ—¶é—´çµæ´»ï¼Œå¯ä¸Žä»»åŠ¡è¾¾äººåå•†"
  - ç”³è¯·æ¶ˆæ¯è¾“å…¥æ¡†ï¼ˆå¯é€‰ï¼‰
  - æäº¤ç”³è¯·æŒ‰é’®
- å‚ä¸ŽçŠ¶æ€æ˜¾ç¤ºï¼ˆå¦‚æžœç”¨æˆ·å·²ç”³è¯·/å‚ä¸Žï¼‰
- **è¿›å…¥èŠå¤©å®¤æŒ‰é’®**ï¼ˆå¦‚æžœç”¨æˆ·å·²æŽ¥å—/å‚ä¸Žï¼Œå¯ä»¥ç«‹å³è¿›å…¥ä»»åŠ¡èŠå¤©å®¤ï¼‰
  - å¤šäººä»»åŠ¡æˆ–è¾¾äººå¤šäººæœåŠ¡éƒ½ä¼šè¿›å…¥å¤šäººä»»åŠ¡èŠå¤©å®¤
  - åœ¨èŠå¤©å®¤ä¸­ï¼Œç®¡ç†å‘˜å’Œä»»åŠ¡è¾¾äººæœ‰æƒè¸¢æŽ‰å‚ä¸Žè€…
  - ç”³è¯·è€…ä¹Ÿå¯ä»¥ç”³è¯·é€€å‡ºå–æ¶ˆæ­¤ä»»åŠ¡
- **ç”³è¯·é€€å‡ºæŒ‰é’®**ï¼ˆå¦‚æžœç”¨æˆ·å·²å‚ä¸Žï¼Œå¯ä»¥ç”³è¯·é€€å‡ºï¼‰
  - ç‚¹å‡»åŽå¼¹å‡ºé€€å‡ºç”³è¯·è¡¨å•
  - éœ€è¦å¡«å†™é€€å‡ºåŽŸå› 
  - æäº¤åŽç­‰å¾…ç®¡ç†å‘˜/ä»»åŠ¡è¾¾äººå®¡æ ¸
- å®Œæˆæäº¤æŒ‰é’®ï¼ˆå¦‚æžœç”¨æˆ·æ˜¯å‚ä¸Žè€…ä¸”ä»»åŠ¡è¿›è¡Œä¸­ï¼‰
- ç¦æ­¢è®®ä»·æç¤ºï¼ˆå¤šäººä»»åŠ¡ä¸æ”¯æŒè®®ä»·ï¼‰

### 3. ä»»åŠ¡èŠå¤©å®¤é¡µé¢

**è·¯å¾„**: `/rooms/{room_code}`ï¼ˆæŽ¨èï¼Œå½»åº•é¿å…æ³„æ¼ä»»åŠ¡IDï¼‰

**è·¯ç”±ç­–ç•¥**ï¼š
- **æŽ¨èæ–¹æ¡ˆ**ï¼šä½¿ç”¨ `/rooms/{room_code}` ä½œä¸ºè·¯ç”±å‚æ•°
  - åŽç«¯åœ¨è¿›å…¥é¡µé¢æ—¶éªŒè¯ç”¨æˆ·æ˜¯å¦ä¸ºè¯¥èŠå¤©å®¤çš„å‚ä¸Žè€…ï¼ˆæ ¹æ® `room_code` æŸ¥è¯¢ `chat_rooms` è¡¨ï¼Œå†éªŒè¯ `task_participants` è¡¨ï¼‰
  - éªŒè¯é€šè¿‡åŽç›´æŽ¥æ¸²æŸ“é¡µé¢ï¼Œå½»åº•é¿å…åœ¨ URL ä¸­æš´éœ² `task_id`
  - WebSocket è¿žæŽ¥æ—¶ä½¿ç”¨ `room_code` è€Œéž `task_id`
- **å¤‡é€‰æ–¹æ¡ˆï¼ˆä¸æŽ¨èï¼‰**ï¼šä½¿ç”¨ `/tasks/{task_id}/chat`ï¼Œå‰ç«¯åœ¨è¿›å…¥é¡µé¢æ—¶ä»ŽåŽç«¯èŽ·å– `room_code`ï¼Œç„¶åŽä½¿ç”¨ `room_code` å»ºç«‹ WebSocket è¿žæŽ¥
  - ç¼ºç‚¹ï¼šURL ä¸­æš´éœ²äº† `task_id`ï¼Œå­˜åœ¨ä¿¡æ¯æ³„éœ²é£Žé™©

**åŠŸèƒ½**:
- æ˜¾ç¤ºä»»åŠ¡åŸºæœ¬ä¿¡æ¯ï¼ˆæ ‡é¢˜ã€å‚ä¸Žäººæ•°ç­‰ï¼‰
- æ˜¾ç¤ºå‚ä¸Žè€…åˆ—è¡¨ï¼ˆæ‰€æœ‰å·²æŽ¥å—çš„å‚ä¸Žè€…ï¼‰
  - æ¯ä¸ªå‚ä¸Žè€…æ˜¾ç¤ºç”¨æˆ·åã€å¤´åƒã€çŠ¶æ€
  - ç®¡ç†å‘˜/ä»»åŠ¡è¾¾äººå¯ä»¥çœ‹åˆ°"è¸¢å‡º"æŒ‰é’®ï¼ˆä»…å¯¹ `accepted`ã€`in_progress` çŠ¶æ€çš„å‚ä¸Žè€…ï¼‰
  - æ™®é€šå‚ä¸Žè€…å¯ä»¥çœ‹åˆ°è‡ªå·±çš„"ç”³è¯·é€€å‡º"æŒ‰é’®
- å®žæ—¶èŠå¤©åŠŸèƒ½ï¼ˆWebSocketï¼‰
- æ¶ˆæ¯å‘é€å’ŒæŽ¥æ”¶
- å›¾ç‰‡ä¸Šä¼ å’Œåˆ†äº«
- ç³»ç»Ÿæ¶ˆæ¯æ˜¾ç¤ºï¼ˆå¦‚ï¼šæ–°æˆå‘˜åŠ å…¥ã€æˆå‘˜é€€å‡ºã€æˆå‘˜è¢«è¸¢å‡ºç­‰ï¼‰
- èŠå¤©å®¤æƒé™æŽ§åˆ¶ï¼š
  - **å‘é€æ¶ˆæ¯æƒé™**ï¼šä»…çŠ¶æ€ä¸º `accepted`ã€`in_progress`ã€`completed` çš„å‚ä¸Žè€…å¯ä»¥å‘é€æ¶ˆæ¯
  - **æŸ¥çœ‹æ¶ˆæ¯æƒé™**ï¼šå‚ä¸Žè€…å¯ä»¥æŸ¥çœ‹åŽ†å²æ¶ˆæ¯ï¼ˆå³ä½¿è¢«è¸¢å‡ºï¼Œæ ¹æ®ä¸šåŠ¡éœ€æ±‚å†³å®šæ˜¯å¦å…è®¸æŸ¥çœ‹ï¼‰
  - **ç®¡ç†æƒé™**ï¼šç®¡ç†å‘˜å’Œä»»åŠ¡è¾¾äººï¼ˆä»»åŠ¡åˆ›å»ºè€…ï¼‰å¯ä»¥è¸¢å‡ºå‚ä¸Žè€…

**èŠå¤©å®¤æƒé™è§„åˆ™**ï¼ˆå¿…é¡»ä¸¥æ ¼æ‰§è¡Œï¼‰ï¼š
- **å…è®¸è¿›å…¥èŠå¤©å®¤çš„çŠ¶æ€**ï¼š`accepted`ã€`in_progress`ã€`completed`
- **å…è®¸å‘é€æ¶ˆæ¯çš„çŠ¶æ€**ï¼š`accepted`ã€`in_progress`ã€`completed`
- **ç¦æ­¢è¿›å…¥å’Œå‘è¨€çš„çŠ¶æ€**ï¼š`pending`ã€`exit_requested`ã€`exited`ã€`cancelled`
- **è¯´æ˜Ž**ï¼š
  - å·²å®Œæˆï¼ˆ`completed`ï¼‰çš„å‚ä¸Žè€…å¯ä»¥æŸ¥çœ‹åŽ†å²æ¶ˆæ¯å¹¶ç»§ç»­å‘è¨€
  - é€€å‡ºç”³è¯·ä¸­ï¼ˆ`exit_requested`ï¼‰çš„å‚ä¸Žè€…å¯ä»¥æŸ¥çœ‹æ¶ˆæ¯ä½†ä¸èƒ½å‘é€æ¶ˆæ¯ï¼ˆç­‰å¾…å®¡æ ¸ï¼‰
  - å·²é€€å‡ºï¼ˆ`exited`ï¼‰æˆ–å·²å–æ¶ˆï¼ˆ`cancelled`ï¼‰çš„å‚ä¸Žè€…ä¸èƒ½è¿›å…¥èŠå¤©å®¤
  - è¢«è¸¢å‡ºçš„å‚ä¸Žè€…ï¼ˆ`cancelled`ï¼‰ä¸èƒ½è¿›å…¥èŠå¤©å®¤ï¼Œæ ¹æ®ä¸šåŠ¡éœ€æ±‚å†³å®šæ˜¯å¦å…è®¸æŸ¥çœ‹åŽ†å²æ¶ˆæ¯

**ç®¡ç†æƒé™**ï¼š
- **ç®¡ç†å‘˜**ï¼šå¯ä»¥è¸¢å‡ºä»»ä½•å‚ä¸Žè€…ï¼ˆçŠ¶æ€ä¸º `accepted`ã€`in_progress` æˆ– `exit_requested`ï¼‰
- **ä»»åŠ¡è¾¾äºº**ï¼ˆä»»åŠ¡åˆ›å»ºè€…ï¼‰ï¼šå¯ä»¥è¸¢å‡ºè‡ªå·±åˆ›å»ºçš„å¤šäººä»»åŠ¡çš„å‚ä¸Žè€…ï¼ˆçŠ¶æ€ä¸º `accepted`ã€`in_progress` æˆ– `exit_requested`ï¼‰
- **æ™®é€šå‚ä¸Žè€…**ï¼šä¸èƒ½è¸¢å‡ºå…¶ä»–å‚ä¸Žè€…ï¼Œåªèƒ½ç”³è¯·é€€å‡º

**èŠå¤©å®¤è¿›å…¥é€»è¾‘**:
- ç”¨æˆ·ç”³è¯·å‚ä¸Žå®˜æ–¹ä»»åŠ¡åŽï¼ŒçŠ¶æ€ç«‹å³å˜ä¸º `accepted`
- ç”¨æˆ·å¯ä»¥åœ¨ä»»åŠ¡è¯¦æƒ…é¡µé¢ç‚¹å‡»"è¿›å…¥èŠå¤©å®¤"æŒ‰é’®
- æˆ–è€…ç³»ç»Ÿè‡ªåŠ¨è·³è½¬åˆ°èŠå¤©å®¤é¡µé¢
- **å®‰å…¨è¯´æ˜Ž**ï¼šèŠå¤©å®¤ä½¿ç”¨ä¸å¯é¢„æµ‹çš„ `room_code`ï¼ˆUUIDæ ¼å¼ï¼‰ï¼Œä¸æš´éœ²ä»»åŠ¡ID
- WebSocketè¿žæŽ¥æ—¶ï¼ŒæœåŠ¡å™¨ç«¯éœ€è¦éªŒè¯ï¼š
  1. ç”¨æˆ·èº«ä»½ï¼ˆJWT tokenï¼‰
  2. ç”¨æˆ·æ˜¯å¦ä¸ºè¯¥ä»»åŠ¡çš„å‚ä¸Žè€…ï¼ˆæŸ¥è¯¢ `task_participants` è¡¨ï¼‰
  3. å‚ä¸Žè€…çŠ¶æ€æ˜¯å¦ä¸º `accepted`ã€`in_progress` æˆ– `completed`ï¼ˆæŒ‰ä¸Šè¿°æƒé™è§„åˆ™ï¼‰

### 4. ç®¡ç†å‘˜ä»»åŠ¡ç®¡ç†é¡µé¢

**è·¯å¾„**: `/admin/tasks/{task_id}/manage`

**åŠŸèƒ½**:
- æ˜¾ç¤ºä»»åŠ¡è¯¦æƒ…
- æ˜¾ç¤ºæ‰€æœ‰å‚ä¸Žè€…åˆ—è¡¨ï¼ˆå®˜æ–¹ä»»åŠ¡è‡ªåŠ¨æŽ¥å—ï¼Œæ— éœ€å®¡æ ¸ï¼‰
  - æ¯ä¸ªå‚ä¸Žè€…æ˜¾ç¤ºçŠ¶æ€ã€ç”³è¯·æ—¶é—´ã€å®Œæˆæ—¶é—´ç­‰ä¿¡æ¯
  - å¯¹çŠ¶æ€ä¸º `accepted`ã€`in_progress` çš„å‚ä¸Žè€…æ˜¾ç¤º"è¸¢å‡º"æŒ‰é’®
  - å¯¹çŠ¶æ€ä¸º `exit_requested` çš„å‚ä¸Žè€…æ˜¾ç¤º"æ‰¹å‡†é€€å‡º"å’Œ"æ‹’ç»é€€å‡º"æŒ‰é’®
- æ˜¾ç¤ºé€€å‡ºç”³è¯·åˆ—è¡¨ï¼ˆå¦‚æžœæœ‰å‚ä¸Žè€…ç”³è¯·é€€å‡ºï¼‰
- æ‰¹å‡†/æ‹’ç»é€€å‡ºç”³è¯·æŒ‰é’®
- è¸¢å‡ºå‚ä¸Žè€…æŒ‰é’®ï¼ˆå¯ä»¥è¸¢å‡ºè¿åè§„åˆ™çš„å‚ä¸Žè€…ï¼‰
- å¼€å§‹ä»»åŠ¡æŒ‰é’®ï¼ˆå½“è¾¾åˆ°æœ€å°å‚ä¸Žäººæ•°æ—¶ï¼Œæˆ–æ‰‹åŠ¨å¼€å§‹ï¼‰
- å‚ä¸Žè€…ç®¡ç†ï¼ˆæŸ¥çœ‹ã€ç§»é™¤å‚ä¸Žè€…ï¼‰
- ä»»åŠ¡å®Œæˆç¡®è®¤å’Œå¥–åŠ±åˆ†é…ï¼ˆçŽ°é‡‘/ç§¯åˆ†ï¼‰
- æ˜¾ç¤ºå®¡è®¡æ—¥å¿—ï¼ˆå¯é€‰ï¼‰

### 4.1. ä»»åŠ¡è¾¾äººä»»åŠ¡ç®¡ç†é¡µé¢

**è·¯å¾„**: `/expert/tasks/{task_id}/manage`

**åŠŸèƒ½**:
- æ˜¾ç¤ºä»»åŠ¡è¯¦æƒ…ï¼ˆåŒ…æ‹¬å…³è”çš„è¾¾äººæœåŠ¡ä¿¡æ¯ï¼‰
- æ˜¾ç¤ºæ‰€æœ‰å‚ä¸Žè€…åˆ—è¡¨
  - æ¯ä¸ªå‚ä¸Žè€…æ˜¾ç¤ºçŠ¶æ€ã€ç”³è¯·æ—¶é—´ã€æ—¶é—´åå¥½ï¼ˆå¦‚æžœæ˜¯éžå›ºå®šæ—¶é—´æ®µæœåŠ¡ï¼‰ã€å®Œæˆæ—¶é—´ç­‰ä¿¡æ¯
  - å¯¹çŠ¶æ€ä¸º `accepted`ã€`in_progress` çš„å‚ä¸Žè€…æ˜¾ç¤º"è¸¢å‡º"æŒ‰é’®
  - å¯¹çŠ¶æ€ä¸º `exit_requested` çš„å‚ä¸Žè€…æ˜¾ç¤º"æ‰¹å‡†é€€å‡º"å’Œ"æ‹’ç»é€€å‡º"æŒ‰é’®
- æ˜¾ç¤ºé€€å‡ºç”³è¯·åˆ—è¡¨ï¼ˆå¦‚æžœæœ‰å‚ä¸Žè€…ç”³è¯·é€€å‡ºï¼‰
- æ‰¹å‡†/æ‹’ç»é€€å‡ºç”³è¯·æŒ‰é’®
- è¸¢å‡ºå‚ä¸Žè€…æŒ‰é’®ï¼ˆå¯ä»¥è¸¢å‡ºè¿åè§„åˆ™çš„å‚ä¸Žè€…ï¼‰
- å¼€å§‹ä»»åŠ¡æŒ‰é’®ï¼ˆå½“è¾¾åˆ°æœ€å°å‚ä¸Žäººæ•°æ—¶ï¼Œæˆ–æ‰‹åŠ¨å¼€å§‹ï¼‰
- å‚ä¸Žè€…ç®¡ç†ï¼ˆæŸ¥çœ‹ã€ç§»é™¤å‚ä¸Žè€…ï¼‰
- ä»»åŠ¡å®Œæˆç¡®è®¤å’Œå¥–åŠ±åˆ†é…
- æ˜¾ç¤ºå®¡è®¡æ—¥å¿—ï¼ˆå¯é€‰ï¼‰

### 5. ç”¨æˆ·æˆ‘çš„å¤šäººä»»åŠ¡é¡µé¢

**è·¯å¾„**: `/my-tasks/multi-participant`

**åŠŸèƒ½**:
- æ˜¾ç¤ºç”¨æˆ·å‚ä¸Žçš„æ‰€æœ‰å¤šäººä»»åŠ¡
- æŒ‰çŠ¶æ€ç­›é€‰ï¼ˆå¾…å®¡æ ¸ã€å·²æŽ¥å—ã€è¿›è¡Œä¸­ã€å·²å®Œæˆï¼‰
- æ˜¾ç¤ºæ¯ä¸ªä»»åŠ¡çš„å‚ä¸ŽçŠ¶æ€å’Œå¥–åŠ±ä¿¡æ¯

---

## ðŸ”’ æƒé™å’Œå®‰å…¨

### 1. æƒé™æŽ§åˆ¶

- **åˆ›å»ºå¤šäººä»»åŠ¡**: ä»…ç®¡ç†å‘˜å¯ä»¥åˆ›å»º
- **ç”³è¯·å‚ä¸Ž**: æ‰€æœ‰è®¤è¯ç”¨æˆ·éƒ½å¯ä»¥ç”³è¯·ï¼ˆå®˜æ–¹ä»»åŠ¡æ‰€æœ‰äººéƒ½å¯ä»¥çœ‹åˆ°ï¼‰
- **è‡ªåŠ¨æŽ¥å—**: å®˜æ–¹ä»»åŠ¡è‡ªåŠ¨æŽ¥å—ç”³è¯·ï¼Œæ— éœ€ç®¡ç†å‘˜å®¡æ ¸
- **è¿›å…¥èŠå¤©å®¤**: ä»…å·²æŽ¥å—çš„å‚ä¸Žè€…å¯ä»¥è¿›å…¥å’Œå‘é€æ¶ˆæ¯ï¼ˆçŠ¶æ€ä¸º `accepted`ã€`in_progress` æˆ– `completed`ï¼‰
- **å¼€å§‹ä»»åŠ¡**: ä»…ç®¡ç†å‘˜å¯ä»¥æ“ä½œï¼ˆæˆ–è¾¾åˆ°min_participantsè‡ªåŠ¨å¼€å§‹ï¼‰
- **æäº¤å®Œæˆ**: ä»…å‚ä¸Žè€…æœ¬äººå¯ä»¥æ“ä½œ
- **ç”³è¯·é€€å‡º**: ä»…å‚ä¸Žè€…æœ¬äººå¯ä»¥æ“ä½œï¼ˆç”³è¯·è€…å¯ä»¥ç”³è¯·é€€å‡ºå–æ¶ˆæ­¤ä»»åŠ¡ï¼‰
- **æ‰¹å‡†/æ‹’ç»é€€å‡º**: ç®¡ç†å‘˜å’Œä»»åŠ¡è¾¾äººï¼ˆä»»åŠ¡åˆ›å»ºè€…ï¼‰å¯ä»¥æ“ä½œ
- **è¸¢å‡ºå‚ä¸Žè€…**: ç®¡ç†å‘˜å’Œä»»åŠ¡è¾¾äººï¼ˆä»»åŠ¡åˆ›å»ºè€…ï¼‰å¯ä»¥æ“ä½œï¼ˆæœ‰æƒè¸¢æŽ‰è¿åè§„åˆ™çš„å‚ä¸Žè€…ï¼‰
- **ç¡®è®¤å®Œæˆå’Œåˆ†é…å¥–åŠ±**: ä»…ç®¡ç†å‘˜å¯ä»¥æ“ä½œ

### 2. æ•°æ®éªŒè¯

- æœ€å¤§å‚ä¸Žäººæ•° >= æœ€å°å‚ä¸Žäººæ•° >= 1
- æ€»å¥–åŠ±é‡‘é¢ >= 0ï¼ˆå¦‚æžœreward_typeåŒ…å«cashï¼‰
- ç§¯åˆ†å¥–åŠ± >= 0ï¼ˆå¦‚æžœreward_typeåŒ…å«pointsï¼‰
- å¥–åŠ±åˆ†é…æ€»é¢ä¸èƒ½è¶…è¿‡ä»»åŠ¡æ€»å¥–åŠ±ï¼ˆçŽ°é‡‘æˆ–ç§¯åˆ†ï¼Œåœ¨äº‹åŠ¡å†…å®žæ—¶éªŒè¯ï¼‰
- å‚ä¸Žè€…ä¸èƒ½é‡å¤ç”³è¯·åŒä¸€ä»»åŠ¡ï¼ˆåˆ©ç”¨å”¯ä¸€çº¦æŸï¼‰
- å¤šäººä»»åŠ¡ä¸å…è®¸è®®ä»·ï¼ˆ`reward_type` å’Œ `points_reward` éªŒè¯ï¼‰
- ä»»åŠ¡çŠ¶æ€æµè½¬éªŒè¯ï¼ˆå¦‚ï¼šä¸èƒ½ä»Žæœªå¼€å§‹ç›´æŽ¥åˆ°å®Œæˆï¼‰
- é€€å‡ºç”³è¯·éªŒè¯ï¼ˆå·²å®Œæˆæˆ–å·²é€€å‡ºçš„ä¸èƒ½å†æ¬¡ç”³è¯·é€€å‡ºï¼‰
- å¥–åŠ±ç±»åž‹å®Œæ•´æ€§éªŒè¯ï¼ˆ`reward_type='points'` æ—¶çŽ°é‡‘å­—æ®µå¿…é¡»ä¸º NULLï¼Œä¸æŽ¥å— 0ï¼›`reward_type='cash'` æ—¶ç§¯åˆ†å­—æ®µå¿…é¡»ä¸º NULLï¼Œä¸æŽ¥å— 0ï¼‰

### 3. å®‰å…¨æŽªæ–½

- **CSRFé˜²æŠ¤**ï¼šæ‰€æœ‰æ•æ„Ÿ POST/PUT/DELETE è¯·æ±‚å¿…é¡»åŒ…å« CSRF token
- **OriginéªŒè¯**ï¼šéªŒè¯è¯·æ±‚æ¥æºï¼Œé˜²æ­¢è·¨ç«™è¯·æ±‚ä¼ªé€ 
- **é€ŸçŽ‡é™åˆ¶**ï¼š
  - ç”³è¯·å‚ä¸Žï¼šæ¯ä¸ªç”¨æˆ·æ¯å°æ—¶æœ€å¤šç”³è¯·10ä¸ªä»»åŠ¡
  - é€€å‡ºç”³è¯·ï¼šæ¯ä¸ªç”¨æˆ·æ¯å°æ—¶æœ€å¤šç”³è¯·é€€å‡º5æ¬¡
  - å®Œæˆæäº¤ï¼šæ¯ä¸ªç”¨æˆ·æ¯å°æ—¶æœ€å¤šæäº¤å®Œæˆ10æ¬¡
  - å¥–åŠ±åˆ†é…ï¼šæ¯ä¸ªç®¡ç†å‘˜æ¯å°æ—¶æœ€å¤šåˆ†é…å¥–åŠ±20æ¬¡
- **WebSocketå®‰å…¨**ï¼š
  - æ¡æ‰‹æ—¶éªŒè¯ JWT token
  - éªŒè¯ç”¨æˆ·æ˜¯å¦ä¸ºä»»åŠ¡å‚ä¸Žè€…ï¼ˆæŸ¥è¯¢ `task_participants` è¡¨ï¼‰
  - å®šæœŸç»­ç­¾ tokenï¼ˆæ¯15åˆ†é’Ÿï¼‰
  - æ–­çº¿é‡è¿žæ—¶é‡æ–°éªŒè¯èº«ä»½
  - æ¶ˆæ¯å‘é€å‰å†æ¬¡éªŒè¯å‚ä¸Žè€…çŠ¶æ€
- **åæ»¥ç”¨ç­–ç•¥**ï¼š
  - æ£€æµ‹å¼‚å¸¸ç”³è¯·æ¨¡å¼ï¼ˆçŸ­æ—¶é—´å†…å¤§é‡ç”³è¯·ï¼‰
  - æ£€æµ‹åˆ·å¥–åŠ±è¡Œä¸ºï¼ˆåŒä¸€ç”¨æˆ·å¤šæ¬¡å‚ä¸Žé«˜å¥–åŠ±ä»»åŠ¡ï¼‰
  - è‡ªåŠ¨æ ‡è®°å¯ç–‘è´¦æˆ·ï¼Œéœ€è¦äººå·¥å®¡æ ¸
- **å®¡è®¡è¿½è¸ª**ï¼šæ‰€æœ‰æ•æ„Ÿæ“ä½œè®°å½•åˆ° `task_audit_logs` è¡¨ï¼ŒåŒ…å«IPåœ°å€å’Œç”¨æˆ·ä»£ç†

### 3. å¹¶å‘æŽ§åˆ¶

- **ç”³è¯·å‚ä¸Žæ—¶çš„å¹¶å‘æŽ§åˆ¶**ï¼š
  - ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
  - å¯¹ `tasks` è®°å½•ä½¿ç”¨ `SELECT ... FOR UPDATE` é”å®šï¼Œé˜²æ­¢å¹¶å‘ä¿®æ”¹
  - ä½¿ç”¨å®žæ—¶ `COUNT(*)` æŸ¥è¯¢å‚ä¸Žè€…æ•°é‡ï¼ˆçŠ¶æ€ä¸º `pending`ã€`accepted`ã€`in_progress`ï¼‰ï¼Œè€Œéžä¾èµ– `current_participants` å­—æ®µ
  - ä½¿ç”¨å”¯ä¸€çº¦æŸ `(task_id, user_id)` é˜²æ­¢é‡å¤ç”³è¯·
  - ä½¿ç”¨å¹‚ç­‰é”®é˜²æ­¢é‡å¤è¯·æ±‚
- **çŠ¶æ€æ›´æ–°æ—¶çš„å¹¶å‘æŽ§åˆ¶**ï¼š
  - ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡
  - ä½¿ç”¨ä¹è§‚é”ï¼ˆ`updated_at` ç‰ˆæœ¬å·ï¼‰æˆ–æ‚²è§‚é”é˜²æ­¢å¹¶å‘çŠ¶æ€å˜æ›´
- **å¥–åŠ±åˆ†é…æ—¶çš„å¹¶å‘æŽ§åˆ¶**ï¼š
  - ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡
  - ä½¿ç”¨å¹‚ç­‰é”®é˜²æ­¢é‡å¤åˆ†é…
  - éªŒè¯æ€»åˆ†é…é‡‘é¢/ç§¯åˆ†ä¸è¶…è¿‡ä»»åŠ¡æ€»é¢ï¼ˆåœ¨äº‹åŠ¡å†…å®žæ—¶è®¡ç®—ï¼‰

### 4. å¹‚ç­‰æ€§ç­–ç•¥

- **ç»Ÿä¸€è§„åˆ™**ï¼šæ‰€æœ‰ä¼šäº§ç”Ÿ side-effect çš„ POST æ“ä½œï¼ˆå°¤å…¶æ˜¯å¯èƒ½è¢«ç”¨æˆ·"è¿žç‚¹ä¸¤æ¬¡"çš„ï¼‰éƒ½åº”åŒ…å« `idempotency_key`
  - **å»ºè®®æºå¸¦**ï¼šç”³è¯·å‚ä¸Žã€é€€å‡ºç”³è¯·ã€æäº¤å®Œæˆ
  - **å¼ºåˆ¶è¦æ±‚**ï¼šå¥–åŠ±åˆ†é…ã€å‘èµ·æ”¯ä»˜ç­‰å…³é”®æ“ä½œ
- **å®¢æˆ·ç«¯ç”Ÿæˆå¹‚ç­‰é”®**ï¼šå®¢æˆ·ç«¯ç”Ÿæˆ UUID æ ¼å¼çš„ `idempotency_key`
- **æœåŠ¡ç«¯ç¼“å­˜**ï¼šåœ¨ Redis æˆ–å†…å­˜ä¸­ç¼“å­˜å¹‚ç­‰é”®ï¼ˆ5-15åˆ†é’Ÿï¼‰ï¼Œæ‹’ç»é‡å¤è¯·æ±‚
- **æ•°æ®åº“å”¯ä¸€çº¦æŸ**ï¼šåœ¨ç›¸å…³è¡¨ä¸­æ·»åŠ  `idempotency_key` å”¯ä¸€çº¦æŸï¼Œä½œä¸ºæœ€åŽä¸€é“é˜²çº¿
  - **å…¨å±€å”¯ä¸€**ï¼šå½“å‰ä½¿ç”¨ `UNIQUE(idempotency_key)`ï¼ŒUUID å†²çªæ¦‚çŽ‡å‡ ä¹Žå¯ä»¥å¿½ç•¥
  - **å¯é€‰ä¼˜åŒ–**ï¼šå¦‚æžœå¸Œæœ›ä¸åŒç”¨æˆ·å¯ä»¥å¤ç”¨åŒä¸€ä¸ª keyï¼Œå¯æ”¹ä¸º `UNIQUE(user_id, idempotency_key)`
- **å¹‚ç­‰è¿”å›žè§„èŒƒ**ï¼ˆå¿…é¡»ä¸¥æ ¼æ‰§è¡Œï¼‰ï¼š
  - **åŽŸåˆ™**ï¼šå½“é‡åˆ° `UNIQUE(idempotency_key)` å†²çªæ—¶ï¼Œ**ä¸æ˜¯è¿”å›ž 4xx é”™è¯¯**ï¼Œè€Œæ˜¯æ ¹æ®å·²æœ‰è®°å½•é‡æ”¾ç»“æžœ
  - **å®žçŽ°æ–¹å¼**ï¼š
    1. æŸ¥è¯¢æ•°æ®åº“ä¸­å·²å­˜åœ¨çš„è®°å½•ï¼ˆæ ¹æ® `idempotency_key`ï¼‰
    2. è¿”å›žè¯¥è®°å½•çš„å®Œæ•´ä¿¡æ¯ï¼ŒçŠ¶æ€ç ä¸º 200 OK
    3. ä¸åœ¨ä¸šåŠ¡é€»è¾‘ä¸­é‡å¤æ‰§è¡Œæ“ä½œ
  - **å…·ä½“ç¤ºä¾‹**ï¼š
    - **ç”³è¯·å‚ä¸Ž**ï¼šæŸ¥è¯¢ `task_participants` è¡¨ä¸­ `idempotency_key` å¯¹åº”çš„è®°å½•ï¼Œè¿”å›žè¯¥å‚ä¸Žè€…ä¿¡æ¯ï¼ˆåŒ…æ‹¬ `status`ã€`applied_at`ã€`accepted_at` ç­‰ï¼‰
    - **æäº¤å®Œæˆ**ï¼šæŸ¥è¯¢ `task_participants` è¡¨ä¸­ `idempotency_key` å¯¹åº”çš„è®°å½•ï¼Œè¿”å›žè¯¥å‚ä¸Žè€…çš„å®Œæˆä¿¡æ¯ï¼ˆåŒ…æ‹¬ `status='completed'`ã€`completed_at` ç­‰ï¼‰
    - **åˆ†é…å¥–åŠ±**ï¼šæŸ¥è¯¢ `task_participant_rewards` è¡¨ä¸­ `idempotency_key` å¯¹åº”çš„è®°å½•ï¼Œèšåˆè¿”å›žæ‰€æœ‰å‚ä¸Žè€…çš„å¥–åŠ±åˆ†é…ç»“æžœ

### 5. current_participants å­—æ®µè¯´æ˜Ž

- `current_participants` å­—æ®µä»…ä½œä¸º**å±•ç¤ºç”¨ç¼“å­˜**ï¼Œä¸åº”ç”¨äºŽä¸šåŠ¡é€»è¾‘å†³ç­–
- æ‰€æœ‰å†³ç­–ï¼ˆå¦‚æ˜¯å¦å…è®¸ç”³è¯·ã€æ˜¯å¦è¾¾åˆ°æœ€å¤§äººæ•°ï¼‰éƒ½åº”ä½¿ç”¨å®žæ—¶ `COUNT(*)` æŸ¥è¯¢
- **MVPé˜¶æ®µå»ºè®®**ï¼šå¯ä»¥å®Œå…¨ä¸å­˜ `current_participants`ï¼Œæ‰€æœ‰åœ°æ–¹å®žæ—¶ `COUNT(*)`
  - å¯¹äºŽäººæ•°ä¸Šé™è¾ƒå°çš„ä»»åŠ¡ï¼ˆ7äººçº§åˆ«ï¼‰ï¼Œ`COUNT(*)` æ€§èƒ½è¶³å¤Ÿ
  - å¦‚æžœåŽç»­å‘çŽ°åˆ—è¡¨é¡µ QPS å¾ˆé«˜ï¼Œä¸” profiling æ˜¾ç¤º `COUNT(*)` æ˜¯ç“¶é¢ˆï¼Œå†è€ƒè™‘æ·»åŠ ç¼“å­˜å­—æ®µ
- **å¦‚æžœä½¿ç”¨ç¼“å­˜å­—æ®µ**ï¼š
  - ä½¿ç”¨æ•°æ®åº“è§¦å‘å™¨è‡ªåŠ¨ç»´æŠ¤ `current_participants`ï¼Œç¦æ­¢åº”ç”¨å±‚ç›´æŽ¥ UPDATE è¯¥å­—æ®µ
  - è§¦å‘å™¨åº”ä½¿ç”¨å¢žé‡æ›´æ–°ï¼ˆåˆ¤æ–­ old/new.status æ˜¯å¦ä»Ž"å å‘çŠ¶æ€"å˜æˆ"éžå å‘çŠ¶æ€"å† Â±1ï¼‰ï¼Œè€Œéžæ¯æ¬¡éƒ½ `COUNT(*)` å…¨è¡¨è®¡ç®—
  - å¦‚æžœå‘çŽ°ä¸ä¸€è‡´ï¼Œä»¥å®žæ—¶è®¡æ•°ä¸ºå‡†

**è§¦å‘å™¨ç»´æŠ¤æ–¹æ¡ˆï¼ˆå¯é€‰ï¼ŒMVPé˜¶æ®µä¸å»ºè®®ä½¿ç”¨ï¼‰**ï¼š

âš ï¸ **v1.0 ä¸è¦å®žçŽ°æœ¬è§¦å‘å™¨ï¼Œä»…ä½œä¸ºæœªæ¥ä¼˜åŒ–æ–¹æ¡ˆ**ã€‚v1.0 é˜¶æ®µæ‰€æœ‰åœ°æ–¹ä½¿ç”¨å®žæ—¶ `COUNT(*)` æŸ¥è¯¢ï¼Œä¸ç»´æŠ¤ `current_participants` ç¼“å­˜å­—æ®µã€‚å¦‚æžœå®žçŽ°è§¦å‘å™¨ä½†ä¸Šå±‚é€»è¾‘ä»ç”¨ `COUNT(*)` åšå¯ä¿¡æºï¼Œä¼šå¯¼è‡´ä¸¤ä¸ªå€¼å¯¹ä¸ä¸Šã€‚

```sql
-- åˆ›å»ºè§¦å‘å™¨å‡½æ•°ï¼Œè‡ªåŠ¨ç»´æŠ¤ current_participants
CREATE OR REPLACE FUNCTION update_task_participants_count() RETURNS trigger AS $$
BEGIN
  IF TG_OP = 'INSERT' THEN
    UPDATE tasks 
    SET current_participants = (
      SELECT COUNT(*) FROM task_participants 
      WHERE task_id = NEW.task_id 
      AND status IN ('pending', 'accepted', 'in_progress')
    )
    WHERE id = NEW.task_id;
    RETURN NEW;
  ELSIF TG_OP = 'UPDATE' THEN
    -- çŠ¶æ€å˜æ›´æ—¶æ›´æ–°è®¡æ•°
    IF OLD.status != NEW.status THEN
      UPDATE tasks 
      SET current_participants = (
        SELECT COUNT(*) FROM task_participants 
        WHERE task_id = NEW.task_id 
        AND status IN ('pending', 'accepted', 'in_progress')
      )
      WHERE id = NEW.task_id;
    END IF;
    RETURN NEW;
  ELSIF TG_OP = 'DELETE' THEN
    UPDATE tasks 
    SET current_participants = (
      SELECT COUNT(*) FROM task_participants 
      WHERE task_id = OLD.task_id 
      AND status IN ('pending', 'accepted', 'in_progress')
    )
    WHERE id = OLD.task_id;
    RETURN OLD;
  END IF;
  RETURN NULL;
END;
$$ LANGUAGE plpgsql;

-- ä¸º task_participants è¡¨æ·»åŠ è§¦å‘å™¨
CREATE TRIGGER trg_update_task_participants_count
AFTER INSERT OR UPDATE OR DELETE ON task_participants
FOR EACH ROW EXECUTE FUNCTION update_task_participants_count();
```

**æ³¨æ„**ï¼šå¦‚æžœä½¿ç”¨è§¦å‘å™¨æ–¹æ¡ˆï¼Œåº”ç”¨å±‚ä»£ç ä¸­æ‰€æœ‰å¯¹ `current_participants` çš„ç›´æŽ¥ UPDATE æ“ä½œéƒ½åº”ç§»é™¤ï¼Œæ”¹ä¸ºä¾èµ–è§¦å‘å™¨è‡ªåŠ¨ç»´æŠ¤ã€‚

---

## ðŸ“Š çŠ¶æ€æµè½¬

### ä»»åŠ¡çŠ¶æ€æµè½¬

```
open (å¼€æ”¾ç”³è¯·)
  â†“ (ç®¡ç†å‘˜å¼€å§‹ä»»åŠ¡ï¼Œæˆ–è¾¾åˆ°min_participantsè‡ªåŠ¨å¼€å§‹)
in_progress (è¿›è¡Œä¸­)
  â†“ (æ»¡è¶³å®Œæˆæ¡ä»¶)
completed (å·²å®Œæˆ)
  â†“
cancelled (å·²å–æ¶ˆ) [å¯å‘ç”Ÿåœ¨ä»»ä½•çŠ¶æ€ï¼Œç®¡ç†å‘˜æ“ä½œ]
```

**çŠ¶æ€è¯´æ˜Ž**ï¼š
- `open`: ä»»åŠ¡å¼€æ”¾ç”³è¯·ï¼Œå‚ä¸Žè€…å¯ä»¥ç”³è¯·å‚ä¸Ž
- `in_progress`: ä»»åŠ¡è¿›è¡Œä¸­ï¼Œå‚ä¸Žè€…æ­£åœ¨å·¥ä½œ
- `completed`: ä»»åŠ¡å·¥ä½œæµç¨‹å·²å®Œæˆï¼ˆæ ¹æ®å®Œæˆè§„åˆ™åˆ¤å®šï¼‰
  - **é‡è¦è¯´æ˜Ž**ï¼š`completed` çŠ¶æ€ä»…è¡¨ç¤ºä»»åŠ¡å·¥ä½œæµç¨‹å·²å®Œæˆï¼Œ**ä¸ä»£è¡¨å¥–åŠ±å·²åˆ†é…**
  - **å¥–åŠ±ç»“ç®—çŠ¶æ€**ï¼šéœ€æŸ¥è¯¢ `task_participant_rewards` è¡¨çš„ `payment_status` å’Œ `points_status` å­—æ®µåˆ¤æ–­å¥–åŠ±æ˜¯å¦å·²å‘æ”¾
  - **å‰ç«¯å±•ç¤ºå»ºè®®**ï¼š
    - "ä»»åŠ¡æ‰§è¡Œå®Œæˆ" = `status = 'completed'`
    - "å¥–åŠ±ç»“ç®—å®Œæˆ" = æ‰€æœ‰ç›¸å…³ `task_participant_rewards` è®°å½•éƒ½è¿›å…¥ `paid`/`credited` ç­‰ç»ˆæ€
- `cancelled`: ä»»åŠ¡å·²å–æ¶ˆï¼ˆå¯å‘ç”Ÿåœ¨ä»»ä½•çŠ¶æ€ï¼Œç®¡ç†å‘˜æ“ä½œï¼‰

**é‡è¦è§„åˆ™**ï¼š
- `min_participants` ä»…ç”¨äºŽ"å¯å¼€å§‹"åˆ¤å®šï¼Œä¸€æ—¦ä»»åŠ¡å¼€å§‹ï¼Œå³ä½¿åŽç»­æœ‰äººé€€å‡ºå¯¼è‡´äººæ•° < `min_participants`ï¼Œä»»åŠ¡ä»å¯ç»§ç»­è¿›è¡Œ
- ä»»åŠ¡å–æ¶ˆæ—¶ï¼Œéœ€è¦å¤„ç†é€€æ¬¾/ç§¯åˆ†å›žé€€ï¼ˆè§"å–æ¶ˆç­–ç•¥çŸ©é˜µ"ç« èŠ‚ï¼‰

---

## ðŸ“‹ è¿Ÿåˆ°åŠ å…¥è§„åˆ™

### å½“å‰ç­–ç•¥

**ç­–ç•¥Aï¼ˆå½“å‰å®žçŽ°ï¼‰**ï¼šä»»åŠ¡å¼€å§‹åŽï¼ˆ`in_progress` çŠ¶æ€ï¼‰**ç¦æ­¢**æ–°æˆå‘˜ç”³è¯·åŠ å…¥ã€‚

**ç†ç”±**ï¼š
- ç®€åŒ–çŠ¶æ€ç®¡ç†ï¼Œé¿å…å¤æ‚çš„è®¡æ—¶å’Œå¥–åŠ±åˆ†é…é€»è¾‘
- ç¡®ä¿æ‰€æœ‰å‚ä¸Žè€…æœ‰ç›¸åŒçš„å¼€å§‹æ—¶é—´å’Œå·¥ä½œå‘¨æœŸ
- é¿å…å› æ–°æˆå‘˜åŠ å…¥å¯¼è‡´çš„ä»»åŠ¡å®Œæˆæ¡ä»¶é‡æ–°è®¡ç®—

### å¯é€‰ç­–ç•¥ï¼ˆæœªæ¥æ‰©å±•ï¼‰

**ç­–ç•¥Bï¼ˆå¯é€‰ï¼‰**ï¼šå…è®¸ä»»åŠ¡å¼€å§‹åŽè¡¥æ‹›è‡³ `max_participants`ã€‚

**éœ€è¦æ˜Žç¡®çš„è§„åˆ™**ï¼š
1. **æ–°æˆå‘˜åˆå§‹çŠ¶æ€**ï¼š
   - æ–¹æ¡ˆ1ï¼šç›´æŽ¥è¿›å…¥ `in_progress`ï¼ˆæŽ¨èï¼Œç®€åŒ–æµç¨‹ï¼‰
   - æ–¹æ¡ˆ2ï¼šå…ˆè¿›å…¥ `accepted`ï¼Œå†ç”±ç®¡ç†å‘˜æˆ–ç³»ç»Ÿè‡ªåŠ¨è½¬æ¢ä¸º `in_progress`

2. **`started_at` è®¡æ—¶è§„åˆ™**ï¼š
   - æ–¹æ¡ˆ1ï¼šä½¿ç”¨ä»»åŠ¡å¼€å§‹æ—¶é—´ï¼ˆæ‰€æœ‰å‚ä¸Žè€…ç»Ÿä¸€è®¡æ—¶ï¼‰
   - æ–¹æ¡ˆ2ï¼šä½¿ç”¨æ–°æˆå‘˜åŠ å…¥æ—¶é—´ï¼ˆæŒ‰å®žé™…å‚ä¸Žæ—¶é•¿è®¡ç®—ï¼‰

3. **å¥–åŠ±åˆ†é…è§„åˆ™**ï¼š
   - æ–¹æ¡ˆ1ï¼šæŒ‰æ¯”ä¾‹å‡å°‘ï¼ˆæ ¹æ®å‚ä¸Žæ—¶é•¿æˆ–å·¥ä½œé‡è°ƒæ•´ï¼‰
   - æ–¹æ¡ˆ2ï¼šå¹³å‡åˆ†é…ï¼ˆæ‰€æœ‰å‚ä¸Žè€…èŽ·å¾—ç›¸åŒå¥–åŠ±ï¼‰
   - æ–¹æ¡ˆ3ï¼šè‡ªå®šä¹‰åˆ†é…ï¼ˆç®¡ç†å‘˜æ‰‹åŠ¨è°ƒæ•´ï¼‰

4. **`completion_rule=min` è®¡æ•°å£å¾„**ï¼š
   - æ–¹æ¡ˆ1ï¼šåŒ…å«æ–°æˆå‘˜ï¼ˆæ–°æˆå‘˜ä¹Ÿéœ€è¦å®Œæˆæ‰èƒ½æ»¡è¶³æœ€å°äººæ•°ï¼‰
   - æ–¹æ¡ˆ2ï¼šä¸åŒ…å«æ–°æˆå‘˜ï¼ˆä»…è®¡ç®—ä»»åŠ¡å¼€å§‹æ—¶çš„å‚ä¸Žè€…ï¼‰

5. **ç”³è¯·æ¡ä»¶**ï¼š
   - ä»»åŠ¡çŠ¶æ€ä»ä¸º `in_progress`
   - å½“å‰å‚ä¸Žäººæ•° < `max_participants`
   - ä»»åŠ¡æœªå®Œæˆ

**å®žçŽ°å»ºè®®**ï¼š
- å¦‚æžœé‡‡ç”¨ç­–ç•¥Bï¼Œéœ€è¦åœ¨ç”³è¯·æŽ¥å£ä¸­ç§»é™¤"ä»»åŠ¡çŠ¶æ€å¿…é¡»ä¸º `open`"çš„é™åˆ¶
- æ·»åŠ "è¿Ÿåˆ°åŠ å…¥"æ ‡è¯†ï¼Œä¾¿äºŽå‰ç«¯æ˜¾ç¤ºå’Œç»Ÿè®¡
- åœ¨å®¡è®¡æ—¥å¿—ä¸­è®°å½•"è¿Ÿåˆ°åŠ å…¥"æ“ä½œ
- è€ƒè™‘æ·»åŠ "è¿Ÿåˆ°åŠ å…¥æˆªæ­¢æ—¶é—´"å­—æ®µï¼Œé™åˆ¶æœ€æ™šåŠ å…¥æ—¶é—´

### é€€å‡ºé€»è¾‘ä¸Žå å‘è§„åˆ™

**å½“å‰ç­–ç•¥ï¼ˆç­–ç•¥Aï¼‰**ï¼š
- ç”³è¯·å‚ä¸Žæ—¶è®¡ç®—äººæ•°ï¼šçŠ¶æ€ä¸º `pending`ã€`accepted`ã€`in_progress` çš„å‚ä¸Žè€…
- `exit_requested` çŠ¶æ€**ä¸å å‘**ï¼ˆå› ä¸ºå½“å‰ç­–ç•¥ä¸‹ä»»åŠ¡å¼€å§‹åŽä¸å…è®¸æ–°æˆå‘˜åŠ å…¥ï¼Œä¸ä¼šå‡ºçŽ°è¶…å–é—®é¢˜ï¼‰
- `completed` çŠ¶æ€**ä¸å å‘**ï¼ˆå·²å®Œæˆè€…ä¸å ç”¨å‚ä¸Žåé¢ï¼‰

**æœªæ¥æ‰©å±•ï¼ˆç­–ç•¥Bï¼Œè¿Ÿåˆ°åŠ å…¥ï¼‰**ï¼š
- å¦‚æžœå¼€æ”¾"è¿Ÿåˆ°åŠ å…¥"ï¼Œéœ€è¦å°† `exit_requested` çŠ¶æ€ä¹Ÿè®¡å…¥å å‘äººæ•°ï¼Œé˜²æ­¢è¶…å–
- éœ€è¦æ˜Žç¡® `completed` çŠ¶æ€æ˜¯å¦å å‘ï¼š
  - å¦‚æžœ `completed` å å‘ï¼šå·²å®Œæˆè€…ä»å ç”¨åé¢ï¼Œæ–°æˆå‘˜æ— æ³•åŠ å…¥ï¼ˆé™¤éžæœ‰äººé€€å‡ºï¼‰
  - å¦‚æžœ `completed` ä¸å å‘ï¼šå·²å®Œæˆè€…é‡Šæ”¾åé¢ï¼Œæ–°æˆå‘˜å¯ä»¥è¡¥ä½
- **å»ºè®®**ï¼š`completed` ä¸å å‘ï¼Œå…è®¸å·²å®Œæˆè€…é‡Šæ”¾åé¢ç»™æ–°æˆå‘˜

---

### å‚ä¸Žè€…çŠ¶æ€æµè½¬ï¼ˆå®˜æ–¹ä»»åŠ¡ï¼‰

```
ç”¨æˆ·ç”³è¯·
  â†“ (è‡ªåŠ¨æŽ¥å—ï¼Œå®˜æ–¹ä»»åŠ¡ auto_accept=true)
accepted (å·²æŽ¥å—ï¼Œå¯è¿›å…¥èŠå¤©å®¤)
  â†“ (ç®¡ç†å‘˜å¼€å§‹ä»»åŠ¡)
in_progress (è¿›è¡Œä¸­)
  â†“ (å‚ä¸Žè€…æäº¤å®Œæˆ)
completed (å·²å®Œæˆ) [âš ï¸ å·²å®ŒæˆçŠ¶æ€ä¸å¯å†ç”³è¯·é€€å‡º]
  â†“
exit_requested (é€€å‡ºç”³è¯·ä¸­) [ä»…å¯å‘ç”Ÿåœ¨ accepted æˆ– in_progress çŠ¶æ€]
  â†“ (ç®¡ç†å‘˜æ‰¹å‡†)
exited (å·²é€€å‡º)
  â†“ (ç®¡ç†å‘˜æ‹’ç»)
[æ¢å¤ä¸º previous_status: accepted æˆ– in_progress]
  â†“
cancelled (å·²å–æ¶ˆ) [ç®¡ç†å‘˜å¯å–æ¶ˆå‚ä¸Žè€…èµ„æ ¼ï¼Œå¯å‘ç”Ÿåœ¨ä»»ä½•çŠ¶æ€]
```

**é‡è¦è§„åˆ™**ï¼š
- `exit_requested` çŠ¶æ€**ä»…å¯**ä»Ž `accepted` æˆ– `in_progress` çŠ¶æ€è¿›å…¥
- `completed` çŠ¶æ€**ä¸å¯**å†ç”³è¯·é€€å‡ºï¼ˆå·²å®Œæˆè€…ä¸èƒ½é€€å‡ºï¼‰
- `exited` æˆ– `cancelled` çŠ¶æ€**ä¸å¯**å†æ¬¡ç”³è¯·é€€å‡º

**éžå®˜æ–¹ä»»åŠ¡çŠ¶æ€æµè½¬ï¼ˆæš‚ä¸æ”¯æŒï¼Œé¢„ç•™ï¼‰**ï¼š
```
ç”¨æˆ·ç”³è¯·
  â†“
pending (å¾…å®¡æ ¸)
  â†“ (ç®¡ç†å‘˜å®¡æ ¸é€šè¿‡)
accepted (å·²æŽ¥å—)
  â†“ (ç®¡ç†å‘˜å®¡æ ¸æ‹’ç»)
[è®°å½•è¢«åˆ é™¤æˆ–çŠ¶æ€ä¸º rejectedï¼Œå½“å‰ä¸å®žçŽ°]
```

**çŠ¶æ€è¯´æ˜Ž**ï¼š
- `pending`: å¾…å®¡æ ¸ï¼ˆéžå®˜æ–¹ä»»åŠ¡éœ€è¦ç­‰å¾…ç®¡ç†å‘˜å®¡æ ¸ï¼Œå®˜æ–¹ä»»åŠ¡ä¸ä¼šè¿›å…¥æ­¤çŠ¶æ€ï¼‰
- `accepted`: å·²æŽ¥å—ï¼ˆå®˜æ–¹ä»»åŠ¡è‡ªåŠ¨æŽ¥å—ï¼Œç”¨æˆ·ç”³è¯·åŽç«‹å³è¿›å…¥æ­¤çŠ¶æ€ï¼Œå¯ä»¥è¿›å…¥èŠå¤©å®¤ï¼‰
- `in_progress`: è¿›è¡Œä¸­ï¼ˆä»»åŠ¡å·²å¼€å§‹ï¼Œå‚ä¸Žè€…æ­£åœ¨å·¥ä½œï¼‰
- `completed`: å·²å®Œæˆï¼ˆå‚ä¸Žè€…å·²å®Œæˆè‡ªå·±çš„éƒ¨åˆ†ï¼‰
- `exit_requested`: é€€å‡ºç”³è¯·ä¸­ï¼ˆå‚ä¸Žè€…ç”³è¯·é€€å‡ºï¼Œç­‰å¾…ç®¡ç†å‘˜å®¡æ ¸ï¼Œæ­¤æ—¶ `previous_status` ä¿å­˜å‰ä¸€ä¸ªçŠ¶æ€ï¼‰
- `exited`: å·²é€€å‡ºï¼ˆç®¡ç†å‘˜æ‰¹å‡†é€€å‡ºï¼‰
- `cancelled`: å·²å–æ¶ˆï¼ˆç®¡ç†å‘˜å–æ¶ˆå‚ä¸Žè€…èµ„æ ¼ï¼Œå¯å‘ç”Ÿåœ¨ä»»ä½•çŠ¶æ€ï¼‰

**é‡è¦è§„åˆ™**ï¼š
- å®˜æ–¹ä»»åŠ¡ï¼ˆ`auto_accept=true`ï¼‰ï¼šç”¨æˆ·ç”³è¯·åŽç«‹å³è¿›å…¥ `accepted` çŠ¶æ€ï¼Œæ— éœ€ç­‰å¾…ç®¡ç†å‘˜å®¡æ ¸
- éžå®˜æ–¹ä»»åŠ¡ï¼ˆ`auto_accept=false`ï¼‰ï¼šç”¨æˆ·ç”³è¯·åŽéœ€è¦ç­‰å¾…ç®¡ç†å‘˜å®¡æ ¸ï¼ˆæ­¤åŠŸèƒ½æš‚ä¸å®žçŽ°ï¼Œå½“å‰ä»…æ”¯æŒå®˜æ–¹ä»»åŠ¡ï¼‰
- å‚ä¸Žè€…**ä»…å¯**åœ¨ `accepted` æˆ– `in_progress` çŠ¶æ€ç”³è¯·é€€å‡ºï¼Œ`completed`ã€`exited`ã€`cancelled` çŠ¶æ€ä¸å¯å†ç”³è¯·é€€å‡º
- é€€å‡ºç”³è¯·è¢«æ‹’ç»æ—¶ï¼Œä»Ž `previous_status` æ¢å¤ä¹‹å‰çš„çŠ¶æ€
- ç®¡ç†å‘˜å¯ä»¥éšæ—¶å–æ¶ˆå‚ä¸Žè€…èµ„æ ¼ï¼ˆçŠ¶æ€å˜ä¸º `cancelled`ï¼‰
- ä»»åŠ¡å®ŒæˆåŽï¼Œæœªå®Œæˆçš„å‚ä¸Žè€…ä»å¯æäº¤å®Œæˆï¼Œä½†ä¸ä¼šå½±å“ä»»åŠ¡å®ŒæˆçŠ¶æ€

---

## ðŸ“‹ å–æ¶ˆç­–ç•¥çŸ©é˜µ

âš ï¸ **é‡è¦è¯´æ˜Ž**ï¼šæœ¬èŠ‚ä¸ºæœªæ¥æ‰©å±•è®¾è®¡ï¼Œv1.0 ä»…å®žçŽ°ã€ŒçŠ¶æ€å˜æ›´ + å®¡è®¡æ—¥å¿—ã€ï¼Œä¸å®žçŽ°çœŸå®žé€€æ¬¾/ç§¯åˆ†å›žé€€é€»è¾‘ã€‚v1.0 çš„å–æ¶ˆæ“ä½œä»…æ›´æ–°çŠ¶æ€å’Œè®°å½•å®¡è®¡æ—¥å¿—ï¼Œä¸æ¶‰åŠæ”¯ä»˜ç½‘å…³å¯¹æŽ¥å’Œç§¯åˆ†æ‰£é™¤ã€‚

### ä»»åŠ¡å–æ¶ˆåœºæ™¯

| å–æ¶ˆæ—¶æœº | å‘èµ·è€… | é€€æ¬¾/å›žé€€ç­–ç•¥ | é€šçŸ¥å¯¹è±¡ | çŠ¶æ€å˜æ›´ |
|---------|--------|--------------|---------|---------|
| ä»»åŠ¡å¼€å§‹å‰ï¼ˆopençŠ¶æ€ï¼‰ | ç®¡ç†å‘˜ | æ— éœ€é€€æ¬¾ï¼ˆå°šæœªåˆ†é…å¥–åŠ±ï¼‰ | æ‰€æœ‰å‚ä¸Žè€… | ä»»åŠ¡çŠ¶æ€ â†’ cancelledï¼Œå‚ä¸Žè€…çŠ¶æ€ â†’ cancelled |
| ä»»åŠ¡è¿›è¡Œä¸­ï¼ˆin_progressï¼‰ | ç®¡ç†å‘˜ | æŒ‰å®Œæˆåº¦éƒ¨åˆ†é€€æ¬¾/ç§¯åˆ†å›žé€€ | æ‰€æœ‰å‚ä¸Žè€… | ä»»åŠ¡çŠ¶æ€ â†’ cancelledï¼Œå‚ä¸Žè€…çŠ¶æ€ â†’ cancelled |
| ä»»åŠ¡å·²å®Œæˆï¼ˆcompletedï¼‰ | ç®¡ç†å‘˜ | å·²å‘æ”¾å¥–åŠ±éœ€è¿½å›žï¼ˆé€€æ¬¾/ç§¯åˆ†æ‰£é™¤ï¼‰ | æ‰€æœ‰å‚ä¸Žè€…ã€è´¢åŠ¡éƒ¨é—¨ | ä»»åŠ¡çŠ¶æ€ â†’ cancelledï¼Œå‚ä¸Žè€…çŠ¶æ€ä¿æŒä¸å˜ï¼ˆå·²å®Œæˆï¼‰ |

### å‚ä¸Žè€…å–æ¶ˆåœºæ™¯

| å–æ¶ˆæ—¶æœº | å‘èµ·è€… | é€€æ¬¾/å›žé€€ç­–ç•¥ | é€šçŸ¥å¯¹è±¡ | çŠ¶æ€å˜æ›´ |
|---------|--------|--------------|---------|---------|
| ç”³è¯·é˜¶æ®µï¼ˆpendingï¼‰ | ç®¡ç†å‘˜ | æ— éœ€å¤„ç† | å‚ä¸Žè€… | å‚ä¸Žè€…çŠ¶æ€ â†’ cancelled |
| å·²æŽ¥å—ï¼ˆacceptedï¼‰ | ç®¡ç†å‘˜ | æ— éœ€é€€æ¬¾ï¼ˆå°šæœªå¼€å§‹å·¥ä½œï¼‰ | å‚ä¸Žè€… | å‚ä¸Žè€…çŠ¶æ€ â†’ cancelledï¼ˆäººæ•°ç»Ÿè®¡é€»è¾‘è§"current_participants å­—æ®µè¯´æ˜Ž"ç« èŠ‚ï¼‰ |
| è¿›è¡Œä¸­ï¼ˆin_progressï¼‰ | ç®¡ç†å‘˜ | æŒ‰å®Œæˆåº¦éƒ¨åˆ†é€€æ¬¾/ç§¯åˆ†å›žé€€ | å‚ä¸Žè€… | å‚ä¸Žè€…çŠ¶æ€ â†’ cancelledï¼ˆäººæ•°ç»Ÿè®¡é€»è¾‘è§"current_participants å­—æ®µè¯´æ˜Ž"ç« èŠ‚ï¼‰ |
| å·²å®Œæˆï¼ˆcompletedï¼‰ | ç®¡ç†å‘˜ | å·²å‘æ”¾å¥–åŠ±éœ€è¿½å›žï¼ˆé€€æ¬¾/ç§¯åˆ†æ‰£é™¤ï¼‰ | å‚ä¸Žè€…ã€è´¢åŠ¡éƒ¨é—¨ | å‚ä¸Žè€…çŠ¶æ€ â†’ cancelledï¼Œå¥–åŠ±è®°å½•æ ‡è®°ä¸º refunded |

### å–æ¶ˆæ“ä½œæµç¨‹

1. **ç®¡ç†å‘˜å‘èµ·å–æ¶ˆ**ï¼š
   - éªŒè¯ç®¡ç†å‘˜æƒé™
   - è®°å½•å–æ¶ˆåŽŸå› åˆ° `admin_notes`
   - æ›´æ–°çŠ¶æ€ä¸º `cancelled`
   - è®¾ç½® `cancelled_at` æ—¶é—´
   - è®°å½•å®¡è®¡æ—¥å¿—

2. **é€€æ¬¾/ç§¯åˆ†å›žé€€å¤„ç†**ï¼š
   - æŸ¥è¯¢ `task_participant_rewards` è¡¨ï¼Œæ‰¾å‡ºå·²å‘æ”¾çš„å¥–åŠ±
   - å¦‚æžœ `payment_status='paid'`ï¼Œè§¦å‘é€€æ¬¾æµç¨‹ï¼ˆä½¿ç”¨ `external_txn_id`ï¼‰
   - å¦‚æžœ `points_status='credited'`ï¼Œä»Žç”¨æˆ·è´¦æˆ·æ‰£é™¤ç§¯åˆ†
     - **ç§¯åˆ†æ‰£é™¤è¾¹ç•Œ**ï¼šéœ€è¦æ˜Žç¡®ç§¯åˆ†ç³»ç»Ÿæ˜¯å¦å…è®¸è´Ÿç§¯åˆ†
       - å¦‚æžœå…è®¸è´Ÿç§¯åˆ†ï¼šç›´æŽ¥æ‰£é™¤ï¼Œç”¨æˆ·è´¦æˆ·å¯èƒ½å‡ºçŽ°è´Ÿæ•°
       - å¦‚æžœä¸å…è®¸è´Ÿç§¯åˆ†ï¼šæ‰£é™¤åˆ° 0 ä¸ºæ­¢ï¼Œå‰©ä½™éƒ¨åˆ†è®°å½•ä¸º"æ¬ è´¦"æˆ–ç”Ÿæˆ"æ‰£å›žè´¦å•"
     - åœ¨å¥–åŠ±è¡¨ä¸­å¢žåŠ  `reversal_reference` å­—æ®µï¼Œå…³è”åŽŸäº¤æ˜“è®°å½•ï¼Œç”¨äºŽå¯¹è´¦
   - æ›´æ–°å¥–åŠ±è®°å½•çŠ¶æ€ä¸º `refunded`
   - è®°å½•å®¡è®¡æ—¥å¿—

3. **é€šçŸ¥å‘é€**ï¼š
   - å‘é€é€šçŸ¥ç»™æ‰€æœ‰ç›¸å…³ç”¨æˆ·
   - åœ¨èŠå¤©å®¤å‘é€ç³»ç»Ÿæ¶ˆæ¯ï¼ˆå¦‚æžœä»»åŠ¡æœ‰èŠå¤©å®¤ï¼‰
   - å‘é€é‚®ä»¶é€šçŸ¥ï¼ˆå¯é€‰ï¼‰

## ðŸ§ª æµ‹è¯•è®¡åˆ’

### 1. å•å…ƒæµ‹è¯•

- ä»»åŠ¡åˆ›å»ºé€»è¾‘æµ‹è¯•
- å‚ä¸Žè€…ç”³è¯·é€»è¾‘æµ‹è¯•
- çŠ¶æ€æµè½¬é€»è¾‘æµ‹è¯•
- å¥–åŠ±åˆ†é…è®¡ç®—æµ‹è¯•

### 2. é›†æˆæµ‹è¯•

- ç®¡ç†å‘˜åˆ›å»ºå®˜æ–¹å¤šäººä»»åŠ¡æµç¨‹ï¼ˆæ”¯æŒç§¯åˆ†å¥–åŠ±ï¼‰
- ç”¨æˆ·ç”³è¯·å‚ä¸Žæµç¨‹ï¼ˆè‡ªåŠ¨æŽ¥å—ï¼Œç«‹å³è¿›å…¥èŠå¤©å®¤ï¼‰
- ä»»åŠ¡èŠå¤©å®¤åŠŸèƒ½æµ‹è¯•ï¼ˆæ¶ˆæ¯å‘é€ã€æŽ¥æ”¶ã€æƒé™æŽ§åˆ¶ï¼‰
- å‚ä¸Žè€…é€€å‡ºç”³è¯·æµç¨‹
- ç®¡ç†å‘˜æ‰¹å‡†/æ‹’ç»é€€å‡ºç”³è¯·æµç¨‹
- ä»»åŠ¡å¼€å§‹æµç¨‹
- å‚ä¸Žè€…å®Œæˆæµç¨‹
- ä»»åŠ¡å®Œæˆå’Œå¥–åŠ±åˆ†é…æµç¨‹ï¼ˆæ”¯æŒç§¯åˆ†å¥–åŠ±ï¼‰
- è®®ä»·åŠŸèƒ½éªŒè¯ï¼ˆå¤šäººä»»åŠ¡ç¦æ­¢è®®ä»·ï¼‰

### 3. è¾¹ç•Œæµ‹è¯•

- è¾¾åˆ°æœ€å¤§å‚ä¸Žäººæ•°æ—¶çš„ç”³è¯·å¤„ç†ï¼ˆåº”æ‹’ç»æ–°ç”³è¯·ï¼‰
- æœªè¾¾åˆ°æœ€å°å‚ä¸Žäººæ•°æ—¶çš„ä»»åŠ¡å¼€å§‹
- ä»»åŠ¡å¼€å§‹åŽäººæ•°è·Œç ´ `min_participants` çš„å¤„ç†ï¼ˆä»»åŠ¡åº”ç»§ç»­ï¼Œä¸æš‚åœï¼‰
- å¥–åŠ±åˆ†é…æ€»é¢éªŒè¯ï¼ˆçŽ°é‡‘å’Œç§¯åˆ†åˆ†åˆ«éªŒè¯ï¼Œåœ¨äº‹åŠ¡å†…å®žæ—¶è®¡ç®—ï¼‰
- å¹¶å‘ç”³è¯·å¤„ç†ï¼ˆå¤šä¸ªç”¨æˆ·åŒæ—¶ç”³è¯·ï¼Œä½¿ç”¨ SELECT FOR UPDATE é”å®šï¼‰
- é€€å‡ºç”³è¯·è¾¹ç•Œï¼ˆå·²å®Œæˆæˆ–å·²é€€å‡ºçš„ä¸èƒ½å†æ¬¡ç”³è¯·é€€å‡ºï¼‰
- é€€å‡ºç”³è¯·æ‹’ç»åŽçŠ¶æ€æ¢å¤ï¼ˆä»Ž `previous_status` æ¢å¤ï¼‰
- èŠå¤©å®¤æƒé™è¾¹ç•Œï¼ˆéžå‚ä¸Žè€…ä¸èƒ½å‘é€æ¶ˆæ¯ï¼ŒWebSocket é‰´æƒï¼‰
- ç§¯åˆ†å¥–åŠ±è¾¹ç•Œï¼ˆä»…ç§¯åˆ†å¥–åŠ±çš„ä»»åŠ¡ï¼ŒçŽ°é‡‘å¥–åŠ±å¿…é¡»ä¸º NULLï¼Œä¸æŽ¥å— 0ï¼‰
- ä»»åŠ¡å®ŒæˆåŽçš„å‚ä¸Žè€…æäº¤ï¼ˆ`completion_rule=min` æ—¶ï¼Œæœªå®Œæˆè€…ä»å¯æäº¤ä½†ä¸å½±å“ä»»åŠ¡çŠ¶æ€ï¼‰
- å¹‚ç­‰é”®é‡å¤è¯·æ±‚ï¼ˆåº”è¿”å›žå·²æœ‰ç»“æžœï¼Œä¸æŠ¥é”™ï¼‰
- å­—æ®µç©ºå€¼éªŒè¯ï¼ˆ`accepted_at`ã€`started_at`ã€`completed_at` ç­‰åˆå§‹åº”ä¸º NULLï¼‰
- å¥–åŠ±å¹³å‡åˆ†é…å››èˆäº”å…¥ä¸Žä½™æ•°åˆ†é…çš„ä¸€è‡´æ€§æµ‹è¯•ï¼ˆå¤šå¹¶å‘ä¸Žé‡è¯•åœºæ™¯ä¸‹çš„å¿«ç…§æµ‹è¯•ï¼‰
- ç›¸åŒ `idempotency_key` å¤šæ¬¡æäº¤åªè½ä¸€ç¬”å¥–åŠ±çš„å¹‚ç­‰æ€§æµ‹è¯•

### 4. æ€§èƒ½æµ‹è¯•

- å¤§é‡å‚ä¸Žè€…ç”³è¯·çš„æ€§èƒ½
- ä»»åŠ¡åˆ—è¡¨æŸ¥è¯¢æ€§èƒ½
- å‚ä¸Žè€…çŠ¶æ€æ›´æ–°æ€§èƒ½

---

## ðŸ“ å¼€å‘æ­¥éª¤

### é˜¶æ®µä¸€ï¼šæ•°æ®åº“è®¾è®¡ï¼ˆ1-2å¤©ï¼‰

1. åˆ›å»ºæ•°æ®åº“è¿ç§»è„šæœ¬
2. æ·»åŠ  Task è¡¨æ–°å­—æ®µ
3. åˆ›å»º TaskParticipant è¡¨
4. åˆ›å»º TaskParticipantReward è¡¨
5. åˆ›å»ºå¿…è¦çš„ç´¢å¼•

### é˜¶æ®µäºŒï¼šåŽç«¯APIå¼€å‘ï¼ˆ4-6å¤©ï¼‰

1. å®žçŽ°ç®¡ç†å‘˜åˆ›å»ºå¤šäººä»»åŠ¡APIï¼ˆæ”¯æŒç§¯åˆ†å¥–åŠ±ï¼‰
2. å®žçŽ°ç”¨æˆ·ç”³è¯·å‚ä¸ŽAPIï¼ˆå®˜æ–¹ä»»åŠ¡è‡ªåŠ¨æŽ¥å—ï¼‰
3. å®žçŽ°ä»»åŠ¡èŠå¤©å®¤é›†æˆï¼ˆç”¨æˆ·ç”³è¯·åŽè‡ªåŠ¨åŠ å…¥èŠå¤©å®¤ï¼‰
4. å®žçŽ°å‚ä¸Žè€…é€€å‡ºç”³è¯·API
5. å®žçŽ°ç®¡ç†å‘˜æ‰¹å‡†/æ‹’ç»é€€å‡ºç”³è¯·API
6. å®žçŽ°ç®¡ç†å‘˜å¼€å§‹ä»»åŠ¡API
7. å®žçŽ°å‚ä¸Žè€…å®ŒæˆAPI
8. å®žçŽ°ç®¡ç†å‘˜ç¡®è®¤å®Œæˆå’Œå¥–åŠ±åˆ†é…APIï¼ˆæ”¯æŒç§¯åˆ†å¥–åŠ±ï¼‰
9. å®žçŽ°æŸ¥è¯¢APIï¼ˆå‚ä¸Žè€…åˆ—è¡¨ã€ç”¨æˆ·ä»»åŠ¡åˆ—è¡¨ç­‰ï¼‰
10. å®žçŽ°è®®ä»·éªŒè¯ï¼ˆå¤šäººä»»åŠ¡ç¦æ­¢è®®ä»·ï¼‰

### é˜¶æ®µä¸‰ï¼šå‰ç«¯å¼€å‘ï¼ˆ4-6å¤©ï¼‰

1. å¼€å‘ç®¡ç†å‘˜å‘å¸ƒå¤šäººä»»åŠ¡é¡µé¢ï¼ˆæ”¯æŒç§¯åˆ†å¥–åŠ±è®¾ç½®ï¼‰
2. ä¿®æ”¹ä»»åŠ¡è¯¦æƒ…é¡µé¢æ”¯æŒå¤šäººä»»åŠ¡ï¼ˆæ˜¾ç¤ºå®˜æ–¹æ ‡è¯†ã€å‚ä¸Žäººæ•°ã€ç§¯åˆ†å¥–åŠ±ç­‰ï¼‰
3. å¼€å‘ä»»åŠ¡èŠå¤©å®¤é¡µé¢ï¼ˆé›†æˆçŽ°æœ‰èŠå¤©åŠŸèƒ½ï¼‰
4. å®žçŽ°ç”³è¯·åŽè‡ªåŠ¨è·³è½¬åˆ°èŠå¤©å®¤åŠŸèƒ½
5. å¼€å‘é€€å‡ºç”³è¯·åŠŸèƒ½
6. å¼€å‘ç®¡ç†å‘˜ä»»åŠ¡ç®¡ç†é¡µé¢ï¼ˆé€€å‡ºç”³è¯·å®¡æ ¸ï¼‰
7. å¼€å‘ç”¨æˆ·æˆ‘çš„å¤šäººä»»åŠ¡é¡µé¢
8. æ·»åŠ ç›¸å…³ç¿»è¯‘æ–‡æœ¬
9. æ·»åŠ å®˜æ–¹ä»»åŠ¡æ ‡è¯†UI

### é˜¶æ®µå››ï¼šæµ‹è¯•å’Œä¼˜åŒ–ï¼ˆ2-3å¤©ï¼‰

1. å•å…ƒæµ‹è¯•
2. é›†æˆæµ‹è¯•
3. æ€§èƒ½æµ‹è¯•
4. Bugä¿®å¤
5. ä»£ç ä¼˜åŒ–

### é˜¶æ®µäº”ï¼šæ–‡æ¡£å’Œéƒ¨ç½²ï¼ˆ1å¤©ï¼‰

1. æ›´æ–°APIæ–‡æ¡£
2. æ›´æ–°ç”¨æˆ·æ‰‹å†Œ
3. éƒ¨ç½²åˆ°æµ‹è¯•çŽ¯å¢ƒ
4. éƒ¨ç½²åˆ°ç”Ÿäº§çŽ¯å¢ƒ

---

## ðŸ”„ å‘åŽå…¼å®¹æ€§

### 1. çŽ°æœ‰å•äººä»»åŠ¡

- æ‰€æœ‰çŽ°æœ‰ä»»åŠ¡ä¿æŒ `is_multi_participant=false`
- `max_participants=1` ä¿æŒå•äººä»»åŠ¡é€»è¾‘
- çŽ°æœ‰çš„ `taker_id` å­—æ®µç»§ç»­ä½¿ç”¨ï¼ˆå•äººä»»åŠ¡ï¼‰
- çŽ°æœ‰çš„ä»»åŠ¡æŸ¥è¯¢å’Œæ˜¾ç¤ºé€»è¾‘ä¸å—å½±å“

### 1.1. å¤šäººä»»åŠ¡ä¸Žå•äººä»»åŠ¡çš„å­—æ®µä½¿ç”¨å·®å¼‚

**å•äººä»»åŠ¡ï¼ˆis_multi_participant=falseï¼‰**ï¼š
- `poster_id`ï¼šä»»åŠ¡å‘å¸ƒè€…IDï¼ˆå¿…éœ€ï¼‰
- `taker_id`ï¼šä»»åŠ¡æŽ¥æ”¶è€…IDï¼ˆå¿…éœ€ï¼Œä»»åŠ¡è¢«æŽ¥å—åŽè®¾ç½®ï¼‰
- `task_participants` è¡¨ï¼šä¸ä½¿ç”¨ï¼ˆæˆ–ä»…ç”¨äºŽåŽ†å²è®°å½•ï¼‰

**å¤šäººä»»åŠ¡ï¼ˆis_multi_participant=trueï¼‰**ï¼š
- `poster_id`ï¼šä»»åŠ¡å‘å¸ƒè€…IDï¼ˆæ ¹æ®ä»»åŠ¡ç±»åž‹å†³å®šï¼‰
  - **ä»»åŠ¡è¾¾äººå‘å¸ƒ**ï¼šå¯ä»¥è®¾ç½®ä¸ºç³»ç»Ÿç”¨æˆ·IDæˆ–NULLï¼ˆä»»åŠ¡è¾¾äººä¸æ˜¯ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„å‘å¸ƒè€…ï¼Œè€Œæ˜¯æœåŠ¡æä¾›è€…ï¼‰
  - **ç®¡ç†å‘˜å‘å¸ƒï¼ˆå‘é’±ä»»åŠ¡ï¼‰**ï¼šç³»ç»Ÿç”¨æˆ·IDæˆ–ç®¡ç†å‘˜å…³è”çš„ç”¨æˆ·IDï¼ˆç®¡ç†å‘˜ä½œä¸ºå‘å¸ƒè€…ï¼Œå‘é’±ç»™ç”¨æˆ·ï¼‰
  - **ç®¡ç†å‘˜å‘å¸ƒï¼ˆæ”¶é’±ä»»åŠ¡ï¼‰**ï¼šç³»ç»Ÿç”¨æˆ·IDæˆ–ç®¡ç†å‘˜å…³è”çš„ç”¨æˆ·IDï¼ˆç®¡ç†å‘˜ä½œä¸ºå‘å¸ƒè€…ï¼Œä½†åŒæ—¶ä¹Ÿæ˜¯æŽ¥æ”¶è€…ï¼‰
- `taker_id`ï¼šä»»åŠ¡æŽ¥æ”¶è€…IDï¼ˆæ ¹æ®ä»»åŠ¡ç±»åž‹å†³å®šï¼‰
  - **ä»»åŠ¡è¾¾äººå‘å¸ƒ**ï¼š**å¿…é¡»è®¾ç½®ä¸ºä»»åŠ¡è¾¾äººçš„ç”¨æˆ·ID**ï¼ˆä»»åŠ¡è¾¾äººæä¾›æœåŠ¡ï¼Œæ”¶é’±ï¼‰
  - **ç®¡ç†å‘˜å‘å¸ƒï¼ˆæ”¶é’±ä»»åŠ¡ï¼‰**ï¼š**å¿…é¡»è®¾ç½®ä¸ºç³»ç»Ÿç”¨æˆ·IDæˆ–ç®¡ç†å‘˜å…³è”çš„ç”¨æˆ·ID**ï¼ˆç®¡ç†å‘˜æ”¶é’±ï¼‰
  - **ç®¡ç†å‘˜å‘å¸ƒï¼ˆå‘é’±ä»»åŠ¡ï¼‰**ï¼š**å¿…é¡»ä¸º NULL**ï¼ˆç®¡ç†å‘˜å‘é’±ï¼Œä¸æ˜¯æŽ¥æ”¶è€…ï¼‰
- `task_participants` è¡¨ï¼šå­˜å‚¨æ‰€æœ‰å‚ä¸Žè€…ä¿¡æ¯
  - é€šè¿‡ `task_participants.task_id` å…³è”æŸ¥è¯¢æ‰€æœ‰å‚ä¸Žè€…
  - æ¯ä¸ªå‚ä¸Žè€…ä¸€æ¡è®°å½•ï¼ŒåŒ…å«çŠ¶æ€ã€æ—¶é—´åå¥½ç­‰ä¿¡æ¯
  - **å‚ä¸Žè€…è§’è‰²**ï¼š
    - ä»»åŠ¡è¾¾äººå‘å¸ƒï¼šå‚ä¸Žè€…æ˜¯ä»˜è´¹æ–¹ï¼ˆä»˜é’±ç»™ä»»åŠ¡è¾¾äººï¼‰
    - ç®¡ç†å‘˜å‘å¸ƒï¼ˆæ”¶é’±ï¼‰ï¼šå‚ä¸Žè€…æ˜¯ä»˜è´¹æ–¹ï¼ˆä»˜é’±ç»™å¹³å°ï¼‰
    - ç®¡ç†å‘˜å‘å¸ƒï¼ˆå‘é’±ï¼‰ï¼šå‚ä¸Žè€…æ˜¯å¥–åŠ±æŽ¥æ”¶æ–¹ï¼ˆä»Žå¹³å°èŽ·å¾—å¥–åŠ±ï¼‰

**æŸ¥è¯¢ç¤ºä¾‹**ï¼š
```sql
-- æŸ¥è¯¢å¤šäººä»»åŠ¡çš„æ‰€æœ‰å‚ä¸Žè€…ï¼ˆä»˜è´¹æ–¹æˆ–å¥–åŠ±æŽ¥æ”¶æ–¹ï¼‰
SELECT tp.*, u.name, u.avatar
FROM task_participants tp
JOIN users u ON tp.user_id = u.id
WHERE tp.task_id = 123
  AND tp.status IN ('accepted', 'in_progress', 'completed');

-- æŸ¥è¯¢ä»»åŠ¡è¾¾äººå‘å¸ƒçš„å¤šäººä»»åŠ¡çš„æŽ¥æ”¶è€…ï¼ˆä»»åŠ¡è¾¾äººï¼Œæ”¶é’±æ–¹ï¼‰
SELECT t.*, u.name, u.avatar
FROM tasks t
JOIN users u ON t.taker_id = u.id
WHERE t.id = 123
  AND t.is_multi_participant = true
  AND t.created_by_expert = true;

-- æŸ¥è¯¢ç®¡ç†å‘˜å‘å¸ƒçš„æ”¶é’±ä»»åŠ¡çš„æŽ¥æ”¶è€…ï¼ˆç®¡ç†å‘˜ï¼Œæ”¶é’±æ–¹ï¼‰
SELECT t.*, u.name, u.avatar
FROM tasks t
JOIN users u ON t.taker_id = u.id
WHERE t.id = 124
  AND t.is_multi_participant = true
  AND t.created_by_admin = true
  AND t.taker_id IS NOT NULL;  -- æ”¶é’±ä»»åŠ¡ï¼Œtaker_idä¸ä¸ºNULL

-- æŸ¥è¯¢å•äººä»»åŠ¡çš„æŽ¥æ”¶è€…ï¼ˆä½¿ç”¨taker_idï¼‰
SELECT t.*, u.name, u.avatar
FROM tasks t
JOIN users u ON t.taker_id = u.id
WHERE t.id = 456
  AND t.is_multi_participant = false;
```

**æ•°æ®ä¸€è‡´æ€§è§„åˆ™**ï¼š
1. **å¤šäººä»»åŠ¡**ï¼š`is_multi_participant=true` æ—¶
   - **ä»»åŠ¡è¾¾äººå‘å¸ƒ**ï¼š`taker_id` å¿…é¡»è®¾ç½®ä¸ºä»»åŠ¡è¾¾äººçš„ç”¨æˆ·IDï¼ˆ`expert_creator_id`ï¼‰
   - **ç®¡ç†å‘˜å‘å¸ƒï¼ˆæ”¶é’±ä»»åŠ¡ï¼‰**ï¼š`taker_id` å¿…é¡»è®¾ç½®ä¸ºç³»ç»Ÿç”¨æˆ·IDæˆ–ç®¡ç†å‘˜å…³è”çš„ç”¨æˆ·ID
   - **ç®¡ç†å‘˜å‘å¸ƒï¼ˆå‘é’±ä»»åŠ¡ï¼‰**ï¼š`taker_id` å¿…é¡»ä¸º NULLï¼ˆç®¡ç†å‘˜å‘é’±ï¼Œä¸æ˜¯æŽ¥æ”¶è€…ï¼‰
   - å‚ä¸Žè€…ä¿¡æ¯å¿…é¡»å­˜å‚¨åœ¨ `task_participants` è¡¨ä¸­
   - æŸ¥è¯¢å‚ä¸Žè€…æ—¶ï¼Œå¿…é¡»ä»Ž `task_participants` è¡¨æŸ¥è¯¢
   - æŸ¥è¯¢æŽ¥æ”¶è€…æ—¶ï¼Œä½¿ç”¨ `taker_id` å­—æ®µï¼ˆå¦‚æžœè®¾ç½®äº†ï¼‰
2. **å•äººä»»åŠ¡**ï¼š`is_multi_participant=false` æ—¶
   - `taker_id` åœ¨ä»»åŠ¡è¢«æŽ¥å—åŽå¿…é¡»è®¾ç½®ï¼ˆä¸ä¸º NULLï¼‰
   - `task_participants` è¡¨ä¸ä½¿ç”¨ï¼ˆæˆ–ä»…ç”¨äºŽåŽ†å²è®°å½•ï¼‰
   - æŸ¥è¯¢æŽ¥æ”¶è€…æ—¶ï¼Œä½¿ç”¨ `taker_id` å­—æ®µ
3. **æ•°æ®éªŒè¯**ï¼šåº”ç”¨å±‚åº”éªŒè¯
   - å¦‚æžœ `is_multi_participant=true` ä¸” `created_by_expert=true`ï¼Œåˆ™ `taker_id` å¿…é¡»ç­‰äºŽ `expert_creator_id`
   - å¦‚æžœ `is_multi_participant=true` ä¸” `created_by_admin=true`ï¼Œæ ¹æ®ä»»åŠ¡ç±»åž‹ï¼ˆæ”¶é’±/å‘é’±ï¼‰éªŒè¯ `taker_id`
   - å¦‚æžœ `is_multi_participant=false`ï¼Œåˆ™ `taker_id` åœ¨ä»»åŠ¡è¢«æŽ¥å—åŽä¸åº”ä¸º NULL

### 2. APIå…¼å®¹æ€§

- çŽ°æœ‰çš„ä»»åŠ¡åˆ›å»ºAPIç»§ç»­æ”¯æŒå•äººä»»åŠ¡
- æ–°å¢žçš„å¤šäººä»»åŠ¡APIä¸å½±å“çŽ°æœ‰API
- ä»»åŠ¡åˆ—è¡¨APIéœ€è¦å…¼å®¹ä¸¤ç§ç±»åž‹çš„ä»»åŠ¡

### 3. å‰ç«¯å…¼å®¹æ€§

- çŽ°æœ‰çš„ä»»åŠ¡å¡ç‰‡å’Œè¯¦æƒ…é¡µé¢éœ€è¦å…¼å®¹æ˜¾ç¤ºä¸¤ç§ç±»åž‹
- æ·»åŠ å¤šäººä»»åŠ¡æ ‡è¯†å’Œå‚ä¸Žäººæ•°æ˜¾ç¤º
- ä¿æŒçŽ°æœ‰UI/UXçš„ä¸€è‡´æ€§

---

## ðŸŒ å›½é™…åŒ–ä¸Žå¯è®¿é—®æ€§

### 1. å›½é™…åŒ–ï¼ˆi18nï¼‰

- æ‰€æœ‰ç”¨æˆ·å¯è§æ–‡æœ¬éœ€è¦æ”¯æŒå¤šè¯­è¨€ï¼ˆè‹±è¯­ã€ä¸­æ–‡ç­‰ï¼‰
- API é”™è¯¯æ¶ˆæ¯éœ€è¦æœ¬åœ°åŒ–
- æ—¥æœŸæ—¶é—´æ ¼å¼æ ¹æ®ç”¨æˆ·æ—¶åŒºæ˜¾ç¤º
- è´§å¸æ ¼å¼æ ¹æ®ç”¨æˆ·åœ°åŒºæ˜¾ç¤º

### 2. å¯è®¿é—®æ€§ï¼ˆA11yï¼‰

- **å±å¹•é˜…è¯»å™¨æ”¯æŒ**ï¼š
  - æ‰€æœ‰äº¤äº’å…ƒç´ æ·»åŠ  `aria-label` æˆ– `aria-labelledby`
  - è¡¨å•å­—æ®µæ·»åŠ  `aria-describedby` å…³è”å¸®åŠ©æ–‡æœ¬
  - çŠ¶æ€å˜æ›´ä½¿ç”¨ `aria-live` åŒºåŸŸé€šçŸ¥
- **é”®ç›˜å¯¼èˆª**ï¼š
  - æ‰€æœ‰åŠŸèƒ½å¯é€šè¿‡é”®ç›˜è®¿é—®ï¼ˆTabã€Enterã€Escç­‰ï¼‰
  - ç„¦ç‚¹é¡ºåºç¬¦åˆé€»è¾‘æµç¨‹
  - ç„¦ç‚¹å¯è§æ€§ï¼ˆæ¸…æ™°çš„ç„¦ç‚¹æŒ‡ç¤ºå™¨ï¼‰
- **è§†è§‰è¾…åŠ©**ï¼š
  - é¢œè‰²å¯¹æ¯”åº¦ç¬¦åˆ WCAG AA æ ‡å‡†
  - ä¸ä¾èµ–é¢œè‰²ä¼ è¾¾ä¿¡æ¯ï¼ˆä½¿ç”¨å›¾æ ‡+æ–‡å­—ï¼‰
  - æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰å­—ä½“å¤§å°
- **å“åº”å¼è®¾è®¡**ï¼š
  - æ”¯æŒç§»åŠ¨ç«¯ã€å¹³æ¿ã€æ¡Œé¢ç«¯
  - è§¦æ‘¸ç›®æ ‡å¤§å°ç¬¦åˆæœ€å°44x44pxæ ‡å‡†

## ðŸ“Š è§‚æµ‹æ€§ä¸Žè¿ç»´

### 1. å…³é”®æŒ‡æ ‡ï¼ˆSLI/SLOï¼‰

- **ç”³è¯·æˆåŠŸçŽ‡**ï¼šç›®æ ‡ > 99%ï¼ˆæŽ’é™¤ç”¨æˆ·ä¸»åŠ¨å–æ¶ˆï¼‰
- **å¹¶å‘ç”³è¯·å¤„ç†**ï¼šç›®æ ‡ < 100ms P95 å“åº”æ—¶é—´
  - **ç»†åˆ†æŒ‡æ ‡**ï¼š
    - æ•°æ®åº“äº‹åŠ¡è€—æ—¶ï¼šç›®æ ‡ < 50ms P95
    - é”ç­‰å¾…æ—¶é—´ï¼šç›®æ ‡ < 30ms P95ï¼ˆç”¨äºŽå®šä½çƒ­ç‚¹ä»»åŠ¡è¶…å–ç«žäº‰ï¼‰
    - ä¸šåŠ¡é€»è¾‘å¤„ç†æ—¶é—´ï¼šç›®æ ‡ < 20ms P95
- **å¥–åŠ±åˆ†é…æˆåŠŸçŽ‡**ï¼šç›®æ ‡ > 99.9%
- **WebSocket è¿žæŽ¥ç¨³å®šæ€§**ï¼šç›®æ ‡ > 99.5% åœ¨çº¿çŽ‡
- **æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½**ï¼šç›®æ ‡ < 50ms P95 æŸ¥è¯¢æ—¶é—´

### 2. ç›‘æŽ§æŒ‡æ ‡

- **ä¸šåŠ¡æŒ‡æ ‡**ï¼š
  - ä»»åŠ¡åˆ›å»ºæ•°é‡ï¼ˆæŒ‰ç±»åž‹ã€ç®¡ç†å‘˜ï¼‰
  - ç”³è¯·å‚ä¸Žæ•°é‡ï¼ˆæŒ‰ä»»åŠ¡ã€ç”¨æˆ·ï¼‰
  - ç”³è¯·å¤±è´¥çŽ‡ï¼ˆåŽŸå› åˆ†ç±»ï¼šäººæ•°å·²æ»¡ã€é‡å¤ç”³è¯·ã€æƒé™ä¸è¶³ç­‰ï¼‰
  - é€€å‡ºç”³è¯·æ•°é‡ï¼ˆæ‰¹å‡†çŽ‡ã€æ‹’ç»çŽ‡ï¼‰
  - ä»»åŠ¡å®ŒæˆçŽ‡ï¼ˆæŒ‰å®Œæˆè§„åˆ™åˆ†ç±»ï¼‰
  - å¥–åŠ±åˆ†é…æ•°é‡ï¼ˆæŒ‰ç±»åž‹ï¼šçŽ°é‡‘ã€ç§¯åˆ†ï¼‰
- **æŠ€æœ¯æŒ‡æ ‡**ï¼š
  - API å“åº”æ—¶é—´ï¼ˆP50ã€P95ã€P99ï¼‰
  - æ•°æ®åº“æŸ¥è¯¢æ—¶é—´
  - WebSocket è¿žæŽ¥æ•°ã€æ¶ˆæ¯å‘é€é€ŸçŽ‡
  - é”™è¯¯çŽ‡ï¼ˆ4xxã€5xxï¼‰
  - å¹¶å‘è¯·æ±‚æ•°

### 3. æ—¥å¿—ç­–ç•¥

- **ç»“æž„åŒ–æ—¥å¿—**ï¼šä½¿ç”¨ JSON æ ¼å¼ï¼ŒåŒ…å«ï¼š
  - è¯·æ±‚IDï¼ˆç”¨äºŽè¿½è¸ªï¼‰
  - ç”¨æˆ·ID/ç®¡ç†å‘˜ID
  - æ“ä½œç±»åž‹
  - æ—¶é—´æˆ³
  - é”™è¯¯å †æ ˆï¼ˆå¦‚æœ‰ï¼‰
- **æ—¥å¿—çº§åˆ«**ï¼š
  - ERRORï¼šç³»ç»Ÿé”™è¯¯ã€æ”¯ä»˜å¤±è´¥ç­‰
  - WARNï¼šå¹¶å‘å†²çªã€æ•°æ®ä¸ä¸€è‡´ç­‰
  - INFOï¼šå…³é”®ä¸šåŠ¡æ“ä½œï¼ˆç”³è¯·ã€å®Œæˆã€åˆ†é…å¥–åŠ±ç­‰ï¼‰
  - DEBUGï¼šè¯¦ç»†è°ƒè¯•ä¿¡æ¯ï¼ˆå¼€å‘çŽ¯å¢ƒï¼‰
- **æ—¥å¿—ä¿ç•™**ï¼š
  - å®¡è®¡æ—¥å¿—ï¼šæ°¸ä¹…ä¿ç•™
  - ä¸šåŠ¡æ—¥å¿—ï¼šä¿ç•™90å¤©
  - è°ƒè¯•æ—¥å¿—ï¼šä¿ç•™7å¤©

### 4. å‘Šè­¦è§„åˆ™

- **ç´§æ€¥å‘Šè­¦**ï¼ˆç«‹å³é€šçŸ¥ï¼‰ï¼š
  - å¥–åŠ±åˆ†é…å¤±è´¥çŽ‡ > 1%
  - æ•°æ®åº“è¿žæŽ¥å¤±è´¥
  - æ”¯ä»˜ç½‘å…³å¼‚å¸¸
- **é‡è¦å‘Šè­¦**ï¼ˆ1å°æ—¶å†…é€šçŸ¥ï¼‰ï¼š
  - ç”³è¯·å¤±è´¥çŽ‡ > 5%
  - API å“åº”æ—¶é—´ P95 > 1s
  - WebSocket è¿žæŽ¥æ•°å¼‚å¸¸ä¸‹é™
- **ä¸€èˆ¬å‘Šè­¦**ï¼ˆ24å°æ—¶å†…é€šçŸ¥ï¼‰ï¼š
  - ä»»åŠ¡åˆ›å»ºæ•°é‡å¼‚å¸¸
  - æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½ä¸‹é™

### 5. ç°åº¦å‘å¸ƒä¸Žå›žæ»š

- **ç°åº¦ç­–ç•¥**ï¼š
  - æ–°åŠŸèƒ½å…ˆå¯¹10%ç”¨æˆ·å¼€æ”¾
  - ç›‘æŽ§å…³é”®æŒ‡æ ‡ï¼Œæ— å¼‚å¸¸åŽé€æ­¥æ‰©å¤§
  - æ”¯æŒåŠŸèƒ½å¼€å…³ï¼ˆFeature Flagï¼‰
- **å›žæ»šé¢„æ¡ˆ**ï¼š
  - æ•°æ®åº“è¿ç§»å›žæ»šè„šæœ¬
  - API ç‰ˆæœ¬å…¼å®¹ï¼ˆæ”¯æŒæ—§ç‰ˆæœ¬å®¢æˆ·ç«¯ï¼‰
  - å¿«é€Ÿå›žæ»šæµç¨‹ï¼ˆ5åˆ†é’Ÿå†…å®Œæˆï¼‰

## ðŸš€ æœªæ¥æ‰©å±•

### 1. ä»»åŠ¡è¾¾äººå‘å¸ƒå¤šäººä»»åŠ¡

- **åŠŸèƒ½æ¦‚è¿°**ï¼šå…è®¸ä»»åŠ¡è¾¾äººï¼ˆå…·æœ‰ç‰¹å®šæœåŠ¡æŠ€èƒ½çš„ç”¨æˆ·ï¼‰åˆ›å»ºå¤šäººä»»åŠ¡
- **æƒé™è¦æ±‚**ï¼šç”¨æˆ·éœ€è¦è¢«æ ‡è®°ä¸º"ä»»åŠ¡è¾¾äºº"ï¼ˆexpertï¼‰ï¼Œå…·æœ‰ç‰¹å®šæœåŠ¡æŠ€èƒ½è®¤è¯
- **ä¸Žç®¡ç†å‘˜ä»»åŠ¡çš„åŒºåˆ«**ï¼š
  - ä»»åŠ¡è¾¾äººå‘å¸ƒçš„ä»»åŠ¡ä¸æ˜¯"å®˜æ–¹ä»»åŠ¡"ï¼ˆ`is_official_task=false`ï¼‰
  - ä»»åŠ¡è¾¾äººå‘å¸ƒçš„ä»»åŠ¡å¯èƒ½éœ€è¦å®¡æ ¸ï¼ˆ`auto_accept=false`ï¼Œæˆ–æ ¹æ®å¹³å°ç­–ç•¥è®¾ç½®ï¼‰
  - ä»»åŠ¡è¾¾äººå¯ä»¥è®¾ç½®å›ºå®šæ—¶é—´æ®µå›ºå®šäººæ•°çš„æœåŠ¡

### 2. ä»»åŠ¡è¾¾äººå›ºå®šæ—¶é—´æ®µå›ºå®šäººæ•°æœåŠ¡

- **åŠŸèƒ½æ¦‚è¿°**ï¼šä»»åŠ¡è¾¾äººå¯ä»¥ä¸ºç‰¹å®šæœåŠ¡è®¾ç½®å›ºå®šæ—¶é—´æ®µå’Œæ¯ä¸ªæ—¶é—´æ®µçš„äººæ•°é™åˆ¶
- **åº”ç”¨åœºæ™¯**ï¼š
  - **å›ºå®šæ—¶é—´æ®µæœåŠ¡ç¤ºä¾‹**ï¼šéº»å°†è¾¾äººå¯ä»¥è®¾ç½®ä¸€ä¸ªæ—¶é—´æ®µä¸º1å°æ—¶ï¼Œä»Žä¸­åˆ12:00åˆ°æ™šä¸Š22:00ï¼Œæ¯ä¸ªæ—¶é—´æ®µ4äºº
    - æ¯ä¸ªæ—¶é—´æ®µç‹¬ç«‹ï¼Œç”¨æˆ·éœ€è¦é€‰æ‹©å…·ä½“çš„æ—¶é—´æ®µè¿›è¡Œç”³è¯·
    - æ¯ä¸ªæ—¶é—´æ®µæœ€å¤šå…è®¸æŒ‡å®šäººæ•°ç”³è¯·ï¼ˆå¦‚éº»å°†éœ€è¦4äººï¼‰
  - **éžå›ºå®šæ—¶é—´æ®µæœåŠ¡ç¤ºä¾‹**ï¼šæ‘„å½±è¾¾äººå¯ä»¥å‘å¸ƒæ‘„å½±æœåŠ¡ï¼Œä¸è®¾ç½®å›ºå®šæ—¶é—´æ®µ
    - ç”³è¯·äººå¯ä»¥é€‰æ‹©æœŸæœ›çš„æˆªæ­¢æ—¥æœŸï¼ˆå¦‚ï¼šå¸Œæœ›åœ¨2æœˆ15æ—¥å‰å®Œæˆï¼‰
    - æˆ–è€…é€‰æ‹©çµæ´»æ—¶é—´ï¼ˆæ—¶é—´çµæ´»ï¼Œå¯ä¸Žä»»åŠ¡è¾¾äººåå•†ï¼‰
    - ä»»åŠ¡è¾¾äººå¯ä»¥æ ¹æ®ç”³è¯·äººçš„æ—¶é—´åå¥½è¿›è¡Œå®¡æ ¸å’Œå®‰æŽ’
  - **æŠ˜æ‰£åº”ç”¨åœºæ™¯**ï¼š
    - ç‰¹å®šæ—¶é—´æ®µç¼ºäººæ—¶ï¼Œå¯ä»¥è®¾ç½®æŠ˜æ‰£å¸å¼•ç”¨æˆ·ï¼ˆå¦‚ï¼š1ç‚¹åˆ°2ç‚¹æ—¶é—´æ®µç¼ºäººï¼ŒåŽŸä»·10é•‘ï¼ŒçŽ°ä»·8é•‘ï¼Œæ‰“8æŠ˜ï¼‰
    - æŽ¨å¹¿æ–°æœåŠ¡æ—¶ï¼Œå¯ä»¥è®¾ç½®æŠ˜æ‰£å¸å¼•ç”¨æˆ·å°è¯•
    - æ·¡å­£æˆ–éžçƒ­é—¨æ—¶é—´æ®µï¼Œå¯ä»¥è®¾ç½®æŠ˜æ‰£æé«˜ä¸Šåº§çŽ‡
- **æ•°æ®åº“å­—æ®µ**ï¼š
  - `is_fixed_time_slot`: æ ‡è¯†æ˜¯å¦ä¸ºå›ºå®šæ—¶é—´æ®µæœåŠ¡
  - `time_slot_duration_minutes`: æ—¶é—´æ®µæ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰ï¼Œå¦‚60è¡¨ç¤º1å°æ—¶
  - `time_slot_start_time`: æ—¶é—´æ®µå¼€å§‹æ—¶é—´ï¼ˆTIMEç±»åž‹ï¼‰ï¼Œå¦‚12:00
  - `time_slot_end_time`: æ—¶é—´æ®µç»“æŸæ—¶é—´ï¼ˆTIMEç±»åž‹ï¼‰ï¼Œå¦‚22:00
  - `participants_per_slot`: æ¯ä¸ªæ—¶é—´æ®µçš„äººæ•°é™åˆ¶ï¼Œå¦‚4äºº
  - `original_price_per_participant`: åŽŸä»·ï¼ˆæ¯äººï¼‰ï¼Œå¦‚10é•‘
  - `discount_percentage`: æŠ˜æ‰£ç™¾åˆ†æ¯”ï¼ˆ0-100ï¼‰ï¼Œå¦‚20è¡¨ç¤ºæ‰“8æŠ˜
  - `discounted_price_per_participant`: æŠ˜æ‰£åŽä»·æ ¼ï¼ˆæ¯äººï¼‰ï¼Œå¦‚8é•‘
- **ä¸šåŠ¡é€»è¾‘**ï¼š
  - ç³»ç»Ÿæ ¹æ® `time_slot_start_time`ã€`time_slot_end_time` å’Œ `time_slot_duration_minutes` è‡ªåŠ¨ç”Ÿæˆæ‰€æœ‰å¯ç”¨æ—¶é—´æ®µ
  - ä¾‹å¦‚ï¼š12:00-22:00ï¼Œæ¯60åˆ†é’Ÿä¸€ä¸ªæ—¶é—´æ®µï¼Œä¼šç”Ÿæˆ10ä¸ªæ—¶é—´æ®µï¼ˆ12:00-13:00, 13:00-14:00, ..., 21:00-22:00ï¼‰
  - ç”¨æˆ·ç”³è¯·æ—¶ï¼Œéœ€è¦é€‰æ‹©å…·ä½“çš„æ—¶é—´æ®µ
  - æ¯ä¸ªæ—¶é—´æ®µç‹¬ç«‹è®¡ç®—å‚ä¸Žäººæ•°ï¼Œè¾¾åˆ° `participants_per_slot` åŽåœæ­¢æŽ¥å—è¯¥æ—¶é—´æ®µçš„ç”³è¯·
  - ä¸åŒæ—¶é—´æ®µä¹‹é—´äº’ä¸å½±å“ï¼Œå¯ä»¥åŒæ—¶è¿›è¡Œå¤šä¸ªæ—¶é—´æ®µçš„ç”³è¯·
- **å‰ç«¯å±•ç¤º**ï¼š
  - **å›ºå®šæ—¶é—´æ®µæœåŠ¡**ï¼š
    - æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨æ—¶é—´æ®µåˆ—è¡¨
    - æ¯ä¸ªæ—¶é—´æ®µæ˜¾ç¤ºå½“å‰ç”³è¯·äººæ•°/æœ€å¤§äººæ•°ï¼ˆå¦‚ï¼š2/4ï¼‰
    - å·²æ»¡çš„æ—¶é—´æ®µæ˜¾ç¤º"å·²æ»¡"æ ‡è¯†ï¼Œç¦æ­¢ç”³è¯·
    - ç”¨æˆ·å¯ä»¥é€‰æ‹©ä¸€ä¸ªæ—¶é—´æ®µè¿›è¡Œç”³è¯·
  - **éžå›ºå®šæ—¶é—´æ®µæœåŠ¡**ï¼š
    - æ˜¾ç¤ºæ—¶é—´é€‰æ‹©è¡¨å•
    - å•é€‰æŒ‰é’®æˆ–å¼€å…³ï¼šé€‰æ‹©"çµæ´»æ—¶é—´"æˆ–"æŒ‡å®šæˆªæ­¢æ—¥æœŸ"
    - å¦‚æžœé€‰æ‹©"æŒ‡å®šæˆªæ­¢æ—¥æœŸ"ï¼šæ˜¾ç¤ºæ—¥æœŸæ—¶é—´é€‰æ‹©å™¨
    - å¦‚æžœé€‰æ‹©"çµæ´»æ—¶é—´"ï¼šæ˜¾ç¤ºæç¤ºä¿¡æ¯
  - **æŠ˜æ‰£ä¿¡æ¯å±•ç¤º**ï¼ˆå¦‚æžœä»»åŠ¡è®¾ç½®äº†æŠ˜æ‰£ï¼‰ï¼š
    - åœ¨ä»»åŠ¡è¯¦æƒ…é¡µé¢é¡¶éƒ¨æˆ–å¥–åŠ±ä¿¡æ¯åŒºåŸŸæ˜¾ç¤ºæŠ˜æ‰£ä¿¡æ¯
    - æ˜¾ç¤ºåŽŸä»·ï¼ˆå¸¦åˆ é™¤çº¿ï¼‰å’ŒçŽ°ä»·ï¼ˆçªå‡ºæ˜¾ç¤ºï¼‰
    - æ˜¾ç¤ºæŠ˜æ‰£ç™¾åˆ†æ¯”æˆ–èŠ‚çœé‡‘é¢
    - ä½¿ç”¨é†’ç›®çš„è§†è§‰æ ·å¼ï¼ˆå¦‚çº¢è‰²ã€æ©™è‰²æ ‡ç­¾ï¼‰å¸å¼•ç”¨æˆ·æ³¨æ„
- **APIè®¾è®¡**ï¼š
  - åˆ›å»ºä»»åŠ¡æ—¶ï¼Œå¦‚æžœ `is_fixed_time_slot=true`ï¼Œå¿…é¡»æä¾›æ—¶é—´æ®µç›¸å…³å­—æ®µ
  - ç”³è¯·å‚ä¸Žæ—¶ï¼Œéœ€è¦æŒ‡å®š `time_slot` å‚æ•°ï¼ˆæ—¶é—´æ®µæ ‡è¯†æˆ–æ—¶é—´èŒƒå›´ï¼‰
  - æŸ¥è¯¢ä»»åŠ¡è¯¦æƒ…æ—¶ï¼Œè¿”å›žæ‰€æœ‰æ—¶é—´æ®µåŠå…¶å½“å‰ç”³è¯·äººæ•°
- **æ•°æ®éªŒè¯**ï¼š
  - `time_slot_duration_minutes` å¿…é¡» > 0
  - `time_slot_end_time` å¿…é¡» > `time_slot_start_time`
  - `participants_per_slot` å¿…é¡» >= 1 ä¸” <= `max_participants`
  - æ—¶é—´æ®µæ€»æ•° = (ç»“æŸæ—¶é—´ - å¼€å§‹æ—¶é—´) / æ—¶é—´æ®µæ—¶é•¿ï¼Œå¿…é¡»ä¸ºæ•´æ•°
  - **æŠ˜æ‰£éªŒè¯**ï¼ˆå¦‚æžœè®¾ç½®äº†æŠ˜æ‰£ï¼‰ï¼š
    - `original_price_per_participant` å¿…é¡» > 0
    - `discount_percentage` å¿…é¡»åœ¨ 0-100 ä¹‹é—´
    - `discounted_price_per_participant` å¿…é¡» > 0 ä¸” <= `original_price_per_participant`
    - `discounted_price_per_participant` å¿…é¡»ç­‰äºŽ `original_price_per_participant * (1 - discount_percentage / 100)`ï¼ˆå…è®¸æµ®ç‚¹æ•°ç²¾åº¦è¯¯å·®ï¼‰
    - ä»»åŠ¡çš„ `reward` å­—æ®µåº”ç­‰äºŽ `discounted_price_per_participant`ï¼ˆæˆ–æ ¹æ®å¥–åŠ±åˆ†é…æ–¹å¼è®¡ç®—æ€»å¥–åŠ±ï¼‰

### 3. æ™®é€šç”¨æˆ·å‘å¸ƒå¤šäººä»»åŠ¡

- å…è®¸æ™®é€šç”¨æˆ·åˆ›å»ºå¤šäººä»»åŠ¡ï¼ˆéœ€è¦æƒé™éªŒè¯ï¼‰
- æ·»åŠ å‘å¸ƒè´¹ç”¨æœºåˆ¶

### 4. ä»»åŠ¡åˆ†ç»„å’Œå­ä»»åŠ¡

- æ”¯æŒå°†å¤§åž‹ä»»åŠ¡åˆ†è§£ä¸ºå­ä»»åŠ¡
- æ”¯æŒä»»åŠ¡åˆ†ç»„ç®¡ç†

### 5. å‚ä¸Žè€…è¯„ä»·ç³»ç»Ÿ

- å‚ä¸Žè€…ä¹‹é—´å¯ä»¥äº’ç›¸è¯„ä»·
- ç®¡ç†å‘˜å¯ä»¥è¯„ä»·å‚ä¸Žè€…

### 6. åŠ¨æ€å¥–åŠ±åˆ†é…

- æ ¹æ®å‚ä¸Žè€…è´¡çŒ®åº¦è‡ªåŠ¨åˆ†é…å¥–åŠ±
- æ”¯æŒæŒ‰å®Œæˆè´¨é‡åˆ†é…å¥–åŠ±

### 7. ä»»åŠ¡åä½œå·¥å…·

- ä»»åŠ¡å†…èŠå¤©åŠŸèƒ½ï¼ˆå·²æœ‰åŸºç¡€ï¼‰
- æ–‡ä»¶å…±äº«åŠŸèƒ½
- è¿›åº¦è·Ÿè¸ªåŠŸèƒ½

---

## ðŸ“š ç›¸å…³æ–‡æ¡£

- [ä»»åŠ¡èŠå¤©åŠŸèƒ½å¼€å‘æ–‡æ¡£](./TASK_CHAT_DEVELOPMENT.md)
- [ä¼˜æƒ åˆ¸å’Œç§¯åˆ†ç³»ç»Ÿå¼€å‘æ—¥å¿—](./COUPON_POINTS_SYSTEM_DEVELOPMENT.md)
- [APIæ–‡æ¡£](./API_DOCUMENTATION.md)

---

## âœ… æ£€æŸ¥æ¸…å•

### æ•°æ®åº“
- [ ] Task è¡¨æ·»åŠ å¤šäººä»»åŠ¡å­—æ®µ
- [ ] åˆ›å»º TaskParticipant è¡¨
- [ ] åˆ›å»º TaskParticipantReward è¡¨
- [ ] åˆ›å»ºå¿…è¦çš„ç´¢å¼•
- [ ] æ•°æ®åº“è¿ç§»è„šæœ¬æµ‹è¯•

### åŽç«¯API
- [ ] ç®¡ç†å‘˜åˆ›å»ºå¤šäººä»»åŠ¡APIï¼ˆæ”¯æŒç§¯åˆ†å¥–åŠ±ï¼‰
- [ ] ç”¨æˆ·ç”³è¯·å‚ä¸ŽAPIï¼ˆå®˜æ–¹ä»»åŠ¡è‡ªåŠ¨æŽ¥å—ï¼‰
- [ ] ä»»åŠ¡èŠå¤©å®¤é›†æˆï¼ˆç”³è¯·åŽè‡ªåŠ¨åŠ å…¥ï¼‰
- [ ] å‚ä¸Žè€…é€€å‡ºç”³è¯·API
- [ ] ç®¡ç†å‘˜æ‰¹å‡†/æ‹’ç»é€€å‡ºç”³è¯·API
- [ ] ç®¡ç†å‘˜å¼€å§‹ä»»åŠ¡API
- [ ] å‚ä¸Žè€…å®ŒæˆAPI
- [ ] ç®¡ç†å‘˜ç¡®è®¤å®Œæˆå’Œå¥–åŠ±åˆ†é…APIï¼ˆæ”¯æŒç§¯åˆ†å¥–åŠ±ï¼‰
- [ ] æŸ¥è¯¢APIï¼ˆå‚ä¸Žè€…åˆ—è¡¨ã€ç”¨æˆ·ä»»åŠ¡åˆ—è¡¨ï¼‰
- [ ] è®®ä»·éªŒè¯ï¼ˆå¤šäººä»»åŠ¡ç¦æ­¢è®®ä»·ï¼‰
- [ ] æƒé™éªŒè¯
- [ ] æ•°æ®éªŒè¯
- [ ] é”™è¯¯å¤„ç†

### å‰ç«¯
- [ ] ç®¡ç†å‘˜å‘å¸ƒå¤šäººä»»åŠ¡é¡µé¢ï¼ˆæ”¯æŒç§¯åˆ†å¥–åŠ±è®¾ç½®ï¼‰
- [ ] ä»»åŠ¡è¯¦æƒ…é¡µé¢æ”¯æŒå¤šäººä»»åŠ¡ï¼ˆå®˜æ–¹æ ‡è¯†ã€å‚ä¸Žäººæ•°ã€ç§¯åˆ†å¥–åŠ±ç­‰ï¼‰
- [ ] ä»»åŠ¡èŠå¤©å®¤é¡µé¢ï¼ˆé›†æˆèŠå¤©åŠŸèƒ½ï¼‰
- [ ] ç”³è¯·åŽè‡ªåŠ¨è·³è½¬åˆ°èŠå¤©å®¤
- [ ] é€€å‡ºç”³è¯·åŠŸèƒ½
- [ ] ç®¡ç†å‘˜ä»»åŠ¡ç®¡ç†é¡µé¢ï¼ˆé€€å‡ºç”³è¯·å®¡æ ¸ï¼‰
- [ ] ç”¨æˆ·æˆ‘çš„å¤šäººä»»åŠ¡é¡µé¢
- [ ] ç¿»è¯‘æ–‡æœ¬
- [ ] UI/UXä¼˜åŒ–
- [ ] å®˜æ–¹ä»»åŠ¡æ ‡è¯†æ˜¾ç¤º

### æµ‹è¯•
- [ ] å•å…ƒæµ‹è¯•
- [ ] é›†æˆæµ‹è¯•
- [ ] è¾¹ç•Œæµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•

### æ–‡æ¡£
- [ ] APIæ–‡æ¡£æ›´æ–°
- [ ] ç”¨æˆ·æ‰‹å†Œæ›´æ–°
- [ ] å¼€å‘æ–‡æ¡£æ›´æ–°

---

**æœ€åŽæ›´æ–°**: 2025-01-20  
**æ–‡æ¡£ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ  
**ç‰ˆæœ¬**: v1.5

## ðŸ“ ç‰ˆæœ¬å˜æ›´æ—¥å¿—

### v1.5 (2025-01-20)

**å…³é”®ä¿®å¤ï¼ˆå½»åº•æ¸…ç†é‡å¤ç‰ˆæœ¬ï¼‰**ï¼š
1. âœ… ç¡®è®¤ TaskParticipant è¡¨ DDL åªæœ‰ä¸€å¥—ç‰ˆæœ¬ï¼ˆä½¿ç”¨ `planned_reward_amount` / `planned_points_reward`ï¼‰
2. âœ… ç¡®è®¤ TaskParticipantReward è¡¨ DDL åªæœ‰ä¸€å¥—ç‰ˆæœ¬ï¼ˆåŒ…å«å®Œæ•´çº¦æŸå’Œè§¦å‘å™¨ï¼‰
3. âœ… ç¡®è®¤ TaskAuditLog è¡¨åªæœ‰ä¸€å¥—è¯­ä¹‰ï¼ˆå…è®¸ä»£ç†åœºæ™¯åŒæ—¶è®°å½• user_id + admin_idï¼‰
4. âœ… ç¡®è®¤ /complete æŽ¥å£åªæœ‰ MVP å’Œæœªæ¥æ‰©å±•ä¸¤ä¸ªç‰ˆæœ¬
5. âœ… ç¡®è®¤ Task è¡¨çš„ CHECK çº¦æŸåªæœ‰ä¸¥æ ¼ç‰ˆæœ¬ï¼ˆ`reward > 0` å’Œ `points_reward > 0`ï¼‰

**æ•°æ®åº“çº¦æŸå¢žå¼º**ï¼š
1. âœ… æ·»åŠ  `chk_reward_positive_amount` çº¦æŸï¼ˆä¸å…è®¸ 0 é‡‘é¢è®°å½•ï¼‰
2. âœ… æ·»åŠ  `chk_mvp_official_multi_points_equal` çº¦æŸï¼ˆMVP é™åˆ¶ï¼šå®˜æ–¹å¤šäººä»»åŠ¡å¿…é¡»ä½¿ç”¨ç§¯åˆ†+å¹³å‡åˆ†é…ï¼‰
3. âœ… æ˜Žç¡®å¥–åŠ±é‡‘é¢å­—æ®µè¯´æ˜Žï¼ˆä¸å…è®¸ä¸º 0ï¼Œå¿…é¡»ä¸º NULL æˆ– > 0ï¼‰

**ä¸šåŠ¡é€»è¾‘ä¼˜åŒ–**ï¼š
1. âœ… åœ¨ /complete æŽ¥å£æ·»åŠ å¹¶å‘æŽ§åˆ¶è¯´æ˜Žï¼ˆä½¿ç”¨ `SELECT ... FOR UPDATE` é”å®šï¼‰
2. âœ… åœ¨å‰ç«¯ä»»åŠ¡è¯¦æƒ…é¡µé¢æ·»åŠ å¥–åŠ±çŠ¶æ€æ˜¾ç¤ºè§„èŒƒï¼ˆåŒºåˆ†ä»»åŠ¡çŠ¶æ€å’Œå¥–åŠ±çŠ¶æ€ï¼‰
3. âœ… åœ¨è§¦å‘å™¨ç« èŠ‚æ·»åŠ  v1.0 ä¸å®žçŽ°çš„é†’ç›®è­¦å‘Š

### v1.4 (2025-01-20)

**å…³é”®ä¿®å¤ï¼ˆå¿…é¡»ä¿®å¤ï¼‰**ï¼š
1. âœ… ç»Ÿä¸€å®¡è®¡æ—¥å¿—è¯­ä¹‰ï¼ˆåˆ é™¤æ—§ç‰ˆæœ¬æè¿°ï¼Œæ˜Žç¡®åº”ç”¨å±‚æ ¡éªŒè§„åˆ™ï¼š`(user_id IS NOT NULL) OR (admin_id IS NOT NULL)`ï¼‰
2. âœ… ç»Ÿä¸€ä»»åŠ¡ completed çŠ¶æ€è¯­ä¹‰ï¼ˆæ˜Žç¡®åŒºåˆ†"å·¥ä½œå®Œæˆ"å’Œ"å¥–åŠ±ç»“ç®—"ï¼Œåˆ é™¤æ—§ç‰ˆæœ¬"å¥–åŠ±å·²åˆ†é…"çš„æè¿°ï¼‰
3. âœ… ç»Ÿä¸€ task_participants è¡¨ DDLï¼ˆä½¿ç”¨ `planned_reward_amount` / `planned_points_reward` ä½œä¸ºå”¯ä¸€è§„èŒƒç‰ˆæœ¬ï¼‰
4. âœ… ä¿®æ­£ current_participants åœ¨æµç¨‹æè¿°ä¸­çš„å¼•ç”¨ï¼ˆæ”¹ä¸º"äººæ•°ç»Ÿè®¡é€»è¾‘è§ current_participants å­—æ®µè¯´æ˜Ž"ï¼‰

**æ•°æ®åº“çº¦æŸä¼˜åŒ–**ï¼š
1. âœ… æ”¶ç´§ CHECK çº¦æŸï¼ˆ`reward_type='cash'` æ—¶è¦æ±‚ `reward > 0`ï¼Œ`reward_type='points'` æ—¶è¦æ±‚ `points_reward > 0`ï¼‰
2. âœ… æ˜Žç¡® `reward_type='both'` çš„å®žé™…å«ä¹‰ï¼ˆä»»åŠ¡çº§åˆ«æœ‰çŽ°é‡‘+ç§¯åˆ†ï¼Œä½†å‚ä¸Žè€…å¯ä»¥åªæ‹¿å…¶ä¸­ä¸€ç§ï¼‰

**ä¸šåŠ¡é€»è¾‘ä¼˜åŒ–**ï¼š
1. âœ… ç®€åŒ– MVP ä¸‹çš„å®ŒæˆæŽ¥å£ï¼ˆç§»é™¤ `participant_rewards` è¯·æ±‚ä½“ï¼ŒæœåŠ¡ç«¯è‡ªåŠ¨è®¡ç®—å¹³å‡åˆ†é…ï¼‰
2. âœ… åœ¨å–æ¶ˆçŸ©é˜µæ˜¾å¼æ ‡æ³¨ã€Œv1.0 ä¸å®žçŽ°çœŸå®žé€€æ¬¾/ç§¯åˆ†å›žé€€é€»è¾‘ã€
3. âœ… æ˜Žç¡®èŠå¤©å®¤æƒé™è§„åˆ™ï¼ˆå…è®¸è¿›å…¥/å‘è¨€çš„çŠ¶æ€ï¼š`accepted`ã€`in_progress`ã€`completed`ï¼‰
4. âœ… å®Œå–„å¹‚ç­‰é”®ç­–ç•¥çš„è½åœ°è§„èŒƒï¼ˆæ·»åŠ æ˜Žç¡®çš„å®žçŽ°ç¤ºä¾‹ï¼šç”³è¯·å‚ä¸Žã€æäº¤å®Œæˆã€åˆ†é…å¥–åŠ±ï¼‰

### v1.3 (2025-01-20)

**é«˜ä¼˜å…ˆä¿®å¤**ï¼š
1. âœ… ä¿®å¤å®¡è®¡æ—¥å¿— `user_id`/`admin_id` è§„åˆ™å†²çªï¼Œç»Ÿä¸€è¯­ä¹‰ï¼ˆé‡‡ç”¨æ–¹æ¡ˆBï¼šè‡³å°‘æœ‰ä¸€ä¸ªä¸ä¸ºNULLï¼Œå…è®¸ä¸¤ä¸ªéƒ½ä¸ä¸ºç©ºï¼‰
2. âœ… æ˜Žç¡®å®¡è®¡æ—¥å¿—å­—æ®µè¯­ä¹‰ï¼ˆ`admin_id`=æ“ä½œæ‰§è¡Œè€…ï¼Œ`user_id`=è¢«å½±å“çš„ä¸šåŠ¡ç”¨æˆ·ï¼‰
3. âœ… ä¿®å¤ä»»åŠ¡ `completed` çŠ¶æ€è¯­ä¹‰ä¸ä¸€è‡´ï¼Œæ˜Žç¡®åŒºåˆ†"å·¥ä½œå®Œæˆ"å’Œ"å¥–åŠ±ç»“ç®—"
4. âœ… æ·»åŠ æ•°æ®åº“çº§ CHECK çº¦æŸï¼ˆè·¨å­—æ®µéªŒè¯ï¼šå‚ä¸Žäººæ•°èŒƒå›´ã€å¥–åŠ±éžè´Ÿã€å¥–åŠ±ç±»åž‹ä¸€è‡´æ€§ï¼‰
5. âœ… ä¼˜åŒ–å­—æ®µå‘½åï¼ˆ`reward_amount` â†’ `planned_reward_amount`ï¼Œ`points_reward` â†’ `planned_points_reward`ï¼‰
6. âœ… æ·»åŠ å¥–åŠ±è¡¨ä¸Žä»»åŠ¡è¡¨çš„ `reward_type` ä¸€è‡´æ€§éªŒè¯è§¦å‘å™¨
7. âœ… ä¼˜åŒ–ç´¢å¼•ï¼ˆåˆ é™¤å†—ä½™ç´¢å¼•ï¼Œä¿ç•™å¿…è¦ç´¢å¼•ï¼‰
8. âœ… ä¼˜åŒ– `current_participants` ç­–ç•¥ï¼ˆMVPé˜¶æ®µå»ºè®®ä¸å­˜ï¼Œå®žæ—¶ `COUNT(*)`ï¼‰

**ä¸­ä¼˜å…ˆä¼˜åŒ–**ï¼š
1. âœ… ç»Ÿä¸€å¹‚ç­‰é”®ä½¿ç”¨è§„åˆ™ï¼ˆæ‰€æœ‰ side-effect æ“ä½œå»ºè®®æºå¸¦ï¼Œå…³é”®æ“ä½œå¼ºåˆ¶è¦æ±‚ï¼‰
2. âœ… æ˜Žç¡®é€€å‡ºé€»è¾‘ä¸Žå å‘è§„åˆ™ï¼ˆå½“å‰ç­–ç•¥å’Œæœªæ¥æ‰©å±•ç­–ç•¥ï¼‰
3. âœ… æ˜Žç¡®èŠå¤©å®¤è·¯ç”±ç­–ç•¥ï¼ˆæŽ¨èä½¿ç”¨ `/rooms/{room_code}`ï¼‰
4. âœ… æ·»åŠ  MVP èŒƒå›´è¯´æ˜Žï¼ˆæ˜Žç¡® v1.0 å¿…é¡»å®žçŽ°çš„åŠŸèƒ½å’Œæœªæ¥æ‰©å±•ï¼‰

**ä½Žä¼˜å…ˆæ”¹è¿›**ï¼š
1. âœ… æ›´æ–° API æŽ¥å£ä¸­çš„å¹‚ç­‰é”®è¯´æ˜Žï¼ˆä»Ž"å¯é€‰"æ”¹ä¸º"å»ºè®®æºå¸¦"ï¼‰
2. âœ… ä¼˜åŒ–ç´¢å¼•è¯´æ˜Žï¼ˆè§£é‡Šä¸ºä»€ä¹ˆåˆ é™¤æŸäº›ç´¢å¼•ï¼‰

### v1.2 (2025-01-20)

**é«˜ä¼˜å…ˆä¿®å¤**ï¼š
1. âœ… ä¿®å¤èŠå¤©å®¤ ID è¿”å›žå€¼ï¼Œæ”¹ä¸ºä¸å¯é¢„æµ‹çš„ `room_code`ï¼ˆUUIDæ ¼å¼ï¼‰
2. âœ… ä¿®å¤ä»…ç§¯åˆ†ä»»åŠ¡ç¤ºä¾‹ï¼Œç§»é™¤çŽ°é‡‘é‡‘é¢å­—æ®µ
3. âœ… æ˜Žç¡®"è‡ªåŠ¨å¼€å§‹"ä¸Ž"ä»…ç®¡ç†å‘˜å¼€å§‹"çš„è¯­ä¹‰ï¼ˆå½“å‰ä»…æ”¯æŒç®¡ç†å‘˜æ‰‹åŠ¨å¼€å§‹ï¼‰
4. âœ… ä¿®å¤ `completed â†’ exit_requested` çš„å›¾ç¤ºæ­§ä¹‰ï¼Œæ˜Žç¡®å·²å®ŒæˆçŠ¶æ€ä¸å¯å†ç”³è¯·é€€å‡º
5. âœ… ç»Ÿä¸€å¹‚ç­‰ä¸Žå®Œæ•´æ€§æ ¡éªŒè§„åˆ™ï¼ˆpoints-only æ—¶çŽ°é‡‘å¿…é¡»ä¸º NULLï¼Œä¸æŽ¥å— 0ï¼‰
6. âœ… æ·»åŠ  `updated_at` è‡ªåŠ¨æ›´æ–°è§¦å‘å™¨ï¼Œæ”¯æŒä¹è§‚é”æœºåˆ¶
7. âœ… ç»Ÿä¸€ç‰ˆæœ¬å·ä¸º v1.2
8. âœ… å¥–åŠ±è¡¨çš„ `admin_operator_id` æ·»åŠ å¤–é”®çº¦æŸ

**ä¸­ä¼˜å…ˆä¼˜åŒ–**ï¼š
1. âœ… æ˜Žç¡® `current_participants` å­—æ®µçš„ç»´æŠ¤ç­–ç•¥ï¼ˆæŽ¨èä½¿ç”¨è§¦å‘å™¨ï¼‰
2. âœ… æ˜Žç¡®"è¿Ÿåˆ°åŠ å…¥"è§„åˆ™ï¼ˆå½“å‰ä¸å…è®¸ä»»åŠ¡å¼€å§‹åŽç”³è¯·ï¼‰
3. âœ… æ˜Žç¡®å¥–åŠ±å­—æ®µå®šä½ï¼ˆå‚ä¸Žè€…è¡¨ä¸ºè®¡åˆ’å€¼ï¼Œå¥–åŠ±è¡¨ä¸ºå®žé™…å€¼ï¼‰
4. âœ… æ·»åŠ  `reward_type` å­—æ®µçš„ CHECK çº¦æŸ
5. âœ… è¯´æ˜Ž `user_id` é•¿åº¦ç»Ÿä¸€é—®é¢˜ï¼ˆå»ºè®®ä¸Ž users è¡¨ä¿æŒä¸€è‡´ï¼‰
6. âœ… æ˜Žç¡®ç§¯åˆ†è¿½å›ž/æ‰£é™¤çš„è¾¹ç•Œè§„åˆ™
7. âœ… æ˜Žç¡®å®¡è®¡æ—¥å¿—çš„ `user_id/admin_id` äº’æ–¥è¯­ä¹‰

**ä½Žä¼˜å…ˆæ”¹è¿›**ï¼š
1. âœ… æ·»åŠ  `can_auto_accept` å­—æ®µåˆ°ç”³è¯·å“åº”
2. âœ… ç»†åŒ–å¹¶å‘ç”³è¯·å¤„ç†çš„æŒ‡æ ‡ï¼ˆæ•°æ®åº“äº‹åŠ¡ã€é”ç­‰å¾…ã€ä¸šåŠ¡é€»è¾‘ï¼‰
3. âœ… è¡¥å……æµ‹è¯•ç”¨ä¾‹ï¼ˆå¥–åŠ±åˆ†é…ä¸€è‡´æ€§ã€å¹‚ç­‰æ€§ï¼‰
4. âœ… ä¼˜åŒ–è·¯ç”±ç­–ç•¥ï¼ˆæŽ¨èä½¿ç”¨ `/rooms/{room_code}`ï¼‰
5. âœ… ä¼˜åŒ–ç´¢å¼•è¦†ç›–é¢ï¼ˆè¦†ç›–ç´¢å¼•ã€éƒ¨åˆ†ç´¢å¼•ï¼‰

### v1.1 (2025-01-20)
- åˆå§‹ç‰ˆæœ¬ï¼ŒåŒ…å«åŸºç¡€åŠŸèƒ½è®¾è®¡

