# Stripe Connect æ”¶æ¬¾è´¦æˆ·æ³¨å†ŒåŠŸèƒ½æ£€æŸ¥æ¸…å•

## âœ… åŠŸèƒ½å®ç°çŠ¶æ€

### 1. ä»£ç å®ç°

- âœ… **è§†å›¾ç»„ä»¶**: `StripeConnectOnboardingView.swift` å·²å®ç°
- âœ… **åŸç”Ÿ SDK**: ä½¿ç”¨ `AccountOnboardingController`ï¼ˆé WebViewï¼‰
- âœ… **ViewModel**: `StripeConnectOnboardingViewModel` å·²å®ç°
- âœ… **å¯¼èˆªé“¾æ¥**: åœ¨ `SettingsView` ä¸­å·²æ·»åŠ 
- âœ… **é”™è¯¯å¤„ç†**: å®Œæ•´çš„é”™è¯¯å¤„ç†å’ŒçŠ¶æ€ç®¡ç†
- âœ… **å®Œæˆå›è°ƒ**: æ”¯æŒå®Œæˆåçš„çŠ¶æ€æ£€æŸ¥

### 2. åç«¯ API

- âœ… **åˆ›å»ºè´¦æˆ·**: `/api/stripe/connect/account/create-embedded`
- âœ… **è´¦æˆ·çŠ¶æ€**: `/api/stripe/connect/account/status`
- âœ… **Account Session**: æ”¯æŒåˆ›å»º onboarding session

### 3. é…ç½®

- âœ… **Stripe Publishable Key**: å·²é…ç½®åœ¨ `Constants.swift`
- âœ… **Terms/Privacy URL**: å·²é…ç½®åœ¨ `Constants.Stripe.ConnectOnboarding`
- âœ… **è‡ªå®šä¹‰ URL æ”¯æŒ**: æ”¯æŒä¼ å…¥è‡ªå®šä¹‰ Terms å’Œ Privacy URL

## âš ï¸ éœ€è¦æ£€æŸ¥çš„é…ç½®é¡¹

### 1. ç›¸æœºæƒé™ï¼ˆå¿…éœ€ï¼‰

Stripe Connect Onboarding éœ€è¦ç›¸æœºæƒé™æ¥æ‹æ‘„èº«ä»½è¯ä»¶ç…§ç‰‡ã€‚

#### æ£€æŸ¥æ–¹æ³•

åœ¨ Xcode ä¸­ï¼š
1. é€‰æ‹©é¡¹ç›® â†’ **Target** â†’ **Info** æ ‡ç­¾
2. æŸ¥çœ‹ **Custom iOS Target Properties**
3. ç¡®è®¤æ˜¯å¦æœ‰ `Privacy - Camera Usage Description` æˆ– `NSCameraUsageDescription`

#### å¦‚æœæ²¡æœ‰ï¼Œéœ€è¦æ·»åŠ ï¼š

**æ–¹æ³•ä¸€ï¼šåœ¨ Xcode ä¸­**
1. ç‚¹å‡» **"+"** æ·»åŠ æ–°é¡¹
2. é€‰æ‹©æˆ–è¾“å…¥ï¼š`Privacy - Camera Usage Description`
3. è®¾ç½®å€¼ä¸ºï¼š`è¯¥åº”ç”¨ç¨‹åºå°†ä½¿ç”¨ç›¸æœºæ‹æ‘„æ‚¨çš„èº«ä»½è¯ä»¶ç…§ç‰‡ã€‚`

**æ–¹æ³•äºŒï¼šåœ¨ project.pbxproj ä¸­**
æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š
```
INFOPLIST_KEY_NSCameraUsageDescription = "è¯¥åº”ç”¨ç¨‹åºå°†ä½¿ç”¨ç›¸æœºæ‹æ‘„æ‚¨çš„èº«ä»½è¯ä»¶ç…§ç‰‡ã€‚";
```

### 2. StripeConnect SDK å®‰è£…

#### æ£€æŸ¥æ–¹æ³•

1. åœ¨ Xcode ä¸­é€‰æ‹©é¡¹ç›®
2. é€‰æ‹© **Target** â†’ **Package Dependencies**
3. ç¡®è®¤ `stripe-ios` æˆ– `stripe-ios-spm` åŒ…å·²æ·»åŠ 
4. ç¡®è®¤ `StripeConnect` äº§å“å·²å‹¾é€‰

### 3. API ç­¾åå…¼å®¹æ€§

ä»£ç ä¸­ä½¿ç”¨äº†ä»¥ä¸‹ APIï¼š
```swift
embeddedComponentManager.createAccountOnboardingController(
    fullTermsOfServiceUrl: fullTermsURL,
    recipientTermsOfServiceUrl: recipientTermsURL,
    privacyPolicyUrl: privacyURL
)
```

#### å¦‚æœç¼–è¯‘é”™è¯¯

å¦‚æœ SDK ä¸æ”¯æŒè¿™äº›å‚æ•°ï¼Œä½¿ç”¨æ— å‚æ•°ç‰ˆæœ¬ï¼š
```swift
let controller = embeddedComponentManager.createAccountOnboardingController()
```

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### 1. åŸºæœ¬åŠŸèƒ½æµ‹è¯•

1. **æ‰“å¼€åº”ç”¨**
2. **å¯¼èˆªåˆ°è®¾ç½®é¡µé¢**
3. **ç‚¹å‡»"è®¾ç½®æ”¶æ¬¾è´¦æˆ·"**
4. **éªŒè¯**ï¼š
   - âœ… åŠ è½½çŠ¶æ€æ­£å¸¸æ˜¾ç¤º
   - âœ… èƒ½å¤Ÿè·å– `client_secret`
   - âœ… `AccountOnboardingController` æ­£å¸¸æ˜¾ç¤º
   - âœ… å¯ä»¥å¡«å†™è¡¨å•

### 2. ç›¸æœºæƒé™æµ‹è¯•

1. **é¦–æ¬¡ä½¿ç”¨ç›¸æœºåŠŸèƒ½æ—¶**
2. **éªŒè¯**ï¼š
   - âœ… ç³»ç»Ÿå¼¹å‡ºç›¸æœºæƒé™è¯·æ±‚
   - âœ… æƒé™æè¿°æ­£ç¡®æ˜¾ç¤º
   - âœ… æˆæƒåå¯ä»¥æ‹æ‘„ç…§ç‰‡

### 3. å®Œæˆæµç¨‹æµ‹è¯•

1. **å®Œæˆæ‰€æœ‰å¿…å¡«å­—æ®µ**
2. **æäº¤è¡¨å•**
3. **éªŒè¯**ï¼š
   - âœ… æ˜¾ç¤º"æ”¶æ¬¾è´¦æˆ·å·²è®¾ç½®å®Œæˆ"
   - âœ… å¯ä»¥ç‚¹å‡»"å®Œæˆ"æŒ‰é’®
   - âœ… è¿”å›åè´¦æˆ·çŠ¶æ€å·²æ›´æ–°

### 4. é”™è¯¯å¤„ç†æµ‹è¯•

1. **ç½‘ç»œé”™è¯¯**ï¼šæ–­å¼€ç½‘ç»œï¼ŒéªŒè¯é”™è¯¯æç¤º
2. **API é”™è¯¯**ï¼šéªŒè¯é”™è¯¯ä¿¡æ¯æ˜¾ç¤º
3. **ç”¨æˆ·å–æ¶ˆ**ï¼šéªŒè¯å–æ¶ˆæµç¨‹æ­£å¸¸

## ğŸ” å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1: ç¼–è¯‘é”™è¯¯ "Cannot find type 'AccountOnboardingController'"

**åŸå› **: StripeConnect SDK æœªæ­£ç¡®å®‰è£…

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®è®¤ `StripeConnect` äº§å“å·²æ·»åŠ åˆ° Target
2. æ¸…ç†æ„å»ºæ–‡ä»¶å¤¹ï¼ˆâŒ˜ + Shift + Kï¼‰
3. é‡æ–°æ„å»ºé¡¹ç›®
4. å¦‚æœä½¿ç”¨ `stripe-ios`ï¼Œè€ƒè™‘åˆ‡æ¢åˆ° `stripe-ios-spm`

### é—®é¢˜ 2: ç›¸æœºæƒé™æœªè¯·æ±‚

**åŸå› **: Info.plist ä¸­ç¼ºå°‘ç›¸æœºæƒé™é…ç½®

**è§£å†³æ–¹æ¡ˆ**:
1. æ·»åŠ  `NSCameraUsageDescription` åˆ° Info.plist
2. é‡æ–°å®‰è£…åº”ç”¨ï¼ˆåˆ é™¤åé‡æ–°å®‰è£…ï¼‰
3. é¦–æ¬¡ä½¿ç”¨æ—¶ç³»ç»Ÿä¼šè‡ªåŠ¨è¯·æ±‚æƒé™

### é—®é¢˜ 3: æ§åˆ¶å™¨ä¸æ˜¾ç¤º

**åŸå› **: `clientSecret` è·å–å¤±è´¥æˆ– `publishableKey` æœªè®¾ç½®

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥åç«¯ API æ˜¯å¦æ­£å¸¸è¿”å› `client_secret`
2. æ£€æŸ¥ `Constants.Stripe.publishableKey` æ˜¯å¦æ­£ç¡®é…ç½®
3. æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯
4. éªŒè¯ç½‘ç»œè¿æ¥æ­£å¸¸

### é—®é¢˜ 4: API å‚æ•°é”™è¯¯

**åŸå› **: SDK ç‰ˆæœ¬ä¸æ”¯æŒæŸäº›å‚æ•°

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ Stripe iOS SDK ç‰ˆæœ¬
2. æŸ¥çœ‹ SDK æ–‡æ¡£ç¡®è®¤ API ç­¾å
3. å¦‚æœä¸æ”¯æŒå‚æ•°ï¼Œä½¿ç”¨æ— å‚æ•°ç‰ˆæœ¬ï¼š
   ```swift
   let controller = embeddedComponentManager.createAccountOnboardingController()
   ```

## ğŸ“Š åŠŸèƒ½å®Œæ•´æ€§æ£€æŸ¥

### å·²å®ç°çš„åŠŸèƒ½

- âœ… åˆ›å»º Stripe Connect è´¦æˆ·
- âœ… è·å– Account Session
- âœ… æ˜¾ç¤ºåŸç”Ÿ Onboarding UI
- âœ… å¤„ç†å®Œæˆå›è°ƒ
- âœ… æ£€æŸ¥è´¦æˆ·çŠ¶æ€
- âœ… é”™è¯¯å¤„ç†
- âœ… åŠ è½½çŠ¶æ€æ˜¾ç¤º
- âœ… å®ŒæˆçŠ¶æ€æ˜¾ç¤º

### å¯é€‰åŠŸèƒ½ï¼ˆå·²é¢„ç•™ï¼‰

- âš ï¸ Collection Optionsï¼ˆéœ€è¦æ ¹æ® SDK ç‰ˆæœ¬è°ƒæ•´ï¼‰
- âœ… è‡ªå®šä¹‰ Terms/Privacy URLï¼ˆå·²å®ç°ï¼‰

## ğŸ¯ ä½¿ç”¨æµç¨‹

```
1. ç”¨æˆ·æ‰“å¼€è®¾ç½®é¡µé¢
   â†“
2. ç‚¹å‡»"è®¾ç½®æ”¶æ¬¾è´¦æˆ·"
   â†“
3. è°ƒç”¨ /api/stripe/connect/account/create-embedded
   â†“
4. è·å– client_secret
   â†“
5. åˆ›å»º AccountOnboardingController
   â†“
6. æ˜¾ç¤ºåŸç”Ÿ Onboarding UI
   â†“
7. ç”¨æˆ·å¡«å†™ä¿¡æ¯ï¼ˆå¯èƒ½éœ€è¦ç›¸æœºæƒé™ï¼‰
   â†“
8. å®Œæˆ Onboarding
   â†“
9. è°ƒç”¨ checkAccountStatus()
   â†“
10. æ˜¾ç¤º"æ”¶æ¬¾è´¦æˆ·å·²è®¾ç½®å®Œæˆ"
```

## âœ… æ€»ç»“

æ”¶æ¬¾è´¦æˆ·æ³¨å†ŒåŠŸèƒ½**åŸºæœ¬å¯ä»¥æ­£å¸¸ä½¿ç”¨**ï¼Œä½†éœ€è¦ç¡®è®¤ï¼š

1. âš ï¸ **ç›¸æœºæƒé™**ï¼šéœ€è¦åœ¨ Info.plist ä¸­æ·»åŠ  `NSCameraUsageDescription`
2. âœ… **SDK å®‰è£…**ï¼šç¡®è®¤ StripeConnect å·²å®‰è£…
3. âœ… **API å…¼å®¹æ€§**ï¼šå¦‚æœç¼–è¯‘é”™è¯¯ï¼Œå¯èƒ½éœ€è¦è°ƒæ•´ API è°ƒç”¨
4. âœ… **åç«¯é…ç½®**ï¼šç¡®è®¤åç«¯ API æ­£å¸¸å·¥ä½œ

å»ºè®®å…ˆæµ‹è¯•ç¼–è¯‘ï¼Œå¦‚æœæœ‰é”™è¯¯ï¼Œæ ¹æ®é”™è¯¯ä¿¡æ¯è°ƒæ•´ä»£ç ã€‚

