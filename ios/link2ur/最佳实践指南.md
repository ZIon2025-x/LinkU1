# ä¼ä¸šçº§å¼€å‘æœ€ä½³å®è·µæŒ‡å—

æœ¬æ–‡æ¡£æä¾›äº†ä½¿ç”¨ä¼ä¸šçº§å·¥å…·çš„æœ€ä½³å®è·µå’Œå»ºè®®ã€‚

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### 1. ä¾èµ–æ³¨å…¥

**âœ… æ¨èåšæ³•**
```swift
class UserViewModel: ObservableObject {
    private let apiService: APIServiceProtocol
    private let cacheManager: CacheManager
    
    init(
        apiService: APIServiceProtocol = DependencyContainer.shared.resolve(APIServiceProtocol.self),
        cacheManager: CacheManager = CacheManager.shared
    ) {
        self.apiService = apiService
        self.cacheManager = cacheManager
    }
}
```

**âŒ é¿å…åšæ³•**
```swift
class UserViewModel: ObservableObject {
    private let apiService = APIService() // ç¡¬ç¼–ç ä¾èµ–
}
```

### 2. é”™è¯¯å¤„ç†

**âœ… æ¨èåšæ³•**
```swift
func loadUser() {
    apiService.getUser()
        .handleError { error in
            ErrorHandler.shared.handle(error, context: "åŠ è½½ç”¨æˆ·")
            Analytics.shared.logError(error, context: "åŠ è½½ç”¨æˆ·")
        }
        .sink(
            receiveCompletion: { completion in
                if case .failure(let error) = completion {
                    Logger.error("åŠ è½½å¤±è´¥: \(error)", category: .api)
                }
            },
            receiveValue: { user in
                Logger.success("åŠ è½½æˆåŠŸ: \(user.name)", category: .api)
            }
        )
}
```

**âŒ é¿å…åšæ³•**
```swift
func loadUser() {
    apiService.getUser { result in
        if case .failure(let error) = result {
            print("é”™è¯¯: \(error)") // ä»…æ‰“å°ï¼Œæ²¡æœ‰ç»Ÿä¸€å¤„ç†
        }
    }
}
```

### 3. ç½‘ç»œè¯·æ±‚

**âœ… æ¨èåšæ³•**
```swift
// ä½¿ç”¨ RequestBuilder æ„å»ºè¯·æ±‚
let request = try RequestBuilder(
    baseURL: Constants.API.baseURL,
    endpoint: "/api/users/me"
)
.method("GET")
.header("X-Session-ID", value: sessionId)
.timeout(30)
.build()

// ä½¿ç”¨ NetworkManager æ‰§è¡Œè¯·æ±‚
NetworkManager.shared.execute(User.self, request: request)
    .retryOnFailure(maxAttempts: 3)
    .handleError { error in
        ErrorHandler.shared.handle(error, context: "åŠ è½½ç”¨æˆ·")
    }
```

**âŒ é¿å…åšæ³•**
```swift
// ç›´æ¥ä½¿ç”¨ URLSessionï¼Œæ²¡æœ‰ç»Ÿä¸€ç®¡ç†
let url = URL(string: "https://api.example.com/users/me")!
URLSession.shared.dataTask(with: url) { data, response, error in
    // å¤„ç†å“åº”
}.resume()
```

## ğŸ’¾ æ•°æ®ç®¡ç†

### 1. ç¼“å­˜ç­–ç•¥

**âœ… æ¨èåšæ³•**
```swift
func loadUser() {
    // å…ˆå°è¯•ä»ç¼“å­˜è·å–
    if let cached = CacheManager.shared.get(
        forKey: "user_\(userId)",
        as: User.self
    ) {
        self.user = cached
        return
    }
    
    // ä»ç½‘ç»œåŠ è½½å¹¶ç¼“å­˜
    loadUserFromAPI()
        .sink { user in
            try? CacheManager.shared.set(
                user,
                forKey: "user_\(userId)",
                expiration: 3600 // 1å°æ—¶
            )
            self.user = user
        }
}
```

**âŒ é¿å…åšæ³•**
```swift
// æ¯æ¬¡éƒ½ä»ç½‘ç»œåŠ è½½ï¼Œæ²¡æœ‰ç¼“å­˜
func loadUser() {
    loadUserFromAPI() { user in
        self.user = user
    }
}
```

### 2. å­˜å‚¨ç®¡ç†

**âœ… æ¨èåšæ³•**
```swift
// ä½¿ç”¨ StorageManager ç»Ÿä¸€ç®¡ç†
StorageManager.shared.setCodable(user, forKey: "current_user")
let user = StorageManager.shared.getCodable(User.self, forKey: "current_user")
```

**âŒ é¿å…åšæ³•**
```swift
// ç›´æ¥ä½¿ç”¨ UserDefaultsï¼Œåˆ†æ•£åœ¨å„å¤„
UserDefaults.standard.set(user, forKey: "current_user")
```

## ğŸ“¡ äº‹ä»¶é€šä¿¡

### 1. äº‹ä»¶æ€»çº¿

**âœ… æ¨èåšæ³•**
```swift
// å®šä¹‰äº‹ä»¶
struct UserLoginEvent: AppEvent {
    let timestamp = Date()
    let userId: String
}

// å‘å¸ƒäº‹ä»¶
EventBus.shared.publish(UserLoginEvent(userId: "123"))

// è®¢é˜…äº‹ä»¶
EventBus.shared.subscribe(UserLoginEvent.self)
    .sink { event in
        // å¤„ç†äº‹ä»¶
    }
```

**âŒ é¿å…åšæ³•**
```swift
// ä½¿ç”¨ NotificationCenterï¼Œç±»å‹ä¸å®‰å…¨
NotificationCenter.default.post(name: .userLogin, object: userId)
```

### 2. å±æ€§è§‚å¯Ÿ

**âœ… æ¨èåšæ³•**
```swift
class ViewModel: ObservableObject {
    @PropertyObserver var count: Int = 0
    
    init() {
        $count.sink { newValue in
            print("Count changed: \(newValue)")
        }
    }
}
```

## ğŸ¨ UI å¼€å‘

### 1. çŠ¶æ€ç®¡ç†

**âœ… æ¨èåšæ³•**
```swift
struct UserListView: View {
    @StateObject private var viewModel = UserListViewModel()
    @State private var loadingState: LoadingState<[User]> = .idle
    
    var body: some View {
        List {
            // å†…å®¹
        }
        .loadingState(loadingState)
        .onAppear {
            viewModel.loadUsers()
        }
    }
}
```

**âŒ é¿å…åšæ³•**
```swift
// åˆ†æ•£çš„çŠ¶æ€ç®¡ç†
@State private var isLoading = false
@State private var errorMessage: String?
@State private var users: [User]?
```

### 2. åŠ è½½çŠ¶æ€

**âœ… æ¨èåšæ³•**
```swift
.loadingState(loadingState) { error in
    AnyView(ErrorView(error: error))
}
```

**âŒ é¿å…åšæ³•**
```swift
if isLoading {
    ProgressView()
} else if let error = error {
    Text("é”™è¯¯: \(error.localizedDescription)")
}
```

## ğŸ”’ çº¿ç¨‹å®‰å…¨

### 1. åŸå­æ“ä½œ

**âœ… æ¨èåšæ³•**
```swift
class Counter {
    @Atomic var count: Int = 0
    
    func increment() {
        $count.update { $0 += 1 }
    }
}
```

**âŒ é¿å…åšæ³•**
```swift
class Counter {
    var count: Int = 0 // éçº¿ç¨‹å®‰å…¨
    
    func increment() {
        count += 1 // å¯èƒ½äº§ç”Ÿç«æ€æ¡ä»¶
    }
}
```

### 2. çº¿ç¨‹å®‰å…¨é›†åˆ

**âœ… æ¨èåšæ³•**
```swift
let safeArray = ThreadSafe<[String]>(wrappedValue: [])
safeArray.wrappedValue.append("item")
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. é˜²æŠ–å’ŒèŠ‚æµ

**âœ… æ¨èåšæ³•**
```swift
// æœç´¢é˜²æŠ–
let searchDebouncer = Debouncer(delay: 0.5)
searchDebouncer.call {
    performSearch(query: searchText)
}

// UI æ›´æ–°èŠ‚æµ
let uiThrottler = Throttler(interval: 0.1)
uiThrottler.execute {
    updateUI()
}
```

### 2. ä»»åŠ¡é˜Ÿåˆ—

**âœ… æ¨èåšæ³•**
```swift
// æŒ‰ä¼˜å…ˆçº§æ·»åŠ ä»»åŠ¡
TaskQueue.shared.enqueue(priority: .high) {
    try await uploadCriticalData()
}

TaskQueue.shared.enqueue(priority: .normal) {
    try await syncData()
}
```

## ğŸ§ª æµ‹è¯•

### 1. Mock æœåŠ¡

**âœ… æ¨èåšæ³•**
```swift
func testLoadUser() {
    let mockService = MockAPIService()
    mockService.mockResponse(User.self, data: userData)
    
    let viewModel = UserViewModel(apiService: mockService)
    viewModel.loadUser()
    
    XCTAssertNotNil(viewModel.user)
}
```

### 2. ä¾èµ–æ³¨å…¥æµ‹è¯•

**âœ… æ¨èåšæ³•**
```swift
func testViewModel() {
    let mockService = MockAPIService()
    DependencyContainer.shared.register(APIServiceProtocol.self) { mockService }
    
    let viewModel = UserViewModel()
    // æµ‹è¯•é€»è¾‘
}
```

## ğŸ“ æ—¥å¿—è®°å½•

### 1. ç»“æ„åŒ–æ—¥å¿—

**âœ… æ¨èåšæ³•**
```swift
Logger.debug("åŠ è½½ç”¨æˆ·", category: .api)
Logger.success("åŠ è½½æˆåŠŸ: \(user.name)", category: .api)
Logger.error("åŠ è½½å¤±è´¥: \(error)", category: .api)
Logger.warning("ç½‘ç»œå»¶è¿Ÿè¾ƒé«˜", category: .network)
```

**âŒ é¿å…åšæ³•**
```swift
print("åŠ è½½ç”¨æˆ·") // éç»“æ„åŒ–æ—¥å¿—
NSLog("é”™è¯¯: %@", error) // ä½¿ç”¨ç³»ç»Ÿæ—¥å¿—
```

### 2. æ—¥å¿—åˆ†ç±»

**âœ… æ¨èåšæ³•**
```swift
Logger.debug("è¯·æ±‚å¼€å§‹", category: .api)
Logger.debug("ç½‘ç»œçŠ¶æ€å˜åŒ–", category: .network)
Logger.debug("UI æ›´æ–°", category: .ui)
```

## ğŸ” å®‰å…¨

### 1. æ•æ„Ÿæ•°æ®

**âœ… æ¨èåšæ³•**
```swift
// ä½¿ç”¨ SecurityManager åŠ å¯†
let encrypted = SecurityManager.shared.encrypt(sensitiveData)
let decrypted = SecurityManager.shared.decrypt(encrypted)
```

**âŒ é¿å…åšæ³•**
```swift
// æ˜æ–‡å­˜å‚¨æ•æ„Ÿæ•°æ®
UserDefaults.standard.set(password, forKey: "password")
```

### 2. æ•°æ®éªŒè¯

**âœ… æ¨èåšæ³•**
```swift
if ValidationHelper.isValidEmail(email) {
    // å¤„ç†é‚®ç®±
}
```

## ğŸ“ˆ ç›‘æ§å’Œåˆ†æ

### 1. æ€§èƒ½ç›‘æ§

**âœ… æ¨èåšæ³•**
```swift
PerformanceMonitor.shared.startMonitoring()
// ... æ‰§è¡Œæ“ä½œ
PerformanceMonitor.shared.stopMonitoring()
```

### 2. äº‹ä»¶è¿½è¸ª

**âœ… æ¨èåšæ³•**
```swift
Analytics.shared.trackEvent(
    "user_login",
    parameters: ["method": "email"]
)
```

### 3. æŒ‡æ ‡æ”¶é›†

**âœ… æ¨èåšæ³•**
```swift
AppMetrics.shared.record(
    name: "api_call_duration",
    value: duration,
    tags: ["endpoint": "/api/users"]
)
```

## ğŸ¯ æ€»ç»“

### æ ¸å¿ƒåŸåˆ™

1. **ç»Ÿä¸€ç®¡ç†**: ä½¿ç”¨ DependencyContainer ç®¡ç†ä¾èµ–
2. **é”™è¯¯å¤„ç†**: ä½¿ç”¨ ErrorHandler ç»Ÿä¸€å¤„ç†é”™è¯¯
3. **ç½‘ç»œè¯·æ±‚**: ä½¿ç”¨ NetworkManager å’Œ RequestBuilder
4. **ç¼“å­˜ç­–ç•¥**: ä½¿ç”¨ CacheManager ç®¡ç†ç¼“å­˜
5. **äº‹ä»¶é€šä¿¡**: ä½¿ç”¨ EventBus è¿›è¡Œç»„ä»¶é—´é€šä¿¡
6. **çº¿ç¨‹å®‰å…¨**: ä½¿ç”¨ Atomicã€ThreadSafe ç­‰å·¥å…·
7. **æ€§èƒ½ä¼˜åŒ–**: ä½¿ç”¨é˜²æŠ–ã€èŠ‚æµã€ä»»åŠ¡é˜Ÿåˆ—
8. **æ—¥å¿—è®°å½•**: ä½¿ç”¨ Logger è¿›è¡Œç»“æ„åŒ–æ—¥å¿—
9. **å®‰å…¨ä¿æŠ¤**: ä½¿ç”¨ SecurityManager ä¿æŠ¤æ•æ„Ÿæ•°æ®
10. **ç›‘æ§åˆ†æ**: ä½¿ç”¨ Analyticsã€PerformanceMonitor ç­‰å·¥å…·

### æ£€æŸ¥æ¸…å•

- [ ] æ‰€æœ‰ä¾èµ–éƒ½é€šè¿‡ DependencyContainer æ³¨å…¥
- [ ] æ‰€æœ‰é”™è¯¯éƒ½é€šè¿‡ ErrorHandler å¤„ç†
- [ ] æ‰€æœ‰ç½‘ç»œè¯·æ±‚éƒ½ä½¿ç”¨ NetworkManager
- [ ] æ‰€æœ‰ç¼“å­˜éƒ½ä½¿ç”¨ CacheManager
- [ ] æ‰€æœ‰æ—¥å¿—éƒ½ä½¿ç”¨ Logger
- [ ] æ‰€æœ‰æ•æ„Ÿæ•°æ®éƒ½åŠ å¯†å­˜å‚¨
- [ ] æ‰€æœ‰å¼‚æ­¥æ“ä½œéƒ½ä½¿ç”¨ä»»åŠ¡é˜Ÿåˆ—
- [ ] æ‰€æœ‰çŠ¶æ€ç®¡ç†éƒ½ä½¿ç”¨ LoadingState
- [ ] æ‰€æœ‰äº‹ä»¶é€šä¿¡éƒ½ä½¿ç”¨ EventBus
- [ ] æ‰€æœ‰æµ‹è¯•éƒ½ä½¿ç”¨ Mock æœåŠ¡

éµå¾ªè¿™äº›æœ€ä½³å®è·µï¼Œå¯ä»¥ç¡®ä¿ä»£ç è´¨é‡ã€å¯ç»´æŠ¤æ€§å’Œæ€§èƒ½ã€‚

