# ä¼ä¸šçº§ç»„ä»¶å¿«é€Ÿå‚è€ƒ

æœ¬æ–‡æ¡£æä¾›ä¼ä¸šçº§ä¼˜åŒ–ç»„ä»¶çš„å¿«é€Ÿå‚è€ƒï¼Œæ–¹ä¾¿å¼€å‘è€…å¿«é€ŸæŸ¥æ‰¾å’Œä½¿ç”¨ã€‚

## ğŸ“‹ ç›®å½•

- [é”™è¯¯å¤„ç†](#é”™è¯¯å¤„ç†)
- [ä¾èµ–æ³¨å…¥](#ä¾èµ–æ³¨å…¥)
- [æ€§èƒ½ç›‘æ§](#æ€§èƒ½ç›‘æ§)
- [æ•°æ®éªŒè¯](#æ•°æ®éªŒè¯)
- [View æ‰©å±•](#view-æ‰©å±•)
- [String æ‰©å±•](#string-æ‰©å±•)

---

## é”™è¯¯å¤„ç†

### ErrorHandler

```swift
// å¤„ç†é”™è¯¯
ErrorHandler.shared.handle(error, context: "æ“ä½œæè¿°")

// è·å–ç”¨æˆ·å‹å¥½çš„é”™è¯¯æ¶ˆæ¯
if let apiError = error as? APIError {
    let message = apiError.userFriendlyMessage
}

// åœ¨ View ä¸­ç›‘å¬é”™è¯¯
.onReceive(ErrorHandler.shared.$currentError) { appError in
    if let appError = appError {
        // æ˜¾ç¤ºé”™è¯¯
    }
}
```

### APIError æ‰©å±•

```swift
// ç”¨æˆ·å‹å¥½çš„é”™è¯¯æ¶ˆæ¯
apiError.userFriendlyMessage

// é”™è¯¯æ¢å¤ç­–ç•¥
apiError.recoveryStrategy
```

---

## ä¾èµ–æ³¨å…¥

### DependencyContainer

```swift
// æ³¨å†ŒæœåŠ¡
DependencyContainer.shared.register(APIServiceProtocol.self) { 
    APIService.shared 
}

// è§£ææœåŠ¡
let apiService = DependencyContainer.shared.resolve(APIServiceProtocol.self)

// å¯é€‰è§£æï¼ˆä¸ä¼šå´©æºƒï¼‰
let apiService = DependencyContainer.shared.resolveOptional(APIServiceProtocol.self)
```

### åœ¨ ViewModel ä¸­ä½¿ç”¨

```swift
class MyViewModel: ObservableObject {
    private let apiService: APIService
    
    init(apiService: APIService? = nil) {
        self.apiService = apiService ?? APIService.shared
    }
}
```

---

## æ€§èƒ½ç›‘æ§

### PerformanceMonitor

```swift
// è®°å½•ç½‘ç»œè¯·æ±‚ï¼ˆå·²åœ¨ APIService ä¸­è‡ªåŠ¨é›†æˆï¼‰
// æ‰‹åŠ¨è®°å½•è§†å›¾åŠ è½½
PerformanceMonitor.shared.recordViewLoad(
    viewName: "ViewName",
    duration: duration
)

// ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š
let report = PerformanceMonitor.shared.generateReport()
print(report.summary)

// è·å–æ…¢è¯·æ±‚
let slowRequests = report.slowRequests
```

---

## æ•°æ®éªŒè¯

### ValidationHelper

```swift
// é‚®ç®±éªŒè¯
ValidationHelper.isValidEmail(email)

// æ‰‹æœºå·éªŒè¯
ValidationHelper.isValidUKPhone(phone)
ValidationHelper.isValidInternationalPhone(phone)

// å¯†ç éªŒè¯
let result = ValidationHelper.validatePassword(
    password,
    minLength: 8,
    requireUppercase: true,
    requireDigit: true
)
if !result.isValid {
    print(result.errorMessage)
}
```

### String æ‰©å±•ï¼ˆæ›´ç®€æ´ï¼‰

```swift
// é‚®ç®±éªŒè¯
email.isValidEmail

// æ‰‹æœºå·éªŒè¯
phone.isValidUKPhone

// å¯†ç éªŒè¯
password.isValidPassword

// ç©ºå€¼æ£€æŸ¥
string.isBlank
string.isNotBlank
```

---

## View æ‰©å±•

### åŠ è½½çŠ¶æ€

```swift
// åŠ è½½è¦†ç›–å±‚
.loadingOverlay(isLoading: viewModel.isLoading)

// LoadingState
.loadingState(viewModel.loadingState)
```

### é”™è¯¯å¤„ç†

```swift
// é”™è¯¯æç¤º
.errorAlert(error: $error)
```

### æ¡ä»¶ä¿®é¥°ç¬¦

```swift
// æ¡ä»¶åº”ç”¨
.if(condition) { view in
    view.foregroundColor(.blue)
}

// æ¡ä»¶åº”ç”¨ï¼ˆå¸¦ elseï¼‰
.if(condition,
    if: { $0.foregroundColor(.blue) },
    else: { $0.foregroundColor(.gray) }
)
```

---

## String æ‰©å±•

### éªŒè¯

```swift
email.isValidEmail
phone.isValidUKPhone
password.isValidPassword
string.isBlank
string.isNotBlank
```

### è½¬æ¢

```swift
string.safeURL
string.safeInt
string.safeDouble
string.safeBool
```

### æ ¼å¼åŒ–

```swift
string.truncated(to: 50)
string.removingHTMLTags
string.capitalizedWords
```

---

## å¸¸ç”¨æ¨¡å¼

### ViewModel æ ‡å‡†æ¨¡å¼

```swift
class MyViewModel: ObservableObject {
    @Published var data: [Item] = []
    @Published var isLoading = false
    @Published var errorMessage: String?
    
    private let apiService: APIService
    private var cancellables = Set<AnyCancellable>()
    
    init(apiService: APIService? = nil) {
        self.apiService = apiService ?? APIService.shared
    }
    
    func loadData() {
        isLoading = true
        errorMessage = nil
        
        apiService.request([Item].self, "/api/items")
            .sink(receiveCompletion: { [weak self] completion in
                self?.isLoading = false
                if case .failure(let error) = completion {
                    ErrorHandler.shared.handle(error, context: "åŠ è½½æ•°æ®")
                    if let apiError = error as? APIError {
                        self?.errorMessage = apiError.userFriendlyMessage
                    } else {
                        self?.errorMessage = error.localizedDescription
                    }
                }
            }, receiveValue: { [weak self] items in
                self?.data = items
            })
            .store(in: &cancellables)
    }
}
```

### View æ ‡å‡†æ¨¡å¼

```swift
struct MyView: View {
    @StateObject private var viewModel = MyViewModel()
    @State private var error: Error?
    
    var body: some View {
        List {
            ForEach(viewModel.data) { item in
                ItemRow(item: item)
            }
        }
        .loadingOverlay(isLoading: viewModel.isLoading)
        .errorAlert(error: $error)
        .onAppear {
            viewModel.loadData()
        }
        .onReceive(ErrorHandler.shared.$currentError) { appError in
            if let appError = appError {
                error = appError.error
            }
        }
    }
}
```

---

## æ–‡ä»¶ä½ç½®

### æ ¸å¿ƒç»„ä»¶
- `Core/DependencyContainer.swift` - ä¾èµ–æ³¨å…¥å®¹å™¨
- `Core/ErrorHandler.swift` - é”™è¯¯å¤„ç†ç³»ç»Ÿ
- `Core/NetworkManager.swift` - ç½‘ç»œç®¡ç†å™¨
- `Core/PerformanceMonitor.swift` - æ€§èƒ½ç›‘æ§
- `Core/SecurityManager.swift` - å®‰å…¨ç®¡ç†å™¨
- `Core/Configuration.swift` - é…ç½®ç®¡ç†

### æ‰©å±•
- `Core/Extensions/View+Extensions.swift` - View æ‰©å±•
- `Core/Extensions/String+Extensions.swift` - String æ‰©å±•
- `Core/Extensions/Publisher+Extensions.swift` - Publisher æ‰©å±•

### å·¥å…·ç±»
- `Core/Utils/ValidationHelper.swift` - éªŒè¯å·¥å…·
- `Core/Utils/DeviceInfo.swift` - è®¾å¤‡ä¿¡æ¯
- `Core/Utils/ThreadSafe.swift` - çº¿ç¨‹å®‰å…¨å·¥å…·
- æ›´å¤šå·¥å…·ç±»åœ¨ `Core/Utils/` ç›®å½•ä¸‹

### UI ç»„ä»¶
- `Core/Components/LoadingState.swift` - åŠ è½½çŠ¶æ€
- `Core/Components/PaginatedList.swift` - åˆ†é¡µåˆ—è¡¨
- `Core/Components/RefreshableScrollView.swift` - å¯åˆ·æ–°æ»šåŠ¨è§†å›¾

---

## å¿«é€ŸæŸ¥æ‰¾

### æˆ‘éœ€è¦...

| éœ€æ±‚ | ä½¿ç”¨ |
|------|------|
| å¤„ç†é”™è¯¯ | `ErrorHandler.shared.handle()` |
| ä¾èµ–æ³¨å…¥ | `DependencyContainer.shared.resolve()` |
| éªŒè¯é‚®ç®± | `ValidationHelper.isValidEmail()` æˆ– `email.isValidEmail` |
| éªŒè¯å¯†ç  | `ValidationHelper.validatePassword()` |
| æ˜¾ç¤ºåŠ è½½çŠ¶æ€ | `.loadingOverlay()` æˆ– `.loadingState()` |
| æ˜¾ç¤ºé”™è¯¯ | `.errorAlert()` |
| ç›‘æ§æ€§èƒ½ | `PerformanceMonitor.shared.recordViewLoad()` |
| æ¡ä»¶ä¿®é¥°ç¬¦ | `.if()` |

---

**æœ€åæ›´æ–°**: 2024å¹´
**ç‰ˆæœ¬**: 1.0

