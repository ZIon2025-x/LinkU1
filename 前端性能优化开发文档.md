# å‰ç«¯æ€§èƒ½ä¼˜åŒ–å¼€å‘æ–‡æ¡£

## ğŸ“‹ ç›®å½•

1. [ä¼˜åŒ–æ¦‚è¿°](#ä¼˜åŒ–æ¦‚è¿°)
2. [å½“å‰æ€§èƒ½çŠ¶å†µåˆ†æ](#å½“å‰æ€§èƒ½çŠ¶å†µåˆ†æ)
3. [å·²å®æ–½çš„ä¼˜åŒ–æªæ–½](#å·²å®æ–½çš„ä¼˜åŒ–æªæ–½)
4. [å¾…ä¼˜åŒ–é¡¹ç›®æ¸…å•](#å¾…ä¼˜åŒ–é¡¹ç›®æ¸…å•)
5. [è¯¦ç»†ä¼˜åŒ–æ–¹æ¡ˆ](#è¯¦ç»†ä¼˜åŒ–æ–¹æ¡ˆ)
6. [å®æ–½ä¼˜å…ˆçº§](#å®æ–½ä¼˜å…ˆçº§)
7. [æ€§èƒ½ç›‘æ§ä¸æµ‹è¯•](#æ€§èƒ½ç›‘æ§ä¸æµ‹è¯•)
8. [æœ€ä½³å®è·µæŒ‡å—](#æœ€ä½³å®è·µæŒ‡å—)

---

## ä¼˜åŒ–æ¦‚è¿°

æœ¬æ–‡æ¡£æ—¨åœ¨å…¨é¢åˆ†æå’Œä¼˜åŒ–å‰ç«¯åº”ç”¨çš„æ€§èƒ½ï¼Œè§£å†³ç”¨æˆ·åé¦ˆçš„"æµè§ˆç‚¹å‡»ç­‰å‰ç«¯è¡Œä¸ºæ…¢ã€æœ‰å¡é¡¿"çš„é—®é¢˜ã€‚é€šè¿‡ç³»ç»Ÿæ€§çš„æ€§èƒ½ä¼˜åŒ–ï¼Œæå‡ç”¨æˆ·ä½“éªŒï¼Œä½¿é¡µé¢åŠ è½½æ›´å¿«ã€äº¤äº’æ›´æµç•…ã€‚

### ä¼˜åŒ–ç›®æ ‡

- **é¦–å±åŠ è½½æ—¶é—´**ï¼šä» ~3.5s é™è‡³ < 2.0sï¼ˆç›®æ ‡ï¼š< 1.5sï¼‰
- **äº¤äº’å“åº”æ—¶é—´**ï¼šç‚¹å‡»å“åº” < 100ms
- **æ»šåŠ¨æµç•…åº¦**ï¼š60 FPS
- **é¡µé¢åˆ‡æ¢é€Ÿåº¦**ï¼š< 300ms
- **å†…å­˜ä½¿ç”¨**ï¼šæ§åˆ¶åœ¨åˆç†èŒƒå›´å†…ï¼Œé¿å…å†…å­˜æ³„æ¼

---

## å½“å‰æ€§èƒ½çŠ¶å†µåˆ†æ

### âœ… å·²ä¼˜åŒ–çš„æ–¹é¢

1. **è·¯ç”±æ‡’åŠ è½½**ï¼šå·²å®ç°ï¼Œå‡å°‘åˆå§‹åŒ…å¤§å° 60-70%
2. **React Query ç¼“å­˜**ï¼šå·²é…ç½®ï¼Œå‡å°‘é‡å¤è¯·æ±‚
3. **éƒ¨åˆ†ç»„ä»¶ memo åŒ–**ï¼šTaskCardã€TaskDetailModal ç­‰å·²ä½¿ç”¨ React.memo
4. **å›¾ç‰‡æ‡’åŠ è½½ç»„ä»¶**ï¼šLazyImage ç»„ä»¶å·²åˆ›å»º
5. **API é˜²æŠ–**ï¼šæœç´¢å…³é”®è¯å·²æ·»åŠ é˜²æŠ–

### âš ï¸ éœ€è¦ä¼˜åŒ–çš„æ–¹é¢

1. **æ»šåŠ¨æ€§èƒ½**ï¼šæ»šåŠ¨äº‹ä»¶å¤„ç†å¯èƒ½å½±å“æ€§èƒ½
2. **å¤§é‡ DOM æ“ä½œ**ï¼šä»»åŠ¡åˆ—è¡¨æ¸²æŸ“å¯èƒ½é€ æˆå¡é¡¿
3. **å›¾ç‰‡ä¼˜åŒ–ä¸è¶³**ï¼šç¼ºå°‘ WebP/AVIF æ ¼å¼æ”¯æŒã€å“åº”å¼å›¾ç‰‡
4. **å†…è”æ ·å¼è¿‡å¤š**ï¼šå½±å“æ¸²æŸ“æ€§èƒ½
5. **Context æ›´æ–°é¢‘ç¹**ï¼šå¯èƒ½å¯¼è‡´ä¸å¿…è¦çš„é‡æ¸²æŸ“
6. **åŠ¨ç”»æ€§èƒ½**ï¼šéƒ¨åˆ†åŠ¨ç”»å¯èƒ½å½±å“æµç•…åº¦
7. **ä»£ç åˆ†å‰²ç²’åº¦**ï¼šå¯ä»¥æ›´ç»†ç²’åº¦åˆ†å‰²
8. **é•¿åˆ—è¡¨æ¸²æŸ“**ï¼šç¼ºå°‘è™šæ‹Ÿæ»šåŠ¨

---

## å·²å®æ–½çš„ä¼˜åŒ–æªæ–½

### 1. è·¯ç”±æ‡’åŠ è½½ âš¡

**å®ç°ä½ç½®**ï¼š`frontend/src/App.tsx`

```tsx
// æ‡’åŠ è½½ç»„ä»¶ - å‡å°‘åˆå§‹åŒ…å¤§å°
const Home = lazyWithRetry(() => import('./pages/Home'));
const Tasks = lazyWithRetry(() => import('./pages/Tasks'));
// ... å…¶ä»–é¡µé¢
```

**æ•ˆæœ**ï¼š
- åˆå§‹åŒ…å¤§å°å‡å°‘ 60-70%
- é¦–å±åŠ è½½æ—¶é—´å‡å°‘ 40-50%

### 2. React Query ç¼“å­˜é…ç½®

**å®ç°ä½ç½®**ï¼š`frontend/src/App.tsx`

```tsx
const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 5 * 60 * 1000,  // 5åˆ†é’Ÿæ•°æ®æ–°é²œ
      gcTime: 10 * 60 * 1000,     // 10åˆ†é’Ÿåƒåœ¾å›æ”¶
      refetchOnWindowFocus: false, // çª—å£èšç„¦æ—¶ä¸è‡ªåŠ¨é‡æ–°è·å–
    },
  },
});
```

### 3. ç»„ä»¶ memo åŒ–

**å®ç°ä½ç½®**ï¼š`frontend/src/components/TaskCard.tsx`

```tsx
const TaskCard: React.FC<TaskCardProps> = React.memo(({ ... }) => {
  // ...
});
```

### 4. å›¾ç‰‡æ‡’åŠ è½½ç»„ä»¶

**å®ç°ä½ç½®**ï¼š`frontend/src/components/LazyImage.tsx`

ä½¿ç”¨ Intersection Observer API å®ç°å›¾ç‰‡æ‡’åŠ è½½ã€‚

---

## å¾…ä¼˜åŒ–é¡¹ç›®æ¸…å•

### ğŸ”´ P0 - é«˜ä¼˜å…ˆçº§ï¼ˆç«‹å³å®æ–½ï¼‰

1. **æ»šåŠ¨äº‹ä»¶ä¼˜åŒ–**
   - é—®é¢˜ï¼šæ»šåŠ¨ç›‘å¬å¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜
   - ä½ç½®ï¼š`frontend/src/pages/Tasks.tsx` (line 876-904)
   - å½±å“ï¼šæ»šåŠ¨å¡é¡¿

2. **ä»»åŠ¡åˆ—è¡¨è™šæ‹Ÿæ»šåŠ¨**
   - é—®é¢˜ï¼šå¤§é‡ä»»åŠ¡å¡ç‰‡åŒæ—¶æ¸²æŸ“å¯¼è‡´å¡é¡¿
   - ä½ç½®ï¼š`frontend/src/pages/Tasks.tsx`
   - å½±å“ï¼šåˆ—è¡¨æ»šåŠ¨ä¸æµç•…

3. **å›¾ç‰‡æ ¼å¼ä¼˜åŒ–**
   - é—®é¢˜ï¼šæœªä½¿ç”¨ç°ä»£å›¾ç‰‡æ ¼å¼ï¼ˆWebP/AVIFï¼‰
   - ä½ç½®ï¼šæ‰€æœ‰å›¾ç‰‡æ˜¾ç¤ºç»„ä»¶
   - å½±å“ï¼šå›¾ç‰‡åŠ è½½æ…¢ã€ä½“ç§¯å¤§

4. **å‡å°‘å†…è”æ ·å¼**
   - é—®é¢˜ï¼šå¤§é‡å†…è”æ ·å¼å½±å“æ¸²æŸ“æ€§èƒ½
   - ä½ç½®ï¼šå¤šä¸ªç»„ä»¶æ–‡ä»¶
   - å½±å“ï¼šæ ·å¼è®¡ç®—å¼€é”€å¤§

5. **Context ä¼˜åŒ–**
   - é—®é¢˜ï¼šContext æ›´æ–°å¯èƒ½å¯¼è‡´å¤§é‡ç»„ä»¶é‡æ¸²æŸ“
   - ä½ç½®ï¼š`frontend/src/contexts/`
   - å½±å“ï¼šä¸å¿…è¦çš„é‡æ¸²æŸ“

### ğŸŸ¡ P1 - ä¸­ä¼˜å…ˆçº§ï¼ˆè¿‘æœŸå®æ–½ï¼‰

6. **åŠ¨ç”»æ€§èƒ½ä¼˜åŒ–**
   - é—®é¢˜ï¼šéƒ¨åˆ†åŠ¨ç”»ä½¿ç”¨ JavaScriptï¼Œåº”ä½¿ç”¨ CSS
   - ä½ç½®ï¼šå¤šä¸ªç»„ä»¶
   - å½±å“ï¼šåŠ¨ç”»å¡é¡¿

7. **ä»£ç åˆ†å‰²ä¼˜åŒ–**
   - é—®é¢˜ï¼šæŸäº›å¤§ç»„ä»¶å¯ä»¥è¿›ä¸€æ­¥åˆ†å‰²
   - ä½ç½®ï¼š`frontend/src/pages/Message.tsx` ç­‰
   - å½±å“ï¼šåˆå§‹åŠ è½½æ…¢

8. **é¢„åŠ è½½å…³é”®èµ„æº**
   - é—®é¢˜ï¼šå…³é”®èµ„æºæœªé¢„åŠ è½½
   - ä½ç½®ï¼š`frontend/public/index.html`
   - å½±å“ï¼šé¦–å±åŠ è½½æ…¢

9. **Service Worker ç¼“å­˜**
   - é—®é¢˜ï¼šç¼ºå°‘ç¦»çº¿ç¼“å­˜ç­–ç•¥
   - ä½ç½®ï¼šéœ€è¦æ–°å»º
   - å½±å“ï¼šé‡å¤è®¿é—®åŠ è½½æ…¢

### ğŸŸ¢ P2 - ä½ä¼˜å…ˆçº§ï¼ˆé•¿æœŸè§„åˆ’ï¼‰

10. **Web Workers**
    - é—®é¢˜ï¼šå¤æ‚è®¡ç®—é˜»å¡ä¸»çº¿ç¨‹
    - ä½ç½®ï¼šéœ€è¦è¯†åˆ«è®¡ç®—å¯†é›†å‹æ“ä½œ
    - å½±å“ï¼šé¡µé¢å“åº”æ…¢

11. **HTTP/2 Server Push**
    - é—®é¢˜ï¼šæœªä½¿ç”¨ HTTP/2 æ¨é€
    - ä½ç½®ï¼šæœåŠ¡å™¨é…ç½®
    - å½±å“ï¼šèµ„æºåŠ è½½æ…¢

12. **æ€§èƒ½ç›‘æ§**
    - é—®é¢˜ï¼šç¼ºå°‘æ€§èƒ½ç›‘æ§
    - ä½ç½®ï¼šéœ€è¦é›†æˆ
    - å½±å“ï¼šæ— æ³•è¿½è¸ªæ€§èƒ½é—®é¢˜

---

## è¯¦ç»†ä¼˜åŒ–æ–¹æ¡ˆ

### 1. æ»šåŠ¨äº‹ä»¶ä¼˜åŒ– ğŸ”´ P0

**é—®é¢˜åˆ†æ**ï¼š
- å½“å‰ä½¿ç”¨ `requestAnimationFrame` èŠ‚æµï¼Œä½†å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–
- æ»šåŠ¨äº‹ä»¶ç›‘å¬å™¨å¯èƒ½è¿‡å¤š

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š

```typescript
// frontend/src/pages/Tasks.tsx

// ä¼˜åŒ–å‰
useEffect(() => {
  const handleScroll = () => {
    // æ»šåŠ¨å¤„ç†é€»è¾‘
  };
  
  let ticking = false;
  const throttledHandleScroll = () => {
    if (!ticking) {
      window.requestAnimationFrame(() => {
        handleScroll();
        ticking = false;
      });
      ticking = true;
    }
  };
  
  window.addEventListener('scroll', throttledHandleScroll, { passive: true });
  return () => window.removeEventListener('scroll', throttledHandleScroll);
}, [dependencies]);

// ä¼˜åŒ–åï¼šä½¿ç”¨è‡ªå®šä¹‰ Hook
import { useThrottledCallback } from '../hooks/useThrottledCallback';

useEffect(() => {
  const handleScroll = useThrottledCallback(() => {
    // æ»šåŠ¨å¤„ç†é€»è¾‘
    if (loadingMore || loading || !hasMore) return;
    
    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
    const windowHeight = window.innerHeight;
    const documentHeight = document.documentElement.scrollHeight;
    
    if (scrollTop + windowHeight >= documentHeight - 200) {
      loadMoreTasks();
    }
  }, 100); // 100ms èŠ‚æµ
  
  window.addEventListener('scroll', handleScroll, { passive: true });
  return () => window.removeEventListener('scroll', handleScroll);
}, [loadingMore, loading, hasMore, loadMoreTasks]);
```

**åˆ›å»º useThrottledCallback Hook**ï¼š

```typescript
// frontend/src/hooks/useThrottledCallback.ts
import { useCallback, useRef } from 'react';

export function useThrottledCallback<T extends (...args: any[]) => any>(
  callback: T,
  delay: number
): T {
  const lastRun = useRef(Date.now());
  const timeoutRef = useRef<NodeJS.Timeout | null>(null);
  
  return useCallback(
    ((...args: Parameters<T>) => {
      const now = Date.now();
      const timeSinceLastRun = now - lastRun.current;
      
      if (timeSinceLastRun >= delay) {
        lastRun.current = now;
        callback(...args);
      } else {
        if (timeoutRef.current) {
          clearTimeout(timeoutRef.current);
        }
        timeoutRef.current = setTimeout(() => {
          lastRun.current = Date.now();
          callback(...args);
        }, delay - timeSinceLastRun);
      }
    }) as T,
    [callback, delay]
  );
}
```

**é¢„æœŸæ•ˆæœ**ï¼š
- æ»šåŠ¨äº‹ä»¶å¤„ç†æ›´é«˜æ•ˆ
- å‡å°‘ä¸å¿…è¦çš„å‡½æ•°è°ƒç”¨
- æ»šåŠ¨æ›´æµç•…

---

### 2. ä»»åŠ¡åˆ—è¡¨è™šæ‹Ÿæ»šåŠ¨ ğŸ”´ P0

**é—®é¢˜åˆ†æ**ï¼š
- ä»»åŠ¡åˆ—è¡¨å¯èƒ½åŒ…å«å¤§é‡ä»»åŠ¡å¡ç‰‡
- åŒæ—¶æ¸²æŸ“æ‰€æœ‰å¡ç‰‡å¯¼è‡´ DOM èŠ‚ç‚¹è¿‡å¤šï¼Œå½±å“æ€§èƒ½

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼šä½¿ç”¨ `react-window` æˆ– `react-virtualized`

```bash
npm install react-window
npm install @types/react-window --save-dev
```

```typescript
// frontend/src/pages/Tasks.tsx
import { FixedSizeGrid as Grid } from 'react-window';

// ä¼˜åŒ–å‰
<div className="tasks-grid" style={{...}}>
  {filteredTasks.map(task => (
    <TaskCard key={task.id} task={task} ... />
  ))}
</div>

// ä¼˜åŒ–å
const Cell = ({ columnIndex, rowIndex, style }: any) => {
  const index = rowIndex * 2 + columnIndex; // å‡è®¾æ¯è¡Œ2åˆ—
  if (index >= filteredTasks.length) return null;
  
  const task = filteredTasks[index];
  return (
    <div style={style}>
      <TaskCard key={task.id} task={task} ... />
    </div>
  );
};

<Grid
  columnCount={2}
  columnWidth={isMobile ? 170 : 300}
  height={600}
  rowCount={Math.ceil(filteredTasks.length / 2)}
  rowHeight={400}
  width={1200}
>
  {Cell}
</Grid>
```

**æˆ–è€…ä½¿ç”¨æ›´ç®€å•çš„æ–¹æ¡ˆ**ï¼šåªæ¸²æŸ“å¯è§åŒºåŸŸçš„ä»»åŠ¡

```typescript
// frontend/src/hooks/useVirtualList.ts
import { useState, useEffect, useRef } from 'react';

interface UseVirtualListOptions {
  itemHeight: number;
  containerHeight: number;
  overscan?: number; // é¢å¤–æ¸²æŸ“çš„é¡¹ç›®æ•°
}

export function useVirtualList<T>(
  items: T[],
  options: UseVirtualListOptions
) {
  const { itemHeight, containerHeight, overscan = 3 } = options;
  const [scrollTop, setScrollTop] = useState(0);
  const containerRef = useRef<HTMLDivElement>(null);
  
  const startIndex = Math.max(0, Math.floor(scrollTop / itemHeight) - overscan);
  const endIndex = Math.min(
    items.length - 1,
    Math.ceil((scrollTop + containerHeight) / itemHeight) + overscan
  );
  
  const visibleItems = items.slice(startIndex, endIndex + 1);
  
  useEffect(() => {
    const container = containerRef.current;
    if (!container) return;
    
    const handleScroll = () => {
      setScrollTop(container.scrollTop);
    };
    
    container.addEventListener('scroll', handleScroll, { passive: true });
    return () => container.removeEventListener('scroll', handleScroll);
  }, []);
  
  return {
    containerRef,
    visibleItems,
    startIndex,
    totalHeight: items.length * itemHeight,
    offsetY: startIndex * itemHeight,
  };
}
```

**é¢„æœŸæ•ˆæœ**ï¼š
- DOM èŠ‚ç‚¹æ•°é‡å‡å°‘ 80-90%
- æ»šåŠ¨æ€§èƒ½æå‡ 3-5 å€
- å†…å­˜ä½¿ç”¨å‡å°‘

---

### 3. å›¾ç‰‡æ ¼å¼ä¼˜åŒ– ğŸ”´ P0

**é—®é¢˜åˆ†æ**ï¼š
- æœªä½¿ç”¨ç°ä»£å›¾ç‰‡æ ¼å¼ï¼ˆWebP/AVIFï¼‰
- å›¾ç‰‡å°ºå¯¸æœªä¼˜åŒ–
- ç¼ºå°‘å“åº”å¼å›¾ç‰‡

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š

#### 3.1 åç«¯æ”¯æŒå›¾ç‰‡æ ¼å¼åå•†

ç¡®ä¿åç«¯æ”¯æŒé€šè¿‡ `Accept` å¤´è‡ªåŠ¨è¿”å›æœ€ä½³æ ¼å¼ï¼š

```typescript
// å‰ç«¯è¯·æ±‚æ—¶è‡ªåŠ¨æ·»åŠ  Accept å¤´
const response = await fetch(imageUrl, {
  headers: {
    'Accept': 'image/avif,image/webp,image/apng,image/*',
  },
});
```

#### 3.2 ä¼˜åŒ– LazyImage ç»„ä»¶

```typescript
// frontend/src/components/LazyImage.tsx

// ä¼˜åŒ–ï¼šæ£€æµ‹æµè§ˆå™¨æ”¯æŒçš„æ ¼å¼
const getBestImageFormat = (baseSrc: string): string => {
  // å¦‚æœ URL å·²ç»åŒ…å«æ ¼å¼ä¿¡æ¯ï¼Œç›´æ¥è¿”å›
  if (baseSrc.includes('.webp') || baseSrc.includes('.avif')) {
    return baseSrc;
  }
  
  // æ£€æµ‹æµè§ˆå™¨æ”¯æŒ
  const supportsWebP = document.createElement('canvas')
    .toDataURL('image/webp')
    .indexOf('data:image/webp') === 0;
  
  const supportsAVIF = document.createElement('canvas')
    .toDataURL('image/avif')
    .indexOf('data:image/avif') === 0;
  
  // æ ¹æ®æ”¯æŒæƒ…å†µè¿”å›æœ€ä½³æ ¼å¼
  if (supportsAVIF) {
    return baseSrc.replace(/\.(jpg|jpeg|png)$/i, '.avif');
  } else if (supportsWebP) {
    return baseSrc.replace(/\.(jpg|jpeg|png)$/i, '.webp');
  }
  
  return baseSrc;
};

// ä½¿ç”¨å“åº”å¼å›¾ç‰‡
<img
  src={getBestImageFormat(src)}
  srcSet={`
    ${getBestImageFormat(src)}?w=400 400w,
    ${getBestImageFormat(src)}?w=800 800w,
    ${getBestImageFormat(src)}?w=1200 1200w
  `}
  sizes="(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 33vw"
  loading="lazy"
  decoding="async"
/>
```

#### 3.3 å›¾ç‰‡å‹ç¼©å’Œ CDN

- ä½¿ç”¨ CDN è‡ªåŠ¨å‹ç¼©å’Œæ ¼å¼è½¬æ¢
- é…ç½®å›¾ç‰‡è´¨é‡å‚æ•°ï¼ˆquality=80ï¼‰
- ä½¿ç”¨é€‚å½“çš„å›¾ç‰‡å°ºå¯¸

**é¢„æœŸæ•ˆæœ**ï¼š
- å›¾ç‰‡ä½“ç§¯å‡å°‘ 30-50%
- å›¾ç‰‡åŠ è½½é€Ÿåº¦æå‡ 40-60%
- å¸¦å®½ä½¿ç”¨å‡å°‘

---

### 4. å‡å°‘å†…è”æ ·å¼ ğŸ”´ P0

**é—®é¢˜åˆ†æ**ï¼š
- å¤§é‡å†…è”æ ·å¼å¯¼è‡´æ ·å¼è®¡ç®—å¼€é”€å¤§
- æ— æ³•åˆ©ç”¨æµè§ˆå™¨æ ·å¼ç¼“å­˜

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š

#### 4.1 æå–æ ·å¼åˆ° CSS æ–‡ä»¶

```typescript
// ä¼˜åŒ–å‰ï¼šfrontend/src/pages/Home.tsx
<div style={{
  background: '#fff',
  padding: '24px',
  borderRadius: '20px',
  boxShadow: '0 8px 32px rgba(0,0,0,0.08)',
}}>

// ä¼˜åŒ–åï¼šåˆ›å»º CSS æ¨¡å—
// frontend/src/pages/Home.module.css
.taskCard {
  background: #fff;
  padding: 24px;
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
}

// frontend/src/pages/Home.tsx
import styles from './Home.module.css';

<div className={styles.taskCard}>
```

#### 4.2 ä½¿ç”¨ styled-components ä¼˜åŒ–

å¦‚æœé¡¹ç›®ä½¿ç”¨ styled-componentsï¼Œå¯ä»¥ä¼˜åŒ–ï¼š

```typescript
// ä¼˜åŒ–å‰ï¼šæ¯æ¬¡æ¸²æŸ“éƒ½åˆ›å»ºæ–°æ ·å¼å¯¹è±¡
<div style={{ color: 'red', fontSize: '16px' }}>

// ä¼˜åŒ–åï¼šä½¿ç”¨ styled-components
import styled from 'styled-components';

const StyledDiv = styled.div`
  color: red;
  font-size: 16px;
`;

<StyledDiv>
```

#### 4.3 ä½¿ç”¨ CSS å˜é‡

```css
/* frontend/src/index.css */
:root {
  --primary-color: #3b82f6;
  --border-radius: 12px;
  --shadow-sm: 0 2px 8px rgba(0,0,0,0.05);
  --shadow-md: 0 8px 32px rgba(0,0,0,0.08);
}
```

```typescript
// ä½¿ç”¨ CSS å˜é‡
<div style={{
  background: 'var(--primary-color)',
  borderRadius: 'var(--border-radius)',
  boxShadow: 'var(--shadow-md)',
}}>
```

**é¢„æœŸæ•ˆæœ**ï¼š
- æ ·å¼è®¡ç®—æ—¶é—´å‡å°‘ 20-30%
- æ¸²æŸ“æ€§èƒ½æå‡
- ä»£ç æ›´æ˜“ç»´æŠ¤

---

### 5. Context ä¼˜åŒ– ğŸ”´ P0

**é—®é¢˜åˆ†æ**ï¼š
- Context æ›´æ–°ä¼šå¯¼è‡´æ‰€æœ‰æ¶ˆè´¹è€…ç»„ä»¶é‡æ¸²æŸ“
- å¤šä¸ª Context å¯èƒ½å¯¼è‡´çº§è”æ›´æ–°

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š

#### 5.1 æ‹†åˆ† Context

```typescript
// ä¼˜åŒ–å‰ï¼šä¸€ä¸ªå¤§çš„ Context
const AppContext = createContext({
  user: null,
  language: 'zh',
  theme: 'light',
  // ... å¾ˆå¤šçŠ¶æ€
});

// ä¼˜åŒ–åï¼šæŒ‰åŠŸèƒ½æ‹†åˆ†
const UserContext = createContext(null);
const LanguageContext = createContext('zh');
const ThemeContext = createContext('light');
```

#### 5.2 ä½¿ç”¨ useMemo å’Œ useCallback

```typescript
// frontend/src/contexts/LanguageContext.tsx

// ä¼˜åŒ–å‰
const LanguageProvider: React.FC = ({ children }) => {
  const [language, setLanguage] = useState('zh');
  
  const value = {
    language,
    setLanguage,
    t: (key: string) => translations[language][key],
  };
  
  return <LanguageContext.Provider value={value}>{children}</LanguageContext.Provider>;
};

// ä¼˜åŒ–å
const LanguageProvider: React.FC = ({ children }) => {
  const [language, setLanguage] = useState('zh');
  
  const t = useCallback((key: string) => {
    return translations[language][key] || key;
  }, [language]);
  
  const value = useMemo(() => ({
    language,
    setLanguage,
    t,
  }), [language, t]);
  
  return <LanguageContext.Provider value={value}>{children}</LanguageContext.Provider>;
};
```

#### 5.3 ä½¿ç”¨é€‰æ‹©å™¨æ¨¡å¼

```typescript
// åˆ›å»ºé€‰æ‹©å™¨ Hook
function useLanguageSelector<T>(selector: (context: LanguageContextType) => T): T {
  const context = useContext(LanguageContext);
  return useMemo(() => selector(context), [context, selector]);
}

// ä½¿ç”¨
const language = useLanguageSelector(ctx => ctx.language);
const t = useLanguageSelector(ctx => ctx.t);
```

**é¢„æœŸæ•ˆæœ**ï¼š
- ä¸å¿…è¦çš„é‡æ¸²æŸ“å‡å°‘ 50-70%
- Context æ›´æ–°æ€§èƒ½æå‡
- ç»„ä»¶æ¸²æŸ“æ›´é«˜æ•ˆ

---

### 6. åŠ¨ç”»æ€§èƒ½ä¼˜åŒ– ğŸŸ¡ P1

**é—®é¢˜åˆ†æ**ï¼š
- éƒ¨åˆ†åŠ¨ç”»ä½¿ç”¨ JavaScriptï¼Œåº”ä½¿ç”¨ CSS
- åŠ¨ç”»å¯èƒ½è§¦å‘é‡æ’/é‡ç»˜

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š

#### 6.1 ä½¿ç”¨ CSS åŠ¨ç”»æ›¿ä»£ JS åŠ¨ç”»

```typescript
// ä¼˜åŒ–å‰ï¼šä½¿ç”¨ JavaScript åŠ¨ç”»
const [transform, setTransform] = useState('translateY(0)');

useEffect(() => {
  const interval = setInterval(() => {
    setTransform(prev => prev === 'translateY(0)' ? 'translateY(-4px)' : 'translateY(0)');
  }, 100);
  return () => clearInterval(interval);
}, []);

<div style={{ transform }}>

// ä¼˜åŒ–åï¼šä½¿ç”¨ CSS åŠ¨ç”»
// frontend/src/components/TaskCard.module.css
@keyframes float {
  0%, 100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-4px);
  }
}

.taskCard {
  animation: float 3s ease-in-out infinite;
  will-change: transform; /* æç¤ºæµè§ˆå™¨ä¼˜åŒ– */
}
```

#### 6.2 ä½¿ç”¨ transform å’Œ opacity

```css
/* ä¼˜åŒ–ï¼šä½¿ç”¨ transform å’Œ opacityï¼ˆGPU åŠ é€Ÿï¼‰ */
.fadeIn {
  opacity: 0;
  transform: translateY(20px);
  transition: opacity 0.3s ease, transform 0.3s ease;
}

.fadeIn.visible {
  opacity: 1;
  transform: translateY(0);
}

/* é¿å…ä½¿ç”¨ left/top/width/heightï¼ˆè§¦å‘é‡æ’ï¼‰ */
```

#### 6.3 ä½¿ç”¨ will-change æç¤ºæµè§ˆå™¨

```css
.animatedElement {
  will-change: transform, opacity;
  /* æµè§ˆå™¨ä¼šæå‰ä¼˜åŒ– */
}
```

**é¢„æœŸæ•ˆæœ**ï¼š
- åŠ¨ç”»å¸§ç‡æå‡åˆ° 60 FPS
- CPU ä½¿ç”¨å‡å°‘
- åŠ¨ç”»æ›´æµç•…

---

### 7. ä»£ç åˆ†å‰²ä¼˜åŒ– ğŸŸ¡ P1

**é—®é¢˜åˆ†æ**ï¼š
- æŸäº›å¤§ç»„ä»¶ï¼ˆå¦‚ Message.tsxï¼‰å¯ä»¥è¿›ä¸€æ­¥åˆ†å‰²
- ç¬¬ä¸‰æ–¹åº“å¯ä»¥æŒ‰éœ€åŠ è½½

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š

#### 7.1 ç»„ä»¶çº§ä»£ç åˆ†å‰²

```typescript
// frontend/src/pages/Message.tsx

// ä¼˜åŒ–å‰ï¼šæ‰€æœ‰ç»„ä»¶åœ¨ä¸€ä¸ªæ–‡ä»¶
import TaskDetailModal from '../components/TaskDetailModal';
import LoginModal from '../components/LoginModal';

// ä¼˜åŒ–åï¼šæŒ‰éœ€åŠ è½½
const TaskDetailModal = lazy(() => import('../components/TaskDetailModal'));
const LoginModal = lazy(() => import('../components/LoginModal'));

// ä½¿ç”¨ Suspense åŒ…è£¹
<Suspense fallback={<div>åŠ è½½ä¸­...</div>}>
  {showTaskDetailModal && <TaskDetailModal ... />}
</Suspense>
```

#### 7.2 ç¬¬ä¸‰æ–¹åº“æŒ‰éœ€åŠ è½½

```typescript
// ä¼˜åŒ–å‰ï¼šå…¨éƒ¨å¯¼å…¥
import * as dayjs from 'dayjs';
import utc from 'dayjs/plugin/utc';
import timezone from 'dayjs/plugin/timezone';

// ä¼˜åŒ–åï¼šæŒ‰éœ€å¯¼å…¥
const loadDayjs = async () => {
  const dayjs = await import('dayjs');
  const utc = await import('dayjs/plugin/utc');
  const timezone = await import('dayjs/plugin/timezone');
  // ...
};
```

#### 7.3 è·¯ç”±çº§ä»£ç åˆ†å‰²

```typescript
// frontend/src/App.tsx

// å·²ç»å®ç°ï¼Œä½†å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–
const Home = lazyWithRetry(() => import('./pages/Home'));
const Tasks = lazyWithRetry(() => import('./pages/Tasks'));

// å¯ä»¥æ·»åŠ é¢„åŠ è½½
const preloadRoute = (routeImport: () => Promise<any>) => {
  routeImport();
};

// é¼ æ ‡æ‚¬åœæ—¶é¢„åŠ è½½
<Link
  to="/tasks"
  onMouseEnter={() => preloadRoute(() => import('./pages/Tasks'))}
>
```

**é¢„æœŸæ•ˆæœ**ï¼š
- åˆå§‹åŒ…å¤§å°è¿›ä¸€æ­¥å‡å°‘ 20-30%
- é¡µé¢åˆ‡æ¢æ›´å¿«
- æŒ‰éœ€åŠ è½½æ›´é«˜æ•ˆ

---

### 8. é¢„åŠ è½½å…³é”®èµ„æº ğŸŸ¡ P1

**é—®é¢˜åˆ†æ**ï¼š
- å…³é”®èµ„æºæœªé¢„åŠ è½½
- å­—ä½“ã€å…³é”®å›¾ç‰‡åŠ è½½æ…¢

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š

#### 8.1 åœ¨ index.html ä¸­æ·»åŠ é¢„åŠ è½½

```html
<!-- frontend/public/index.html -->
<head>
  <!-- é¢„åŠ è½½å…³é”®èµ„æº -->
  <link rel="preload" href="/static/background.jpg" as="image" />
  <link rel="preload" href="/static/favicon.png" as="image" />
  
  <!-- é¢„è¿æ¥å…³é”®åŸŸå -->
  <link rel="preconnect" href="https://api.link2ur.com" />
  <link rel="dns-prefetch" href="https://api.link2ur.com" />
  
  <!-- é¢„åŠ è½½å­—ä½“ -->
  <link rel="preload" href="/fonts/main-font.woff2" as="font" type="font/woff2" crossorigin />
</head>
```

#### 8.2 ä½¿ç”¨ React çš„ preload

```typescript
// frontend/src/App.tsx
import { useEffect } from 'react';

useEffect(() => {
  // é¢„åŠ è½½å…³é”®å›¾ç‰‡
  const preloadImages = [
    '/static/background.jpg',
    '/static/favicon.png',
  ];
  
  preloadImages.forEach(src => {
    const link = document.createElement('link');
    link.rel = 'preload';
    link.as = 'image';
    link.href = src;
    document.head.appendChild(link);
  });
}, []);
```

#### 8.3 é¢„åŠ è½½è·¯ç”±

```typescript
// åœ¨ç”¨æˆ·å¯èƒ½è®¿é—®çš„é¡µé¢é¢„åŠ è½½
useEffect(() => {
  // é¢„åŠ è½½å¯èƒ½è®¿é—®çš„é¡µé¢
  const timer = setTimeout(() => {
    import('./pages/Tasks');
    import('./pages/PublishTask');
  }, 2000); // 2ç§’åé¢„åŠ è½½
  
  return () => clearTimeout(timer);
}, []);
```

**é¢„æœŸæ•ˆæœ**ï¼š
- å…³é”®èµ„æºåŠ è½½æ›´å¿«
- é¦–å±æ¸²æŸ“æ—¶é—´å‡å°‘ 10-20%
- ç”¨æˆ·ä½“éªŒæå‡

---

### 9. Service Worker ç¼“å­˜ ğŸŸ¡ P1

**é—®é¢˜åˆ†æ**ï¼š
- ç¼ºå°‘ç¦»çº¿ç¼“å­˜ç­–ç•¥
- é‡å¤è®¿é—®æ—¶èµ„æºé‡æ–°åŠ è½½

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š

#### 9.1 åˆ›å»º Service Worker

```typescript
// frontend/public/sw.js
const CACHE_NAME = 'link2ur-v1';
const urlsToCache = [
  '/',
  '/static/favicon.png',
  '/static/background.jpg',
];

// å®‰è£… Service Worker
self.addEventListener('install', (event) => {
  event.waitUntil(
    caches.open(CACHE_NAME)
      .then((cache) => cache.addAll(urlsToCache))
  );
});

// æ‹¦æˆªè¯·æ±‚
self.addEventListener('fetch', (event) => {
  event.respondWith(
    caches.match(event.request)
      .then((response) => {
        // ç¼“å­˜å‘½ä¸­ï¼Œè¿”å›ç¼“å­˜
        if (response) {
          return response;
        }
        // ç¼“å­˜æœªå‘½ä¸­ï¼Œè¯·æ±‚ç½‘ç»œ
        return fetch(event.request).then((response) => {
          // æ£€æŸ¥å“åº”æ˜¯å¦æœ‰æ•ˆ
          if (!response || response.status !== 200 || response.type !== 'basic') {
            return response;
          }
          // å…‹éš†å“åº”
          const responseToCache = response.clone();
          caches.open(CACHE_NAME)
            .then((cache) => {
              cache.put(event.request, responseToCache);
            });
          return response;
        });
      })
  );
});
```

#### 9.2 æ³¨å†Œ Service Worker

```typescript
// frontend/src/index.tsx
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/sw.js')
      .then((registration) => {
        console.log('SW registered: ', registration);
      })
      .catch((registrationError) => {
        console.log('SW registration failed: ', registrationError);
      });
  });
}
```

**é¢„æœŸæ•ˆæœ**ï¼š
- é‡å¤è®¿é—®é€Ÿåº¦æå‡ 50-70%
- æ”¯æŒç¦»çº¿è®¿é—®
- å‡å°‘æœåŠ¡å™¨è´Ÿè½½

---

## å®æ–½ä¼˜å…ˆçº§

### ç¬¬ä¸€é˜¶æ®µï¼ˆ1-2å‘¨ï¼‰- ç«‹å³å®æ–½

1. âœ… **æ»šåŠ¨äº‹ä»¶ä¼˜åŒ–** - 1å¤©
2. âœ… **å›¾ç‰‡æ ¼å¼ä¼˜åŒ–** - 2å¤©
3. âœ… **å‡å°‘å†…è”æ ·å¼** - 3å¤©
4. âœ… **Context ä¼˜åŒ–** - 2å¤©

**é¢„æœŸæ•ˆæœ**ï¼šæ€§èƒ½æå‡ 30-40%

### ç¬¬äºŒé˜¶æ®µï¼ˆ2-4å‘¨ï¼‰- è¿‘æœŸå®æ–½

5. âœ… **ä»»åŠ¡åˆ—è¡¨è™šæ‹Ÿæ»šåŠ¨** - 5å¤©
6. âœ… **åŠ¨ç”»æ€§èƒ½ä¼˜åŒ–** - 3å¤©
7. âœ… **ä»£ç åˆ†å‰²ä¼˜åŒ–** - 3å¤©
8. âœ… **é¢„åŠ è½½å…³é”®èµ„æº** - 2å¤©

**é¢„æœŸæ•ˆæœ**ï¼šæ€§èƒ½æå‡ 20-30%

### ç¬¬ä¸‰é˜¶æ®µï¼ˆ1-2æœˆï¼‰- é•¿æœŸè§„åˆ’

9. âœ… **Service Worker ç¼“å­˜** - 5å¤©
10. âœ… **æ€§èƒ½ç›‘æ§** - 3å¤©
11. âœ… **Web Workers** - 5å¤©

**é¢„æœŸæ•ˆæœ**ï¼šæ€§èƒ½æå‡ 10-20%

---

## æ€§èƒ½ç›‘æ§ä¸æµ‹è¯•

### æ€§èƒ½æŒ‡æ ‡

ä½¿ç”¨ä»¥ä¸‹å·¥å…·ç›‘æ§æ€§èƒ½ï¼š

1. **Lighthouse**ï¼šç»¼åˆæ€§èƒ½è¯„åˆ†
2. **Web Vitals**ï¼šæ ¸å¿ƒæ€§èƒ½æŒ‡æ ‡
   - LCP (Largest Contentful Paint)ï¼š< 2.5s
   - FID (First Input Delay)ï¼š< 100ms
   - CLS (Cumulative Layout Shift)ï¼š< 0.1
3. **Chrome DevTools Performance**ï¼šè¯¦ç»†æ€§èƒ½åˆ†æ

### æµ‹è¯•æ–¹æ³•

```typescript
// frontend/src/utils/performanceMonitor.ts
export function measurePerformance(name: string, fn: () => void) {
  performance.mark(`${name}-start`);
  fn();
  performance.mark(`${name}-end`);
  performance.measure(name, `${name}-start`, `${name}-end`);
  
  const measure = performance.getEntriesByName(name)[0];
  console.log(`${name}: ${measure.duration}ms`);
}

// ä½¿ç”¨
measurePerformance('renderTasks', () => {
  renderTasks();
});
```

### æ€§èƒ½é¢„ç®—

- **JavaScript åŒ…å¤§å°**ï¼š< 500KB (gzipped)
- **CSS å¤§å°**ï¼š< 50KB (gzipped)
- **å›¾ç‰‡å¤§å°**ï¼š< 200KB per image
- **é¦–å±åŠ è½½æ—¶é—´**ï¼š< 2.0s
- **äº¤äº’å“åº”æ—¶é—´**ï¼š< 100ms

---

## æœ€ä½³å®è·µæŒ‡å—

### 1. ç»„ä»¶ä¼˜åŒ–

```typescript
// âœ… å¥½çš„åšæ³•
const MyComponent = React.memo(({ data }) => {
  const processedData = useMemo(() => {
    return expensiveProcessing(data);
  }, [data]);
  
  const handleClick = useCallback(() => {
    // å¤„ç†ç‚¹å‡»
  }, []);
  
  return <div onClick={handleClick}>{processedData}</div>;
});

// âŒ ä¸å¥½çš„åšæ³•
const MyComponent = ({ data }) => {
  const processedData = expensiveProcessing(data); // æ¯æ¬¡æ¸²æŸ“éƒ½æ‰§è¡Œ
  
  const handleClick = () => { // æ¯æ¬¡æ¸²æŸ“éƒ½åˆ›å»ºæ–°å‡½æ•°
    // å¤„ç†ç‚¹å‡»
  };
  
  return <div onClick={handleClick} style={{ color: 'red' }}>{processedData}</div>; // å†…è”æ ·å¼
};
```

### 2. å›¾ç‰‡ä¼˜åŒ–

```typescript
// âœ… å¥½çš„åšæ³•
<LazyImage
  src={imageUrl}
  srcSet={`${imageUrl}?w=400 400w, ${imageUrl}?w=800 800w`}
  sizes="(max-width: 640px) 100vw, 50vw"
  loading="lazy"
  decoding="async"
/>

// âŒ ä¸å¥½çš„åšæ³•
<img src={imageUrl} /> // ç«‹å³åŠ è½½ï¼Œæ— ä¼˜åŒ–
```

### 3. äº‹ä»¶å¤„ç†ä¼˜åŒ–

```typescript
// âœ… å¥½çš„åšæ³•
const handleScroll = useThrottledCallback(() => {
  // å¤„ç†æ»šåŠ¨
}, 100);

window.addEventListener('scroll', handleScroll, { passive: true });

// âŒ ä¸å¥½çš„åšæ³•
window.addEventListener('scroll', () => {
  // æ¯æ¬¡æ»šåŠ¨éƒ½æ‰§è¡Œï¼Œæ— èŠ‚æµ
});
```

### 4. çŠ¶æ€ç®¡ç†ä¼˜åŒ–

```typescript
// âœ… å¥½çš„åšæ³•ï¼šæ‹†åˆ† Context
const UserContext = createContext(null);
const LanguageContext = createContext('zh');

// âŒ ä¸å¥½çš„åšæ³•ï¼šä¸€ä¸ªå¤§ Context
const AppContext = createContext({
  user: null,
  language: 'zh',
  theme: 'light',
  // ... å¾ˆå¤šçŠ¶æ€
});
```

---

## æ€»ç»“

é€šè¿‡ç³»ç»Ÿæ€§çš„æ€§èƒ½ä¼˜åŒ–ï¼Œé¢„æœŸå¯ä»¥å®ç°ï¼š

- **é¦–å±åŠ è½½æ—¶é—´**ï¼šä» ~3.5s é™è‡³ < 2.0sï¼ˆç›®æ ‡ï¼š< 1.5sï¼‰
- **äº¤äº’å“åº”æ—¶é—´**ï¼š< 100ms
- **æ»šåŠ¨æµç•…åº¦**ï¼š60 FPS
- **é¡µé¢åˆ‡æ¢é€Ÿåº¦**ï¼š< 300ms
- **æ•´ä½“æ€§èƒ½æå‡**ï¼š50-70%

### å…³é”®ä¼˜åŒ–ç‚¹

1. **æ»šåŠ¨æ€§èƒ½**ï¼šä½¿ç”¨èŠ‚æµå’Œè™šæ‹Ÿæ»šåŠ¨
2. **å›¾ç‰‡ä¼˜åŒ–**ï¼šä½¿ç”¨ç°ä»£æ ¼å¼å’Œæ‡’åŠ è½½
3. **æ ·å¼ä¼˜åŒ–**ï¼šå‡å°‘å†…è”æ ·å¼ï¼Œä½¿ç”¨ CSS
4. **Context ä¼˜åŒ–**ï¼šæ‹†åˆ†å’Œä¼˜åŒ–æ›´æ–°ç­–ç•¥
5. **ä»£ç åˆ†å‰²**ï¼šæ›´ç»†ç²’åº¦çš„æ‡’åŠ è½½

### æŒç»­ä¼˜åŒ–

æ€§èƒ½ä¼˜åŒ–æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œéœ€è¦ï¼š

1. **å®šæœŸç›‘æ§**ï¼šä½¿ç”¨æ€§èƒ½ç›‘æ§å·¥å…·
2. **ç”¨æˆ·åé¦ˆ**ï¼šæ”¶é›†ç”¨æˆ·åé¦ˆ
3. **æ€§èƒ½æµ‹è¯•**ï¼šå®šæœŸè¿›è¡Œæ€§èƒ½æµ‹è¯•
4. **è¿­ä»£ä¼˜åŒ–**ï¼šæ ¹æ®æ•°æ®æŒç»­ä¼˜åŒ–

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0.0  
**æœ€åæ›´æ–°**ï¼š2025-01-XX  
**ç»´æŠ¤è€…**ï¼šå‰ç«¯å¼€å‘å›¢é˜Ÿ

