"use strict";(self.webpackChunklinku_admin=self.webpackChunklinku_admin||[]).push([[960],{7011(e,a,t){t.r(a),t.d(a,{default:()=>P});var n=t(5043),s=t(4400),i=t(446),r=t.n(i),d=t(6204),l=t(3028);const c={normal:"\u666e\u901a",vip:"VIP",super:"\u8d85\u7ea7"};var o=t(5580),_=t(8075),u=t(6427);const m="UserManagement_container__3JMs9",p="UserManagement_header__8YeLx",g="UserManagement_title__xjTVl",h="UserManagement_searchContainer__t9kNR",x="UserManagement_searchInput__C-JZR",y="UserManagement_errorMessage__KDTeu",b="UserManagement_levelSelect__qFFAO",k="UserManagement_statusBadge__XHzjN",v="UserManagement_statusBanned__7Z8Ra",f="UserManagement_statusSuspended__AXOoS",j="UserManagement_statusActive__FXIQe",M="UserManagement_statusInactive__LfQiA",w="UserManagement_inviteCode__7SiCl",U="UserManagement_inviterId__yqV1D",C="UserManagement_placeholder__oxNvX",D="UserManagement_actionGroup__rfWBL",S="UserManagement_actionBtn__9Oll4",N="UserManagement_btnDanger__To4Re",I="UserManagement_btnSuccess__EQ4+P",Y="UserManagement_btnWarning__+ikJP",A="UserManagement_btnPrimary__E239W";var R=t(579);const L=[{key:"id",label:"ID"},{key:"name",label:"\u7528\u6237\u540d"},{key:"email",label:"\u90ae\u7bb1"},{key:"user_level",label:"\u7b49\u7ea7",format:e=>c[e]||e},{key:"is_banned",label:"\u5c01\u7981",format:e=>e?"\u662f":"\u5426"},{key:"is_suspended",label:"\u6682\u505c",format:e=>e?"\u662f":"\u5426"},{key:"task_count",label:"\u4efb\u52a1\u6570"},{key:"avg_rating",label:"\u8bc4\u5206",format:e=>Number(e).toFixed(1)},{key:"created_at",label:"\u6ce8\u518c\u65f6\u95f4",format:e=>r()(e).format("YYYY-MM-DD")}],P=()=>{const[e,a]=(0,n.useState)(null),[t,i]=(0,n.useState)(null),P=(0,o.Dp)({fetchData:async e=>{let{page:a,pageSize:t,searchTerm:n}=e;const s=await(0,d.Fb)(a,t,n||void 0);return{data:s.users||[],total:(s.total_pages||1)*t}},initialPageSize:20,onError:e=>a((0,l.u1)(e))}),O=(0,o.Fb)({initialValues:{userId:"",days:1},onSubmit:async e=>{const a=new Date;a.setDate(a.getDate()+e.days),await(0,d.LD)(e.userId,{is_suspended:1,suspend_until:a.toISOString()}),s.Ay.success("\u7528\u6237\u5df2\u6682\u505c".concat(e.days,"\u5929")),P.refresh()},onError:e=>s.Ay.error((0,l.u1)(e))}),F=async(e,a)=>{i(e);try{await(0,d.LD)(e,{user_level:a}),s.Ay.success("\u7528\u6237\u7b49\u7ea7\u66f4\u65b0\u6210\u529f\uff01"),P.refresh()}catch(t){s.Ay.error((0,l.u1)(t))}finally{i(null)}},T=e=>e.is_banned?v:e.is_suspended?f:e.is_active?j:M,z=e=>e.is_banned?"\u5df2\u5c01\u7981":e.is_suspended?"\u5df2\u6682\u505c":e.is_active?"\u6b63\u5e38":"\u672a\u6fc0\u6d3b",B=[{key:"id",title:"ID",dataIndex:"id",fixed:"left",width:80},{key:"name",title:"\u7528\u6237\u540d",dataIndex:"name",fixed:"left",width:120},{key:"email",title:"\u90ae\u7bb1",dataIndex:"email",width:200},{key:"user_level",title:"\u7b49\u7ea7",width:120,render:(e,a)=>(0,R.jsx)("select",{value:a.user_level,onChange:e=>F(a.id,e.target.value),disabled:t===a.id,className:b,children:Object.entries(c).map(e=>{let[a,t]=e;return(0,R.jsx)("option",{value:a,children:t},a)})})},{key:"status",title:"\u72b6\u6001",width:100,render:(e,a)=>(0,R.jsx)("span",{className:"".concat(k," ").concat(T(a)),children:z(a)})},{key:"task_count",title:"\u4efb\u52a1\u6570",dataIndex:"task_count",width:80},{key:"avg_rating",title:"\u8bc4\u5206",width:80,render:(e,a)=>a.avg_rating.toFixed(1)},{key:"invitation_code_text",title:"\u9080\u8bf7\u7801",width:120,render:(e,a)=>a.invitation_code_text?(0,R.jsx)("span",{className:w,children:a.invitation_code_text}):(0,R.jsx)("span",{className:C,children:"-"})},{key:"inviter_id",title:"\u9080\u8bf7\u4eba",width:120,render:(e,a)=>a.inviter_id?(0,R.jsx)("span",{className:U,onClick:()=>P.setSearchTerm(a.inviter_id),title:"\u70b9\u51fb\u67e5\u770b\u9080\u8bf7\u4eba\u4fe1\u606f",children:a.inviter_id}):(0,R.jsx)("span",{className:C,children:"-"})},{key:"created_at",title:"\u6ce8\u518c\u65f6\u95f4",width:120,render:(e,a)=>r()(a.created_at).format("YYYY-MM-DD")},{key:"actions",title:"\u64cd\u4f5c",width:220,render:(e,a)=>(0,R.jsxs)("div",{className:D,children:[(0,R.jsx)("button",{onClick:()=>(async(e,a)=>{i(e);try{await(0,d.LD)(e,{is_banned:a}),s.Ay.success(a?"\u7528\u6237\u5df2\u5c01\u7981":"\u7528\u6237\u5df2\u89e3\u5c01"),P.refresh()}catch(t){s.Ay.error((0,l.u1)(t))}finally{i(null)}})(a.id,a.is_banned?0:1),disabled:t===a.id,className:"".concat(S," ").concat(a.is_banned?I:N),children:a.is_banned?"\u89e3\u5c01":"\u5c01\u7981"}),(0,R.jsx)("button",{onClick:()=>a.is_suspended?(async(e,a)=>{i(e);try{await(0,d.LD)(e,{is_suspended:a}),s.Ay.success(a?"\u7528\u6237\u5df2\u6682\u505c":"\u7528\u6237\u5df2\u6062\u590d"),P.refresh()}catch(t){s.Ay.error((0,l.u1)(t))}finally{i(null)}})(a.id,0):O.open({userId:a.id,days:1}),disabled:t===a.id,className:"".concat(S," ").concat(a.is_suspended?I:Y),children:a.is_suspended?"\u6062\u590d":"\u6682\u505c"}),(0,R.jsx)("button",{onClick:()=>F(a.id,"normal"),disabled:t===a.id,className:"".concat(S," ").concat(A),children:"\u91cd\u7f6e\u7b49\u7ea7"})]})}];return(0,R.jsxs)("div",{className:m,children:[(0,R.jsxs)("div",{className:p,children:[(0,R.jsx)("h2",{className:g,children:"\u7528\u6237\u7ba1\u7406"}),(0,R.jsx)("button",{onClick:()=>{(0,u.G)(P.data,"users-".concat(r()().format("YYYY-MM-DD")),L)},disabled:0===P.data.length,style:{padding:"8px 16px",border:"1px solid #52c41a",background:"white",color:"#52c41a",borderRadius:"4px",cursor:"pointer",fontSize:"14px"},children:"\u5bfc\u51fa CSV"})]}),(0,R.jsx)("div",{className:h,children:(0,R.jsx)("input",{type:"text",placeholder:"\u641c\u7d22\u7528\u6237ID\u3001\u7528\u6237\u540d\u6216\u90ae\u7bb1...",value:P.searchTerm,onChange:e=>P.setSearchTerm(e.target.value),className:x})}),e&&(0,R.jsx)("div",{className:y,children:e}),(0,R.jsx)(_.G8,{columns:B,data:P.data,loading:P.loading,rowKey:"id",emptyText:"\u6682\u65e0\u7528\u6237\u6570\u636e"}),(0,R.jsx)(_.E1,{currentPage:P.currentPage,totalPages:P.totalPages,total:P.total,pageSize:P.pageSize,onPageChange:P.setCurrentPage}),(0,R.jsx)(_.lM,{isOpen:O.isOpen,onClose:O.close,title:"\u6682\u505c\u7528\u6237",footer:(0,R.jsxs)("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:[(0,R.jsx)("button",{onClick:O.close,style:{padding:"8px 16px",border:"1px solid #d9d9d9",borderRadius:"4px",cursor:"pointer",background:"white"},children:"\u53d6\u6d88"}),(0,R.jsx)("button",{onClick:O.handleSubmit,disabled:O.loading,style:{padding:"8px 16px",border:"none",borderRadius:"4px",cursor:"pointer",background:"#faad14",color:"white"},children:O.loading?"\u5904\u7406\u4e2d...":"\u786e\u8ba4\u6682\u505c"})]}),children:(0,R.jsxs)("div",{style:{padding:"8px 0"},children:[(0,R.jsx)("label",{style:{display:"block",marginBottom:"8px",fontWeight:"500"},children:"\u6682\u505c\u5929\u6570"}),(0,R.jsx)("input",{type:"number",min:"1",max:"365",value:O.formData.days,onChange:e=>O.updateField("days",parseInt(e.target.value)||1),style:{width:"100%",padding:"8px",border:"1px solid #d9d9d9",borderRadius:"4px",fontSize:"14px"}})]})})]})}},6427(e,a,t){function n(e,a,t){const n=[t.map(e=>'"'.concat(e.label,'"')).join(","),...e.map(e=>t.map(a=>{const t=a.format?a.format(e[a.key],e):e[a.key],n=null==t?"":String(t);return'"'.concat(n.replace(/"/g,'""'),'"')}).join(","))].join("\r\n"),s=new Blob(["\ufeff"+n],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(s),r=document.createElement("a");r.href=i,r.download="".concat(a,".csv"),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i)}t.d(a,{G:()=>n})}}]);
//# sourceMappingURL=960.f70d5687.chunk.js.map