"use strict";(self.webpackChunklinku_admin=self.webpackChunklinku_admin||[]).push([[835],{6835(e,s,a){a.r(s),a.d(s,{default:()=>O});var r=a(5043),t=a(4400),n=a(1180),l=a(5231),i=a(7734),d=a(2185),o=a(6026),c=a(3670),u=a(435),h=a(6204),_=a(3028);const m="Dashboard_dashboardSection__bm5b-",x="Dashboard_dashboardHeader__fXa7U",b="Dashboard_dashboardTitle__NHJY7",j="Dashboard_statsGrid__Kn0ni",f="Dashboard_statCard__FFN3H",p="Dashboard_statLabel__6i+GI",v="Dashboard_statValue__3956s",y="Dashboard_cleanupBtn__m+Q12",g="Dashboard_spinner__GGlJu",N="Dashboard_loadingContainer__HSmiu",k="Dashboard_errorContainer__5MzM-",D="Dashboard_errorMessage__aRBdz",S="Dashboard_retryBtn__vBq0r",w="Dashboard_periodBtn__AxUOq",C="Dashboard_periodBtnActive__PD8Cv",A="Dashboard_chartsGrid__-db7p",z="Dashboard_chartCard__DDF7z",F="Dashboard_chartTitle__Xj5LZ",B="Dashboard_chartLoading__nzNRM";var E=a(579);const R=e=>{let{label:s,value:a,prefix:r="",suffix:t=""}=e;return(0,E.jsxs)("div",{className:f,children:[(0,E.jsx)("h3",{className:p,children:s}),(0,E.jsxs)("p",{className:v,children:[r,"number"===typeof a?a.toLocaleString():a,t]})]})},K={"7d":"7\u5929","30d":"30\u5929","90d":"90\u5929"},O=()=>{const[e,s]=(0,r.useState)(null),[a,f]=(0,r.useState)(!0),[p,v]=(0,r.useState)(null),[O,W]=(0,r.useState)(!1),[G,L]=(0,r.useState)("30d"),[M,H]=(0,r.useState)([]),[J,T]=(0,r.useState)([]),[q,I]=(0,r.useState)(!1),P=(0,r.useCallback)(async()=>{f(!0),v(null);try{const e=await(0,h.wx)();s(e)}catch(e){const s=(0,_.u1)(e);v(s),console.error("Failed to load dashboard stats:",e)}finally{f(!1)}},[]),Q=(0,r.useCallback)(async()=>{I(!0);try{const[e,s]=await Promise.all([(0,h.Qq)(G),(0,h.gf)(G)]);H(e),T(s)}catch(e){t.Ay.warning("\u8d8b\u52bf\u6570\u636e\u52a0\u8f7d\u5931\u8d25: "+(0,_.u1)(e))}finally{I(!1)}},[G]);(0,r.useEffect)(()=>{P()},[P]),(0,r.useEffect)(()=>{Q()},[Q]);const U=(0,r.useCallback)(async()=>{if(window.confirm("\u786e\u5b9a\u8981\u6e05\u7406\u6240\u6709\u5df2\u5b8c\u6210\u6216\u5df2\u53d6\u6d88\u4efb\u52a1\u7684\u6240\u6709\u56fe\u7247\u548c\u6587\u4ef6\u5417\uff1f\n\n\u6e05\u7406\u5185\u5bb9\u5305\u62ec\uff1a\n- \u516c\u5f00\u56fe\u7247\uff08\u4efb\u52a1\u76f8\u5173\u56fe\u7247\uff09\n- \u79c1\u5bc6\u56fe\u7247\uff08\u4efb\u52a1\u804a\u5929\u56fe\u7247\uff09\n- \u79c1\u5bc6\u6587\u4ef6\uff08\u4efb\u52a1\u804a\u5929\u6587\u4ef6\uff09\n\n\u6ce8\u610f\uff1a\u5c06\u6e05\u7406\u6240\u6709\u5df2\u5b8c\u6210\u6216\u5df2\u53d6\u6d88\u7684\u4efb\u52a1\uff0c\u4e0d\u68c0\u67e5\u65f6\u95f4\u9650\u5236\uff01\n\u6b64\u64cd\u4f5c\u4e0d\u53ef\u6062\u590d\uff01")){W(!0);try{const e=await h.Ay.post("/api/admin/cleanup/all-old-tasks");e.data.success?(t.Ay.success(e.data.message),P()):t.Ay.error("\u6e05\u7406\u5931\u8d25")}catch(p){t.Ay.error((0,_.u1)(p))}finally{W(!1)}}},[P]),X=(0,r.useMemo)(()=>e?(0,E.jsxs)("div",{className:j,children:[(0,E.jsx)(R,{label:"\u603b\u7528\u6237\u6570",value:e.total_users}),(0,E.jsx)(R,{label:"\u603b\u4efb\u52a1\u6570",value:e.total_tasks}),(0,E.jsx)(R,{label:"\u5ba2\u670d\u6570\u91cf",value:e.total_customer_service}),(0,E.jsx)(R,{label:"\u6d3b\u8dc3\u4f1a\u8bdd",value:e.active_sessions}),(0,E.jsx)(R,{label:"\u603b\u6536\u5165",value:e.total_revenue.toFixed(2),prefix:"\xa3"}),(0,E.jsx)(R,{label:"\u5e73\u5747\u8bc4\u5206",value:e.avg_rating.toFixed(1)})]}):null,[e]);return a?(0,E.jsxs)("div",{className:N,children:[(0,E.jsx)("span",{className:g,style:{width:"24px",height:"24px",borderWidth:"3px"}}),(0,E.jsx)("span",{style:{marginLeft:"12px"},children:"\u52a0\u8f7d\u4e2d..."})]}):p?(0,E.jsxs)("div",{className:k,children:[(0,E.jsxs)("span",{className:D,children:["\u52a0\u8f7d\u5931\u8d25: ",p]}),(0,E.jsx)("button",{className:S,onClick:P,children:"\u91cd\u8bd5"})]}):(0,E.jsxs)("div",{className:m,children:[(0,E.jsxs)("div",{className:x,children:[(0,E.jsx)("h2",{className:b,children:"\u6570\u636e\u6982\u89c8"}),(0,E.jsxs)("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[["7d","30d","90d"].map(e=>(0,E.jsx)("button",{onClick:()=>L(e),className:"".concat(w," ").concat(G===e?C:""),children:K[e]},e)),(0,E.jsx)("button",{onClick:U,disabled:O,className:y,children:O?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("span",{className:g}),"\u6e05\u7406\u4e2d..."]}):(0,E.jsx)(E.Fragment,{children:"\ud83d\uddd1\ufe0f \u4e00\u952e\u6e05\u7406\u5df2\u5b8c\u6210\u548c\u8fc7\u671f\u4efb\u52a1\u6587\u4ef6"})})]})]}),X,(0,E.jsxs)("div",{className:A,children:[(0,E.jsxs)("div",{className:z,children:[(0,E.jsx)("h3",{className:F,children:"\ud83d\udcc8 \u7528\u6237\u6ce8\u518c\u8d8b\u52bf"}),q?(0,E.jsx)("div",{className:B,children:"\u52a0\u8f7d\u4e2d..."}):(0,E.jsx)(n.u,{width:"100%",height:240,children:(0,E.jsxs)(l.b,{data:M,margin:{top:5,right:20,left:0,bottom:5},children:[(0,E.jsx)(i.d,{strokeDasharray:"3 3"}),(0,E.jsx)(d.W,{dataKey:"date",tick:{fontSize:11}}),(0,E.jsx)(o.h,{tick:{fontSize:11}}),(0,E.jsx)(c.m,{}),(0,E.jsx)(u.N1,{type:"monotone",dataKey:"count",stroke:"#1890ff",dot:!1,strokeWidth:2,name:"\u65b0\u589e\u7528\u6237"})]})})]}),(0,E.jsxs)("div",{className:z,children:[(0,E.jsx)("h3",{className:F,children:"\ud83d\udcca \u4efb\u52a1\u53d1\u5e03\u8d8b\u52bf"}),q?(0,E.jsx)("div",{className:B,children:"\u52a0\u8f7d\u4e2d..."}):(0,E.jsx)(n.u,{width:"100%",height:240,children:(0,E.jsxs)(l.b,{data:J,margin:{top:5,right:20,left:0,bottom:5},children:[(0,E.jsx)(i.d,{strokeDasharray:"3 3"}),(0,E.jsx)(d.W,{dataKey:"date",tick:{fontSize:11}}),(0,E.jsx)(o.h,{tick:{fontSize:11}}),(0,E.jsx)(c.m,{}),(0,E.jsx)(u.N1,{type:"monotone",dataKey:"count",stroke:"#52c41a",dot:!1,strokeWidth:2,name:"\u65b0\u589e\u4efb\u52a1"})]})})]})]})]})}},3028(e,s,a){a.d(s,{u1:()=>r});const r=e=>{var s;if("ERR_NETWORK"===(null===e||void 0===e?void 0:e.code)||"Network Error"===(null===e||void 0===e?void 0:e.message))return"\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u8fde\u63a5";if("ECONNABORTED"===(null===e||void 0===e?void 0:e.code)||null!==e&&void 0!==e&&null!==(s=e.message)&&void 0!==s&&s.includes("timeout"))return"\u8bf7\u6c42\u8d85\u65f6\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5";if(null!==e&&void 0!==e&&e.response){const s=e.response.status,a=e.response.data||{};switch(s){case 400:return t(a)||"\u8bf7\u6c42\u53c2\u6570\u9519\u8bef\uff0c\u8bf7\u68c0\u67e5\u8f93\u5165";case 401:return"\u8bf7\u5148\u767b\u5f55";case 403:return t(a)||"\u6ca1\u6709\u6743\u9650\u6267\u884c\u6b64\u64cd\u4f5c";case 404:return t(a)||"\u8d44\u6e90\u4e0d\u5b58\u5728";case 409:return t(a)||"\u8d44\u6e90\u51b2\u7a81\uff0c\u8bf7\u68c0\u67e5\u662f\u5426\u91cd\u590d\u64cd\u4f5c";case 429:const r=e.response.headers["retry-after"]||e.response.headers["Retry-After"];return r?"\u8bf7\u6c42\u8fc7\u4e8e\u9891\u7e41\uff0c\u8bf7\u5728 ".concat(r," \u79d2\u540e\u91cd\u8bd5"):t(a)||"\u8bf7\u6c42\u8fc7\u4e8e\u9891\u7e41\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5";case 500:return"\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5";case 502:return"\u7f51\u5173\u9519\u8bef\uff0c\u670d\u52a1\u6682\u65f6\u4e0d\u53ef\u7528";case 503:return"\u670d\u52a1\u6682\u65f6\u4e0d\u53ef\u7528\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5";default:return t(a)||"\u64cd\u4f5c\u5931\u8d25 (".concat(s,")\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5")}}return null!==e&&void 0!==e&&e.message?e.message:"\u64cd\u4f5c\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5"},t=e=>{if(e.message)return e.message;if(e.detail){if("string"===typeof e.detail)return e.detail;if(Array.isArray(e.detail))return e.detail.map(e=>"string"===typeof e?e:e.msg||e.message||JSON.stringify(e)).join("\uff1b");if("object"===typeof e.detail)return e.detail.msg||e.detail.message||JSON.stringify(e.detail)}return e.errors&&Array.isArray(e.errors)?e.errors.join("\uff1b"):e.error?e.error:null}}}]);
//# sourceMappingURL=835.1fa99db9.chunk.js.map