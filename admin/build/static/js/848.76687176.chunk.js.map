{"version":3,"file":"static/js/848.76687176.chunk.js","mappings":"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","sources":["pages/admin/notifications/NotificationManagement.tsx","utils/errorHandler.ts"],"sourcesContent":["import React, { useState, useCallback } from 'react';\r\nimport { message } from 'antd';\r\nimport { sendAdminNotification } from '../../../api';\r\nimport { getErrorMessage } from '../../../utils/errorHandler';\r\n\r\ninterface NotificationForm {\r\n  title: string;\r\n  content: string;\r\n  user_ids: string[];\r\n}\r\n\r\nconst initialForm: NotificationForm = {\r\n  title: '',\r\n  content: '',\r\n  user_ids: [],\r\n};\r\n\r\n/**\r\n * 通知管理组件\r\n * 发送通知给用户\r\n */\r\nconst NotificationManagement: React.FC = () => {\r\n  const [loading, setLoading] = useState(false);\r\n  const [form, setForm] = useState<NotificationForm>(initialForm);\r\n\r\n  const handleSendNotification = useCallback(async () => {\r\n    if (!form.title || !form.content) {\r\n      message.warning('请填写通知标题和内容');\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    try {\r\n      await sendAdminNotification({\r\n        title: form.title,\r\n        content: form.content,\r\n        user_ids: form.user_ids.length > 0 ? form.user_ids : [],\r\n      });\r\n      message.success('通知发送成功！');\r\n      setForm(initialForm);\r\n    } catch (error: any) {\r\n      message.error(getErrorMessage(error));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [form]);\r\n\r\n  const handleUserIdsChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const ids = e.target.value.split(',').map(id => id.trim()).filter(id => id.length > 0);\r\n    setForm(prev => ({ ...prev, user_ids: ids }));\r\n  }, []);\r\n\r\n  const handleReset = useCallback(() => {\r\n    setForm(initialForm);\r\n  }, []);\r\n\r\n  return (\r\n    <div style={{ padding: '0' }}>\r\n      <h2 style={{ marginBottom: '20px' }}>发送通知</h2>\r\n\r\n      <div style={{\r\n        background: 'white',\r\n        padding: '24px',\r\n        borderRadius: '8px',\r\n        boxShadow: '0 2px 4px rgba(0,0,0,0.1)',\r\n        marginBottom: '20px',\r\n      }}>\r\n        <div style={{ marginBottom: '20px' }}>\r\n          <label style={{ display: 'block', marginBottom: '8px', fontWeight: '600' }}>\r\n            通知标题：\r\n          </label>\r\n          <input\r\n            type=\"text\"\r\n            placeholder=\"请输入通知标题\"\r\n            value={form.title}\r\n            onChange={(e) => setForm(prev => ({ ...prev, title: e.target.value }))}\r\n            style={{\r\n              width: '100%',\r\n              padding: '10px 14px',\r\n              border: '1px solid #d9d9d9',\r\n              borderRadius: '6px',\r\n              fontSize: '14px',\r\n            }}\r\n          />\r\n        </div>\r\n\r\n        <div style={{ marginBottom: '20px' }}>\r\n          <label style={{ display: 'block', marginBottom: '8px', fontWeight: '600' }}>\r\n            通知内容：\r\n          </label>\r\n          <textarea\r\n            placeholder=\"请输入通知内容\"\r\n            value={form.content}\r\n            onChange={(e) => setForm(prev => ({ ...prev, content: e.target.value }))}\r\n            rows={6}\r\n            style={{\r\n              width: '100%',\r\n              padding: '10px 14px',\r\n              border: '1px solid #d9d9d9',\r\n              borderRadius: '6px',\r\n              fontSize: '14px',\r\n              resize: 'vertical',\r\n            }}\r\n          />\r\n        </div>\r\n\r\n        <div style={{ marginBottom: '20px' }}>\r\n          <label style={{ display: 'block', marginBottom: '8px', fontWeight: '600' }}>\r\n            目标用户ID（留空发送给所有用户）：\r\n          </label>\r\n          <input\r\n            type=\"text\"\r\n            placeholder=\"用逗号分隔多个用户ID，如：1,2,3\"\r\n            onChange={handleUserIdsChange}\r\n            style={{\r\n              width: '100%',\r\n              padding: '10px 14px',\r\n              border: '1px solid #d9d9d9',\r\n              borderRadius: '6px',\r\n              fontSize: '14px',\r\n            }}\r\n          />\r\n          <small style={{ color: '#666', fontSize: '12px', marginTop: '4px', display: 'block' }}>\r\n            提示：留空用户ID将发送给所有用户，填写用户ID将只发送给指定用户\r\n          </small>\r\n        </div>\r\n\r\n        <div style={{ display: 'flex', gap: '12px' }}>\r\n          <button\r\n            onClick={handleSendNotification}\r\n            disabled={loading || !form.title || !form.content}\r\n            style={{\r\n              padding: '10px 24px',\r\n              border: 'none',\r\n              borderRadius: '6px',\r\n              background: '#007bff',\r\n              color: 'white',\r\n              fontSize: '14px',\r\n              fontWeight: '500',\r\n              cursor: loading || !form.title || !form.content ? 'not-allowed' : 'pointer',\r\n              opacity: loading || !form.title || !form.content ? 0.6 : 1,\r\n            }}\r\n          >\r\n            {loading ? '发送中...' : '发送通知'}\r\n          </button>\r\n          <button\r\n            onClick={handleReset}\r\n            style={{\r\n              padding: '10px 24px',\r\n              border: '1px solid #d9d9d9',\r\n              borderRadius: '6px',\r\n              background: 'white',\r\n              color: '#333',\r\n              fontSize: '14px',\r\n              cursor: 'pointer',\r\n            }}\r\n          >\r\n            清空表单\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <div style={{\r\n        background: '#e7f3ff',\r\n        padding: '16px 20px',\r\n        borderRadius: '8px',\r\n        border: '1px solid #b3d7ff',\r\n      }}>\r\n        <h4 style={{ margin: '0 0 12px 0', color: '#0056b3' }}>通知发送说明：</h4>\r\n        <ul style={{ margin: 0, paddingLeft: '20px', color: '#333' }}>\r\n          <li>通知标题和内容为必填项</li>\r\n          <li>用户ID留空时，通知将发送给所有用户</li>\r\n          <li>填写用户ID时，通知只发送给指定用户</li>\r\n          <li>多个用户ID用逗号分隔，如：1,2,3</li>\r\n          <li>发送后用户将在通知中心收到此消息</li>\r\n        </ul>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default NotificationManagement;\r\n","/**\r\n * 统一错误处理工具\r\n * 提供友好的错误提示，统一错误处理逻辑\r\n */\r\n\r\nexport interface ErrorResponse {\r\n  detail?: string | string[] | { msg?: string; message?: string };\r\n  message?: string;\r\n  error?: string;\r\n  errors?: string[];\r\n}\r\n\r\n/**\r\n * 获取友好的错误消息\r\n * @param error 错误对象\r\n * @returns 友好的错误消息\r\n */\r\nexport const getErrorMessage = (error: any): string => {\r\n  // 处理网络错误\r\n  if (error?.code === 'ERR_NETWORK' || error?.message === 'Network Error') {\r\n    return '网络错误，请检查网络连接';\r\n  }\r\n\r\n  // 处理超时错误\r\n  if (error?.code === 'ECONNABORTED' || error?.message?.includes('timeout')) {\r\n    return '请求超时，请稍后重试';\r\n  }\r\n\r\n  // 处理HTTP响应错误\r\n  if (error?.response) {\r\n    const status = error.response.status;\r\n    const data: ErrorResponse = error.response.data || {};\r\n    \r\n    switch (status) {\r\n      case 400:\r\n        return parseErrorDetail(data) || '请求参数错误，请检查输入';\r\n      case 401:\r\n        return '请先登录';\r\n      case 403:\r\n        return parseErrorDetail(data) || '没有权限执行此操作';\r\n      case 404:\r\n        return parseErrorDetail(data) || '资源不存在';\r\n      case 409:\r\n        return parseErrorDetail(data) || '资源冲突，请检查是否重复操作';\r\n      case 429:\r\n        const retryAfter = error.response.headers['retry-after'] || error.response.headers['Retry-After'];\r\n        if (retryAfter) {\r\n          return `请求过于频繁，请在 ${retryAfter} 秒后重试`;\r\n        }\r\n        return parseErrorDetail(data) || '请求过于频繁，请稍后再试';\r\n      case 500:\r\n        return '服务器错误，请稍后再试';\r\n      case 502:\r\n        return '网关错误，服务暂时不可用';\r\n      case 503:\r\n        return '服务暂时不可用，请稍后重试';\r\n      default:\r\n        return parseErrorDetail(data) || `操作失败 (${status})，请稍后再试`;\r\n    }\r\n  }\r\n  \r\n  // 处理普通错误消息\r\n  if (error?.message) {\r\n    return error.message;\r\n  }\r\n  \r\n  // 默认错误消息\r\n  return '操作失败，请稍后再试';\r\n};\r\n\r\n/**\r\n * 解析错误详情\r\n * @param data 错误响应数据\r\n * @returns 错误消息字符串\r\n */\r\nconst parseErrorDetail = (data: ErrorResponse): string | null => {\r\n  // 优先使用 message 字段\r\n  if (data.message) {\r\n    return data.message;\r\n  }\r\n\r\n  // 然后尝试 detail 字段\r\n  if (data.detail) {\r\n    if (typeof data.detail === 'string') {\r\n      return data.detail;\r\n    }\r\n    if (Array.isArray(data.detail)) {\r\n      return data.detail.map((item: any) => {\r\n        if (typeof item === 'string') {\r\n          return item;\r\n        }\r\n        return item.msg || item.message || JSON.stringify(item);\r\n      }).join('；');\r\n    }\r\n    if (typeof data.detail === 'object') {\r\n      return data.detail.msg || data.detail.message || JSON.stringify(data.detail);\r\n    }\r\n  }\r\n\r\n  // 尝试 errors 数组\r\n  if (data.errors && Array.isArray(data.errors)) {\r\n    return data.errors.join('；');\r\n  }\r\n\r\n  // 尝试 error 字段\r\n  if (data.error) {\r\n    return data.error;\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\n/**\r\n * 判断错误是否可重试\r\n * @param error 错误对象\r\n * @returns 是否可重试\r\n */\r\nexport const isRetryableError = (error: any): boolean => {\r\n  if (!error?.response) {\r\n    // 网络错误可以重试\r\n    return error?.code === 'ERR_NETWORK' || error?.message === 'Network Error';\r\n  }\r\n\r\n  const status = error.response.status;\r\n  // 5xx 错误和 429 错误可以重试\r\n  return status >= 500 || status === 429;\r\n};\r\n\r\n/**\r\n * 获取重试延迟时间（毫秒）\r\n * @param error 错误对象\r\n * @param attempt 当前重试次数\r\n * @returns 延迟时间（毫秒）\r\n */\r\nexport const getRetryDelay = (error: any, attempt: number = 1): number => {\r\n  // 如果有 Retry-After 头，使用它\r\n  const retryAfter = error?.response?.headers?.['retry-after'] || \r\n                     error?.response?.headers?.['Retry-After'];\r\n  if (retryAfter) {\r\n    return parseInt(retryAfter, 10) * 1000;\r\n  }\r\n\r\n  // 指数退避：1s, 2s, 4s, 8s...\r\n  return Math.min(1000 * Math.pow(2, attempt - 1), 8000);\r\n};\r\n\r\n/**\r\n * 记录错误（用于错误监控）\r\n * @param error 错误对象\r\n * @param context 错误上下文\r\n */\r\nexport const logError = (error: any, context?: Record<string, any>): void => {\r\n  const errorMessage = getErrorMessage(error);\r\n  const errorInfo = {\r\n    message: errorMessage,\r\n    status: error?.response?.status,\r\n    url: error?.config?.url || error?.request?.url,\r\n    method: error?.config?.method,\r\n    context,\r\n    timestamp: new Date().toISOString(),\r\n  };\r\n\r\n  // 在生产环境中，可以发送到错误监控服务（如 Sentry）\r\n  if (process.env.NODE_ENV === 'production') {\r\n    // TODO: 集成错误监控服务\r\n    // Sentry.captureException(error, { extra: errorInfo });\r\n    // 错误信息已记录，可用于错误监控服务\r\n  } else {\r\n    // 开发环境：错误信息已记录\r\n    // 如需调试，可在此处添加日志输出\r\n  }\r\n};\r\n\r\n"],"names":["initialForm","title","content","user_ids","NotificationManagement","loading","setLoading","useState","form","setForm","handleSendNotification","useCallback","async","sendAdminNotification","length","message","success","error","getErrorMessage","warning","handleUserIdsChange","e","ids","target","value","split","map","id","trim","filter","prev","_objectSpread","handleReset","_jsxs","style","padding","children","_jsx","marginBottom","background","borderRadius","boxShadow","display","fontWeight","type","placeholder","onChange","width","border","fontSize","rows","resize","color","marginTop","gap","onClick","disabled","cursor","opacity","margin","paddingLeft","_error$message","code","includes","response","status","data","parseErrorDetail","retryAfter","headers","concat","detail","Array","isArray","item","msg","JSON","stringify","join","errors"],"sourceRoot":""}