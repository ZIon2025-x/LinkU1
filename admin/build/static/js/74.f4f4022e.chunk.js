"use strict";(self.webpackChunklinku_admin=self.webpackChunklinku_admin||[]).push([[74],{5833(e,i,t){t.r(i),t.d(i,{default:()=>v});var o=t(5043),l=t(4400),r=t(5580),n=t(8075),d=t(6204),a=t(3028),s=t(4558);function c(e){if(!e||"string"!==typeof e||""===e.trim())return"";const i=e.trim();if(i.startsWith("http://")||i.startsWith("https://"))return i;const t=(i.startsWith("/uploads")?s.QR:s.JR).replace(/\/$/,""),o=i.startsWith("/")?i:"/".concat(i);return"".concat(t).concat(o)}var p=t(9379),h=t(1686),u=t(579);const x=e=>{let{src:i,alt:t,className:l,placeholder:r="/placeholder.png",width:n,height:d,style:a,onLoad:s,onError:c,onClick:x,title:g,onMouseEnter:v,onMouseLeave:b,rootMargin:y="50px"}=e;const[m,f]=(0,o.useState)(!1),[j,k]=(0,o.useState)(!1),[w,_]=(0,o.useState)(!1),C=(0,o.useRef)(null);(0,o.useEffect)(()=>{if("absolute"===(null===a||void 0===a?void 0:a.position))return void k(!0);if(!("IntersectionObserver"in window))return void k(!0);const e=new IntersectionObserver(i=>{i.forEach(i=>{i.isIntersecting&&(k(!0),e.disconnect())})},{rootMargin:y,threshold:.01});return C.current&&e.observe(C.current),()=>{C.current&&e.unobserve(C.current),e.disconnect()}},[y,null===a||void 0===a?void 0:a.position]);if(w&&r)return(0,u.jsx)("div",{ref:C,style:(0,p.A)({position:"relative",width:n||"100%",height:d||"auto",overflow:"hidden"},a),className:l,children:(0,u.jsx)("img",{src:r,alt:t,width:n,height:d,loading:"lazy",style:{width:"100%",height:"100%",maxWidth:"100%",maxHeight:"100%",objectFit:"cover",display:"block"}})});const B=n&&d,z="absolute"===(null===a||void 0===a?void 0:a.position),R=["position","top","left","right","bottom","objectFit","objectPosition","opacity","zIndex","minWidth","minHeight","maxWidth","maxHeight","width","height"],S={position:"relative",width:z?"100%":(null===a||void 0===a?void 0:a.width)||n||"100%",height:z?"100%":(null===a||void 0===a?void 0:a.height)||(B?d:d||"auto"),overflow:"hidden",borderRadius:(null===a||void 0===a?void 0:a.borderRadius)||void 0};if(a){Object.keys(a).forEach(e=>{if(!R.includes(e)&&"borderRadius"!==e&&"width"!==e&&"height"!==e){const i=a[e];void 0!==i&&(S[e]=i)}})}const W={opacity:m?void 0!==(null===a||void 0===a?void 0:a.opacity)?a.opacity:1:0,transition:"opacity 0.3s ease-in-out",width:z&&(null===a||void 0===a?void 0:a.width)||"100%",height:z&&(null===a||void 0===a?void 0:a.height)||"100%",maxWidth:"100%",maxHeight:"100%",objectFit:(null===a||void 0===a?void 0:a.objectFit)||"cover",objectPosition:(null===a||void 0===a?void 0:a.objectPosition)||"center",display:"block"};return z&&(W.position="absolute",void 0!==(null===a||void 0===a?void 0:a.top)&&(W.top=a.top),void 0!==(null===a||void 0===a?void 0:a.left)&&(W.left=a.left),void 0!==(null===a||void 0===a?void 0:a.right)&&(W.right=a.right),void 0!==(null===a||void 0===a?void 0:a.bottom)&&(W.bottom=a.bottom),void 0!==(null===a||void 0===a?void 0:a.zIndex)&&(W.zIndex=a.zIndex),void 0!==(null===a||void 0===a?void 0:a.minWidth)&&(W.minWidth=a.minWidth),void 0!==(null===a||void 0===a?void 0:a.minHeight)&&(W.minHeight=a.minHeight)),(0,u.jsxs)("div",{ref:C,style:S,className:l,children:[!j&&(0,u.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#f0f0f0"},children:(0,u.jsx)(h.A,{size:"small"})}),j&&(0,u.jsx)("img",{src:i,alt:t,width:n,height:d,loading:"lazy",onLoad:()=>{f(!0),s&&s()},onError:e=>{_(!0),c&&c(e)},style:W})]})},g={title:"",subtitle:"",image_url:"",link_url:"",link_type:"internal",order:0,is_active:!0},v=()=>{const[e,i]=(0,o.useState)(!1),t=(0,o.useCallback)(async e=>{let{page:i,pageSize:t}=e;const o=await(0,d.LV)({page:i,limit:t});return{data:o.data||o.items||[],total:o.total||0}},[]),s=(0,r.Dp)({fetchData:t,initialPageSize:20,onError:e=>l.Ay.error((0,a.u1)(e))}),p=(0,r.Fb)({initialValues:g,onSubmit:async(e,i)=>{if(!e.title||!e.image_url)throw l.Ay.warning("\u8bf7\u586b\u5199\u6807\u9898\u548c\u4e0a\u4f20\u56fe\u7247"),new Error("validation");const t={title:e.title,subtitle:e.subtitle||void 0,image_url:e.image_url,link_url:e.link_url||void 0,link_type:e.link_type,order:e.order,is_active:e.is_active};i&&e.id?(await(0,d.cQ)(e.id,t),l.Ay.success("Banner \u66f4\u65b0\u6210\u529f\uff01")):(await(0,d.Zt)(t),l.Ay.success("Banner \u521b\u5efa\u6210\u529f\uff01")),s.refresh()},onError:e=>{"validation"!==(null===e||void 0===e?void 0:e.message)&&l.Ay.error((0,a.u1)(e))}}),h=(0,o.useCallback)(async e=>{var t;const o=null===(t=e.target.files)||void 0===t?void 0:t[0];if(o){i(!0);try{const e=await(0,d.TC)(o);p.updateField("image_url",e.url),l.Ay.success("\u56fe\u7247\u4e0a\u4f20\u6210\u529f")}catch(r){l.Ay.error((0,a.u1)(r))}finally{i(!1)}}},[p]),v=(0,o.useCallback)(e=>{p.open({id:e.id,title:e.title,subtitle:e.subtitle||"",image_url:e.image_url,link_url:e.link_url||"",link_type:e.link_type,order:e.order,is_active:e.is_active})},[p]),b=(0,o.useCallback)(e=>{window.confirm("\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u4e2a Banner \u5417\uff1f")&&(0,d.Oe)(e).then(()=>{l.Ay.success("Banner \u5220\u9664\u6210\u529f\uff01"),s.refresh()}).catch(e=>l.Ay.error((0,a.u1)(e)))},[s]),y=(0,o.useCallback)(async(e,i)=>{try{await(0,d.fz)(e),l.Ay.success(i?"Banner \u5df2\u7981\u7528":"Banner \u5df2\u542f\u7528"),s.refresh()}catch(t){l.Ay.error((0,a.u1)(t))}},[s]),m=(0,u.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px"},children:[(0,u.jsx)("button",{onClick:p.close,style:{padding:"8px 16px",border:"1px solid #d9d9d9",borderRadius:"4px",background:"white",cursor:"pointer"},children:"\u53d6\u6d88"}),(0,u.jsx)("button",{onClick:p.handleSubmit,disabled:p.loading,style:{padding:"8px 16px",border:"none",borderRadius:"4px",background:"#007bff",color:"white",cursor:p.loading?"not-allowed":"pointer",opacity:p.loading?.7:1},children:p.loading?"\u63d0\u4ea4\u4e2d...":p.isEdit?"\u66f4\u65b0":"\u521b\u5efa"})]});return(0,u.jsxs)("div",{children:[(0,u.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[(0,u.jsx)("h2",{style:{margin:0},children:"Banner \u7ba1\u7406"}),(0,u.jsx)("button",{onClick:()=>p.open(),style:{padding:"10px 20px",border:"none",background:"#28a745",color:"white",borderRadius:"4px",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"\u521b\u5efa Banner"})]}),(0,u.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(350px, 1fr))",gap:"20px"},children:s.loading?(0,u.jsx)("div",{style:{padding:"40px",textAlign:"center",gridColumn:"1 / -1"},children:"\u52a0\u8f7d\u4e2d..."}):0===s.data.length?(0,u.jsx)("div",{style:{padding:"40px",textAlign:"center",color:"#999",gridColumn:"1 / -1"},children:"\u6682\u65e0 Banner"}):s.data.map(e=>(0,u.jsxs)("div",{style:{background:"white",borderRadius:"8px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)",overflow:"hidden"},children:[(0,u.jsxs)("div",{style:{position:"relative",height:"150px",overflow:"hidden"},children:[(0,u.jsx)(x,{src:c(e.image_url),alt:e.title,style:{width:"100%",height:"100%",objectFit:"cover"}}),(0,u.jsx)("span",{style:{position:"absolute",top:"10px",right:"10px",padding:"4px 8px",borderRadius:"4px",background:e.is_active?"#28a745":"#dc3545",color:"white",fontSize:"12px",fontWeight:"500"},children:e.is_active?"\u542f\u7528":"\u7981\u7528"})]}),(0,u.jsxs)("div",{style:{padding:"16px"},children:[(0,u.jsx)("h3",{style:{margin:"0 0 8px 0",fontSize:"16px"},children:e.title}),(0,u.jsx)("p",{style:{margin:"0 0 12px 0",color:"#666",fontSize:"14px",minHeight:"20px"},children:e.subtitle||"-"}),(0,u.jsxs)("div",{style:{fontSize:"12px",color:"#999",marginBottom:"12px"},children:["\u6392\u5e8f: ",e.order," | \u94fe\u63a5\u7c7b\u578b: ","external"===e.link_type?"\u5916\u90e8\u94fe\u63a5":"\u5185\u90e8\u94fe\u63a5"]}),(0,u.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,u.jsx)("button",{onClick:()=>v(e),style:{flex:1,padding:"6px",border:"1px solid #007bff",background:"white",color:"#007bff",borderRadius:"4px",cursor:"pointer",fontSize:"12px"},children:"\u7f16\u8f91"}),(0,u.jsx)("button",{onClick:()=>y(e.id,e.is_active),style:{flex:1,padding:"6px",border:"none",background:e.is_active?"#ffc107":"#28a745",color:e.is_active?"#212529":"white",borderRadius:"4px",cursor:"pointer",fontSize:"12px"},children:e.is_active?"\u7981\u7528":"\u542f\u7528"}),(0,u.jsx)("button",{onClick:()=>b(e.id),style:{flex:1,padding:"6px",border:"1px solid #dc3545",background:"white",color:"#dc3545",borderRadius:"4px",cursor:"pointer",fontSize:"12px"},children:"\u5220\u9664"})]})]})]},e.id))}),(0,u.jsx)(n.E1,{currentPage:s.currentPage,totalPages:s.totalPages,total:s.total,pageSize:s.pageSize,onPageChange:s.setCurrentPage,onPageSizeChange:s.setPageSize}),(0,u.jsx)(n.lM,{isOpen:p.isOpen,onClose:p.close,title:p.isEdit?"\u7f16\u8f91 Banner":"\u521b\u5efa Banner",footer:m,width:"600px",children:(0,u.jsxs)("div",{style:{padding:"20px 0"},children:[(0,u.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,u.jsxs)("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:["\u6807\u9898 ",(0,u.jsx)("span",{style:{color:"red"},children:"*"})]}),(0,u.jsx)("input",{type:"text",value:p.formData.title,onChange:e=>p.updateField("title",e.target.value),placeholder:"\u8bf7\u8f93\u5165\u6807\u9898",style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px"}})]}),(0,u.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,u.jsx)("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:"\u526f\u6807\u9898"}),(0,u.jsx)("textarea",{value:p.formData.subtitle,onChange:e=>p.updateField("subtitle",e.target.value),placeholder:"\u8bf7\u8f93\u5165\u526f\u6807\u9898",rows:3,style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px",resize:"vertical"}})]}),(0,u.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,u.jsxs)("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:["\u56fe\u7247 ",(0,u.jsx)("span",{style:{color:"red"},children:"*"})]}),(0,u.jsx)("input",{type:"file",accept:"image/*",onChange:h,disabled:e}),e&&(0,u.jsx)("span",{style:{marginLeft:"10px",color:"#666"},children:"\u4e0a\u4f20\u4e2d..."}),p.formData.image_url&&(0,u.jsx)("div",{style:{marginTop:"10px"},children:(0,u.jsx)("img",{src:c(p.formData.image_url),alt:"Preview",style:{maxWidth:"200px",maxHeight:"100px",objectFit:"cover",borderRadius:"4px"}})})]}),(0,u.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,u.jsx)("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:"\u94fe\u63a5\u7c7b\u578b"}),(0,u.jsxs)("select",{value:p.formData.link_type,onChange:e=>p.updateField("link_type",e.target.value),style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px"},children:[(0,u.jsx)("option",{value:"internal",children:"\u5185\u90e8\u94fe\u63a5"}),(0,u.jsx)("option",{value:"external",children:"\u5916\u90e8\u94fe\u63a5"})]})]}),(0,u.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,u.jsx)("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:"\u94fe\u63a5 URL"}),(0,u.jsx)("input",{type:"text",value:p.formData.link_url,onChange:e=>p.updateField("link_url",e.target.value),placeholder:"external"===p.formData.link_type?"https://...":"/page/...",style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px"}})]}),(0,u.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,u.jsx)("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:"\u6392\u5e8f\uff08\u6570\u5b57\u8d8a\u5c0f\u8d8a\u9760\u524d\uff09"}),(0,u.jsx)("input",{type:"number",value:p.formData.order,onChange:e=>p.updateField("order",parseInt(e.target.value)||0),style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px"}})]}),(0,u.jsx)("div",{style:{marginBottom:"15px"},children:(0,u.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer"},children:[(0,u.jsx)("input",{type:"checkbox",checked:p.formData.is_active,onChange:e=>p.updateField("is_active",e.target.checked)}),(0,u.jsx)("span",{children:"\u542f\u7528\u72b6\u6001"})]})})]})})]})}}}]);
//# sourceMappingURL=74.f4f4022e.chunk.js.map