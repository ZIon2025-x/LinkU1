"use strict";(self.webpackChunklinku_admin=self.webpackChunklinku_admin||[]).push([[203],{8084(e,s,a){a.r(s),a.d(s,{default:()=>K});var n=a(9379),t=a(5043),i=a(4400),l=a(9682),c=a(5580),r=a(8075),d=a(6204),o=a(3028);const m={pending:"\u5f85\u5904\u7406",resolved:"\u5df2\u89e3\u51b3",dismissed:"\u5df2\u9a73\u56de"},u={pending:{bg:"#fff3cd",color:"#856404"},resolved:{bg:"#d4edda",color:"#155724"},dismissed:{bg:"#f8d7da",color:"#721c24"}},h={open:"\u5f00\u653e\u4e2d",taken:"\u5df2\u63a5\u53d7",in_progress:"\u8fdb\u884c\u4e2d",pending_confirmation:"\u5f85\u786e\u8ba4",completed:"\u5df2\u5b8c\u6210",cancelled:"\u5df2\u53d6\u6d88"},p={open:{bg:"#e3f2fd",color:"#1565c0"},taken:{bg:"#e8f5e9",color:"#2e7d32"},in_progress:{bg:"#d1ecf1",color:"#0c5460"},pending_confirmation:{bg:"#fff3cd",color:"#856404"},completed:{bg:"#d4edda",color:"#155724"},cancelled:{bg:"#f8d7da",color:"#721c24"}},_="DisputeManagement_container__f91px",x="DisputeManagement_title__S-C4O",N="DisputeManagement_filterContainer__SG3kL",j="DisputeManagement_searchInput__H1Fql",g="DisputeManagement_filterSelect__itBBX",v="DisputeManagement_filterBtn__0ylN5",k="DisputeManagement_filterBtnPrimary__iehB4",D="DisputeManagement_filterBtnClear__tDFsI",f="DisputeManagement_tableCellTruncate__72Dtj",y="DisputeManagement_tableCellReason__mhydH",b="DisputeManagement_statusBadge__usFqE",w="DisputeManagement_actionGroup__AVhZ4",C="DisputeManagement_actionBtn__Q16VZ",M="DisputeManagement_btnView__ZAsqn",S="DisputeManagement_btnResolve__l9STQ",F="DisputeManagement_btnDismiss__GToyv",I="DisputeManagement_modalSection__rv66E",P="DisputeManagement_modalSectionTitle__JaprV",A="DisputeManagement_modalField__7fuzI",z="DisputeManagement_modalLabel__0tHyV",B="DisputeManagement_modalValue__syfA2",L="DisputeManagement_modalTextBlock__Jdf1j",T="DisputeManagement_codeBlock__aZ3DU",E="DisputeManagement_actionForm__3NIPc",V="DisputeManagement_actionFormField__mvgUk",G="DisputeManagement_actionFormLabel__uSF65",Z="DisputeManagement_actionFormTextarea__eW4Fz";var q=a(579);const H={action:"resolve",resolutionNote:"",dispute:null},K=()=>{const[e,s]=(0,t.useState)(""),[a,K]=(0,t.useState)(""),[O,U]=(0,t.useState)(!1),[J,Q]=(0,t.useState)(null),R=(0,t.useCallback)(async e=>{let{page:s,pageSize:a,filters:n}=e;const t=await(0,d.S9)({skip:(s-1)*a,limit:a,status:(null===n||void 0===n?void 0:n.status)||void 0,keyword:(null===n||void 0===n?void 0:n.keyword)||void 0});return{data:t.disputes||[],total:t.total||0}},[]),W=(0,t.useCallback)(e=>{i.Ay.error((0,o.u1)(e))},[]),X=(0,c.Dp)({fetchData:R,initialPageSize:20,onError:W}),Y=(0,c.Fb)({initialValues:H,onSubmit:async e=>{if(!e.dispute||!e.resolutionNote.trim())throw i.Ay.error("\u8bf7\u8f93\u5165\u5904\u7406\u5907\u6ce8"),new Error("\u8bf7\u8f93\u5165\u5904\u7406\u5907\u6ce8");"resolve"===e.action?(await(0,d.Kd)(e.dispute.id,e.resolutionNote.trim()),i.Ay.success("\u4e89\u8bae\u5df2\u89e3\u51b3")):(await(0,d.IU)(e.dispute.id,e.resolutionNote.trim()),i.Ay.success("\u4e89\u8bae\u5df2\u9a73\u56de")),X.refresh()},onError:e=>{i.Ay.error((0,o.u1)(e))}});(0,t.useEffect)(()=>{const s=setInterval(()=>{X.loading||e&&"pending"!==e||X.refresh()},3e4);return()=>clearInterval(s)},[X.loading,e,X.refresh]);const $=(e,s)=>{Y.open({action:s,resolutionNote:"",dispute:e})},ee=()=>{X.setFilters({status:e||void 0,keyword:a.trim()||void 0}),X.setCurrentPage(1)},se=e=>{const s=u[e]||u.pending;return{background:s.bg,color:s.color}},ae=[{key:"id",title:"ID",dataIndex:"id",width:80},{key:"task",title:"\u4efb\u52a1",width:200,render:(e,s)=>(0,q.jsxs)("span",{className:f,children:[s.task_title," (#",s.task_id,")"]})},{key:"poster_name",title:"\u53d1\u5e03\u8005",dataIndex:"poster_name",width:120},{key:"reason",title:"\u4e89\u8bae\u539f\u56e0",dataIndex:"reason",width:250,render:e=>(0,q.jsx)("span",{className:y,children:e})},{key:"status",title:"\u72b6\u6001",dataIndex:"status",width:100,render:e=>(0,q.jsx)("span",{className:b,style:se(e),children:m[e]})},{key:"created_at",title:"\u521b\u5efa\u65f6\u95f4",dataIndex:"created_at",width:160,render:e=>new Date(e).toLocaleString("zh-CN")},{key:"actions",title:"\u64cd\u4f5c",width:180,align:"center",render:(e,s)=>(0,q.jsxs)("div",{className:w,children:[(0,q.jsx)("button",{onClick:()=>(async e=>{try{const s=await(0,d.kT)(e);Q(s),U(!0)}catch(s){i.Ay.error((0,o.u1)(s))}})(s.id),className:"".concat(C," ").concat(M),children:"\u67e5\u770b"}),"pending"===s.status&&(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)("button",{onClick:()=>$(s,"resolve"),className:"".concat(C," ").concat(S),children:"\u89e3\u51b3"}),(0,q.jsx)("button",{onClick:()=>$(s,"dismiss"),className:"".concat(C," ").concat(F),children:"\u9a73\u56de"})]})]})}];return(0,q.jsxs)("div",{className:_,children:[(0,q.jsx)("h2",{className:x,children:"\u4efb\u52a1\u4e89\u8bae\u7ba1\u7406"}),(0,q.jsxs)("div",{className:N,children:[(0,q.jsx)("input",{type:"text",placeholder:"\u641c\u7d22\u4efb\u52a1\u6807\u9898\u3001\u53d1\u5e03\u8005\u59d3\u540d\u6216\u4e89\u8bae\u539f\u56e0...",value:a,onChange:e=>K(e.target.value),onKeyPress:e=>"Enter"===e.key&&ee(),className:j}),(0,q.jsxs)("select",{value:e,onChange:e=>{return n=e.target.value,s(n),X.setFilters({status:n||void 0,keyword:a.trim()||void 0}),void X.setCurrentPage(1);var n},className:g,children:[(0,q.jsx)("option",{value:"",children:"\u5168\u90e8\u72b6\u6001"}),(0,q.jsx)("option",{value:"pending",children:"\u5f85\u5904\u7406"}),(0,q.jsx)("option",{value:"resolved",children:"\u5df2\u89e3\u51b3"}),(0,q.jsx)("option",{value:"dismissed",children:"\u5df2\u9a73\u56de"})]}),(0,q.jsx)("button",{onClick:ee,className:"".concat(v," ").concat(k),children:"\u641c\u7d22"}),a&&(0,q.jsx)("button",{onClick:()=>{K(""),X.setFilters({status:e||void 0,keyword:void 0}),X.setCurrentPage(1)},className:"".concat(v," ").concat(D),children:"\u6e05\u9664"})]}),(0,q.jsx)(r.G8,{columns:ae,data:X.data,loading:X.loading,rowKey:"id",emptyText:a?"\u672a\u627e\u5230\u5339\u914d\u7684\u4e89\u8bae\u8bb0\u5f55":"\u6682\u65e0\u4e89\u8bae\u8bb0\u5f55"}),(0,q.jsx)(r.E1,{currentPage:X.currentPage,totalPages:X.totalPages,total:X.total,pageSize:X.pageSize,onPageChange:X.setCurrentPage,onPageSizeChange:X.setPageSize}),(0,q.jsx)(l.A,{title:"\u4e89\u8bae\u8be6\u60c5 #".concat((null===J||void 0===J?void 0:J.id)||""),open:O,onCancel:()=>{U(!1),Q(null)},footer:null,width:800,children:J&&(0,q.jsxs)("div",{style:{padding:"20px"},children:[(0,q.jsxs)("div",{className:I,children:[(0,q.jsx)("h3",{className:P,children:"\u4efb\u52a1\u4fe1\u606f"}),(0,q.jsxs)("div",{className:A,children:[(0,q.jsx)("span",{className:z,children:"\u4efb\u52a1\u6807\u9898\uff1a"}),(0,q.jsx)("span",{className:B,children:J.task_title||"\u4efb\u52a1 #".concat(J.task_id)})]}),J.task_description&&(0,q.jsxs)("div",{className:A,children:[(0,q.jsx)("span",{className:z,children:"\u4efb\u52a1\u63cf\u8ff0\uff1a"}),(0,q.jsx)("div",{className:L,children:J.task_description})]}),(0,q.jsxs)("div",{className:A,children:[(0,q.jsx)("span",{className:z,children:"\u4efb\u52a1\u72b6\u6001\uff1a"}),(0,q.jsx)("span",{className:b,style:(0,n.A)((0,n.A)({},(e=>{const s=p[e]||{bg:"#e9ecef",color:"#6c757d"};return{background:s.bg,color:s.color}})(J.task_status||"")),{},{marginLeft:"8px"}),children:h[J.task_status||""]||J.task_status||"\u672a\u77e5"})]}),J.task_created_at&&(0,q.jsxs)("div",{className:A,children:[(0,q.jsx)("span",{className:z,children:"\u4efb\u52a1\u521b\u5efa\u65f6\u95f4\uff1a"}),(0,q.jsx)("span",{className:B,children:new Date(J.task_created_at).toLocaleString("zh-CN")})]})]}),(0,q.jsxs)("div",{className:I,children:[(0,q.jsx)("h3",{className:P,children:"\u53c2\u4e0e\u65b9\u4fe1\u606f"}),(0,q.jsxs)("div",{className:A,children:[(0,q.jsx)("span",{className:z,children:"\u53d1\u5e03\u8005ID\uff1a"}),(0,q.jsx)("span",{className:B,children:J.poster_id})]}),(0,q.jsxs)("div",{className:A,children:[(0,q.jsx)("span",{className:z,children:"\u53d1\u5e03\u8005\u59d3\u540d\uff1a"}),(0,q.jsx)("span",{className:B,children:J.poster_name||"\u672a\u8bbe\u7f6e"})]}),J.taker_id?(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)("div",{className:A,children:[(0,q.jsx)("span",{className:z,children:"\u63a5\u53d7\u8005ID\uff1a"}),(0,q.jsx)("span",{className:B,children:J.taker_id})]}),(0,q.jsxs)("div",{className:A,children:[(0,q.jsx)("span",{className:z,children:"\u63a5\u53d7\u8005\u59d3\u540d\uff1a"}),(0,q.jsx)("span",{className:B,children:J.taker_name||"\u672a\u8bbe\u7f6e"})]})]}):(0,q.jsx)("div",{className:A,style:{color:"#999"},children:"\u6682\u65e0\u63a5\u53d7\u8005"})]}),(0,q.jsxs)("div",{className:I,children:[(0,q.jsx)("h3",{className:P,children:"\u652f\u4ed8\u4fe1\u606f"}),(0,q.jsxs)("div",{className:A,children:[(0,q.jsx)("span",{className:z,children:"\u4efb\u52a1\u91d1\u989d\uff1a"}),(0,q.jsx)("span",{className:B,children:null!=J.task_amount?"".concat(J.currency||"GBP"," ").concat(Number(J.task_amount).toFixed(2)):"\u672a\u8bbe\u7f6e"})]}),(0,q.jsxs)("div",{className:A,children:[(0,q.jsx)("span",{className:z,children:"\u652f\u4ed8\u72b6\u6001\uff1a"}),(0,q.jsx)("span",{className:b,style:{background:J.is_paid?"#d4edda":"#f8d7da",color:J.is_paid?"#155724":"#721c24",marginLeft:"8px"},children:J.is_paid?"\u2705 \u5df2\u652f\u4ed8":"\u23f3 \u672a\u652f\u4ed8"})]}),J.payment_intent_id&&(0,q.jsxs)("div",{className:A,children:[(0,q.jsx)("span",{className:z,children:"\u652f\u4ed8Intent ID\uff1a"}),(0,q.jsx)("code",{className:T,children:J.payment_intent_id})]}),(0,q.jsxs)("div",{className:A,children:[(0,q.jsx)("span",{className:z,children:"\u6258\u7ba1\u91d1\u989d\uff1a"}),(0,q.jsxs)("span",{className:B,children:[J.currency||"GBP"," ",Number(J.escrow_amount||0).toFixed(2)]})]})]}),(0,q.jsxs)("div",{className:I,children:[(0,q.jsx)("h3",{className:P,children:"\u4e89\u8bae\u4fe1\u606f"}),(0,q.jsxs)("div",{className:A,children:[(0,q.jsx)("span",{className:z,children:"\u4e89\u8bae\u539f\u56e0\uff1a"}),(0,q.jsx)("div",{className:L,children:J.reason})]}),(0,q.jsxs)("div",{className:A,children:[(0,q.jsx)("span",{className:z,children:"\u72b6\u6001\uff1a"}),(0,q.jsx)("span",{className:b,style:se(J.status),children:m[J.status]})]}),(0,q.jsxs)("div",{className:A,children:[(0,q.jsx)("span",{className:z,children:"\u521b\u5efa\u65f6\u95f4\uff1a"}),(0,q.jsx)("span",{className:B,children:new Date(J.created_at).toLocaleString("zh-CN")})]}),J.resolved_at&&(0,q.jsxs)("div",{className:A,children:[(0,q.jsx)("span",{className:z,children:"\u5904\u7406\u65f6\u95f4\uff1a"}),(0,q.jsx)("span",{className:B,children:new Date(J.resolved_at).toLocaleString("zh-CN")})]}),J.resolver_name&&(0,q.jsxs)("div",{className:A,children:[(0,q.jsx)("span",{className:z,children:"\u5904\u7406\u4eba\uff1a"}),(0,q.jsx)("span",{className:B,children:J.resolver_name})]}),J.resolution_note&&(0,q.jsxs)("div",{className:A,children:[(0,q.jsx)("span",{className:z,children:"\u5904\u7406\u5907\u6ce8\uff1a"}),(0,q.jsx)("div",{className:L,children:J.resolution_note})]})]})]})}),(0,q.jsx)(l.A,{title:"resolve"===Y.formData.action?"\u89e3\u51b3\u4e89\u8bae":"\u9a73\u56de\u4e89\u8bae",open:Y.isOpen,onCancel:Y.close,onOk:Y.handleSubmit,confirmLoading:Y.loading,okText:"resolve"===Y.formData.action?"\u89e3\u51b3":"\u9a73\u56de",cancelText:"\u53d6\u6d88",width:600,children:Y.formData.dispute&&(0,q.jsxs)("div",{className:E,children:[(0,q.jsxs)("div",{className:V,children:[(0,q.jsx)("span",{className:z,children:"\u4efb\u52a1\uff1a"}),(0,q.jsx)("span",{className:B,children:Y.formData.dispute.task_title||"\u4efb\u52a1 #".concat(Y.formData.dispute.task_id)})]}),(0,q.jsxs)("div",{className:V,children:[(0,q.jsx)("span",{className:z,children:"\u4e89\u8bae\u539f\u56e0\uff1a"}),(0,q.jsx)("div",{className:L,children:Y.formData.dispute.reason})]}),(0,q.jsxs)("div",{className:V,children:[(0,q.jsxs)("label",{className:G,children:["resolve"===Y.formData.action?"\u5904\u7406\u5907\u6ce8":"\u9a73\u56de\u7406\u7531","\uff1a"]}),(0,q.jsx)("textarea",{value:Y.formData.resolutionNote,onChange:e=>Y.updateField("resolutionNote",e.target.value),placeholder:"resolve"===Y.formData.action?"\u8bf7\u8f93\u5165\u5904\u7406\u5907\u6ce8...":"\u8bf7\u8f93\u5165\u9a73\u56de\u7406\u7531...",rows:6,className:Z})]})]})})]})}}}]);
//# sourceMappingURL=203.b55c7b04.chunk.js.map