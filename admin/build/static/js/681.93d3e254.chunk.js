"use strict";(self.webpackChunklinku_admin=self.webpackChunklinku_admin||[]).push([[681],{3150(e,a,n){n.r(a),n.d(a,{default:()=>se});var t=n(5043),s=n(4400),d=n(9682),l=n(446),r=n.n(l),i=n(5580),c=n(8075),o=n(6204),m=n(3028);const u={pending:"\u5f85\u5904\u7406",approved:"\u5df2\u6279\u51c6",rejected:"\u5df2\u62d2\u7edd",processing:"\u5904\u7406\u4e2d",completed:"\u5df2\u5b8c\u6210",cancelled:"\u5df2\u53d6\u6d88"},p={pending:{bg:"#fff3cd",color:"#856404"},approved:{bg:"#d1ecf1",color:"#0c5460"},rejected:{bg:"#f8d7da",color:"#721c24"},processing:{bg:"#d1ecf1",color:"#0c5460"},completed:{bg:"#d4edda",color:"#155724"},cancelled:{bg:"#e9ecef",color:"#6c757d"}},_={task_completed:"\u2705",task_confirmed:"\u2713",refund_request:"\u21a9\ufe0f",rebuttal:"\ud83d\udcac",dispute:"\u26a0\ufe0f",dispute_resolved:"\u2705",dispute_dismissed:"\u274c",refund_approved:"\u2705",refund_rejected:"\u274c",refund_completed:"\ud83d\udcb0"};var f=n(6427);const h="RefundManagement_container__X+ZY4",g="RefundManagement_title__tjkK3",x="RefundManagement_filterContainer__tBLpq",v="RefundManagement_searchInput__b1akp",j="RefundManagement_filterSelect__vpFW0",N="RefundManagement_filterBtn__mxvcZ",k="RefundManagement_filterBtnPrimary__dT9Ok",y="RefundManagement_filterBtnClear__sD8pU",b="RefundManagement_tableCellTruncate__Mpg9s",R="RefundManagement_taskIdLink__lyyet",w="RefundManagement_statusBadge__mZ15Z",C="RefundManagement_actionGroup__m7uRC",M="RefundManagement_actionBtn__R4mgT",D="RefundManagement_btnView__Bs1Dm",F="RefundManagement_btnTimeline__tJ8x-",S="RefundManagement_btnApprove__CrFP2",A="RefundManagement_btnReject__0sYwU",L="RefundManagement_modalSection__kEqZN",I="RefundManagement_modalSectionTitle__mtdq+",P="RefundManagement_modalField__vXd4L",z="RefundManagement_modalLabel__YXMiw",B="RefundManagement_modalValue__-r9Nk",T="RefundManagement_modalTextBlock__UUK7a",Y="RefundManagement_timeline__-cgHP",U="RefundManagement_timelineItem__X97zY",E="RefundManagement_timelineLine__2AAbN",H="RefundManagement_timelineDot__1j8FJ",V="RefundManagement_timelineContent__LcpcA",O="RefundManagement_timelineHeader__npLHy",X="RefundManagement_timelineActor__1HNFU",Z="RefundManagement_timelineTime__NlfxF",q="RefundManagement_timelineBody__3m4II",G="RefundManagement_evidenceFiles__X1xCR",K="RefundManagement_evidenceLink__kHckd",J="RefundManagement_actionForm__up0by",Q="RefundManagement_actionFormField__CisDV",W="RefundManagement_actionFormLabel__n7VA0",$="RefundManagement_actionFormTextarea__NpwVQ",ee="RefundManagement_actionFormInput__Mwyj2";var ae=n(579);const ne=[{key:"id",label:"ID"},{key:"task_id",label:"\u4efb\u52a1ID"},{key:"poster_id",label:"\u53d1\u5e03\u8005ID"},{key:"reason_type",label:"\u9000\u6b3e\u539f\u56e0\u7c7b\u578b"},{key:"refund_type",label:"\u9000\u6b3e\u7c7b\u578b",format:e=>"full"===e?"\u5168\u989d\u9000\u6b3e":"partial"===e?"\u90e8\u5206\u9000\u6b3e":"-"},{key:"refund_amount",label:"\u9000\u6b3e\u91d1\u989d",format:e=>null!=e?"\xa3".concat(Number(e).toFixed(2)):"\u5168\u989d\u9000\u6b3e"},{key:"status",label:"\u72b6\u6001",format:e=>u[e]||e},{key:"created_at",label:"\u7533\u8bf7\u65f6\u95f4",format:e=>r()(e).format("YYYY-MM-DD HH:mm")}],te={action:"approve",adminComment:"",refundAmount:void 0,refund:null},se=()=>{var e;const[a,n]=(0,t.useState)(""),[l,se]=(0,t.useState)(""),[de,le]=(0,t.useState)(!1),[re,ie]=(0,t.useState)(null),[ce,oe]=(0,t.useState)(!1),[me,ue]=(0,t.useState)(null),[pe,_e]=(0,t.useState)(!1),fe=(0,t.useCallback)(async e=>{let{page:a,pageSize:n,filters:t}=e;const s=await(0,o.sQ)({skip:(a-1)*n,limit:n,status:(null===t||void 0===t?void 0:t.status)||void 0,keyword:(null===t||void 0===t?void 0:t.keyword)||void 0});return{data:s.items||[],total:s.total||0}},[]),he=(0,t.useCallback)(e=>{s.Ay.error((0,m.u1)(e))},[]),ge=(0,i.Dp)({fetchData:fe,initialPageSize:20,onError:he}),xe=(0,i.Fb)({initialValues:te,onSubmit:async e=>{if(e.refund){if("reject"===e.action&&!e.adminComment.trim())throw s.Ay.error("\u8bf7\u8f93\u5165\u62d2\u7edd\u7406\u7531"),new Error("\u8bf7\u8f93\u5165\u62d2\u7edd\u7406\u7531");"approve"===e.action?(await(0,o.RS)(e.refund.id,{admin_comment:e.adminComment.trim()||void 0,refund_amount:e.refundAmount}),s.Ay.success("\u9000\u6b3e\u7533\u8bf7\u5df2\u6279\u51c6\uff0c\u6b63\u5728\u5904\u7406\u9000\u6b3e...")):(await(0,o.Fe)(e.refund.id,e.adminComment.trim()),s.Ay.success("\u9000\u6b3e\u7533\u8bf7\u5df2\u62d2\u7edd")),ge.refresh()}},onError:e=>{s.Ay.error((0,m.u1)(e))}});(0,t.useEffect)(()=>{const e=setInterval(()=>{ge.loading||a&&"pending"!==a||ge.refresh()},3e4);return()=>clearInterval(e)},[ge.loading,a,ge.refresh]);const ve=(e,a)=>{xe.open({action:a,adminComment:"",refundAmount:void 0,refund:e})},je=()=>{ge.setFilters({status:a||void 0,keyword:l.trim()||void 0}),ge.setCurrentPage(1)},Ne=e=>{const a=p[e]||p.pending;return{background:a.bg,color:a.color}},ke=[{key:"id",title:"\u7533\u8bf7ID",dataIndex:"id",width:80},{key:"task_id",title:"\u4efb\u52a1ID",width:90,render:(e,a)=>(0,ae.jsxs)("span",{className:R,onClick:()=>{return e=a.task_id,navigator.clipboard.writeText(String(e)),void s.Ay.success("\u4efb\u52a1ID ".concat(e," \u5df2\u590d\u5236\u5230\u526a\u8d34\u677f"));var e},title:"\u70b9\u51fb\u590d\u5236\u4efb\u52a1ID",children:["#",a.task_id]})},{key:"task_title",title:"\u4efb\u52a1",width:180,render:(e,a)=>{var n;return(0,ae.jsx)("span",{className:b,children:(null===(n=a.task)||void 0===n?void 0:n.title)||"\u4efb\u52a1 #".concat(a.task_id)})}},{key:"poster",title:"\u53d1\u5e03\u8005",width:120,render:(e,a)=>{var n;return(null===(n=a.poster)||void 0===n?void 0:n.name)||a.poster_id}},{key:"reason_type",title:"\u9000\u6b3e\u539f\u56e0\u7c7b\u578b",width:120,render:(e,a)=>a.reason_type_display||a.reason_type||"-"},{key:"refund_type",title:"\u9000\u6b3e\u7c7b\u578b",width:100,render:(e,a)=>(0,ae.jsx)("span",{className:w,style:{background:"full"===a.refund_type?"#d4edda":"#fff3cd",color:"full"===a.refund_type?"#155724":"#856404"},children:a.refund_type_display||("full"===a.refund_type?"\u5168\u989d\u9000\u6b3e":"partial"===a.refund_type?"\u90e8\u5206\u9000\u6b3e":"-")})},{key:"refund_amount",title:"\u9000\u6b3e\u91d1\u989d",width:130,render:(e,a)=>null!=a.refund_amount?"\xa3".concat(Number(a.refund_amount).toFixed(2)).concat(a.refund_percentage?" (".concat(a.refund_percentage.toFixed(1),"%)"):""):"\u5168\u989d\u9000\u6b3e"},{key:"status",title:"\u72b6\u6001",dataIndex:"status",width:100,render:e=>(0,ae.jsx)("span",{className:w,style:Ne(e),children:u[e]})},{key:"created_at",title:"\u521b\u5efa\u65f6\u95f4",dataIndex:"created_at",width:160,render:e=>new Date(e).toLocaleString("zh-CN")},{key:"actions",title:"\u64cd\u4f5c",width:200,align:"center",render:(e,a)=>(0,ae.jsxs)("div",{className:C,children:[(0,ae.jsx)("button",{onClick:()=>(ie(a),void le(!0)),className:"".concat(M," ").concat(D),children:"\u67e5\u770b"}),(0,ae.jsx)("button",{onClick:()=>(async e=>{try{_e(!0);const a=await(0,o.pe)(e);ue(a),oe(!0)}catch(a){s.Ay.error((0,m.u1)(a))}finally{_e(!1)}})(a.task_id),disabled:pe,className:"".concat(M," ").concat(F),children:pe?"\u52a0\u8f7d\u4e2d...":"\u4e89\u8bae\u8be6\u60c5"}),"pending"===a.status&&(0,ae.jsxs)(ae.Fragment,{children:[(0,ae.jsx)("button",{onClick:()=>ve(a,"approve"),className:"".concat(M," ").concat(S),children:"\u6279\u51c6"}),(0,ae.jsx)("button",{onClick:()=>ve(a,"reject"),className:"".concat(M," ").concat(A),children:"\u62d2\u7edd"})]})]})}];return(0,ae.jsxs)("div",{className:h,children:[(0,ae.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"16px"},children:[(0,ae.jsx)("h2",{className:g,style:{margin:0},children:"\u9000\u6b3e\u7533\u8bf7\u7ba1\u7406"}),(0,ae.jsx)("button",{onClick:()=>{(0,f.G)(ge.data,"refunds-".concat(r()().format("YYYY-MM-DD")),ne)},disabled:0===ge.data.length,style:{padding:"8px 16px",border:"1px solid #52c41a",background:"white",color:"#52c41a",borderRadius:"4px",cursor:"pointer",fontSize:"14px"},children:"\u5bfc\u51fa CSV"})]}),(0,ae.jsxs)("div",{className:x,children:[(0,ae.jsx)("input",{type:"text",placeholder:"\u641c\u7d22\u4efb\u52a1\u6807\u9898\u3001\u53d1\u5e03\u8005\u59d3\u540d\u6216\u9000\u6b3e\u539f\u56e0...",value:l,onChange:e=>se(e.target.value),onKeyPress:e=>"Enter"===e.key&&je(),className:v}),(0,ae.jsxs)("select",{value:a,onChange:e=>{return a=e.target.value,n(a),ge.setFilters({status:a||void 0,keyword:l.trim()||void 0}),void ge.setCurrentPage(1);var a},className:j,children:[(0,ae.jsx)("option",{value:"",children:"\u5168\u90e8\u72b6\u6001"}),(0,ae.jsx)("option",{value:"pending",children:"\u5f85\u5904\u7406"}),(0,ae.jsx)("option",{value:"approved",children:"\u5df2\u6279\u51c6"}),(0,ae.jsx)("option",{value:"rejected",children:"\u5df2\u62d2\u7edd"}),(0,ae.jsx)("option",{value:"processing",children:"\u5904\u7406\u4e2d"}),(0,ae.jsx)("option",{value:"completed",children:"\u5df2\u5b8c\u6210"}),(0,ae.jsx)("option",{value:"cancelled",children:"\u5df2\u53d6\u6d88"})]}),(0,ae.jsx)("button",{onClick:je,className:"".concat(N," ").concat(k),children:"\u641c\u7d22"}),l&&(0,ae.jsx)("button",{onClick:()=>{se(""),ge.setFilters({status:a||void 0,keyword:void 0}),ge.setCurrentPage(1)},className:"".concat(N," ").concat(y),children:"\u6e05\u9664"})]}),(0,ae.jsx)(c.G8,{columns:ke,data:ge.data,loading:ge.loading,rowKey:"id",emptyText:l?"\u672a\u627e\u5230\u5339\u914d\u7684\u9000\u6b3e\u7533\u8bf7\u8bb0\u5f55":"\u6682\u65e0\u9000\u6b3e\u7533\u8bf7\u8bb0\u5f55"}),(0,ae.jsx)(c.E1,{currentPage:ge.currentPage,totalPages:ge.totalPages,total:ge.total,pageSize:ge.pageSize,onPageChange:ge.setCurrentPage,onPageSizeChange:ge.setPageSize}),(0,ae.jsx)(d.A,{title:"\u9000\u6b3e\u7533\u8bf7\u8be6\u60c5 #".concat((null===re||void 0===re?void 0:re.id)||""),open:de,onCancel:()=>{le(!1),ie(null)},footer:null,width:800,children:re&&(0,ae.jsxs)("div",{style:{padding:"20px"},children:[(0,ae.jsxs)("div",{className:L,children:[(0,ae.jsx)("h3",{className:I,children:"\u4efb\u52a1\u4fe1\u606f"}),re.task&&(0,ae.jsxs)(ae.Fragment,{children:[(0,ae.jsxs)("div",{className:P,children:[(0,ae.jsx)("span",{className:z,children:"\u4efb\u52a1\u6807\u9898\uff1a"}),(0,ae.jsx)("span",{className:B,children:re.task.title||"\u4efb\u52a1 #".concat(re.task_id)})]}),(0,ae.jsxs)("div",{className:P,children:[(0,ae.jsx)("span",{className:z,children:"\u4efb\u52a1\u91d1\u989d\uff1a"}),(0,ae.jsxs)("span",{className:B,children:["\xa3",re.task.agreed_reward||re.task.base_reward||0]})]}),(0,ae.jsxs)("div",{className:P,children:[(0,ae.jsx)("span",{className:z,children:"\u652f\u4ed8\u72b6\u6001\uff1a"}),(0,ae.jsx)("span",{className:w,style:{background:re.task.is_paid?"#d4edda":"#f8d7da",color:re.task.is_paid?"#155724":"#721c24",marginLeft:"8px"},children:re.task.is_paid?"\u2705 \u5df2\u652f\u4ed8":"\u23f3 \u672a\u652f\u4ed8"})]})]})]}),(0,ae.jsxs)("div",{className:L,children:[(0,ae.jsx)("h3",{className:I,children:"\u9000\u6b3e\u7533\u8bf7\u4fe1\u606f"}),(0,ae.jsxs)("div",{className:P,children:[(0,ae.jsx)("span",{className:z,children:"\u9000\u6b3e\u539f\u56e0\u7c7b\u578b\uff1a"}),(0,ae.jsx)("span",{className:w,style:{background:"#e3f2fd",color:"#1976d2",marginLeft:"8px"},children:re.reason_type_display||re.reason_type||"\u672a\u77e5"})]}),(0,ae.jsxs)("div",{className:P,children:[(0,ae.jsx)("span",{className:z,children:"\u9000\u6b3e\u7c7b\u578b\uff1a"}),(0,ae.jsx)("span",{className:w,style:{background:"full"===re.refund_type?"#d4edda":"#fff3cd",color:"full"===re.refund_type?"#155724":"#856404",marginLeft:"8px"},children:re.refund_type_display||("full"===re.refund_type?"\u5168\u989d\u9000\u6b3e":"\u90e8\u5206\u9000\u6b3e")})]}),(0,ae.jsxs)("div",{className:P,children:[(0,ae.jsx)("span",{className:z,children:"\u9000\u6b3e\u539f\u56e0\u8be6\u7ec6\u8bf4\u660e\uff1a"}),(0,ae.jsx)("div",{className:T,children:re.reason})]}),(0,ae.jsxs)("div",{className:P,children:[(0,ae.jsx)("span",{className:z,children:"\u7533\u8bf7\u9000\u6b3e\u91d1\u989d\uff1a"}),(0,ae.jsx)("span",{className:B,children:null!=re.refund_amount?"\xa3".concat(Number(re.refund_amount).toFixed(2)).concat(re.refund_percentage?" (".concat(re.refund_percentage.toFixed(1),"%)"):""):"\u5168\u989d\u9000\u6b3e"})]}),re.evidence_files&&re.evidence_files.length>0&&(0,ae.jsxs)("div",{className:P,children:[(0,ae.jsx)("span",{className:z,children:"\u8bc1\u636e\u6587\u4ef6\uff1a"}),(0,ae.jsx)("div",{className:G,children:re.evidence_files.map((e,a)=>(0,ae.jsxs)("a",{href:"/api/private-file?file=".concat(e),target:"_blank",rel:"noopener noreferrer",className:K,children:["\u6587\u4ef6 ",a+1]},a))})]}),(0,ae.jsxs)("div",{className:P,children:[(0,ae.jsx)("span",{className:z,children:"\u72b6\u6001\uff1a"}),(0,ae.jsx)("span",{className:w,style:Ne(re.status),children:u[re.status]})]}),re.admin_comment&&(0,ae.jsxs)("div",{className:P,children:[(0,ae.jsx)("span",{className:z,children:"\u7ba1\u7406\u5458\u5907\u6ce8\uff1a"}),(0,ae.jsx)("div",{className:T,children:re.admin_comment})]}),re.reviewed_at&&(0,ae.jsxs)("div",{className:P,children:[(0,ae.jsx)("span",{className:z,children:"\u5ba1\u6838\u65f6\u95f4\uff1a"}),(0,ae.jsx)("span",{className:B,children:new Date(re.reviewed_at).toLocaleString("zh-CN")})]}),(0,ae.jsxs)("div",{className:P,children:[(0,ae.jsx)("span",{className:z,children:"\u521b\u5efa\u65f6\u95f4\uff1a"}),(0,ae.jsx)("span",{className:B,children:new Date(re.created_at).toLocaleString("zh-CN")})]})]})]})}),(0,ae.jsx)(d.A,{title:"\u4e89\u8bae\u8be6\u60c5 - \u4efb\u52a1 #".concat((null===me||void 0===me?void 0:me.task_id)||""),open:ce,onCancel:()=>{oe(!1),ue(null)},footer:null,width:900,children:me&&(0,ae.jsxs)("div",{style:{padding:"20px",maxHeight:"70vh",overflow:"auto"},children:[(0,ae.jsxs)("div",{style:{marginBottom:"20px",padding:"12px",background:"#f3f4f6",borderRadius:"8px"},children:[(0,ae.jsx)("strong",{children:"\u4efb\u52a1\u6807\u9898\uff1a"})," ",me.task_title]}),me.timeline&&me.timeline.length>0?(0,ae.jsx)("div",{className:Y,children:me.timeline.map((e,a)=>{const n=a===me.timeline.length-1,t=(e=>{const a={poster:{bg:"#dbeafe",color:"#3b82f6"},taker:{bg:"#d1fae5",color:"#10b981"},admin:{bg:"#fef3c7",color:"#f59e0b"}};return a[e]||a.admin})(e.actor),s="poster"===e.actor?"\u53d1\u5e03\u8005":"taker"===e.actor?"\u63a5\u5355\u8005":e.reviewer_name||e.resolver_name||"\u7ba1\u7406\u5458",d=_[e.type]||"\ud83d\udccb";return(0,ae.jsxs)("div",{className:U,children:[!n&&(0,ae.jsx)("div",{className:E}),(0,ae.jsx)("div",{className:H,style:{background:t.bg},children:d}),(0,ae.jsxs)("div",{className:V,children:[(0,ae.jsxs)("div",{className:O,children:[(0,ae.jsx)("span",{className:X,style:{background:t.bg,color:t.color},children:s}),(0,ae.jsx)("span",{className:Z,children:new Date(e.timestamp).toLocaleString("zh-CN")})]}),(0,ae.jsx)("div",{className:q,children:e.content||e.status||"-"})]})]},a)})}):(0,ae.jsx)("div",{style:{textAlign:"center",color:"#999",padding:"40px"},children:"\u6682\u65e0\u4e89\u8bae/\u9000\u6b3e\u8bb0\u5f55"})]})}),(0,ae.jsx)(d.A,{title:"approve"===xe.formData.action?"\u6279\u51c6\u9000\u6b3e\u7533\u8bf7":"\u62d2\u7edd\u9000\u6b3e\u7533\u8bf7",open:xe.isOpen,onCancel:xe.close,onOk:xe.handleSubmit,confirmLoading:xe.loading,okText:"approve"===xe.formData.action?"\u6279\u51c6":"\u62d2\u7edd",cancelText:"\u53d6\u6d88",width:600,children:xe.formData.refund&&(0,ae.jsxs)("div",{className:J,children:[(0,ae.jsxs)("div",{className:Q,children:[(0,ae.jsx)("span",{className:z,children:"\u4efb\u52a1\uff1a"}),(0,ae.jsx)("span",{className:B,children:(null===(e=xe.formData.refund.task)||void 0===e?void 0:e.title)||"\u4efb\u52a1 #".concat(xe.formData.refund.task_id)})]}),(0,ae.jsxs)("div",{className:Q,children:[(0,ae.jsx)("span",{className:z,children:"\u7533\u8bf7\u9000\u6b3e\u91d1\u989d\uff1a"}),(0,ae.jsx)("span",{className:B,children:null!=xe.formData.refund.refund_amount?"\xa3".concat(Number(xe.formData.refund.refund_amount).toFixed(2)):"\u5168\u989d\u9000\u6b3e"})]}),"approve"===xe.formData.action&&(0,ae.jsxs)("div",{className:Q,children:[(0,ae.jsx)("label",{className:W,children:"\u5b9e\u9645\u9000\u6b3e\u91d1\u989d\uff08\u53ef\u9009\uff0c\u7559\u7a7a\u5219\u6309\u7533\u8bf7\u91d1\u989d\u9000\u6b3e\uff09\uff1a"}),(0,ae.jsx)("input",{type:"number",step:"0.01",min:"0",value:xe.formData.refundAmount||"",onChange:e=>xe.updateField("refundAmount",e.target.value?parseFloat(e.target.value):void 0),placeholder:"\xa30.00",className:ee})]}),(0,ae.jsxs)("div",{className:Q,children:[(0,ae.jsx)("label",{className:W,children:"approve"===xe.formData.action?"\u7ba1\u7406\u5458\u5907\u6ce8\uff08\u53ef\u9009\uff09\uff1a":"\u62d2\u7edd\u7406\u7531\uff1a"}),(0,ae.jsx)("textarea",{value:xe.formData.adminComment,onChange:e=>xe.updateField("adminComment",e.target.value),placeholder:"approve"===xe.formData.action?"\u8bf7\u8f93\u5165\u5907\u6ce8...":"\u8bf7\u8f93\u5165\u62d2\u7edd\u7406\u7531...",rows:4,className:$})]})]})})]})}},6427(e,a,n){function t(e,a,n){const t=[n.map(e=>'"'.concat(e.label,'"')).join(","),...e.map(e=>n.map(a=>{const n=a.format?a.format(e[a.key],e):e[a.key],t=null==n?"":String(n);return'"'.concat(t.replace(/"/g,'""'),'"')}).join(","))].join("\r\n"),s=new Blob(["\ufeff"+t],{type:"text/csv;charset=utf-8;"}),d=URL.createObjectURL(s),l=document.createElement("a");l.href=d,l.download="".concat(a,".csv"),document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(d)}n.d(a,{G:()=>t})}}]);
//# sourceMappingURL=681.93d3e254.chunk.js.map