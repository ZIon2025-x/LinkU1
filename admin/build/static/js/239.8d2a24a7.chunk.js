"use strict";(self.webpackChunklinku_admin=self.webpackChunklinku_admin||[]).push([[239],{2320(e,t,i){i.r(t),i.d(t,{default:()=>c});var d=i(5043),a=i(4400),o=i(5580),n=i(8075),r=i(6204),l=i(3028),s=i(579);const p={code:"",name:"",description:"",reward_type:"points",points_reward:0,coupon_id:void 0,max_uses:void 0,valid_from:"",valid_until:"",is_active:!0},c=()=>{const[e,t]=(0,d.useState)(""),i=(0,d.useCallback)(async e=>{let{page:t,pageSize:i,filters:d}=e;const a=await(0,r.U4)({page:t,limit:i,status:null===d||void 0===d?void 0:d.status});return{data:a.data||a.items||[],total:a.total||0}},[]),c=(0,d.useCallback)(e=>{a.Ay.error((0,l.u1)(e))},[]),x=(0,o.Dp)({fetchData:i,initialPageSize:20,onError:c}),u=(0,o.Fb)({initialValues:p,onSubmit:async(e,t)=>{if(!e.code||!e.valid_from||!e.valid_until)throw a.Ay.warning("\u8bf7\u586b\u5199\u9080\u8bf7\u7801\u3001\u6709\u6548\u671f\u5f00\u59cb\u65f6\u95f4\u548c\u7ed3\u675f\u65f6\u95f4"),new Error("validation");t&&e.id?(await(0,r.y1)(e.id,{name:e.name||void 0,description:e.description||void 0,is_active:e.is_active,max_uses:e.max_uses,valid_from:e.valid_from?new Date(e.valid_from).toISOString():void 0,valid_until:e.valid_until?new Date(e.valid_until).toISOString():void 0,points_reward:e.points_reward||void 0,coupon_id:e.coupon_id}),a.Ay.success("\u9080\u8bf7\u7801\u66f4\u65b0\u6210\u529f\uff01")):(await(0,r.lX)({code:e.code,name:e.name||void 0,description:e.description||void 0,reward_type:e.reward_type,points_reward:e.points_reward||void 0,coupon_id:e.coupon_id,max_uses:e.max_uses,valid_from:new Date(e.valid_from).toISOString(),valid_until:new Date(e.valid_until).toISOString(),is_active:e.is_active}),a.Ay.success("\u9080\u8bf7\u7801\u521b\u5efa\u6210\u529f\uff01")),x.refresh()},onError:e=>{"validation"!==(null===e||void 0===e?void 0:e.message)&&a.Ay.error((0,l.u1)(e))}}),h=(0,d.useCallback)(async e=>{try{const t=await(0,r.MT)(e);u.open({id:t.id,code:t.code,name:t.name||"",description:t.description||"",reward_type:t.reward_type,points_reward:t.points_reward||0,coupon_id:t.coupon_id,max_uses:t.max_uses,valid_from:t.valid_from?new Date(t.valid_from).toISOString().slice(0,16):"",valid_until:t.valid_until?new Date(t.valid_until).toISOString().slice(0,16):"",is_active:t.is_active})}catch(t){a.Ay.error((0,l.u1)(t))}},[u]),g=(0,d.useCallback)(e=>{window.confirm("\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u4e2a\u9080\u8bf7\u7801\u5417\uff1f")&&(0,r.gN)(e).then(()=>{a.Ay.success("\u9080\u8bf7\u7801\u5220\u9664\u6210\u529f\uff01"),x.refresh()}).catch(e=>{a.Ay.error((0,l.u1)(e))})},[x]),y=(0,d.useCallback)(e=>{t(e),x.setFilters({status:e||void 0})},[x]),v=[{key:"code",title:"\u9080\u8bf7\u7801",dataIndex:"code",width:120},{key:"name",title:"\u540d\u79f0",dataIndex:"name",width:140,render:e=>e||"-"},{key:"reward_type",title:"\u5956\u52b1\u7c7b\u578b",dataIndex:"reward_type",width:120,render:e=>"points"===e?"\u79ef\u5206":"coupon"===e?"\u4f18\u60e0\u5238":"\u79ef\u5206+\u4f18\u60e0\u5238"},{key:"points_reward",title:"\u79ef\u5206\u5956\u52b1",dataIndex:"points_reward_display",width:100,render:e=>e||"0.00"},{key:"usage",title:"\u4f7f\u7528\u6b21\u6570",width:100,render:(e,t)=>"".concat(t.used_count||0," / ").concat(t.max_uses||"\u221e")},{key:"validity",title:"\u6709\u6548\u671f",width:200,render:(e,t)=>(0,s.jsxs)("span",{style:{fontSize:"12px"},children:[new Date(t.valid_from).toLocaleString("zh-CN")," ~",(0,s.jsx)("br",{}),new Date(t.valid_until).toLocaleString("zh-CN")]})},{key:"status",title:"\u72b6\u6001",dataIndex:"is_active",width:80,render:e=>(0,s.jsx)(n.Wh,{text:e?"\u542f\u7528":"\u7981\u7528",variant:e?"success":"danger"})},{key:"actions",title:"\u64cd\u4f5c",width:120,align:"center",render:(e,t)=>(0,s.jsxs)("div",{style:{display:"flex",gap:"8px",justifyContent:"center"},children:[(0,s.jsx)("button",{onClick:()=>h(t.id),style:{padding:"4px 8px",border:"1px solid #007bff",background:"white",color:"#007bff",borderRadius:"4px",cursor:"pointer",fontSize:"12px"},children:"\u7f16\u8f91"}),(0,s.jsx)("button",{onClick:()=>g(t.id),style:{padding:"4px 8px",border:"1px solid #dc3545",background:"white",color:"#dc3545",borderRadius:"4px",cursor:"pointer",fontSize:"12px"},children:"\u5220\u9664"})]})}],m=(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px"},children:[(0,s.jsx)("button",{onClick:u.close,style:{padding:"8px 16px",border:"1px solid #d9d9d9",borderRadius:"4px",background:"white",cursor:"pointer"},children:"\u53d6\u6d88"}),(0,s.jsx)("button",{onClick:u.handleSubmit,disabled:u.loading,style:{padding:"8px 16px",border:"none",borderRadius:"4px",background:"#007bff",color:"white",cursor:u.loading?"not-allowed":"pointer",opacity:u.loading?.7:1},children:u.loading?"\u63d0\u4ea4\u4e2d...":u.isEdit?"\u66f4\u65b0":"\u521b\u5efa"})]});return(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[(0,s.jsx)("h2",{style:{margin:0},children:"\u9080\u8bf7\u7801\u7ba1\u7406"}),(0,s.jsx)("button",{onClick:()=>u.open(),style:{padding:"10px 20px",border:"none",background:"#28a745",color:"white",borderRadius:"4px",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"\u521b\u5efa\u9080\u8bf7\u7801"})]}),(0,s.jsxs)("div",{style:{marginBottom:"20px",display:"flex",gap:"10px",alignItems:"center"},children:[(0,s.jsx)("label",{style:{fontWeight:"bold"},children:"\u72b6\u6001\u7b5b\u9009\uff1a"}),(0,s.jsxs)("select",{value:e,onChange:e=>y(e.target.value),style:{padding:"8px 12px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px"},children:[(0,s.jsx)("option",{value:"",children:"\u5168\u90e8"}),(0,s.jsx)("option",{value:"active",children:"\u542f\u7528"}),(0,s.jsx)("option",{value:"inactive",children:"\u7981\u7528"})]})]}),(0,s.jsx)(n.G8,{columns:v,data:x.data,loading:x.loading,rowKey:"id",emptyText:"\u6682\u65e0\u9080\u8bf7\u7801\u6570\u636e"}),(0,s.jsx)(n.E1,{currentPage:x.currentPage,totalPages:x.totalPages,total:x.total,pageSize:x.pageSize,onPageChange:x.setCurrentPage,onPageSizeChange:x.setPageSize}),(0,s.jsx)(n.lM,{isOpen:u.isOpen,onClose:u.close,title:u.isEdit?"\u7f16\u8f91\u9080\u8bf7\u7801":"\u521b\u5efa\u9080\u8bf7\u7801",footer:m,width:"600px",children:(0,s.jsxs)("div",{style:{padding:"20px 0"},children:[(0,s.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,s.jsxs)("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:["\u9080\u8bf7\u7801 ",(0,s.jsx)("span",{style:{color:"red"},children:"*"})]}),(0,s.jsx)("input",{type:"text",value:u.formData.code,onChange:e=>u.updateField("code",e.target.value.toUpperCase()),disabled:u.isEdit,placeholder:"\u8bf7\u8f93\u5165\u9080\u8bf7\u7801",style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px"}})]}),(0,s.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,s.jsx)("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:"\u540d\u79f0"}),(0,s.jsx)("input",{type:"text",value:u.formData.name,onChange:e=>u.updateField("name",e.target.value),placeholder:"\u8bf7\u8f93\u5165\u540d\u79f0",style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px"}})]}),(0,s.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,s.jsxs)("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:["\u5956\u52b1\u7c7b\u578b ",(0,s.jsx)("span",{style:{color:"red"},children:"*"})]}),(0,s.jsxs)("select",{value:u.formData.reward_type,onChange:e=>u.updateField("reward_type",e.target.value),style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px"},children:[(0,s.jsx)("option",{value:"points",children:"\u79ef\u5206"}),(0,s.jsx)("option",{value:"coupon",children:"\u4f18\u60e0\u5238"}),(0,s.jsx)("option",{value:"both",children:"\u79ef\u5206+\u4f18\u60e0\u5238"})]})]}),("points"===u.formData.reward_type||"both"===u.formData.reward_type)&&(0,s.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,s.jsx)("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:"\u79ef\u5206\u5956\u52b1\uff08\u5206\uff09"}),(0,s.jsx)("input",{type:"number",value:u.formData.points_reward,onChange:e=>u.updateField("points_reward",parseInt(e.target.value)||0),placeholder:"100\u5206=1.00",min:"0",style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px"}})]}),(0,s.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,s.jsxs)("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:["\u6709\u6548\u671f\u5f00\u59cb\u65f6\u95f4 ",(0,s.jsx)("span",{style:{color:"red"},children:"*"})]}),(0,s.jsx)("input",{type:"datetime-local",value:u.formData.valid_from,onChange:e=>u.updateField("valid_from",e.target.value),style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px"}})]}),(0,s.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,s.jsxs)("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:["\u6709\u6548\u671f\u7ed3\u675f\u65f6\u95f4 ",(0,s.jsx)("span",{style:{color:"red"},children:"*"})]}),(0,s.jsx)("input",{type:"datetime-local",value:u.formData.valid_until,onChange:e=>u.updateField("valid_until",e.target.value),style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px"}})]}),(0,s.jsx)("div",{style:{marginBottom:"15px"},children:(0,s.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer"},children:[(0,s.jsx)("input",{type:"checkbox",checked:u.formData.is_active,onChange:e=>u.updateField("is_active",e.target.checked)}),(0,s.jsx)("span",{children:"\u542f\u7528\u72b6\u6001"})]})})]})})]})}}}]);
//# sourceMappingURL=239.8d2a24a7.chunk.js.map