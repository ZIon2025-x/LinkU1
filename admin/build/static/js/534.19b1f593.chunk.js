/*! For license information please see 534.19b1f593.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunklinku_admin=self.webpackChunklinku_admin||[]).push([[534],{9534(e,t,a){a.r(t),a.d(t,{default:()=>_});var i=a(9379),s=a(5043),n=a(3216),r=a(3927),o=a(3427),l=a(4400),d=a(5531),c=a(2524),u=a(5492),f=a(8168);const h={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64L128 192v384c0 212.1 171.9 384 384 384s384-171.9 384-384V192L512 64zm312 512c0 172.3-139.7 312-312 312S200 748.3 200 576V246l312-110 312 110v330z"}},{tag:"path",attrs:{d:"M378.4 475.1a35.91 35.91 0 00-50.9 0 35.91 35.91 0 000 50.9l129.4 129.4 2.1 2.1a33.98 33.98 0 0048.1 0L730.6 434a33.98 33.98 0 000-48.1l-2.8-2.8a33.98 33.98 0 00-48.1 0L483 579.7 378.4 475.1z"}}]},name:"safety",theme:"outlined"};var g=a(2172),m=function(e,t){return s.createElement(g.A,(0,f.A)({},e,{ref:t,icon:h}))};const y=s.forwardRef(m);const p={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M858.5 763.6a374 374 0 00-80.6-119.5 375.63 375.63 0 00-119.5-80.6c-.4-.2-.8-.3-1.2-.5C719.5 518 760 444.7 760 362c0-137-111-248-248-248S264 225 264 362c0 82.7 40.5 156 102.8 201.1-.4.2-.8.3-1.2.5-44.8 18.9-85 46-119.5 80.6a375.63 375.63 0 00-80.6 119.5A371.7 371.7 0 00136 901.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8 2-77.2 33-149.5 87.8-204.3 56.7-56.7 132-87.9 212.2-87.9s155.5 31.2 212.2 87.9C779 752.7 810 825 812 902.2c.1 4.4 3.6 7.8 8 7.8h60a8 8 0 008-8.2c-1-47.8-10.9-94.3-29.5-138.2zM512 534c-45.9 0-89.1-17.9-121.6-50.4S340 407.9 340 362c0-45.9 17.9-89.1 50.4-121.6S466.1 190 512 190s89.1 17.9 121.6 50.4S684 316.1 684 362c0 45.9-17.9 89.1-50.4 121.6S557.9 534 512 534z"}}]},name:"user",theme:"outlined"};var v=function(e,t){return s.createElement(g.A,(0,f.A)({},e,{ref:t,icon:p}))};const A=s.forwardRef(v);const x={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM332 240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224H332V240zm460 600H232V536h560v304zM484 701v53c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-53a48.01 48.01 0 10-56 0z"}}]},name:"lock",theme:"outlined"};var b=function(e,t){return s.createElement(g.A,(0,f.A)({},e,{ref:t,icon:x}))};const j=s.forwardRef(b);const k={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 110.8V792H136V270.8l-27.6-21.5 39.3-50.5 42.8 33.3h643.1l42.8-33.3 39.3 50.5-27.7 21.5zM833.6 232L512 482 190.4 232l-42.8-33.3-39.3 50.5 27.6 21.5 341.6 265.6a55.99 55.99 0 0068.7 0L888 270.8l27.6-21.5-39.3-50.5-42.7 33.2z"}}]},name:"mail",theme:"outlined"};var w=function(e,t){return s.createElement(g.A,(0,f.A)({},e,{ref:t,icon:k}))};const S=s.forwardRef(w);var z=a(6204),C=a(579);const{Title:F,Text:R}=r.A,_=()=>{const e=(0,n.Zp)(),[t,a]=(0,s.useState)("login"),[r,f]=(0,s.useState)(!1),[h]=o.A.useForm(),[g]=o.A.useForm(),[m,p]=(0,s.useState)(""),[v,x]=(0,s.useState)({username_or_id:"",password:""}),[b,k]=(0,s.useState)({admin_id:"",code:""}),[w,_]=(0,s.useState)(""),[V,B]=(0,s.useState)(""),[I,M]=(0,s.useState)(!1);return(0,C.jsx)(C.Fragment,{children:(0,C.jsx)("div",{style:{minHeight:"100vh",display:"flex",justifyContent:"center",alignItems:"center",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",padding:"20px"},children:(0,C.jsxs)(d.A,{style:{width:"100%",maxWidth:400,boxShadow:"0 10px 40px rgba(0, 0, 0, 0.2)",borderRadius:12},bodyStyle:{padding:"40px 32px"},children:[(0,C.jsxs)("div",{style:{textAlign:"center",marginBottom:32},children:[(0,C.jsx)("div",{style:{width:64,height:64,margin:"0 auto 16px",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:16,display:"flex",justifyContent:"center",alignItems:"center"},children:(0,C.jsx)(y,{style:{fontSize:32,color:"#fff"}})}),(0,C.jsx)(F,{level:3,style:{margin:0},children:"login"===t?"LinkU \u7ba1\u7406\u540e\u53f0":I?"2FA \u9a8c\u8bc1":"\u90ae\u7bb1\u9a8c\u8bc1\u7801\u9a8c\u8bc1"}),(0,C.jsx)(R,{type:"secondary",children:"login"===t?"\u8bf7\u4f7f\u7528\u7ba1\u7406\u5458\u8d26\u53f7\u767b\u5f55":I?"\u8bf7\u8f93\u5165 Authenticator \u5e94\u7528\u4e2d\u7684 6 \u4f4d\u9a8c\u8bc1\u7801":"\u8bf7\u8f93\u5165\u53d1\u9001\u5230\u7ba1\u7406\u5458\u90ae\u7bb1\u76846\u4f4d\u9a8c\u8bc1\u7801"})]}),w&&(0,C.jsx)("div",{style:{marginBottom:20,padding:"12px",background:"#fff1f0",border:"1px solid #ffccc7",borderRadius:6,color:"#ff4d4f"},children:w}),V&&(0,C.jsx)("div",{style:{marginBottom:20,padding:"12px",background:"#f6ffed",border:"1px solid #b7eb8f",borderRadius:6,color:"#52c41a"},children:V}),"login"===t?(0,C.jsxs)(o.A,{form:h,onFinish:async t=>{f(!0),_(""),B(""),x(t);try{const r=await z.Ay.post("/api/auth/admin/login",t);if(202===r.status){var s,n;const e="true"===r.headers["x-requires-2fa"]||(null===(s=r.data)||void 0===s?void 0:s.detail)&&r.data.detail.includes("2FA"),o="true"===r.headers["x-requires-verification"]||(null===(n=r.data)||void 0===n?void 0:n.detail)&&r.data.detail.includes("\u9a8c\u8bc1\u7801");if(e)M(!0),a("verification"),B("\u8bf7\u8f93\u5165 Authenticator \u5e94\u7528\u4e2d\u7684 6 \u4f4d\u9a8c\u8bc1\u7801"),l.Ay.info("\u8bf7\u8f93\u5165 2FA \u9a8c\u8bc1\u7801");else if(o){const e=await z.Ay.post("/api/auth/admin/send-verification-code",t);k(t=>(0,i.A)((0,i.A)({},t),{},{admin_id:e.data.admin_id})),a("verification"),B("\u9a8c\u8bc1\u7801\u5df2\u53d1\u9001\u5230\u7ba1\u7406\u5458\u90ae\u7bb1\uff0c\u8bf7\u68c0\u67e5\u90ae\u7bb1\u5e76\u8f93\u5165\u9a8c\u8bc1\u7801"),l.Ay.success("\u9a8c\u8bc1\u7801\u5df2\u53d1\u9001\u5230\u7ba1\u7406\u5458\u90ae\u7bb1")}else M(!0),a("verification"),B("\u8bf7\u8f93\u5165 Authenticator \u5e94\u7528\u4e2d\u7684 6 \u4f4d\u9a8c\u8bc1\u7801"),l.Ay.info("\u8bf7\u8f93\u5165 2FA \u9a8c\u8bc1\u7801")}else{try{await z.Ay.get("/api/csrf/token")}catch(w){console.error("\u83b7\u53d6CSRF token\u5931\u8d25:",w)}l.Ay.success("\u767b\u5f55\u6210\u529f"),e("/")}}catch(w){var r,o;if(202===(null===w||void 0===w||null===(r=w.response)||void 0===r?void 0:r.status)&&"true"===(null===w||void 0===w||null===(o=w.response)||void 0===o?void 0:o.headers["x-requires-2fa"]))M(!0),a("verification"),B("\u8bf7\u8f93\u5165 Authenticator \u5e94\u7528\u4e2d\u7684 6 \u4f4d\u9a8c\u8bc1\u7801"),l.Ay.info("\u8bf7\u8f93\u5165 2FA \u9a8c\u8bc1\u7801");else{var d,c;let t="\u767b\u5f55\u5931\u8d25";null!==w&&void 0!==w&&null!==(d=w.response)&&void 0!==d&&null!==(c=d.data)&&void 0!==c&&c.detail?t=w.response.data.detail:null!==w&&void 0!==w&&w.message&&(t=w.message),_(t),l.Ay.error(t)}}finally{f(!1)}},size:"large",autoComplete:"off",children:[(0,C.jsx)(o.A.Item,{name:"username_or_id",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u7528\u6237\u540d\u6216ID"}],children:(0,C.jsx)(c.A,{prefix:(0,C.jsx)(A,{style:{color:"#bfbfbf"}}),placeholder:"\u7528\u6237\u540d\u6216\u7ba1\u7406\u5458ID (\u5982: A1234)"})}),(0,C.jsx)(o.A.Item,{name:"password",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u5bc6\u7801"}],children:(0,C.jsx)(c.A.Password,{prefix:(0,C.jsx)(j,{style:{color:"#bfbfbf"}}),placeholder:"\u5bc6\u7801"})}),(0,C.jsx)(o.A.Item,{style:{marginBottom:0},children:(0,C.jsx)(u.Ay,{type:"primary",htmlType:"submit",loading:r,block:!0,style:{height:48,fontSize:16,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",border:"none"},children:"\u767b\u5f55"})})]}):(0,C.jsxs)(o.A,{form:g,onFinish:async t=>{f(!0),_("");try{if(I){await z.Ay.post("/api/auth/admin/login",(0,i.A)((0,i.A)({},v),{},{totp_code:t.code}));try{await z.Ay.get("/api/csrf/token")}catch(w){console.error("\u83b7\u53d6CSRF token\u5931\u8d25:",w)}l.Ay.success("\u767b\u5f55\u6210\u529f"),e("/")}else{await z.Ay.post("/api/auth/admin/verify-code",(0,i.A)((0,i.A)({},b),{},{code:t.code}));try{await z.Ay.get("/api/csrf/token")}catch(w){console.error("\u83b7\u53d6CSRF token\u5931\u8d25:",w)}l.Ay.success("\u9a8c\u8bc1\u6210\u529f\uff0c\u6b63\u5728\u8df3\u8f6c..."),e("/")}}catch(w){var a,s;let t="\u9a8c\u8bc1\u5931\u8d25";null!==w&&void 0!==w&&null!==(a=w.response)&&void 0!==a&&null!==(s=a.data)&&void 0!==s&&s.detail?t=w.response.data.detail:null!==w&&void 0!==w&&w.message&&(t=w.message),_(t),l.Ay.error(t)}finally{f(!1)}},size:"large",autoComplete:"off",children:[(0,C.jsx)(o.A.Item,{name:"code",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801"},{len:6,message:"\u9a8c\u8bc1\u7801\u5fc5\u987b\u662f6\u4f4d\u6570\u5b57"},{pattern:/^\d+$/,message:"\u9a8c\u8bc1\u7801\u53ea\u80fd\u662f\u6570\u5b57"}],children:(0,C.jsx)(c.A,{prefix:(0,C.jsx)(S,{style:{color:"#bfbfbf"}}),placeholder:"000000",maxLength:6,value:m,onChange:e=>{const t=e.target.value;p(t),g.setFieldsValue({code:t})},style:{textAlign:"center",fontSize:24,letterSpacing:8,fontFamily:"monospace"}})}),(0,C.jsx)(o.A.Item,{style:{marginBottom:16},children:(0,C.jsx)(u.Ay,{type:"primary",htmlType:"submit",loading:r,block:!0,disabled:6!==m.length||!/^\d+$/.test(m)||r,style:{height:48,fontSize:16,background:6===m.length&&/^\d+$/.test(m)&&!r?"linear-gradient(135deg, #667eea 0%, #764ba2 100%)":"#d9d9d9",border:"none",cursor:6===m.length&&/^\d+$/.test(m)&&!r?"pointer":"not-allowed"},children:r?"\u9a8c\u8bc1\u4e2d...":"\u9a8c\u8bc1"})}),(0,C.jsxs)("div",{style:{display:"flex",gap:12},children:[!I&&(0,C.jsx)(u.Ay,{onClick:async()=>{f(!0),_("");try{await z.Ay.post("/api/auth/admin/send-verification-code",v),B("\u9a8c\u8bc1\u7801\u5df2\u91cd\u65b0\u53d1\u9001\u5230\u7ba1\u7406\u5458\u90ae\u7bb1"),l.Ay.success("\u9a8c\u8bc1\u7801\u5df2\u91cd\u65b0\u53d1\u9001")}catch(w){var e,t;let i="\u91cd\u65b0\u53d1\u9001\u9a8c\u8bc1\u7801\u5931\u8d25";null!==w&&void 0!==w&&null!==(e=w.response)&&void 0!==e&&null!==(t=e.data)&&void 0!==t&&t.detail?i=w.response.data.detail:null!==w&&void 0!==w&&w.message&&(i=w.message),_(i),l.Ay.error(i)}finally{f(!1)}},disabled:r,block:!0,style:{height:40,borderColor:"#d9d9d9"},children:"\u91cd\u65b0\u53d1\u9001"}),(0,C.jsx)(u.Ay,{onClick:()=>{a("login"),_(""),B(""),p(""),M(!1),k({admin_id:"",code:""}),g.resetFields()},disabled:r,block:!0,style:{height:40,borderColor:"#d9d9d9",flex:I?1:void 0},children:"\u8fd4\u56de\u767b\u5f55"})]})]}),(0,C.jsx)("div",{style:{marginTop:24,textAlign:"center",color:"#999",fontSize:12},children:"\u4ec5\u9650\u6388\u6743\u7ba1\u7406\u5458\u8bbf\u95ee"})]})})})}}}]);
//# sourceMappingURL=534.19b1f593.chunk.js.map