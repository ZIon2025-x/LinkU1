{"version":3,"file":"static/js/246.c6c86d99.chunk.js","mappings":"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","sources":["pages/admin/settings/Settings.tsx","utils/errorHandler.ts"],"sourcesContent":["import React, { useState } from 'react';\nimport { message } from 'antd';\nimport { clearCache } from '../../../api';\nimport { getErrorMessage } from '../../../utils/errorHandler';\nimport { API_BASE_URL } from '../../../config';\n\n/**\n * ç³»ç»Ÿè®¾ç½®ç»„ä»¶\n */\nconst Settings: React.FC = () => {\n  const [loading, setLoading] = useState(false);\n  const [clearingCache, setClearingCache] = useState(false);\n\n  const handleClearCache = async () => {\n    setClearingCache(true);\n    try {\n      await clearCache();\n      message.success('ç¼“å­˜æ¸…ç†æˆåŠŸ');\n    } catch (error: any) {\n      message.error(getErrorMessage(error));\n    } finally {\n      setClearingCache(false);\n    }\n  };\n\n  return (\n    <div>\n      <h2 style={{ marginBottom: '20px' }}>ç³»ç»Ÿè®¾ç½®</h2>\n\n      <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>\n        {/* ç¼“å­˜ç®¡ç† */}\n        <div style={{ background: 'white', padding: '24px', borderRadius: '8px', boxShadow: '0 2px 4px rgba(0,0,0,0.1)' }}>\n          <h3 style={{ margin: '0 0 16px 0', fontSize: '16px' }}>ç¼“å­˜ç®¡ç†</h3>\n          <p style={{ color: '#666', marginBottom: '16px' }}>\n            æ¸…ç†ç³»ç»Ÿç¼“å­˜å¯ä»¥è§£å†³æŸäº›æ•°æ®ä¸åŒæ­¥çš„é—®é¢˜ã€‚å»ºè®®åœ¨æ›´æ–°é…ç½®åæ‰§è¡Œæ­¤æ“ä½œã€‚\n          </p>\n          <button\n            onClick={handleClearCache}\n            disabled={clearingCache}\n            style={{\n              padding: '10px 20px',\n              border: 'none',\n              background: '#dc3545',\n              color: 'white',\n              borderRadius: '4px',\n              cursor: clearingCache ? 'not-allowed' : 'pointer',\n              fontSize: '14px',\n              fontWeight: '500',\n              opacity: clearingCache ? 0.6 : 1\n            }}\n          >\n            {clearingCache ? 'æ¸…ç†ä¸­...' : 'æ¸…ç†ç¼“å­˜'}\n          </button>\n        </div>\n\n        {/* ç³»ç»Ÿä¿¡æ¯ */}\n        <div style={{ background: 'white', padding: '24px', borderRadius: '8px', boxShadow: '0 2px 4px rgba(0,0,0,0.1)' }}>\n          <h3 style={{ margin: '0 0 16px 0', fontSize: '16px' }}>ç³»ç»Ÿä¿¡æ¯</h3>\n          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '16px' }}>\n            <div>\n              <div style={{ color: '#666', fontSize: '12px', marginBottom: '4px' }}>ç‰ˆæœ¬</div>\n              <div style={{ fontWeight: '500' }}>v1.0.0</div>\n            </div>\n            <div>\n              <div style={{ color: '#666', fontSize: '12px', marginBottom: '4px' }}>ç¯å¢ƒ</div>\n              <div style={{ fontWeight: '500' }}>\n                {process.env.NODE_ENV === 'production' ? 'ç”Ÿäº§ç¯å¢ƒ' : 'å¼€å‘ç¯å¢ƒ'}\n              </div>\n            </div>\n            <div>\n              <div style={{ color: '#666', fontSize: '12px', marginBottom: '4px' }}>åç«¯åœ°å€</div>\n              <div style={{ fontWeight: '500', fontSize: '12px', wordBreak: 'break-all' }}>{API_BASE_URL}</div>\n            </div>\n          </div>\n        </div>\n\n        {/* å®‰å…¨è®¾ç½® */}\n        <div style={{ background: 'white', padding: '24px', borderRadius: '8px', boxShadow: '0 2px 4px rgba(0,0,0,0.1)' }}>\n          <h3 style={{ margin: '0 0 16px 0', fontSize: '16px' }}>å®‰å…¨è®¾ç½®</h3>\n          <p style={{ color: '#666', marginBottom: '16px', fontSize: '14px' }}>\n            ç®¡ç†åŒå› ç´ è®¤è¯ (2FA) å’Œè´¦å·å®‰å…¨ã€‚\n          </p>\n          <button\n            onClick={() => window.location.href = '/2fa-settings'}\n            style={{\n              padding: '10px 20px', border: '1px solid #d9d9d9', background: 'white',\n              borderRadius: '4px', cursor: 'pointer', fontSize: '14px'\n            }}\n          >\n            ğŸ” ç®¡ç†åŒå› ç´ è®¤è¯ (2FA)\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Settings;\n","/**\r\n * ç»Ÿä¸€é”™è¯¯å¤„ç†å·¥å…·\r\n * æä¾›å‹å¥½çš„é”™è¯¯æç¤ºï¼Œç»Ÿä¸€é”™è¯¯å¤„ç†é€»è¾‘\r\n */\r\n\r\nexport interface ErrorResponse {\r\n  detail?: string | string[] | { msg?: string; message?: string };\r\n  message?: string;\r\n  error?: string;\r\n  errors?: string[];\r\n}\r\n\r\n/**\r\n * è·å–å‹å¥½çš„é”™è¯¯æ¶ˆæ¯\r\n * @param error é”™è¯¯å¯¹è±¡\r\n * @returns å‹å¥½çš„é”™è¯¯æ¶ˆæ¯\r\n */\r\nexport const getErrorMessage = (error: any): string => {\r\n  // å¤„ç†ç½‘ç»œé”™è¯¯\r\n  if (error?.code === 'ERR_NETWORK' || error?.message === 'Network Error') {\r\n    return 'ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥';\r\n  }\r\n\r\n  // å¤„ç†è¶…æ—¶é”™è¯¯\r\n  if (error?.code === 'ECONNABORTED' || error?.message?.includes('timeout')) {\r\n    return 'è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•';\r\n  }\r\n\r\n  // å¤„ç†HTTPå“åº”é”™è¯¯\r\n  if (error?.response) {\r\n    const status = error.response.status;\r\n    const data: ErrorResponse = error.response.data || {};\r\n    \r\n    switch (status) {\r\n      case 400:\r\n        return parseErrorDetail(data) || 'è¯·æ±‚å‚æ•°é”™è¯¯ï¼Œè¯·æ£€æŸ¥è¾“å…¥';\r\n      case 401:\r\n        return 'è¯·å…ˆç™»å½•';\r\n      case 403:\r\n        return parseErrorDetail(data) || 'æ²¡æœ‰æƒé™æ‰§è¡Œæ­¤æ“ä½œ';\r\n      case 404:\r\n        return parseErrorDetail(data) || 'èµ„æºä¸å­˜åœ¨';\r\n      case 409:\r\n        return parseErrorDetail(data) || 'èµ„æºå†²çªï¼Œè¯·æ£€æŸ¥æ˜¯å¦é‡å¤æ“ä½œ';\r\n      case 429:\r\n        const retryAfter = error.response.headers['retry-after'] || error.response.headers['Retry-After'];\r\n        if (retryAfter) {\r\n          return `è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·åœ¨ ${retryAfter} ç§’åé‡è¯•`;\r\n        }\r\n        return parseErrorDetail(data) || 'è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•';\r\n      case 500:\r\n        return 'æœåŠ¡å™¨é”™è¯¯ï¼Œè¯·ç¨åå†è¯•';\r\n      case 502:\r\n        return 'ç½‘å…³é”™è¯¯ï¼ŒæœåŠ¡æš‚æ—¶ä¸å¯ç”¨';\r\n      case 503:\r\n        return 'æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•';\r\n      default:\r\n        return parseErrorDetail(data) || `æ“ä½œå¤±è´¥ (${status})ï¼Œè¯·ç¨åå†è¯•`;\r\n    }\r\n  }\r\n  \r\n  // å¤„ç†æ™®é€šé”™è¯¯æ¶ˆæ¯\r\n  if (error?.message) {\r\n    return error.message;\r\n  }\r\n  \r\n  // é»˜è®¤é”™è¯¯æ¶ˆæ¯\r\n  return 'æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åå†è¯•';\r\n};\r\n\r\n/**\r\n * è§£æé”™è¯¯è¯¦æƒ…\r\n * @param data é”™è¯¯å“åº”æ•°æ®\r\n * @returns é”™è¯¯æ¶ˆæ¯å­—ç¬¦ä¸²\r\n */\r\nconst parseErrorDetail = (data: ErrorResponse): string | null => {\r\n  // ä¼˜å…ˆä½¿ç”¨ message å­—æ®µ\r\n  if (data.message) {\r\n    return data.message;\r\n  }\r\n\r\n  // ç„¶åå°è¯• detail å­—æ®µ\r\n  if (data.detail) {\r\n    if (typeof data.detail === 'string') {\r\n      return data.detail;\r\n    }\r\n    if (Array.isArray(data.detail)) {\r\n      return data.detail.map((item: any) => {\r\n        if (typeof item === 'string') {\r\n          return item;\r\n        }\r\n        return item.msg || item.message || JSON.stringify(item);\r\n      }).join('ï¼›');\r\n    }\r\n    if (typeof data.detail === 'object') {\r\n      return data.detail.msg || data.detail.message || JSON.stringify(data.detail);\r\n    }\r\n  }\r\n\r\n  // å°è¯• errors æ•°ç»„\r\n  if (data.errors && Array.isArray(data.errors)) {\r\n    return data.errors.join('ï¼›');\r\n  }\r\n\r\n  // å°è¯• error å­—æ®µ\r\n  if (data.error) {\r\n    return data.error;\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\n/**\r\n * åˆ¤æ–­é”™è¯¯æ˜¯å¦å¯é‡è¯•\r\n * @param error é”™è¯¯å¯¹è±¡\r\n * @returns æ˜¯å¦å¯é‡è¯•\r\n */\r\nexport const isRetryableError = (error: any): boolean => {\r\n  if (!error?.response) {\r\n    // ç½‘ç»œé”™è¯¯å¯ä»¥é‡è¯•\r\n    return error?.code === 'ERR_NETWORK' || error?.message === 'Network Error';\r\n  }\r\n\r\n  const status = error.response.status;\r\n  // 5xx é”™è¯¯å’Œ 429 é”™è¯¯å¯ä»¥é‡è¯•\r\n  return status >= 500 || status === 429;\r\n};\r\n\r\n/**\r\n * è·å–é‡è¯•å»¶è¿Ÿæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰\r\n * @param error é”™è¯¯å¯¹è±¡\r\n * @param attempt å½“å‰é‡è¯•æ¬¡æ•°\r\n * @returns å»¶è¿Ÿæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰\r\n */\r\nexport const getRetryDelay = (error: any, attempt: number = 1): number => {\r\n  // å¦‚æœæœ‰ Retry-After å¤´ï¼Œä½¿ç”¨å®ƒ\r\n  const retryAfter = error?.response?.headers?.['retry-after'] || \r\n                     error?.response?.headers?.['Retry-After'];\r\n  if (retryAfter) {\r\n    return parseInt(retryAfter, 10) * 1000;\r\n  }\r\n\r\n  // æŒ‡æ•°é€€é¿ï¼š1s, 2s, 4s, 8s...\r\n  return Math.min(1000 * Math.pow(2, attempt - 1), 8000);\r\n};\r\n\r\n/**\r\n * è®°å½•é”™è¯¯ï¼ˆç”¨äºé”™è¯¯ç›‘æ§ï¼‰\r\n * @param error é”™è¯¯å¯¹è±¡\r\n * @param context é”™è¯¯ä¸Šä¸‹æ–‡\r\n */\r\nexport const logError = (error: any, context?: Record<string, any>): void => {\r\n  const errorMessage = getErrorMessage(error);\r\n  const errorInfo = {\r\n    message: errorMessage,\r\n    status: error?.response?.status,\r\n    url: error?.config?.url || error?.request?.url,\r\n    method: error?.config?.method,\r\n    context,\r\n    timestamp: new Date().toISOString(),\r\n  };\r\n\r\n  // åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¯ä»¥å‘é€åˆ°é”™è¯¯ç›‘æ§æœåŠ¡ï¼ˆå¦‚ Sentryï¼‰\r\n  if (process.env.NODE_ENV === 'production') {\r\n    // TODO: é›†æˆé”™è¯¯ç›‘æ§æœåŠ¡\r\n    // Sentry.captureException(error, { extra: errorInfo });\r\n    // é”™è¯¯ä¿¡æ¯å·²è®°å½•ï¼Œå¯ç”¨äºé”™è¯¯ç›‘æ§æœåŠ¡\r\n  } else {\r\n    // å¼€å‘ç¯å¢ƒï¼šé”™è¯¯ä¿¡æ¯å·²è®°å½•\r\n    // å¦‚éœ€è°ƒè¯•ï¼Œå¯åœ¨æ­¤å¤„æ·»åŠ æ—¥å¿—è¾“å‡º\r\n  }\r\n};\r\n\r\n"],"names":["Settings","loading","setLoading","useState","clearingCache","setClearingCache","_jsxs","children","_jsx","style","marginBottom","display","flexDirection","gap","background","padding","borderRadius","boxShadow","margin","fontSize","color","onClick","async","clearCache","message","success","error","getErrorMessage","disabled","border","cursor","fontWeight","opacity","gridTemplateColumns","wordBreak","API_BASE_URL","window","location","href","_error$message","code","includes","response","status","data","parseErrorDetail","retryAfter","headers","concat","detail","Array","isArray","map","item","msg","JSON","stringify","join","errors"],"sourceRoot":""}