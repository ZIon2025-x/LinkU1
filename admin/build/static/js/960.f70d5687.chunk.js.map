{"version":3,"file":"static/js/960.f70d5687.chunk.js","mappings":"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","sources":["pages/admin/users/types.ts","webpack://linku-admin/./src/pages/admin/users/UserManagement.module.css?4d5e","pages/admin/users/UserManagement.tsx","utils/exportUtils.ts"],"sourcesContent":["/**\r\n * UserManagement 模块类型定义\r\n */\r\n\r\nexport interface User {\r\n  id: string;\r\n  name: string;\r\n  inviter_id?: string;\r\n  invitation_code_text?: string;\r\n  invitation_code_id?: number;\r\n  email: string;\r\n  user_level: 'normal' | 'vip' | 'super';\r\n  is_active: number;\r\n  is_banned: number;\r\n  is_suspended: number;\r\n  created_at: string;\r\n  task_count: number;\r\n  avg_rating: number;\r\n}\r\n\r\nexport interface UserUpdateData {\r\n  user_level?: string;\r\n  is_banned?: number;\r\n  is_suspended?: number;\r\n  suspend_until?: string;\r\n}\r\n\r\nexport type UserLevel = 'normal' | 'vip' | 'super';\r\n\r\nexport const USER_LEVEL_LABELS: Record<UserLevel, string> = {\r\n  normal: '普通',\r\n  vip: 'VIP',\r\n  super: '超级'\r\n};\r\n","// extracted by mini-css-extract-plugin\nexport default {\"container\":\"UserManagement_container__3JMs9\",\"header\":\"UserManagement_header__8YeLx\",\"title\":\"UserManagement_title__xjTVl\",\"searchContainer\":\"UserManagement_searchContainer__t9kNR\",\"searchInput\":\"UserManagement_searchInput__C-JZR\",\"errorMessage\":\"UserManagement_errorMessage__KDTeu\",\"tableContainer\":\"UserManagement_tableContainer__9o6lZ\",\"table\":\"UserManagement_table__OhSV7\",\"tableHeader\":\"UserManagement_tableHeader__WoF3j\",\"tableHeaderCell\":\"UserManagement_tableHeaderCell__chgGk\",\"stickyCell\":\"UserManagement_stickyCell__Ky-rR\",\"stickyIdCell\":\"UserManagement_stickyIdCell__OgNFX\",\"stickyNameCell\":\"UserManagement_stickyNameCell__cjbg4\",\"tableRow\":\"UserManagement_tableRow__jqD+V\",\"tableCell\":\"UserManagement_tableCell__k0+rs\",\"tableCellSticky\":\"UserManagement_tableCellSticky__qdtDF\",\"levelSelect\":\"UserManagement_levelSelect__qFFAO\",\"statusBadge\":\"UserManagement_statusBadge__XHzjN\",\"statusBanned\":\"UserManagement_statusBanned__7Z8Ra\",\"statusSuspended\":\"UserManagement_statusSuspended__AXOoS\",\"statusActive\":\"UserManagement_statusActive__FXIQe\",\"statusInactive\":\"UserManagement_statusInactive__LfQiA\",\"inviteCode\":\"UserManagement_inviteCode__7SiCl\",\"inviterId\":\"UserManagement_inviterId__yqV1D\",\"placeholder\":\"UserManagement_placeholder__oxNvX\",\"actionGroup\":\"UserManagement_actionGroup__rfWBL\",\"actionBtn\":\"UserManagement_actionBtn__9Oll4\",\"btnDanger\":\"UserManagement_btnDanger__To4Re\",\"btnSuccess\":\"UserManagement_btnSuccess__EQ4+P\",\"btnWarning\":\"UserManagement_btnWarning__+ikJP\",\"btnPrimary\":\"UserManagement_btnPrimary__E239W\",\"emptyRow\":\"UserManagement_emptyRow__mzpXd\",\"pagination\":\"UserManagement_pagination__7sDhl\",\"pageBtn\":\"UserManagement_pageBtn__5HOdf\",\"pageInfo\":\"UserManagement_pageInfo__Dg3Yl\",\"modal\":\"UserManagement_modal__DCa2z\",\"modalContent\":\"UserManagement_modalContent__oInn5\",\"modalTitle\":\"UserManagement_modalTitle__zo9zM\",\"modalLabel\":\"UserManagement_modalLabel__cuZx9\",\"modalInput\":\"UserManagement_modalInput__-Qzb3\",\"modalActions\":\"UserManagement_modalActions__SSAU5\",\"modalBtn\":\"UserManagement_modalBtn__fw7oM\",\"modalBtnCancel\":\"UserManagement_modalBtnCancel__QtC+r\",\"modalBtnConfirm\":\"UserManagement_modalBtnConfirm__Hbfj4\",\"loadingContainer\":\"UserManagement_loadingContainer__pq5RP\"};","import React, { useState } from 'react';\r\nimport { message } from 'antd';\r\nimport dayjs from 'dayjs';\r\nimport { getUsersForAdmin, updateUserByAdmin } from '../../../api';\r\nimport { getErrorMessage } from '../../../utils/errorHandler';\r\nimport { User, USER_LEVEL_LABELS, UserLevel } from './types';\r\nimport { useAdminTable, useModalForm } from '../../../hooks';\r\nimport { AdminTable, AdminPagination, AdminModal, Column } from '../../../components/admin';\r\nimport { exportToCSV, ExportColumn } from '../../../utils/exportUtils';\r\nimport styles from './UserManagement.module.css';\r\n\r\nconst USER_EXPORT_COLUMNS: ExportColumn[] = [\r\n  { key: 'id', label: 'ID' },\r\n  { key: 'name', label: '用户名' },\r\n  { key: 'email', label: '邮箱' },\r\n  { key: 'user_level', label: '等级', format: v => USER_LEVEL_LABELS[v as UserLevel] || v },\r\n  { key: 'is_banned', label: '封禁', format: v => v ? '是' : '否' },\r\n  { key: 'is_suspended', label: '暂停', format: v => v ? '是' : '否' },\r\n  { key: 'task_count', label: '任务数' },\r\n  { key: 'avg_rating', label: '评分', format: v => Number(v).toFixed(1) },\r\n  { key: 'created_at', label: '注册时间', format: v => dayjs(v).format('YYYY-MM-DD') },\r\n];\r\n\r\n/**\r\n * 用户管理组件\r\n * 提供用户列表查看、搜索、等级修改、封禁/暂停等功能\r\n */\r\nconst UserManagement: React.FC = () => {\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [userActionLoading, setUserActionLoading] = useState<string | null>(null);\r\n\r\n  const table = useAdminTable<User>({\r\n    fetchData: async ({ page, pageSize, searchTerm }) => {\r\n      const response = await getUsersForAdmin(page, pageSize, searchTerm || undefined);\r\n      return {\r\n        data: response.users || [],\r\n        total: (response.total_pages || 1) * pageSize,\r\n      };\r\n    },\r\n    initialPageSize: 20,\r\n    onError: (err) => setError(getErrorMessage(err)),\r\n  });\r\n\r\n  interface SuspendForm { userId: string; days: number; }\r\n  const suspendModal = useModalForm<SuspendForm>({\r\n    initialValues: { userId: '', days: 1 },\r\n    onSubmit: async (values) => {\r\n      const suspendUntil = new Date();\r\n      suspendUntil.setDate(suspendUntil.getDate() + values.days);\r\n      await updateUserByAdmin(values.userId, {\r\n        is_suspended: 1,\r\n        suspend_until: suspendUntil.toISOString(),\r\n      });\r\n      message.success(`用户已暂停${values.days}天`);\r\n      table.refresh();\r\n    },\r\n    onError: (err) => message.error(getErrorMessage(err)),\r\n  });\r\n\r\n  // 更新用户等级\r\n  const handleUpdateUserLevel = async (userId: string, newLevel: string) => {\r\n    setUserActionLoading(userId);\r\n    try {\r\n      await updateUserByAdmin(userId, { user_level: newLevel });\r\n      message.success('用户等级更新成功！');\r\n      table.refresh();\r\n    } catch (err: any) {\r\n      message.error(getErrorMessage(err));\r\n    } finally {\r\n      setUserActionLoading(null);\r\n    }\r\n  };\r\n\r\n  // 封禁/解封用户\r\n  const handleBanUser = async (userId: string, isBanned: number) => {\r\n    setUserActionLoading(userId);\r\n    try {\r\n      await updateUserByAdmin(userId, { is_banned: isBanned });\r\n      message.success(isBanned ? '用户已封禁' : '用户已解封');\r\n      table.refresh();\r\n    } catch (err: any) {\r\n      message.error(getErrorMessage(err));\r\n    } finally {\r\n      setUserActionLoading(null);\r\n    }\r\n  };\r\n\r\n  // 暂停/恢复用户\r\n  const handleSuspendUser = async (userId: string, isSuspended: number) => {\r\n    setUserActionLoading(userId);\r\n    try {\r\n      await updateUserByAdmin(userId, { is_suspended: isSuspended });\r\n      message.success(isSuspended ? '用户已暂停' : '用户已恢复');\r\n      table.refresh();\r\n    } catch (err: any) {\r\n      message.error(getErrorMessage(err));\r\n    } finally {\r\n      setUserActionLoading(null);\r\n    }\r\n  };\r\n\r\n  const handleExport = () => {\r\n    exportToCSV(\r\n      table.data as Record<string, any>[],\r\n      `users-${dayjs().format('YYYY-MM-DD')}`,\r\n      USER_EXPORT_COLUMNS\r\n    );\r\n  };\r\n\r\n  // 获取状态样式\r\n  const getStatusClassName = (user: User) => {\r\n    if (user.is_banned) return styles.statusBanned;\r\n    if (user.is_suspended) return styles.statusSuspended;\r\n    if (user.is_active) return styles.statusActive;\r\n    return styles.statusInactive;\r\n  };\r\n\r\n  // 获取状态文本\r\n  const getStatusText = (user: User) => {\r\n    if (user.is_banned) return '已封禁';\r\n    if (user.is_suspended) return '已暂停';\r\n    if (user.is_active) return '正常';\r\n    return '未激活';\r\n  };\r\n\r\n  const columns: Column<User>[] = [\r\n    { key: 'id', title: 'ID', dataIndex: 'id', fixed: 'left', width: 80 },\r\n    { key: 'name', title: '用户名', dataIndex: 'name', fixed: 'left', width: 120 },\r\n    { key: 'email', title: '邮箱', dataIndex: 'email', width: 200 },\r\n    {\r\n      key: 'user_level', title: '等级', width: 120,\r\n      render: (_, user) => (\r\n        <select\r\n          value={user.user_level}\r\n          onChange={e => handleUpdateUserLevel(user.id, e.target.value)}\r\n          disabled={userActionLoading === user.id}\r\n          className={styles.levelSelect}\r\n        >\r\n          {Object.entries(USER_LEVEL_LABELS).map(([v, l]) => (\r\n            <option key={v} value={v}>{l}</option>\r\n          ))}\r\n        </select>\r\n      ),\r\n    },\r\n    {\r\n      key: 'status', title: '状态', width: 100,\r\n      render: (_, user) => (\r\n        <span className={`${styles.statusBadge} ${getStatusClassName(user)}`}>\r\n          {getStatusText(user)}\r\n        </span>\r\n      ),\r\n    },\r\n    { key: 'task_count', title: '任务数', dataIndex: 'task_count', width: 80 },\r\n    { key: 'avg_rating', title: '评分', width: 80, render: (_, u) => u.avg_rating.toFixed(1) },\r\n    {\r\n      key: 'invitation_code_text', title: '邀请码', width: 120,\r\n      render: (_, u) => u.invitation_code_text\r\n        ? <span className={styles.inviteCode}>{u.invitation_code_text}</span>\r\n        : <span className={styles.placeholder}>-</span>,\r\n    },\r\n    {\r\n      key: 'inviter_id', title: '邀请人', width: 120,\r\n      render: (_, u) => u.inviter_id\r\n        ? <span className={styles.inviterId} onClick={() => table.setSearchTerm(u.inviter_id!)} title=\"点击查看邀请人信息\">{u.inviter_id}</span>\r\n        : <span className={styles.placeholder}>-</span>,\r\n    },\r\n    {\r\n      key: 'created_at', title: '注册时间', width: 120,\r\n      render: (_, u) => dayjs(u.created_at).format('YYYY-MM-DD'),\r\n    },\r\n    {\r\n      key: 'actions', title: '操作', width: 220,\r\n      render: (_, user) => (\r\n        <div className={styles.actionGroup}>\r\n          <button\r\n            onClick={() => handleBanUser(user.id, user.is_banned ? 0 : 1)}\r\n            disabled={userActionLoading === user.id}\r\n            className={`${styles.actionBtn} ${user.is_banned ? styles.btnSuccess : styles.btnDanger}`}\r\n          >\r\n            {user.is_banned ? '解封' : '封禁'}\r\n          </button>\r\n          <button\r\n            onClick={() => user.is_suspended\r\n              ? handleSuspendUser(user.id, 0)\r\n              : suspendModal.open({ userId: user.id, days: 1 })}\r\n            disabled={userActionLoading === user.id}\r\n            className={`${styles.actionBtn} ${user.is_suspended ? styles.btnSuccess : styles.btnWarning}`}\r\n          >\r\n            {user.is_suspended ? '恢复' : '暂停'}\r\n          </button>\r\n          <button\r\n            onClick={() => handleUpdateUserLevel(user.id, 'normal')}\r\n            disabled={userActionLoading === user.id}\r\n            className={`${styles.actionBtn} ${styles.btnPrimary}`}\r\n          >\r\n            重置等级\r\n          </button>\r\n        </div>\r\n      ),\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <div className={styles.container}>\r\n      <div className={styles.header}>\r\n        <h2 className={styles.title}>用户管理</h2>\r\n        <button\r\n          onClick={handleExport}\r\n          disabled={table.data.length === 0}\r\n          style={{\r\n            padding: '8px 16px',\r\n            border: '1px solid #52c41a',\r\n            background: 'white',\r\n            color: '#52c41a',\r\n            borderRadius: '4px',\r\n            cursor: 'pointer',\r\n            fontSize: '14px',\r\n          }}\r\n        >\r\n          导出 CSV\r\n        </button>\r\n      </div>\r\n\r\n      <div className={styles.searchContainer}>\r\n        <input\r\n          type=\"text\"\r\n          placeholder=\"搜索用户ID、用户名或邮箱...\"\r\n          value={table.searchTerm}\r\n          onChange={e => table.setSearchTerm(e.target.value)}\r\n          className={styles.searchInput}\r\n        />\r\n      </div>\r\n\r\n      {error && <div className={styles.errorMessage}>{error}</div>}\r\n\r\n      <AdminTable\r\n        columns={columns}\r\n        data={table.data}\r\n        loading={table.loading}\r\n        rowKey=\"id\"\r\n        emptyText=\"暂无用户数据\"\r\n      />\r\n\r\n      <AdminPagination\r\n        currentPage={table.currentPage}\r\n        totalPages={table.totalPages}\r\n        total={table.total}\r\n        pageSize={table.pageSize}\r\n        onPageChange={table.setCurrentPage}\r\n      />\r\n\r\n      {/* Suspend modal */}\r\n      <AdminModal\r\n        isOpen={suspendModal.isOpen}\r\n        onClose={suspendModal.close}\r\n        title=\"暂停用户\"\r\n        footer={\r\n          <div style={{ display: 'flex', gap: '8px', justifyContent: 'flex-end' }}>\r\n            <button onClick={suspendModal.close} style={{ padding: '8px 16px', border: '1px solid #d9d9d9', borderRadius: '4px', cursor: 'pointer', background: 'white' }}>\r\n              取消\r\n            </button>\r\n            <button\r\n              onClick={suspendModal.handleSubmit}\r\n              disabled={suspendModal.loading}\r\n              style={{ padding: '8px 16px', border: 'none', borderRadius: '4px', cursor: 'pointer', background: '#faad14', color: 'white' }}\r\n            >\r\n              {suspendModal.loading ? '处理中...' : '确认暂停'}\r\n            </button>\r\n          </div>\r\n        }\r\n      >\r\n        <div style={{ padding: '8px 0' }}>\r\n          <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500' }}>暂停天数</label>\r\n          <input\r\n            type=\"number\"\r\n            min=\"1\"\r\n            max=\"365\"\r\n            value={suspendModal.formData.days}\r\n            onChange={e => suspendModal.updateField('days', parseInt(e.target.value) || 1)}\r\n            style={{ width: '100%', padding: '8px', border: '1px solid #d9d9d9', borderRadius: '4px', fontSize: '14px' }}\r\n          />\r\n        </div>\r\n      </AdminModal>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default UserManagement;\r\n","export interface ExportColumn {\r\n  key: string;\r\n  label: string;\r\n  /** Optional transform function for the cell value */\r\n  format?: (value: any, row: Record<string, any>) => string;\r\n}\r\n\r\n/**\r\n * Export data as CSV and trigger browser download.\r\n * UTF-8 BOM is prepended so Excel opens Chinese characters correctly.\r\n */\r\nexport function exportToCSV(\r\n  data: Record<string, any>[],\r\n  filename: string,\r\n  columns: ExportColumn[]\r\n): void {\r\n  const header = columns.map(c => `\"${c.label}\"`).join(',');\r\n  const rows = data.map(row =>\r\n    columns\r\n      .map(c => {\r\n        const raw = c.format ? c.format(row[c.key], row) : row[c.key];\r\n        const value = raw == null ? '' : String(raw);\r\n        return `\"${value.replace(/\"/g, '\"\"')}\"`;\r\n      })\r\n      .join(',')\r\n  );\r\n  const csv = [header, ...rows].join('\\r\\n');\r\n  const blob = new Blob(['\\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });\r\n  const url = URL.createObjectURL(blob);\r\n  const a = document.createElement('a');\r\n  a.href = url;\r\n  a.download = `${filename}.csv`;\r\n  document.body.appendChild(a);\r\n  a.click();\r\n  document.body.removeChild(a);\r\n  URL.revokeObjectURL(url);\r\n}\r\n"],"names":["USER_LEVEL_LABELS","normal","vip","super","USER_EXPORT_COLUMNS","key","label","format","v","Number","toFixed","dayjs","UserManagement","error","setError","useState","userActionLoading","setUserActionLoading","table","useAdminTable","fetchData","async","page","pageSize","searchTerm","_ref","response","getUsersForAdmin","undefined","data","users","total","total_pages","initialPageSize","onError","err","getErrorMessage","suspendModal","useModalForm","initialValues","userId","days","onSubmit","suspendUntil","Date","setDate","getDate","values","updateUserByAdmin","is_suspended","suspend_until","toISOString","message","success","concat","refresh","handleUpdateUserLevel","newLevel","user_level","getStatusClassName","user","is_banned","styles","is_active","getStatusText","columns","title","dataIndex","fixed","width","render","_","_jsx","value","onChange","e","id","target","disabled","className","children","Object","entries","map","_ref2","l","u","avg_rating","invitation_code_text","inviter_id","onClick","setSearchTerm","created_at","_jsxs","isBanned","handleBanUser","isSuspended","handleSuspendUser","open","handleExport","exportToCSV","length","style","padding","border","background","color","borderRadius","cursor","fontSize","type","placeholder","AdminTable","loading","rowKey","emptyText","AdminPagination","currentPage","totalPages","onPageChange","setCurrentPage","AdminModal","isOpen","onClose","close","footer","display","gap","justifyContent","handleSubmit","marginBottom","fontWeight","min","max","formData","updateField","parseInt","filename","csv","c","join","row","raw","String","replace","blob","Blob","url","URL","createObjectURL","a","document","createElement","href","download","body","appendChild","click","removeChild","revokeObjectURL"],"sourceRoot":""}