# 自定义排行榜功能测试清单

## 📋 测试概述

本文档提供了自定义排行榜功能的完整测试清单，用于确保所有功能正常工作。

## ✅ 功能测试

### 1. 榜单申请功能

#### 1.1 正常流程
- [ ] 用户登录后可以申请创建新榜单
- [ ] 填写榜单名称（2-100字符）
- [ ] 选择地区
- [ ] 填写描述（可选，最多2000字符）
- [ ] 填写申请理由（最多1000字符）
- [ ] 提交后显示"榜单申请已提交，等待审核"
- [ ] 申请后榜单状态为"pending"

#### 1.2 验证测试
- [ ] 未登录用户无法申请（提示"请先登录"）
- [ ] 榜单名称为空或少于2字符（提示错误）
- [ ] 榜单名称超过100字符（提示错误）
- [ ] 未选择地区（提示错误）
- [ ] 描述超过2000字符（提示错误）
- [ ] 申请理由超过1000字符（提示错误）
- [ ] 相同地区相同名称的榜单已存在（提示"该地区已存在相同名称的榜单"）
- [ ] 速率限制：5分钟内申请超过5次（提示速率限制）

### 2. 榜单列表功能

#### 2.1 正常流程
- [ ] 可以查看所有active状态的榜单
- [ ] 榜单列表显示正确（名称、地区、统计信息）
- [ ] 点击榜单卡片可以跳转到详情页
- [ ] 分页功能正常（默认20条/页）
- [ ] 可以切换页码
- [ ] 显示总数和当前页信息

#### 2.2 筛选和搜索
- [ ] 按地区筛选功能正常
- [ ] 关键词搜索功能正常（搜索名称和描述）
- [ ] 搜索防抖功能正常（500ms延迟）
- [ ] 搜索关键词超过100字符（提示错误）
- [ ] 清空筛选条件后显示所有榜单

#### 2.3 排序功能
- [ ] 按"最新"排序（created_at DESC）
- [ ] 按"热门"排序（综合投票数、竞品数、浏览量）
- [ ] 按"投票数"排序（vote_count DESC）
- [ ] 按"竞品数"排序（item_count DESC）
- [ ] 切换排序后列表正确更新

### 3. 榜单详情功能

#### 3.1 正常流程
- [ ] 可以查看榜单详情
- [ ] 显示榜单名称、地区、描述
- [ ] 显示统计信息（竞品数、投票数、浏览量）
- [ ] 显示封面图片（如果有）
- [ ] 浏览量自动增加

#### 3.2 权限测试
- [ ] 未激活的榜单无法访问（404错误）
- [ ] 已拒绝的榜单无法访问（404错误）
- [ ] 待审核的榜单无法访问（404错误）

### 4. 新增竞品功能

#### 4.1 正常流程
- [ ] 登录用户可以在active榜单中新增竞品
- [ ] 填写竞品名称（1-200字符）
- [ ] 填写描述（可选，最多1000字符）
- [ ] 填写地址（可选，最多500字符）
- [ ] 填写电话（可选，最多50字符）
- [ ] 填写网站（可选，最多500字符，自动添加https://）
- [ ] 上传图片（最多5张，自动压缩）
- [ ] 提交后显示"竞品新增成功"
- [ ] 新增后自动刷新列表并跳转到第一页

#### 4.2 验证测试
- [ ] 未登录用户无法新增（提示"请先登录"）
- [ ] 竞品名称为空（提示错误）
- [ ] 竞品名称超过200字符（提示错误）
- [ ] 描述超过1000字符（提示错误）
- [ ] 地址超过500字符（提示错误）
- [ ] 电话超过50字符（提示错误）
- [ ] 网站超过500字符（提示错误）
- [ ] 上传超过5张图片（提示错误）
- [ ] 相同名称的竞品已存在（提示"该榜单中已存在相同名称的竞品"）
- [ ] 速率限制：1分钟内新增超过10次（提示速率限制）

#### 4.3 图片上传测试
- [ ] 可以上传单张图片
- [ ] 可以上传多张图片（最多5张）
- [ ] 图片自动压缩（最大1MB）
- [ ] 可以预览上传的图片
- [ ] 可以删除已上传的图片
- [ ] 上传失败时显示错误提示

### 5. 竞品列表功能

#### 5.1 正常流程
- [ ] 可以查看榜单中的所有竞品
- [ ] 显示竞品排名（前3名显示🏆）
- [ ] 显示竞品名称、描述、联系方式
- [ ] 显示投票统计（点赞数、点踩数、净赞数、得分）
- [ ] 显示图片（如果有）
- [ ] 分页功能正常（默认20条/页）

#### 5.2 排序功能
- [ ] 按"综合得分"排序（vote_score DESC）
- [ ] 按"净赞数"排序（net_votes DESC）
- [ ] 按"点赞数"排序（upvotes DESC）
- [ ] 按"最新添加"排序（created_at DESC）
- [ ] 切换排序后列表正确更新

#### 5.3 用户投票状态
- [ ] 已登录用户可以看到自己的投票状态
- [ ] 显示自己的投票类型（upvote/downvote）
- [ ] 显示自己的投票留言（如果有）
- [ ] 显示是否匿名投票

### 6. 投票功能

#### 6.1 正常流程
- [ ] 登录用户可以对竞品投票
- [ ] 可以点赞（upvote）
- [ ] 可以点踩（downvote）
- [ ] 可以添加投票留言（可选，最多500字）
- [ ] 可以选择匿名投票
- [ ] 投票后立即更新投票数
- [ ] 投票后自动重新排序（如果按vote_score排序）

#### 6.2 修改和取消投票
- [ ] 可以修改投票（从点赞改为点踩，或相反）
- [ ] 可以取消投票（点击已投票的按钮）
- [ ] 取消投票后投票数正确更新
- [ ] 修改投票后留言可以更新

#### 6.3 验证测试
- [ ] 未登录用户无法投票（提示"请先登录"）
- [ ] 投票留言超过500字符（提示错误）
- [ ] 对已投票的竞品再次投票相同类型（提示"您已经投过相同的票"）
- [ ] 对不存在的竞品投票（404错误）
- [ ] 对非active榜单的竞品投票（404错误）
- [ ] 速率限制：1分钟内投票超过30次（提示速率限制）

#### 6.4 XSS防护测试
- [ ] 投票留言中包含HTML标签（应该被清洗）
- [ ] 投票留言中包含JavaScript代码（应该被清洗）
- [ ] 清洗后的留言正确显示

### 7. 管理员功能

#### 7.1 榜单审核
- [ ] 管理员可以查看所有状态的榜单
- [ ] 可以批准榜单（状态变为active）
- [ ] 可以拒绝榜单（状态变为rejected）
- [ ] 可以添加审核意见
- [ ] 审核后记录审核人和审核时间

#### 7.2 查看投票记录
- [ ] 管理员可以查看所有投票记录
- [ ] 可以按竞品ID筛选
- [ ] 可以按榜单ID筛选
- [ ] 可以按是否匿名筛选
- [ ] 可以按关键词搜索（用户名/留言内容）
- [ ] 始终显示真实user_id（即使匿名）

### 8. 性能测试

#### 8.1 查询性能
- [ ] 榜单列表查询时间 < 100ms
- [ ] 竞品列表查询时间 < 100ms
- [ ] 分页查询性能正常
- [ ] 搜索查询性能正常

#### 8.2 并发测试
- [ ] 多个用户同时投票（数据一致性）
- [ ] 多个用户同时新增竞品（唯一约束生效）
- [ ] 高并发下的响应时间正常

### 9. 错误处理测试

#### 9.1 HTTP错误
- [ ] 401错误：未登录（提示"请先登录"）
- [ ] 403错误：无权限（提示"没有权限"）
- [ ] 404错误：资源不存在（提示"不存在或已删除"）
- [ ] 429错误：速率限制（显示重试时间）
- [ ] 500错误：服务器错误（提示"服务器错误，请稍后重试"）

#### 9.2 数据验证错误
- [ ] 所有必填字段验证
- [ ] 所有字段长度限制验证
- [ ] URL格式验证
- [ ] 唯一约束验证

### 10. UI/UX测试

#### 10.1 响应式设计
- [ ] 桌面端显示正常
- [ ] 移动端显示正常
- [ ] 平板端显示正常

#### 10.2 交互体验
- [ ] 加载状态显示正常
- [ ] 空状态显示友好
- [ ] 错误提示清晰
- [ ] 操作反馈及时
- [ ] 图片预览功能正常
- [ ] 分页跳转流畅

#### 10.3 视觉设计
- [ ] 排名徽章显示正确（前3名🏆）
- [ ] 投票按钮状态正确（高亮已投票）
- [ ] 净赞数颜色区分（正数绿色，负数红色）
- [ ] 用户留言背景色区分（点赞绿色，点踩红色）

## 🔒 安全测试

### 1. 认证和授权
- [ ] 所有写操作需要登录
- [ ] CSRF保护生效
- [ ] 管理员功能需要管理员权限

### 2. 输入验证
- [ ] SQL注入防护（使用ORM参数化查询）
- [ ] XSS防护（投票留言使用bleach清洗）
- [ ] 文件上传验证（图片格式、大小）

### 3. 速率限制
- [ ] 申请榜单速率限制（5次/5分钟）
- [ ] 新增竞品速率限制（10次/分钟）
- [ ] 投票速率限制（30次/分钟）

## 📊 数据完整性测试

### 1. 数据库约束
- [ ] 榜单名称+地区唯一约束生效
- [ ] 竞品名称+榜单ID唯一约束生效
- [ ] 用户+竞品投票唯一约束生效
- [ ] 外键约束生效（删除用户时级联删除）

### 2. 数据统计
- [ ] 榜单item_count正确更新
- [ ] 榜单vote_count正确更新
- [ ] 榜单view_count正确更新
- [ ] 竞品投票数正确更新
- [ ] 竞品vote_score正确计算

## 🎯 边界情况测试

### 1. 空数据
- [ ] 无榜单时显示空状态
- [ ] 无竞品时显示空状态
- [ ] 无投票时显示0

### 2. 极端数据
- [ ] 榜单名称最大长度（100字符）
- [ ] 竞品名称最大长度（200字符）
- [ ] 描述最大长度（1000/2000字符）
- [ ] 投票留言最大长度（500字符）
- [ ] 上传最大图片数（5张）

### 3. 并发操作
- [ ] 同时申请相同名称的榜单（只有一个成功）
- [ ] 同时新增相同名称的竞品（只有一个成功）
- [ ] 同时投票（数据一致性）

## 📝 测试记录

### 测试环境
- 后端版本：_______
- 前端版本：_______
- 数据库版本：_______
- 测试日期：_______
- 测试人员：_______

### 测试结果
- 通过：___ / ___
- 失败：___ / ___
- 阻塞：___ / ___

### 问题记录
1. [问题描述]
   - 严重程度：高/中/低
   - 状态：待修复/已修复/已关闭

---

**测试完成日期**：_______
**测试结论**：通过/不通过/部分通过

