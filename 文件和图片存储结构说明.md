# æ–‡ä»¶å’Œå›¾ç‰‡å­˜å‚¨ç»“æ„è¯´æ˜

## ğŸ“ å­˜å‚¨ç›®å½•ç»“æ„

### æ€»ä½“ç»“æ„
```
uploads/
â”œâ”€â”€ public/              # å…¬å¼€æ–‡ä»¶ï¼ˆå¯ç›´æ¥è®¿é—®ï¼‰
â”‚   â”œâ”€â”€ images/          # å…¬å¼€å›¾ç‰‡
â”‚   â”‚   â”œâ”€â”€ expert_avatars/    # ä»»åŠ¡è¾¾äººå¤´åƒ
â”‚   â”‚   â”œâ”€â”€ service_images/    # æœåŠ¡å›¾ç‰‡
â”‚   â”‚   â””â”€â”€ public/            # ä»»åŠ¡ç›¸å…³å›¾ç‰‡
â”‚   â””â”€â”€ files/           # å…¬å¼€æ–‡ä»¶
â”‚
â””â”€â”€ private/             # ç§æœ‰æ–‡ä»¶ï¼ˆéœ€è¦ç­¾åURLï¼‰
    â”œâ”€â”€ images/          # ç§æœ‰å›¾ç‰‡
    â””â”€â”€ files/           # ç§æœ‰æ–‡ä»¶
```

### ç§å¯†æ–‡ä»¶å­˜å‚¨ï¼ˆæŒ‰åˆ†ç±»ï¼‰

#### 1. å›¾ç‰‡å­˜å‚¨ (`private_images/`)
```
uploads/private_images/
â”œâ”€â”€ tasks/               # ä»»åŠ¡èŠå¤©å›¾ç‰‡
â”‚   â””â”€â”€ {task_id}/      # æŒ‰ä»»åŠ¡IDåˆ†ç±»
â”‚       â””â”€â”€ {image_id}.jpg
â”‚
â””â”€â”€ chats/               # å®¢æœèŠå¤©å›¾ç‰‡
    â””â”€â”€ {chat_id}/       # æŒ‰èŠå¤©IDåˆ†ç±»
        â””â”€â”€ {image_id}.jpg
```

#### 2. æ–‡ä»¶å­˜å‚¨ (`private_files/`)
```
uploads/private_files/
â”œâ”€â”€ tasks/               # ä»»åŠ¡èŠå¤©æ–‡ä»¶
â”‚   â””â”€â”€ {task_id}/      # æŒ‰ä»»åŠ¡IDåˆ†ç±»
â”‚       â””â”€â”€ {file_id}.pdf
â”‚
â””â”€â”€ chats/               # å®¢æœèŠå¤©æ–‡ä»¶
    â””â”€â”€ {chat_id}/      # æŒ‰èŠå¤©IDåˆ†ç±»
        â””â”€â”€ {file_id}.pdf
```

## ğŸ” å­˜å‚¨é€»è¾‘

### å›¾ç‰‡ä¸Šä¼  (`/upload/image`)
- **ä»»åŠ¡èŠå¤©**ï¼šæä¾› `task_id` â†’ å­˜å‚¨åœ¨ `private_images/tasks/{task_id}/`
- **å®¢æœèŠå¤©**ï¼šæä¾› `chat_id` â†’ å­˜å‚¨åœ¨ `private_images/chats/{chat_id}/`

### æ–‡ä»¶ä¸Šä¼  (`/upload/file`)
- **ä»»åŠ¡èŠå¤©**ï¼šæä¾› `task_id` â†’ å­˜å‚¨åœ¨ `private_files/tasks/{task_id}/`
- **å®¢æœèŠå¤©**ï¼šæä¾› `chat_id` â†’ å­˜å‚¨åœ¨ `private_files/chats/{chat_id}/`

## ğŸ“‹ å®ç°ç»†èŠ‚

### 1. å›¾ç‰‡ç³»ç»Ÿ (`image_system.py`)
```python
# ä»»åŠ¡èŠå¤©å›¾ç‰‡
if task_id:
    image_dir = base_dir / "tasks" / str(task_id)
    
# å®¢æœèŠå¤©å›¾ç‰‡
elif chat_id:
    image_dir = base_dir / "chats" / chat_id
```

### 2. æ–‡ä»¶ç³»ç»Ÿ (`file_system.py`)
```python
# ä»»åŠ¡èŠå¤©æ–‡ä»¶
if task_id:
    task_dir = base_dir / "tasks" / str(task_id)
    file_path = task_dir / filename
    
# å®¢æœèŠå¤©æ–‡ä»¶
elif chat_id:
    chat_dir = base_dir / "chats" / chat_id
    file_path = chat_dir / filename
```

## âœ… æ€»ç»“

**æ˜¯çš„ï¼Œæ–‡ä»¶å’Œå›¾ç‰‡ä¸€æ ·ï¼Œéƒ½å­˜å‚¨åœ¨ç‰¹å®šçš„æ–‡ä»¶å¤¹é‡Œé¢ï¼š**

1. **ç›¸åŒçš„åˆ†ç±»æ–¹å¼**ï¼š
   - éƒ½æŒ‰ `task_id` æˆ– `chat_id` åˆ†ç±»
   - ä»»åŠ¡ç›¸å…³ï¼š`tasks/{task_id}/`
   - å®¢æœèŠå¤©ï¼š`chats/{chat_id}/`

2. **ä¸åŒçš„å­˜å‚¨ç›®å½•**ï¼š
   - å›¾ç‰‡ï¼š`uploads/private_images/`
   - æ–‡ä»¶ï¼š`uploads/private_files/`

3. **ç›¸åŒçš„å®‰å…¨æœºåˆ¶**ï¼š
   - éƒ½éœ€è¦ç­¾åURLè®¿é—®
   - éƒ½å­˜å‚¨åœ¨ç§æœ‰ç›®å½•
   - éƒ½æ”¯æŒæƒé™éªŒè¯

4. **ç›¸åŒçš„æ¸…ç†æœºåˆ¶**ï¼š
   - å¯¹è¯ç»“æŸæ—¶è‡ªåŠ¨æ¸…ç†ç›¸å…³æ–‡ä»¶
   - æŒ‰åˆ†ç±»ç›®å½•æ¸…ç†ï¼Œæé«˜æ•ˆç‡

## ğŸ¯ ä¼˜åŠ¿

1. **ç»„ç»‡æ¸…æ™°**ï¼šæŒ‰ä»»åŠ¡/èŠå¤©åˆ†ç±»ï¼Œä¾¿äºç®¡ç†
2. **æ¸…ç†é«˜æ•ˆ**ï¼šåˆ é™¤å¯¹è¯æ—¶ï¼Œç›´æ¥åˆ é™¤å¯¹åº”æ–‡ä»¶å¤¹
3. **æƒé™æ§åˆ¶**ï¼šç§æœ‰ç›®å½• + ç­¾åURLï¼Œç¡®ä¿å®‰å…¨
4. **ç»“æ„ç»Ÿä¸€**ï¼šæ–‡ä»¶å’Œå›¾ç‰‡ä½¿ç”¨ç›¸åŒçš„åˆ†ç±»é€»è¾‘

