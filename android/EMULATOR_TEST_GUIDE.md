# Android 虚拟机（模拟器）测试指南

## 📱 什么是 Android 模拟器？

Android 模拟器（AVD - Android Virtual Device）是在电脑上运行的虚拟 Android 设备，可以模拟真实手机的功能，用于测试应用。

## 🚀 快速开始

### 步骤 1: 打开设备管理器

1. 在 Android Studio 中，点击顶部菜单：`Tools > Device Manager`
2. 或者点击右侧边栏的设备管理器图标

### 步骤 2: 创建新的虚拟设备

1. 在设备管理器窗口中，点击 `Create Device` 按钮
2. 选择设备型号（推荐选择）：
   - **Pixel 5** - 性能好，推荐
   - **Pixel 6** - 较新版本
   - **Pixel 7** - 最新版本
   - 或其他你喜欢的型号
3. 点击 `Next`

### 步骤 3: 选择系统镜像

1. 选择一个系统镜像（推荐）：
   - **API 33 (Android 13)** - 稳定，推荐
   - **API 34 (Android 14)** - 较新
   - **API 35 (Android 15)** - 最新（如果可用）
2. 如果镜像未下载，点击 `Download` 下载
3. 下载完成后，选择该镜像
4. 点击 `Next`

### 步骤 4: 配置虚拟设备

1. **AVD Name**: 给模拟器起个名字（如 `Pixel_5_API_33`）
2. **Startup orientation**: 选择 `Portrait`（竖屏）或 `Landscape`（横屏）
3. **Graphics**: 
   - `Automatic` - 自动选择（推荐）
   - `Hardware - GLES 2.0` - 硬件加速（性能更好）
   - `Software - GLES 2.0` - 软件渲染（兼容性更好）
4. 点击 `Finish`

### 步骤 5: 启动模拟器

1. 在设备管理器列表中，找到刚创建的模拟器
2. 点击右侧的 **播放按钮（▶️）** 启动模拟器
3. 等待模拟器启动（首次启动可能需要几分钟）

## 🎯 运行应用

### 方法 1: 使用运行按钮

1. 确保模拟器已启动
2. 在 Android Studio 顶部工具栏，选择你的模拟器
3. 点击运行按钮（▶️）或按 `Shift + F10`
4. 等待应用编译和安装
5. 应用会自动在模拟器中启动

### 方法 2: 直接安装 APK

1. 先构建 APK：`Build > Build Bundle(s) / APK(s) > Build APK(s)`
2. 等待构建完成
3. 将 APK 拖拽到模拟器窗口中
4. 应用会自动安装并启动

## 🔧 模拟器操作技巧

### 基本操作

- **点击**: 鼠标左键点击
- **长按**: 鼠标左键按住不放
- **滑动**: 鼠标左键按住并拖动
- **返回**: 点击模拟器右侧的返回按钮，或按键盘 `Esc`
- **主页**: 点击主页按钮，或按键盘 `Home`
- **菜单**: 点击菜单按钮，或按键盘 `Menu`

### 键盘快捷键

- `Ctrl + M` - 打开菜单
- `Esc` - 返回
- `Home` - 主页
- `F2` - 返回
- `F3` - 菜单
- `F7` - 电源键
- `F8` - 旋转屏幕
- `Ctrl + F11` / `Ctrl + F12` - 旋转屏幕
- `Ctrl + P` - 截图

### 模拟器设置

1. 点击模拟器右侧的 **三个点（...）** 打开扩展控制面板
2. 可以调整：
   - **位置** - 模拟 GPS 位置
   - **电池** - 模拟电池状态
   - **网络** - 模拟网络速度
   - **电话** - 模拟来电
   - **短信** - 模拟短信
   - **相机** - 使用电脑摄像头
   - **指纹** - 模拟指纹识别

## 📊 性能优化

### 如果模拟器运行慢

1. **启用硬件加速**：
   - 在创建模拟器时选择 `Hardware - GLES 2.0`
   - 或在 AVD 配置中启用硬件加速

2. **增加内存**：
   - 编辑 AVD，增加 RAM 大小（推荐 2GB 或更多）

3. **使用 x86/x86_64 镜像**：
   - 选择 x86 或 x86_64 架构的镜像（比 ARM 快）

4. **关闭不需要的功能**：
   - 关闭动画效果
   - 减少后台应用

### 推荐配置

- **RAM**: 2GB - 4GB
- **VM heap**: 512MB
- **Graphics**: Hardware - GLES 2.0
- **Architecture**: x86_64（如果 CPU 支持）

## 🐛 常见问题解决

### 问题 1: 模拟器启动失败

**错误**: `HAXM is not installed` 或 `Intel HAXM is required`

**解决方法**:
1. 安装 Intel HAXM（如果使用 Intel CPU）
2. 或在创建 AVD 时选择 `Software - GLES 2.0`（软件渲染）

### 问题 2: 模拟器运行很慢

**解决方法**:
1. 启用硬件加速
2. 增加 RAM 分配
3. 关闭其他占用资源的程序
4. 使用 x86_64 镜像

### 问题 3: 应用无法连接到网络

**解决方法**:
1. 检查模拟器的网络设置
2. 确保电脑有网络连接
3. 检查防火墙设置
4. 在模拟器中打开浏览器测试网络

### 问题 4: 应用崩溃

**解决方法**:
1. 查看 Logcat 中的错误信息
2. 检查 API 地址是否正确
3. 检查权限是否已配置
4. 尝试清理并重新构建项目

### 问题 5: 模拟器黑屏

**解决方法**:
1. 关闭模拟器
2. 在设备管理器中删除该 AVD
3. 重新创建一个新的 AVD
4. 或尝试冷启动（Cold Boot）

## 🔍 调试技巧

### 使用 Logcat

1. 在 Android Studio 底部打开 `Logcat` 标签
2. 选择你的应用包名：`com.linku.app`
3. 可以查看：
   - 应用日志
   - 网络请求
   - 错误信息
   - WebSocket 连接状态

**过滤日志**:
- 在搜索框输入关键词，如 `WebSocket`、`API`、`Error`
- 或使用过滤器：`package:mine` 只看你的应用

### 使用断点调试

1. 在代码行号左侧点击设置断点
2. 运行应用（Debug 模式）
3. 程序会在断点处暂停
4. 可以查看：
   - 变量值
   - 调用栈
   - 表达式值

### 查看网络请求

1. 在 Logcat 中搜索 `OkHttp`
2. 可以看到所有网络请求的详细信息：
   - 请求 URL
   - 请求头
   - 请求体
   - 响应状态
   - 响应体

### 使用 ADB 命令

打开终端（Terminal），可以使用 ADB 命令：

```bash
# 查看连接的设备
adb devices

# 安装 APK
adb install app.apk

# 卸载应用
adb uninstall com.linku.app

# 查看日志
adb logcat

# 清除应用数据
adb shell pm clear com.linku.app

# 重启应用
adb shell am force-stop com.linku.app
adb shell am start -n com.linku.app/.MainActivity
```

## 📱 测试不同设备

### 创建多个模拟器

可以创建多个不同配置的模拟器来测试：

1. **不同屏幕尺寸**：
   - 小屏：Pixel 2
   - 中屏：Pixel 5
   - 大屏：Pixel 7 Pro

2. **不同 Android 版本**：
   - Android 7.0 (API 24) - 最低支持版本
   - Android 13 (API 33) - 推荐版本
   - Android 14 (API 34) - 最新版本

3. **不同分辨率**：
   - 720p、1080p、2K、4K

### 快速切换设备

1. 在运行应用前，在顶部工具栏选择不同的设备
2. 点击运行，应用会安装到选中的设备

## ✅ 测试清单

在开始测试前，确保：

- [ ] 模拟器已创建并可以正常启动
- [ ] 模拟器有网络连接（可以打开浏览器）
- [ ] 项目已正确配置（参考 `SETUP.md`）
- [ ] API 地址已配置（`https://api.link2ur.com`）
- [ ] 所有依赖已同步成功
- [ ] 项目可以编译（无红色错误）

## 🎯 测试流程

### 1. 基础功能测试

- [ ] 应用可以正常启动
- [ ] 登录界面正常显示
- [ ] 可以输入邮箱和密码
- [ ] 点击登录按钮有响应

### 2. 网络功能测试

- [ ] 可以成功登录（如果 API 配置正确）
- [ ] 登录后跳转到主页
- [ ] 可以加载任务列表
- [ ] 可以加载跳蚤市场商品
- [ ] WebSocket 可以连接（查看 Logcat）

### 3. UI 测试

- [ ] 所有页面正常显示
- [ ] 底部导航栏可以切换
- [ ] 列表可以滚动
- [ ] 图片可以加载
- [ ] 按钮可以点击

### 4. 功能测试

- [ ] 可以发布任务
- [ ] 可以发布跳蚤市场商品
- [ ] 可以查看消息
- [ ] 可以查看个人资料
- [ ] 可以退出登录

## 💡 实用技巧

### 快速重启应用

1. 在模拟器中，按 `Home` 键回到主页
2. 在 Android Studio 中，点击运行按钮
3. 应用会重新安装并启动

### 清除应用数据

1. 在模拟器中，打开 `设置 > 应用 > LinkU`
2. 点击 `存储`
3. 点击 `清除数据`
4. 重新启动应用（会回到登录界面）

### 截图

1. 在模拟器右侧点击相机图标
2. 或使用快捷键 `Ctrl + S`
3. 截图会保存到电脑

### 录制屏幕

1. 在模拟器右侧点击录像图标
2. 开始录制
3. 操作应用
4. 停止录制
5. 视频会保存到电脑

## 📚 相关文档

- [ANDROID_STUDIO_TEST_GUIDE.md](ANDROID_STUDIO_TEST_GUIDE.md) - 完整测试指南
- [SETUP.md](SETUP.md) - 项目设置
- [QUICK_START.md](QUICK_START.md) - 快速开始
- [API_CONFIG.md](API_CONFIG.md) - API 配置

## 🎉 开始测试

现在你已经知道如何使用模拟器了！按照以下步骤开始：

1. ✅ 创建模拟器
2. ✅ 启动模拟器
3. ✅ 运行应用
4. ✅ 开始测试

**提示**: 如果遇到任何问题，查看 Logcat 日志是最快的调试方法！

