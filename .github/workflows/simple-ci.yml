name: Simple CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  # æ£€æŸ¥ä»£ç è´¨é‡
  code-quality:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Check file structure
      run: |
        echo "ğŸ“ Project structure:"
        ls -la
        echo "ğŸ“ Backend structure:"
        ls -la backend/
        echo "ğŸ“ Frontend structure:"
        ls -la frontend/
    
    - name: Check configuration files
      run: |
        echo "ğŸ”§ Checking configuration files..."
        echo "âœ… Dockerfile exists: $([ -f Dockerfile ] && echo 'Yes' || echo 'No')"
        echo "âœ… railway.json exists: $([ -f railway.json ] && echo 'Yes' || echo 'No')"
        echo "âœ… vercel.json exists: $([ -f vercel.json ] && echo 'Yes' || echo 'No')"
        echo "âœ… frontend/package.json exists: $([ -f frontend/package.json ] && echo 'Yes' || echo 'No')"
        echo "âœ… backend/requirements.txt exists: $([ -f backend/requirements.txt ] && echo 'Yes' || echo 'No')"
    
    - name: Validate JSON files
      run: |
        echo "ğŸ” Validating JSON configuration files..."
        python -m json.tool railway.json > /dev/null && echo "âœ… railway.json is valid" || echo "âŒ railway.json is invalid"
        python -m json.tool vercel.json > /dev/null && echo "âœ… vercel.json is valid" || echo "âŒ vercel.json is invalid"
    
    - name: Check for common issues
      run: |
        echo "ğŸ” Checking for common issues..."
        # æ£€æŸ¥æ˜¯å¦æœ‰æ•æ„Ÿä¿¡æ¯æ³„éœ²
        if grep -r "password\|secret\|key" --include="*.py" --include="*.js" --include="*.ts" --include="*.json" . | grep -v node_modules | grep -v __pycache__ | grep -v ".git"; then
          echo "âš ï¸  Warning: Potential sensitive information found"
        else
          echo "âœ… No obvious sensitive information found"
        fi
        
        # æ£€æŸ¥æ–‡ä»¶å¤§å°
        echo "ğŸ“Š File sizes:"
        find . -name "*.py" -o -name "*.js" -o -name "*.ts" | head -10 | xargs ls -lh
    
    - name: Deployment status
      run: |
        echo "ğŸš€ Deployment status:"
        echo "Backend: Railway (automatic deployment on push to main)"
        echo "Frontend: Vercel (automatic deployment on push to main)"
        echo "âœ… CI/CD pipeline is working!"
