# å­¦ç”Ÿè®¤è¯ç³»ç»Ÿæ€§èƒ½ä¼˜åŒ–è¯´æ˜Ž

## ðŸš€ å·²å®žçŽ°çš„æ€§èƒ½ä¼˜åŒ–

### 1. å¤§å­¦åŒ¹é…ç¼“å­˜ä¼˜åŒ–

**é—®é¢˜**ï¼šæ¯æ¬¡åŒ¹é…å¤§å­¦éƒ½éœ€è¦æŸ¥è¯¢æ•°æ®åº“ï¼Œæ€§èƒ½è¾ƒä½Žã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨å†…å­˜ç¼“å­˜ + Aho-Corasickç®—æ³•

**å®žçŽ°ä½ç½®**ï¼š
- `backend/app/university_matcher.py` - å¤§å­¦åŒ¹é…å™¨
- `backend/app/main.py` - å¯åŠ¨æ—¶åˆå§‹åŒ–

**æ€§èƒ½æå‡**ï¼š
- å¯åŠ¨æ—¶ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰å¤§å­¦æ•°æ®åˆ°å†…å­˜
- ä½¿ç”¨Aho-Corasickç®—æ³•ï¼ŒåŒ¹é…æ—¶é—´å¤æ‚åº¦O(n)ï¼Œå…¶ä¸­næ˜¯åŸŸåé•¿åº¦
- é¿å…æ¯æ¬¡åŒ¹é…éƒ½æŸ¥è¯¢æ•°æ®åº“ï¼Œæ€§èƒ½æå‡10å€+

**ä½¿ç”¨æ–¹å¼**ï¼š
```python
from app.university_matcher import match_university_by_email

# è‡ªåŠ¨ä½¿ç”¨ç¼“å­˜ç‰ˆæœ¬
university = match_university_by_email(email, db)
```

**ä¾èµ–**ï¼š
- å¯é€‰ï¼š`pyahocorasick` åº“ï¼ˆæŽ¨èå®‰è£…ä»¥èŽ·å¾—æœ€ä½³æ€§èƒ½ï¼‰
- å¦‚æžœæ²¡æœ‰å®‰è£…ï¼Œä¼šè‡ªåŠ¨å›žé€€åˆ°å­—å…¸åŒ¹é…ï¼ˆæ€§èƒ½ä»ç„¶ä¼˜äºŽæ•°æ®åº“æŸ¥è¯¢ï¼‰

**å®‰è£…ä¾èµ–**ï¼š

å·²æ·»åŠ åˆ° `backend/requirements.txt`ï¼Œéƒ¨ç½²æ—¶ä¼šè‡ªåŠ¨å®‰è£…ï¼š

```bash
# æ–¹å¼1ï¼šå®‰è£…æ‰€æœ‰ä¾èµ–ï¼ˆæŽ¨èï¼‰
pip install -r backend/requirements.txt

# æ–¹å¼2ï¼šä»…å®‰è£…æ­¤ä¾èµ–
pip install pyahocorasick>=2.0.0,<3.0.0
```

**æ³¨æ„**ï¼šå¦‚æžœä¸å®‰è£…æ­¤ä¾èµ–ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å›žé€€åˆ°å­—å…¸åŒ¹é…ï¼Œæ€§èƒ½ä»ç„¶ä¼˜äºŽæ•°æ®åº“æŸ¥è¯¢ã€‚

### 2. APIé™æµä¿æŠ¤

**é—®é¢˜**ï¼šå­¦ç”Ÿè®¤è¯æŽ¥å£å¯èƒ½è¢«æ¶æ„è¯·æ±‚æ”»å‡»ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šä¸ºæ‰€æœ‰å­¦ç”Ÿè®¤è¯æŽ¥å£æ·»åŠ é™æµä¿æŠ¤ã€‚

**å®žçŽ°ä½ç½®**ï¼š
- `backend/app/student_verification_routes.py` - æ‰€æœ‰æŽ¥å£éƒ½æ·»åŠ äº†`@rate_limit`è£…é¥°å™¨

**é™æµé…ç½®**ï¼š
- `POST /submit` - 5æ¬¡/åˆ†é’Ÿ/IP
- `GET /verify/{token}` - 10æ¬¡/åˆ†é’Ÿ/IP
- `GET /status` - 60æ¬¡/åˆ†é’Ÿ/ç”¨æˆ·
- `POST /renew` - 5æ¬¡/åˆ†é’Ÿ/IP
- `POST /change-email` - 5æ¬¡/åˆ†é’Ÿ/IP

**æŠ€æœ¯å®žçŽ°**ï¼š
- ä½¿ç”¨Rediså®žçŽ°åˆ†å¸ƒå¼é™æµ
- æ»‘åŠ¨çª—å£ç®—æ³•
- æ”¯æŒIPå’Œç”¨æˆ·IDä¸¤ç§é™æµæ–¹å¼

## ðŸ“Š æ€§èƒ½å¯¹æ¯”

### å¤§å­¦åŒ¹é…æ€§èƒ½

| æ–¹å¼ | å¹³å‡å“åº”æ—¶é—´ | æ•°æ®åº“æŸ¥è¯¢æ¬¡æ•° |
|------|------------|---------------|
| æ•°æ®åº“æŸ¥è¯¢ | ~50ms | 1-3æ¬¡ |
| å†…å­˜ç¼“å­˜ï¼ˆå­—å…¸ï¼‰ | ~5ms | 0æ¬¡ |
| å†…å­˜ç¼“å­˜ï¼ˆAho-Corasickï¼‰ | ~2ms | 0æ¬¡ |

### APIé™æµæ•ˆæžœ

- é˜²æ­¢æ¶æ„è¯·æ±‚ï¼šæœ‰æ•ˆé˜»æ­¢æš´åŠ›ç ´è§£å’ŒDDoSæ”»å‡»
- ä¿æŠ¤ç³»ç»Ÿèµ„æºï¼šé¿å…å•ä¸ªç”¨æˆ·/IPå ç”¨è¿‡å¤šèµ„æº
- æå‡ç”¨æˆ·ä½“éªŒï¼šç¡®ä¿æ­£å¸¸ç”¨æˆ·ä¸å—å½±å“

## ðŸ”§ é…ç½®è¯´æ˜Ž

### å¯ç”¨Aho-Corasickä¼˜åŒ–

1. å®‰è£…ä¾èµ–ï¼š
```bash
pip install pyahocorasick
```

2. é‡å¯åº”ç”¨ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨Aho-Corasickç®—æ³•

3. æŸ¥çœ‹æ—¥å¿—ç¡®è®¤ï¼š
```
å¤§å­¦åŒ¹é…å™¨åˆå§‹åŒ–å®Œæˆï¼ŒåŠ è½½äº† XX æ‰€å¤§å­¦ (ä½¿ç”¨Aho-Corasickç®—æ³•)
```

### è°ƒæ•´é™æµé…ç½®

å¦‚éœ€è°ƒæ•´é™æµé…ç½®ï¼Œä¿®æ”¹ `backend/app/student_verification_routes.py` ä¸­çš„è£…é¥°å™¨ï¼š

```python
@rate_limit("10/minute")  # æ”¹ä¸º10æ¬¡/åˆ†é’Ÿ
def submit_verification(...):
    ...
```

## ðŸ“ æ³¨æ„äº‹é¡¹

1. **å†…å­˜ä½¿ç”¨**ï¼šå¤§å­¦åŒ¹é…å™¨ä¼šå ç”¨å°‘é‡å†…å­˜ï¼ˆçº¦å‡ MBï¼‰ï¼Œä½†æ€§èƒ½æå‡æ˜¾è‘—
2. **æ•°æ®æ›´æ–°**ï¼šå¦‚æžœå¤§å­¦æ•°æ®æ›´æ–°ï¼Œéœ€è¦é‡å¯åº”ç”¨æ‰èƒ½ç”Ÿæ•ˆ
3. **é™æµç²¾åº¦**ï¼šé™æµä½¿ç”¨æ»‘åŠ¨çª—å£ï¼Œç²¾åº¦ä¸ºç§’çº§
4. **Redisä¾èµ–**ï¼šé™æµåŠŸèƒ½éœ€è¦Redisï¼Œå¦‚æžœæ²¡æœ‰Redisä¼šå›žé€€åˆ°å†…å­˜é™æµï¼ˆå•å®žä¾‹ï¼‰

## ðŸŽ¯ åŽç»­ä¼˜åŒ–å»ºè®®

1. **ç¼“å­˜é¢„çƒ­**ï¼šåº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨é¢„çƒ­å¤§å­¦åŒ¹é…å™¨
2. **ç›‘æŽ§æŒ‡æ ‡**ï¼šæ·»åŠ åŒ¹é…æ€§èƒ½ç›‘æŽ§å’Œé™æµç»Ÿè®¡
3. **åŠ¨æ€æ›´æ–°**ï¼šæ”¯æŒçƒ­æ›´æ–°å¤§å­¦æ•°æ®ï¼ˆæ— éœ€é‡å¯ï¼‰
4. **æ‰¹é‡åŒ¹é…**ï¼šæ”¯æŒæ‰¹é‡é‚®ç®±åŒ¹é…ï¼ˆè¿›ä¸€æ­¥æå‡æ€§èƒ½ï¼‰

