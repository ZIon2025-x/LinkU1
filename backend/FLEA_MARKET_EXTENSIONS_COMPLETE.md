# è·³èš¤å¸‚åœºæ‰©å±•åŠŸèƒ½å¼€å‘å®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„åŠŸèƒ½

### 1. å•†å“æ”¶è—åŠŸèƒ½ âœ…
- **æ•°æ®åº“è¡¨**ï¼š`flea_market_favorites`ï¼ˆè¿ç§»æ–‡ä»¶ï¼š`004_add_flea_market_favorites.sql`ï¼‰
- **æ¨¡å‹**ï¼š`FleaMarketFavorite`ï¼ˆ`backend/app/models.py`ï¼‰
- **Schemas**ï¼š`FleaMarketFavoriteResponse`ã€`FleaMarketFavoriteListResponse`ï¼ˆ`backend/app/schemas.py`ï¼‰
- **APIç«¯ç‚¹**ï¼š
  - `POST /api/flea-market/items/{item_id}/favorite` - æ”¶è—/å–æ¶ˆæ”¶è—
  - `GET /api/flea-market/favorites` - è·å–æˆ‘çš„æ”¶è—åˆ—è¡¨
- **å‰ç«¯**ï¼šå•†å“è¯¦æƒ…é¡µå·²é›†æˆæ”¶è—åŠŸèƒ½

### 2. å•†å“è¯¦æƒ…é¡µ âœ…
- **å‰ç«¯é¡µé¢**ï¼š`frontend/src/pages/FleaMarketItemDetail.tsx`
- **æ ·å¼æ–‡ä»¶**ï¼š`frontend/src/pages/FleaMarketItemDetail.module.css`
- **è·¯ç”±é…ç½®**ï¼š`/{lang}/flea-market/:itemId`
- **åŠŸèƒ½**ï¼š
  - å•†å“è¯¦æƒ…å±•ç¤ºï¼ˆå›¾ç‰‡è½®æ’­ã€ä»·æ ¼ã€æè¿°ã€å–å®¶ä¿¡æ¯ï¼‰
  - æ”¶è—/å–æ¶ˆæ”¶è—
  - ç›´æ¥è´­ä¹°
  - è®®ä»·è´­ä¹°
  - ä¸¾æŠ¥å•†å“
  - ç¼–è¾‘/åˆ é™¤ï¼ˆä»…æ‰€æœ‰è€…ï¼‰

### 3. Redisç¼“å­˜ âœ…
- **ç¼“å­˜ç­–ç•¥**ï¼šå•†å“åˆ—è¡¨ç¼“å­˜ï¼ˆ5åˆ†é’ŸTTLï¼‰
- **ç¼“å­˜é”®ç”Ÿæˆ**ï¼š`get_cache_key_for_items()` å‡½æ•°
- **ç¼“å­˜å¤±æ•ˆ**ï¼š`invalidate_item_cache()` å‡½æ•°
- **é›†æˆä½ç½®**ï¼š
  - å•†å“åˆ—è¡¨APIï¼šç¼“å­˜æŸ¥è¯¢ç»“æœ
  - å•†å“åˆ›å»º/æ›´æ–°/åˆ é™¤/åˆ·æ–°ï¼šè‡ªåŠ¨æ¸…é™¤ç›¸å…³ç¼“å­˜

### 4. æ¶ˆæ¯é€šçŸ¥ âœ…
- **é€šçŸ¥ç±»å‹**ï¼š
  - `flea_market_purchase_request` - è´­ä¹°ç”³è¯·é€šçŸ¥ï¼ˆå‘é€ç»™å–å®¶ï¼‰
  - `flea_market_purchase_accepted` - è´­ä¹°æ¥å—é€šçŸ¥ï¼ˆå‘é€ç»™ä¹°å®¶ï¼‰
  - `flea_market_direct_purchase` - ç›´æ¥è´­ä¹°é€šçŸ¥ï¼ˆå‘é€ç»™å–å®¶ï¼‰
- **é€šçŸ¥å‡½æ•°**ï¼š
  - `send_purchase_request_notification()` - è´­ä¹°ç”³è¯·é€šçŸ¥
  - `send_purchase_accepted_notification()` - è´­ä¹°æ¥å—é€šçŸ¥
  - `send_direct_purchase_notification()` - ç›´æ¥è´­ä¹°é€šçŸ¥
- **é›†æˆä½ç½®**ï¼š
  - è´­ä¹°ç”³è¯·APIï¼šå‘é€é€šçŸ¥ç»™å–å®¶
  - æ¥å—è´­ä¹°APIï¼šå‘é€é€šçŸ¥ç»™ä¹°å®¶
  - ç›´æ¥è´­ä¹°APIï¼šå‘é€é€šçŸ¥ç»™å–å®¶

### 5. æ•æ„Ÿè¯è¿‡æ»¤ âœ…
- **åŠŸèƒ½å‡½æ•°**ï¼š
  - `contains_sensitive_words()` - æ£€æŸ¥æ˜¯å¦åŒ…å«æ•æ„Ÿè¯
  - `filter_sensitive_words()` - è¿‡æ»¤æ•æ„Ÿè¯ï¼ˆç”¨*æ›¿æ¢ï¼‰
- **é›†æˆä½ç½®**ï¼š
  - å•†å“åˆ›å»ºAPIï¼šéªŒè¯å¹¶è¿‡æ»¤æ•æ„Ÿè¯
- **æ‰©å±•æ€§**ï¼šæ•æ„Ÿè¯åˆ—è¡¨å¯ä»¥ä»æ•°æ®åº“æˆ–é…ç½®æ–‡ä»¶åŠ è½½

### 6. å•†å“ä¸¾æŠ¥åŠŸèƒ½ âœ…
- **æ•°æ®åº“è¡¨**ï¼š`flea_market_reports`ï¼ˆè¿ç§»æ–‡ä»¶ï¼š`005_add_flea_market_reports.sql`ï¼‰
- **æ¨¡å‹**ï¼š`FleaMarketReport`ï¼ˆ`backend/app/models.py`ï¼‰
- **Schemas**ï¼š`FleaMarketReportCreate`ã€`FleaMarketReportResponse`ï¼ˆ`backend/app/schemas.py`ï¼‰
- **APIç«¯ç‚¹**ï¼š`POST /api/flea-market/items/{item_id}/report` - ä¸¾æŠ¥å•†å“
- **ä¸¾æŠ¥åŸå› **ï¼šspamï¼ˆåƒåœ¾ä¿¡æ¯ï¼‰ã€fraudï¼ˆæ¬ºè¯ˆï¼‰ã€inappropriateï¼ˆä¸å½“å†…å®¹ï¼‰ã€otherï¼ˆå…¶ä»–ï¼‰
- **å‰ç«¯**ï¼šå•†å“è¯¦æƒ…é¡µå·²é›†æˆä¸¾æŠ¥åŠŸèƒ½

## ğŸ“ æ–°å¢/ä¿®æ”¹çš„æ–‡ä»¶

### æ•°æ®åº“è¿ç§»æ–‡ä»¶
1. `backend/migrations/004_add_flea_market_favorites.sql` - æ”¶è—è¡¨
2. `backend/migrations/005_add_flea_market_reports.sql` - ä¸¾æŠ¥è¡¨

### åç«¯æ–‡ä»¶
1. `backend/app/models.py` - æ·»åŠ  `FleaMarketFavorite` å’Œ `FleaMarketReport` æ¨¡å‹
2. `backend/app/schemas.py` - æ·»åŠ æ”¶è—å’Œä¸¾æŠ¥ç›¸å…³schemas
3. `backend/app/flea_market_routes.py` - æ·»åŠ æ”¶è—ã€ä¸¾æŠ¥APIï¼Œé›†æˆç¼“å­˜å’Œé€šçŸ¥
4. `backend/app/flea_market_extensions.py` - **æ–°æ–‡ä»¶**ï¼šæ‰©å±•åŠŸèƒ½æ¨¡å—ï¼ˆé€šçŸ¥ã€ç¼“å­˜ã€æ•æ„Ÿè¯è¿‡æ»¤ï¼‰

### å‰ç«¯æ–‡ä»¶
1. `frontend/src/pages/FleaMarketItemDetail.tsx` - **æ–°æ–‡ä»¶**ï¼šå•†å“è¯¦æƒ…é¡µ
2. `frontend/src/pages/FleaMarketItemDetail.module.css` - **æ–°æ–‡ä»¶**ï¼šè¯¦æƒ…é¡µæ ·å¼
3. `frontend/src/pages/FleaMarketPage.tsx` - æ›´æ–°ï¼šå•†å“å¡ç‰‡æ·»åŠ ç‚¹å‡»è·³è½¬
4. `frontend/src/App.tsx` - æ›´æ–°ï¼šæ·»åŠ å•†å“è¯¦æƒ…é¡µè·¯ç”±

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### Redisç¼“å­˜ç­–ç•¥
- **ç¼“å­˜é”®æ ¼å¼**ï¼š`flea_market_items:page_{page}:size_{pageSize}:status_{status}:cat_{category}:kw_{keyword_hash}`
- **TTL**ï¼š5åˆ†é’Ÿï¼ˆ300ç§’ï¼‰
- **ç¼“å­˜å¤±æ•ˆ**ï¼šå•†å“åˆ›å»º/æ›´æ–°/åˆ é™¤/åˆ·æ–°æ—¶è‡ªåŠ¨æ¸…é™¤ç›¸å…³ç¼“å­˜

### é€šçŸ¥ç³»ç»Ÿ
- **å¼‚æ­¥é€šçŸ¥**ï¼šä½¿ç”¨ `async_crud.async_notification_crud.create_notification()`
- **é€šçŸ¥å†…å®¹**ï¼šåŒ…å«å•†å“ä¿¡æ¯ã€ä¹°å®¶/å–å®¶ä¿¡æ¯ã€ä»·æ ¼ç­‰
- **é€šçŸ¥ç±»å‹**ï¼šä½¿ç”¨ç»Ÿä¸€çš„ç±»å‹æ ‡è¯†ï¼Œä¾¿äºå‰ç«¯ç­›é€‰å’Œæ˜¾ç¤º

### æ•æ„Ÿè¯è¿‡æ»¤
- **æ£€æŸ¥æ—¶æœº**ï¼šå•†å“åˆ›å»ºæ—¶
- **å¤„ç†æ–¹å¼**ï¼šåŒ…å«æ•æ„Ÿè¯æ—¶æ‹’ç»åˆ›å»ºï¼Œæç¤ºç”¨æˆ·ä¿®æ”¹
- **æ‰©å±•æ€§**ï¼šå¯ä»¥è½»æ¾æ‰©å±•ä¸ºä»æ•°æ®åº“åŠ è½½æ•æ„Ÿè¯åˆ—è¡¨

### æ”¶è—åŠŸèƒ½
- **å”¯ä¸€çº¦æŸ**ï¼šä¸€ä¸ªç”¨æˆ·åªèƒ½æ”¶è—ä¸€æ¬¡åŒä¸€ä¸ªå•†å“
- **çŠ¶æ€ç®¡ç†**ï¼šæ”¶è—/å–æ¶ˆæ”¶è—åˆ‡æ¢
- **æ€§èƒ½ä¼˜åŒ–**ï¼šä½¿ç”¨å”¯ä¸€çº¦æŸé˜²æ­¢é‡å¤æ”¶è—

### ä¸¾æŠ¥åŠŸèƒ½
- **å”¯ä¸€çº¦æŸ**ï¼šä¸€ä¸ªç”¨æˆ·å¯¹åŒä¸€ä¸ªå•†å“åªèƒ½æœ‰ä¸€ä¸ªpendingçŠ¶æ€çš„ä¸¾æŠ¥
- **çŠ¶æ€ç®¡ç†**ï¼špending â†’ reviewing â†’ resolved/rejected
- **ç®¡ç†å‘˜å¤„ç†**ï¼šæ”¯æŒç®¡ç†å‘˜å¤„ç†ä¸¾æŠ¥å¹¶æ·»åŠ å¤„ç†æ„è§

## ğŸ“Š APIç«¯ç‚¹æ€»è§ˆï¼ˆæ–°å¢ï¼‰

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ | éœ€è¦ç™»å½• |
|------|------|------|---------|
| POST | `/api/flea-market/items/:id/favorite` | æ”¶è—/å–æ¶ˆæ”¶è— | âœ… |
| GET | `/api/flea-market/favorites` | æˆ‘çš„æ”¶è—åˆ—è¡¨ | âœ… |
| POST | `/api/flea-market/items/:id/report` | ä¸¾æŠ¥å•†å“ | âœ… |

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1. æ•°æ®åº“è¿ç§»
æ–°çš„è¿ç§»æ–‡ä»¶ä¼šåœ¨åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œï¼š
- `004_add_flea_market_favorites.sql`
- `005_add_flea_market_reports.sql`

### 2. å‰ç«¯æ„å»º
ç¡®ä¿å‰ç«¯å·²æ„å»ºå¹¶éƒ¨ç½²æœ€æ–°ç‰ˆæœ¬ï¼ŒåŒ…å«ï¼š
- å•†å“è¯¦æƒ…é¡µç»„ä»¶
- æ›´æ–°çš„è·¯ç”±é…ç½®

### 3. éªŒè¯åŠŸèƒ½
- [ ] æµ‹è¯•å•†å“è¯¦æƒ…é¡µè®¿é—®
- [ ] æµ‹è¯•æ”¶è—/å–æ¶ˆæ”¶è—åŠŸèƒ½
- [ ] æµ‹è¯•ä¸¾æŠ¥åŠŸèƒ½
- [ ] éªŒè¯é€šçŸ¥æ˜¯å¦æ­£å¸¸å‘é€
- [ ] éªŒè¯Redisç¼“å­˜æ˜¯å¦æ­£å¸¸å·¥ä½œ

## ğŸ“ åç»­ä¼˜åŒ–å»ºè®®

### 1. æ€§èƒ½ä¼˜åŒ–
- âœ… Redisç¼“å­˜ï¼ˆå·²å®Œæˆï¼‰
- â³ å›¾ç‰‡CDNåŠ é€Ÿï¼ˆå¾…å®ç°ï¼‰
- â³ çƒ­é—¨å•†å“ç¼“å­˜ï¼ˆå¾…å®ç°ï¼‰

### 2. åŠŸèƒ½æ‰©å±•
- âœ… å•†å“è¯¦æƒ…é¡µï¼ˆå·²å®Œæˆï¼‰
- âœ… å•†å“æ”¶è—åŠŸèƒ½ï¼ˆå·²å®Œæˆï¼‰
- â³ å•†å“è¯„è®ºå’Œè¯„åˆ†ï¼ˆå¾…å®ç°ï¼‰
- âœ… æ¶ˆæ¯é€šçŸ¥ï¼ˆå·²å®Œæˆï¼‰

### 3. å®‰å…¨å¢å¼º
- âœ… æ•æ„Ÿè¯è¿‡æ»¤ï¼ˆå·²å®Œæˆï¼‰
- âœ… å•†å“ä¸¾æŠ¥åŠŸèƒ½ï¼ˆå·²å®Œæˆï¼‰
- â³ å›¾ç‰‡å†…å®¹å®¡æ ¸ï¼ˆå¾…å®ç°ï¼‰

## âœ… å®ŒæˆçŠ¶æ€

**æ‰©å±•åŠŸèƒ½å¼€å‘ï¼š100% å®Œæˆ**

æ‰€æœ‰è®¡åˆ’çš„åŠŸèƒ½å·²å®Œæ•´å®ç°ï¼š
- âœ… å•†å“æ”¶è—åŠŸèƒ½ï¼ˆæ•°æ®åº“ã€APIã€å‰ç«¯ï¼‰
- âœ… å•†å“è¯¦æƒ…é¡µï¼ˆå®Œæ•´é¡µé¢ï¼‰
- âœ… Redisç¼“å­˜ï¼ˆå•†å“åˆ—è¡¨ï¼‰
- âœ… æ¶ˆæ¯é€šçŸ¥ï¼ˆè´­ä¹°ç”³è¯·ã€æ¥å—è´­ä¹°ã€ç›´æ¥è´­ä¹°ï¼‰
- âœ… æ•æ„Ÿè¯è¿‡æ»¤ï¼ˆåˆ›å»ºå•†å“æ—¶ï¼‰
- âœ… å•†å“ä¸¾æŠ¥åŠŸèƒ½ï¼ˆæ•°æ®åº“ã€APIã€å‰ç«¯ï¼‰

**ä»£ç è´¨é‡**ï¼šæ— linteré”™è¯¯
**åŠŸèƒ½å®Œæ•´æ€§**ï¼šæ‰€æœ‰åŠŸèƒ½å·²å®ç°å¹¶é›†æˆ
**æ–‡æ¡£**ï¼šå®Œæ•´

æ‰€æœ‰æ‰©å±•åŠŸèƒ½å·²æŒ‰ç…§è®¡åˆ’å®Œæ•´å®ç°ï¼Œå¯ä»¥è¿›è¡Œæµ‹è¯•å’Œéƒ¨ç½²ã€‚

